(window.webpackJsonp=window.webpackJsonp||[]).push([[107],{"./client/components/infinite-list/index.jsx":function(e,t,o){"use strict";var i=o("./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=o.n(i),r=o("./node_modules/@babel/runtime/helpers/createClass.js"),n=o.n(r),l=o("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),h=o.n(l),d=o("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),a=o.n(d),c=o("./node_modules/@babel/runtime/helpers/inherits.js"),p=o.n(c),u=o("./node_modules/debug/src/browser.js"),m=o.n(u),g=o("./node_modules/lodash/lodash.js"),f=o("./node_modules/page/page.js"),H=o.n(f),x=o("./node_modules/prop-types/index.js"),v=o.n(x),R=o("./node_modules/react/index.js"),I=o.n(R),b=o("./node_modules/react-dom/index.js"),P=o.n(b),w=o("./client/lib/detect-history-navigation/index.js"),S=m()("calypso:infinite-list:scroll-store"),y={leading:!1},_=new Map,L=new Map,T={getPositions:function(e){var t=_.get(e);return S("getting positions:",e,t),t},storePositions:Object(g.throttle)(function(e,t){S("storing positions:",e,t),_.set(e,t)},1e3,y),getScrollTop:function(e){var t=L.get(e);return S("getting scrollTop:",e,t),t},storeScrollTop:Object(g.throttle)(function(e,t){S("storing scrollTop:",e,t),L.set(e,t)},1e3,y)},k=T,C=m()("calypso:infinite-list:helper"),B=function(){function e(t){s()(this,e),this.boundsForRef=t,this.itemHeights={},this.contextHeight=null,this.topHideLevelHard=null,this.topHideLevelSoft=null,this.bottomHideLevelHard=null,this.bottomHideLevelSoft=null,this.bottomHideLevelUltraSoft=null,this.props=null,this.scrollPosition=null,this.containerTop=null,this.topPlaceholderHeight=null,this.bottomPlaceholderHeight=null,this.containerBottom=null,this.stateUpdated=null,this.firstRenderedIndex=null,this.lastRenderedIndex=null}return n()(e,[{key:"storedItemHeight",value:function(e){var t=this.props.guessedItemHeight;return e in this.itemHeights&&(t=this.itemHeights[e]),t}},{key:"forEachInRow",value:function(e,t,o){if("function"==typeof t){o&&(t=t.bind(o));for(var i=e-e%this.props.itemsPerRow,s=Math.min(i+this.props.itemsPerRow,this.props.items.length)-1,r=i;r<=s;r++)t(this.props.items[r],r)}}},{key:"storeRowItemHeights",value:function(e,t){this.forEachInRow(t,function(t){var o,i=this.props.getItemRef(t),s=this.boundsForRef(i);o=s?"bottom"===e?this.containerBottom-this.bottomPlaceholderHeight-s.top:s.bottom-(this.containerTop+this.topPlaceholderHeight):this.props.guessedItemHeight,this.itemHeights[i]=o},this)}},{key:"deleteRowItemHeights",value:function(e){var t=this;this.forEachInRow(e,function(e){var o=t.props.getItemRef(e);delete t.itemHeights[o]},this)}},{key:"getRowHeight",value:function(e){var t=this,o=0;return this.forEachInRow(e,function(e){var i=t.props.getItemRef(e),s=t.storedItemHeight(i);o=Math.max(o,s)},this),o}},{key:"updateContextHeight",value:function(e){this.contextHeight!==e&&(this.contextHeight=e,this.topHideLevelHard=Math.min(-1*e,-5*this.props.guessedItemHeight),this.topHideLevelSoft=Math.min(-2*e,-10*this.props.guessedItemHeight),this.bottomHideLevelHard=e+Math.max(e,5*this.props.guessedItemHeight),this.bottomHideLevelSoft=e+Math.max(2*e,10*this.props.guessedItemHeight),this.bottomHideLevelUltraSoft=e+Math.max(3*e,15*this.props.guessedItemHeight))}},{key:"initialLastRenderedIndex",value:function(){return Math.min(this.props.items.length-1,Math.floor(this.bottomHideLevelSoft/this.props.guessedItemHeight)-1)}},{key:"updatePlaceholderDimensions",value:function(){var e=this.boundsForRef("topPlaceholder"),t=this.boundsForRef("bottomPlaceholder");this.topPlaceholderHeight=e.height,this.containerTop=e.top,this.bottomPlaceholderHeight=t.height,this.containerBottom=t.bottom}},{key:"scrollChecks",value:function(e){this.reset(e),this.adjustLastRenderedIndex(),this.shouldHideItemsAbove()?this.hideItemsAbove():this.shouldShowItemsAbove()&&this.showItemsAbove(),this.shouldHideItemsBelow()?this.hideItemsBelow():this.shouldShowItemsBelow()&&this.showItemsBelow(),this.shouldLoadNextPage()&&this.loadNextPage()}},{key:"reset",value:function(e){this.stateUpdated=!1,this.firstRenderedIndex=e.firstRenderedIndex,this.lastRenderedIndex=e.lastRenderedIndex}},{key:"adjustLastRenderedIndex",value:function(){var e=this.initialLastRenderedIndex(),t=this.lastRenderedIndex||0,o=this.firstRenderedIndex||0,i=this.props.items.length,s=t;0===i&&(s=-1),t>=i&&(s=Math.min(o+e,i-1)),-1===s&&i>0&&0===o&&(s=e),s!==this.lastRenderedIndex&&(this.stateUpdated=!0,this.lastRenderedIndex=s)}},{key:"shouldHideItemsAbove",value:function(){return this.containerTop+this.topPlaceholderHeight<this.topHideLevelSoft}},{key:"hideItemsAbove",value:function(){for(var e,t;this.firstRenderedIndex<this.props.items.length;){if(this.storeRowItemHeights("top",this.firstRenderedIndex),e=this.getRowHeight(this.firstRenderedIndex),t=this.containerTop+this.topPlaceholderHeight+e,t>this.topHideLevelHard){this.deleteRowItemHeights(this.firstRenderedIndex);break}this.topPlaceholderHeight+=e,this.firstRenderedIndex+=this.props.itemsPerRow,this.stateUpdated=!0,C("hiding top item",e,this.topPlaceholderHeight)}}},{key:"shouldShowItemsAbove",value:function(){return this.containerTop+this.topPlaceholderHeight>this.topHideLevelHard}},{key:"showItemsAbove",value:function(){for(var e,t;this.firstRenderedIndex>0&&(e=this.getRowHeight(this.firstRenderedIndex-this.props.itemsPerRow),t=this.containerTop+this.topPlaceholderHeight-e,!(t<this.topHideLevelSoft));)this.deleteRowItemHeights(this.firstRenderedIndex-this.props.itemsPerRow),this.firstRenderedIndex-=this.props.itemsPerRow,this.firstRenderedIndex=Math.max(0,this.firstRenderedIndex),this.firstRenderedIndex<=0?this.topPlaceholderHeight=0:this.topPlaceholderHeight=Math.max(0,this.topPlaceholderHeight-e),this.stateUpdated=!0,C("showing top item",e,this.topPlaceholderHeight)}},{key:"shouldHideItemsBelow",value:function(){var e=this.containerBottom-this.bottomPlaceholderHeight;return e>this.bottomHideLevelUltraSoft}},{key:"hideItemsBelow",value:function(){for(var e,t;this.lastRenderedIndex>=0;){if(this.storeRowItemHeights("bottom",this.lastRenderedIndex),t=this.getRowHeight(this.lastRenderedIndex),e=this.containerBottom-this.bottomPlaceholderHeight-t,e<this.bottomHideLevelHard){this.deleteRowItemHeights(this.lastRenderedIndex);break}this.bottomPlaceholderHeight+=t,this.lastRenderedIndex-=this.props.itemsPerRow,this.stateUpdated=!0,C("hiding bottom item",t,this.bottomPlaceholderHeight)}}},{key:"shouldShowItemsBelow",value:function(){var e=this.containerBottom-this.bottomPlaceholderHeight;return e<this.bottomHideLevelHard}},{key:"showItemsBelow",value:function(){for(var e,t,o;this.lastRenderedIndex<this.props.items.length-1&&(e=this.getRowHeight(this.lastRenderedIndex+this.props.itemsPerRow),o=this.containerBottom-this.bottomPlaceholderHeight,t=o+e,!(t>this.bottomHideLevelSoft&&o>this.bottomHideLevelHard));)this.deleteRowItemHeights(this.lastRenderedIndex+this.props.itemsPerRow),this.bottomPlaceholderHeight-e<0?(this.containerBottom+=e-this.bottomPlaceholderHeight,this.bottomPlaceholderHeight=0):this.bottomPlaceholderHeight-=e,this.lastRenderedIndex+=this.props.itemsPerRow,this.lastRenderedIndex=Math.min(this.lastRenderedIndex,this.props.items.length-1),this.lastRenderedIndex>=this.props.items.length-1&&(this.bottomPlaceholderHeight=0),this.stateUpdated=!0,C("showing bottom item",e,this.bottomPlaceholderHeight)}},{key:"shouldLoadNextPage",value:function(){return!this.props.fetchingNextPage&&!this.props.lastPage&&(0===this.bottomPlaceholderHeight&&this.containerBottom<this.bottomHideLevelHard)}},{key:"loadNextPage",value:function(){var e=this;if(!this.queuedFetchNextPage){var t=this.triggeredByScroll;C("fetching next page",this.containerBottom,this.bottomPlaceholderHeight),this.scrollPosition>this.contextHeight&&(t=!0),this.queuedFetchNextPage=Promise.resolve().then(function(){if(e.queuedFetchNextPage=null,e.props.fetchingNextPage||e.props.lastPage)return!1;e.props.fetchNextPage({triggeredByScroll:t})})}}}]),e}(),F=B,M=o("./client/lib/scroll-to/index.js"),A=o("./client/lib/react-smart-set-state/index.js");o.d(t,"a",function(){return E});var j=m()("calypso:infinite-list"),E=function(e){function t(){var e,o;s()(this,t);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return o=h()(this,(e=a()(t)).call.apply(e,[this].concat(r))),o.lastScrollTop=-1,o.scrollRAFHandle=!1,o.scrollHelper=null,o.isScrolling=!1,o._isMounted=!1,o.smartSetState=A.a,o.onScroll=function(){o.isScrolling||o.scrollRAFHandle||o.getCurrentScrollTop()===o.lastScrollTop||(o.scrollRAFHandle=window.requestAnimationFrame(o.scrollChecks))},o.scrollChecks=function(){o._isMounted&&o.getCurrentScrollTop()!==o.lastScrollTop?o.updateScroll({triggeredByScroll:!0}):o.scrollRAFHandle=null},o.boundsForRef=function(e){return e in o.refs?P.a.findDOMNode(o.refs[e]).getBoundingClientRect():null},o._resetScroll=function(e){var t=o.state.scrollTop;o._contextLoaded()&&(j("history setting scroll position:",e),o._setContainerY(t),o._scrollContainer.removeEventListener("scroll",o._resetScroll),j("override scroll position from HTML5 history popstate:",t))},o}return p()(t,e),n()(t,[{key:"componentWillMount",value:function(){var e,t,o=H.a.current;w.a.loadedViaHistory()&&(e=k.getPositions(o),t=k.getScrollTop(o)),e&&t&&(j("overriding scrollTop:",t),e.scrollTop=t),this.scrollHelper=new F(this.boundsForRef),this.scrollHelper.props=this.props,this._contextLoaded()&&(this._scrollContainer=this.props.context||window,this.scrollHelper.updateContextHeight(this.getCurrentContextHeight())),this.isScrolling=!1,e?j("infinite-list positions loaded from store"):(j("infinite-list positions reset for new list"),e={firstRenderedIndex:0,topPlaceholderHeight:0,lastRenderedIndex:this.scrollHelper.initialLastRenderedIndex(),bottomPlaceholderHeight:0,scrollTop:0}),j("infinite list mounting",e),this.setState(e)}},{key:"componentDidMount",value:function(){this._isMounted=!0,this._contextLoaded()&&this._setContainerY(this.state.scrollTop),w.a.loadedViaHistory()&&this._overrideHistoryScroll(),j("setting scrollTop:",this.state.scrollTop),this.updateScroll({triggeredByScroll:!1}),this._contextLoaded()&&this._scrollContainer.addEventListener("scroll",this.onScroll)}},{key:"componentWillReceiveProps",value:function(e){this.scrollHelper.props=e,this.isScrolling||(this.cancelAnimationFrame(),this.updateScroll({triggeredByScroll:!1})),e.context!==this.props.context&&this._contextLoaded()&&this._scrollContainer.removeEventListener("scroll",this._resetScroll)}},{key:"componentDidUpdate",value:function(e){this._contextLoaded()&&(this.props.context!==e.context&&(this._scrollContainer&&this._scrollContainer.removeEventListener("scroll",this.onScroll),this._scrollContainer=this.props.context||window,this._scrollContainer.addEventListener("scroll",this.onScroll),w.a.loadedViaHistory()&&this._overrideHistoryScroll()),this.isScrolling||(this.cancelAnimationFrame(),this.updateScroll({triggeredByScroll:!1})))}},{key:"reset",value:function(){this.cancelAnimationFrame(),this.scrollHelper=new F(this.boundsForRef),this.scrollHelper.props=this.props,this._contextLoaded()&&(this._scrollContainer=this.props.context||window,this.scrollHelper.updateContextHeight(this.getCurrentContextHeight())),this.isScrolling=!1,this.setState({firstRenderedIndex:0,topPlaceholderHeight:0,lastRenderedIndex:this.scrollHelper.initialLastRenderedIndex(),bottomPlaceholderHeight:0,scrollTop:0})}},{key:"componentWillUnmount",value:function(){this._scrollContainer.removeEventListener("scroll",this.onScroll),this._scrollContainer.removeEventListener("scroll",this._resetScroll),this.cancelAnimationFrame(),this._isMounted=!1}},{key:"cancelAnimationFrame",value:function(){this.scrollRAFHandle&&(window.cancelAnimationFrame(this.scrollRAFHandle),this.scrollRAFHandle=null),this.lastScrollTop=-1}},{key:"getCurrentContextHeight",value:function(){var e=this.props.context||window.document.documentElement;return e.clientHeight}},{key:"getCurrentScrollTop",value:function(){return this.props.context?(j("getting scrollTop from context"),this.props.context.scrollTop):window.pageYOffset}},{key:"scrollToTop",value:function(){var e=this;this.cancelAnimationFrame(),this.isScrolling=!0,this.props.context&&this.props.context!==window?(this.props.context.scrollTop=0,this.updateScroll({triggeredByScroll:!1}),this.isScrolling=!1):Object(M.a)({x:0,y:0,duration:250,onComplete:function(){e._isMounted&&e.updateScroll({triggeredByScroll:!1}),e.isScrolling=!1}})}},{key:"updateScroll",value:function(e){var t,o=H.a.current;this._contextLoaded()&&(this.lastScrollTop=this.getCurrentScrollTop(),k.storeScrollTop(o,this.lastScrollTop),this.scrollHelper.updateContextHeight(this.getCurrentContextHeight()),this.scrollHelper.scrollPosition=this.lastScrollTop,this.scrollHelper.triggeredByScroll=e.triggeredByScroll,this.scrollHelper.updatePlaceholderDimensions(),this.scrollHelper.scrollChecks(this.state),this.scrollHelper.stateUpdated&&(t={firstRenderedIndex:this.scrollHelper.firstRenderedIndex,topPlaceholderHeight:this.scrollHelper.topPlaceholderHeight,lastRenderedIndex:this.scrollHelper.lastRenderedIndex,bottomPlaceholderHeight:this.scrollHelper.bottomPlaceholderHeight,scrollTop:this.lastScrollTop},this.lastScrollTop=-1,j("new scroll positions",t,this.state),this.smartSetState(t),k.storePositions(o,t)),this.scrollRAFHandle=window.requestAnimationFrame(this.scrollChecks))}},{key:"getVisibleItemIndexes",value:function(e){var t,o,i,s,r=P.a.findDOMNode(this),n=[],l=this.state.firstRenderedIndex,h=this.state.lastRenderedIndex,d=e&&e.offsetTop?e.offsetTop:0,a=e&&e.offsetBottom?e.offsetBottom:0;if(a=a||0,h>-1)for(i=r.children,s=1;s<i.length-1;s++)o=r.children[s].getBoundingClientRect(),t=window.innerHeight||document.documentElement.clientHeight,(o.top<0&&Math.abs(o.top)<o.height-d||o.top>0&&o.top<t-a)&&n.push({index:l+s-1,bounds:o});return n}},{key:"render",value:function(){var e,t=Object(g.omit)(this.props,Object.keys(this.constructor.propTypes)),o=this.state.lastRenderedIndex,i=[];for((-1===o||o>this.props.items.length-1)&&(j("resetting lastRenderedIndex, currently at %s, %d items",o,this.props.items.length),o=Math.min(this.state.firstRenderedIndex+this.scrollHelper.initialLastRenderedIndex(),this.props.items.length-1),j("reset lastRenderedIndex to %s",o)),j("rendering %d to %d",this.state.firstRenderedIndex,o),e=this.state.firstRenderedIndex;e<=o;e++)i.push(this.props.renderItem(this.props.items[e],e));return this.props.fetchingNextPage&&(i=i.concat(this.props.renderLoadingPlaceholders())),I.a.createElement("div",t,I.a.createElement("div",{ref:"topPlaceholder",className:"infinite-list__spacer",style:{height:this.state.topPlaceholderHeight}}),i,this.props.renderTrailingItems(),I.a.createElement("div",{ref:"bottomPlaceholder",className:"infinite-list__spacer",style:{height:this.state.bottomPlaceholderHeight}}))}},{key:"_setContainerY",value:function(e){this.props.context&&this.props.context!==window?this.props.context.scrollTop=e:window.scrollTo(0,e)}},{key:"_overrideHistoryScroll",value:function(){this._contextLoaded()&&this._scrollContainer.addEventListener("scroll",this._resetScroll)}},{key:"_contextLoaded",value:function(){return this.props.context||!1===this.props.context||!("context"in this.props)}}]),t}(I.a.Component);E.propTypes={items:v.a.array.isRequired,fetchingNextPage:v.a.bool.isRequired,lastPage:v.a.bool.isRequired,guessedItemHeight:v.a.number.isRequired,itemsPerRow:v.a.number,fetchNextPage:v.a.func.isRequired,getItemRef:v.a.func.isRequired,renderItem:v.a.func.isRequired,renderLoadingPlaceholders:v.a.func.isRequired,renderTrailingItems:v.a.func,context:v.a.oneOfType([v.a.object,v.a.bool])},E.defaultProps={itemsPerRow:1,renderTrailingItems:g.noop}},"./client/lib/react-smart-set-state/index.js":function(e,t,o){"use strict";function i(e){var t=Object.keys(e).some(function(t){return!(this.state&&this.state.hasOwnProperty(t))||this.state[t]!==e[t]},this);return!!t&&(this.setState(e),!0)}o.d(t,"a",function(){return i})}}]);