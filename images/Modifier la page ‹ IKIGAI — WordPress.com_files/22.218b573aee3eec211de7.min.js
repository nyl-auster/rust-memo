(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{"./client/blocks/image-editor/index.jsx":function(e,t,o){"use strict";var n=o("./node_modules/@babel/runtime/helpers/objectSpread.js"),a=o.n(n),i=o("./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=o.n(i),r=o("./node_modules/@babel/runtime/helpers/createClass.js"),l=o.n(r),d=o("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),p=o.n(d),c=o("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),u=o.n(c),m=o("./node_modules/@babel/runtime/helpers/inherits.js"),h=o.n(m),g=o("./node_modules/prop-types/index.js"),f=o.n(g),b=o("./node_modules/react/index.js"),v=o.n(b),E=o("./node_modules/react-redux/es/index.js"),C=o("./node_modules/redux/es/redux.js"),y=o("./node_modules/lodash/lodash.js"),w=o("./node_modules/path-browserify/index.js"),D=o.n(w),R=o("./node_modules/i18n-calypso/index.js"),x=o("./node_modules/classnames/index.js"),j=o.n(x),_=o("./client/components/close-on-escape/index.jsx"),k=o("./client/components/notice/index.jsx"),O=o("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),S=o.n(O),I=o("./node_modules/react-dom/index.js"),T=o.n(I),N=o("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),A=o.n(N),P=o("./node_modules/@babel/runtime/helpers/extends.js"),L=o.n(P),B=function(e){function t(e){var o;return s()(this,t),o=p()(this,u()(t).call(this,e)),o.state={x:o.props.x,y:o.props.y},o.onTouchStartHandler=o.onTouchStartHandler.bind(S()(S()(o))),o.onMouseDownHandler=o.onMouseDownHandler.bind(S()(S()(o))),o.draggingHandler=o.draggingHandler.bind(S()(S()(o))),o.draggingEndedHandler=o.draggingEndedHandler.bind(S()(S()(o))),o.update=o.update.bind(S()(S()(o))),o}return h()(t,e),l()(t,[{key:"componentWillReceiveProps",value:function(e){this.state.x===e.x&&this.state.y===e.y||this.setState({x:e.x,y:e.y})}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"draggingStartedHandler",value:function(e){this.dragging=!0;var t=e;this.isTouchEvent(e)&&(t=e.touches[0]),this.relativePos={x:t.pageX-this.state.x,y:t.pageY-this.state.y},cancelAnimationFrame(this.frameRequestId),this.frameRequestId=requestAnimationFrame(this.update)}},{key:"isTouchEvent",value:function(e){return(!e.pageX||!e.pageY)&&e.targetTouches&&e.targetTouches.length}},{key:"draggingHandler",value:function(e){var t=e;this.isTouchEvent(e)&&(t=e.touches[0]);var o=t.pageX-this.relativePos.x,n=t.pageY-this.relativePos.y;this.mousePos={x:o,y:n}}},{key:"draggingEndedHandler",value:function(){this.dragging=!1,this.mousePos=null,cancelAnimationFrame(this.frameRequestId),this.removeListeners(),this.props.onStop()}},{key:"onTouchStartHandler",value:function(e){e.preventDefault(),document.addEventListener("touchmove",this.draggingHandler),document.addEventListener("touchend",this.draggingEndedHandler),this.draggingStartedHandler(e)}},{key:"onMouseDownHandler",value:function(e){e.preventDefault(),document.addEventListener("mousemove",this.draggingHandler),document.addEventListener("mouseup",this.draggingEndedHandler),this.draggingStartedHandler(e)}},{key:"update",value:function(){if(this.mousePos){var e=this.props.bounds,t=this.mousePos,o=t.x,n=t.y;e&&(o=Math.max(e.left,Math.min(e.right-this.props.width,o)),n=Math.max(e.top,Math.min(e.bottom-this.props.height,n))),this.dragging&&(this.frameRequestId=requestAnimationFrame(this.update)),this.props.onDrag(o,n),this.props.controlled||this.setState({x:o,y:n})}else this.frameRequestId=requestAnimationFrame(this.update)}},{key:"removeListeners",value:function(){document.removeEventListener("mousemove",this.draggingHandler),document.removeEventListener("mouseup",this.draggingEndedHandler),document.removeEventListener("touchmove",this.draggingHandler),document.removeEventListener("touchend",this.draggingEndedHandler)}},{key:"render",value:function(){var e=Object(y.omit)(this.props,Object.keys(this.constructor.propTypes)),t={transform:"translate("+this.state.x+"px, "+this.state.y+"px)"};return(this.props.width||this.props.height)&&(t.width=this.props.width+"px",t.height=this.props.height+"px"),v.a.createElement("div",L()({},e,{style:t,onMouseDown:this.onMouseDownHandler,onTouchStart:this.onTouchStartHandler}))}}]),t}(b.Component);B.propTypes={onDrag:f.a.func,onStop:f.a.func,width:f.a.number,height:f.a.number,x:f.a.number,y:f.a.number,controlled:f.a.bool,bounds:f.a.shape({top:f.a.number,left:f.a.number,bottom:f.a.number,right:f.a.number})},B.defaultProps={onDrag:y.noop,onStop:y.noop,width:0,height:0,x:0,y:0,controlled:!1,bounds:null};var H=o("./client/state/ui/editor/image-editor/selectors.js"),M=o("./client/state/ui/editor/image-editor/constants.js"),F=o("./client/state/ui/editor/image-editor/actions.js"),z=o("./client/state/ui/editor/image-editor/reducer.js");function W(e){return Object(y.get)(e,"ui.editor.imageEditor.originalAspectRatio",null)}var q=function(e){function t(e){var o;return s()(this,t),o=p()(this,u()(t).call(this,e)),o.state=o.getDefaultState(e),o.onTopLeftDrag=o.onTopLeftDrag.bind(S()(S()(o))),o.onTopRightDrag=o.onTopRightDrag.bind(S()(S()(o))),o.onBottomLeftDrag=o.onBottomLeftDrag.bind(S()(S()(o))),o.onBottomRightDrag=o.onBottomRightDrag.bind(S()(S()(o))),o.applyCrop=o.applyCrop.bind(S()(S()(o))),o.onBorderDrag=o.onBorderDrag.bind(S()(S()(o))),o}return h()(t,e),l()(t,[{key:"getDefaultState",value:function(e){return{top:e.bounds.topBound,left:e.bounds.leftBound,bottom:e.bounds.bottomBound,right:e.bounds.rightBound}}},{key:"componentWillMount",value:function(){this.updateCrop(this.getDefaultState(this.props),this.props,this.applyComputedCrop)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,o=t.bounds,n=t.aspectRatio,a=t.crop;if(!Object(y.isEqual)(o,e.bounds)){var i=e.bounds.rightBound-e.bounds.leftBound,s=e.bounds.bottomBound-e.bounds.topBound,r=e.bounds.topBound+e.crop.topRatio*s,l=e.bounds.leftBound+e.crop.leftRatio*i,d=r+e.crop.heightRatio*s,p=l+e.crop.widthRatio*i,c={top:r,left:l,bottom:d,right:p};this.setState(c),this.updateCrop(c)}n!==e.aspectRatio&&this.updateCrop(this.getDefaultState(e),e,this.applyCrop),e.imageEditorHasChanges||!Object(y.isEqual)(e.crop,z.b)||Object(y.isEqual)(a,e.crop)||this.updateCrop(this.getDefaultState(e),e,this.applyComputedCrop)}},{key:"updateCrop",value:function(e,t,o){t=t||this.props;var n=t.aspectRatio;if(n!==M.a.FREE){var a,i,s,r,l=t.degrees%180!=0,d=Object.assign({},this.state,e),p=d.right-d.left,c=d.bottom-d.top;switch(n){case M.a.ORIGINAL:if(!this.props.originalAspectRatio)return void this.setState(e,o);var u=this.props.originalAspectRatio,m=u.width,h=u.height;a=l?h:m,i=l?m:h;break;case M.a.ASPECT_1X1:a=1,i=1;break;case M.a.ASPECT_16X9:a=l?9:16,i=l?16:9;break;case M.a.ASPECT_4X3:a=l?3:4,i=l?4:3;break;case M.a.ASPECT_3X2:a=l?2:3,i=l?3:2}var g=Math.min(p/a,c/i);s=a*g,r=i*g,e.hasOwnProperty("top")?e.top=d.bottom-r:e.hasOwnProperty("bottom")&&(e.bottom=d.top+r),e.hasOwnProperty("left")?e.left=d.right-s:e.hasOwnProperty("right")&&(e.right=d.left+s),this.setState(e,o)}else this.setState(e,o)}},{key:"onTopLeftDrag",value:function(e,t){var o=this.state,n=o.right,a=o.bottom,i=this.props.minCropSize,s=t,r=e;n-r<=i.width&&(r=n-i.width),a-s<=i.height&&(s=a-i.height),this.updateCrop({top:s,left:r})}},{key:"onTopRightDrag",value:function(e,t){var o=this.state,n=o.left,a=o.bottom,i=this.props.minCropSize,s=t,r=e;r-n<=i.width&&(r=n+i.width),a-s<=i.height&&(s=a-i.height),this.updateCrop({top:s,right:r})}},{key:"onBottomRightDrag",value:function(e,t){var o=this.state,n=o.left,a=o.top,i=this.props.minCropSize,s=t,r=e;r-n<=i.width&&(r=n+i.width),s-a<=i.height&&(s=a+i.height),this.updateCrop({bottom:s,right:r})}},{key:"onBottomLeftDrag",value:function(e,t){var o=this.state,n=o.right,a=o.top,i=this.props.minCropSize,s=t,r=e;n-r<=i.width&&(r=n-i.width),s-a<=i.height&&(s=a+i.height),this.updateCrop({bottom:s,left:r})}},{key:"onBorderDrag",value:function(e,t){var o=this.state,n=o.top,a=o.left,i=o.right,s=o.bottom,r=i-a,l=s-n;this.setState({top:t,left:e,bottom:t+l,right:e+r})}},{key:"getCropBounds",value:function(){var e=this.state,t=e.top,o=e.left,n=e.right,a=e.bottom,i=this.props.bounds,s=i.topBound,r=i.leftBound,l=i.rightBound,d=i.bottomBound,p=t-s,c=o-r,u=n-o,m=a-t,h=l-r,g=d-s,f=this.props.degrees%180!=0;if(this.props.originalAspectRatio){var b=this.props.originalAspectRatio,v=b.width,E=b.height,C=f?E:v,y=f?v:E,w=y/C;g=h*w}return[p/g,c/h,u/h,m/g]}},{key:"applyCrop",value:function(){var e;(e=this.props).imageEditorCrop.apply(e,A()(this.getCropBounds()))}},{key:"applyComputedCrop",value:function(){var e;(e=this.props).imageEditorComputedCrop.apply(e,A()(this.getCropBounds()))}},{key:"render",value:function(){var e=this.state,t=e.top,o=e.left,n=e.right,a=e.bottom,i=n-o,s=a-t,r="image-editor__crop-handle",l=this.props.bounds,d=l.topBound,p=l.leftBound,c=l.rightBound,u=l.bottomBound;return v.a.createElement("div",null,v.a.createElement("div",{className:"image-editor__crop-background",style:{top:d+"px",left:o+"px",width:i+"px",height:Math.max(0,t-d)+"px"}}),v.a.createElement("div",{className:"image-editor__crop-background",style:{top:d+"px",left:p+"px",width:Math.max(0,o-p)+"px",height:Math.max(0,u-d)+"px"}}),v.a.createElement("div",{className:"image-editor__crop-background",style:{top:a+"px",left:o+"px",width:i+"px",height:Math.max(0,u-a)+"px"}}),v.a.createElement("div",{className:"image-editor__crop-background",style:{top:d+"px",left:n+"px",width:Math.max(0,c-n)+"px",height:Math.max(0,u-d)+"px"}}),v.a.createElement(B,{ref:"border",onDrag:this.onBorderDrag,onStop:this.applyCrop,x:o,y:t,width:i,height:s,bounds:{top:d,left:p,bottom:u,right:c},className:"image-editor__crop"}),v.a.createElement(B,{onDrag:this.onTopLeftDrag,onStop:this.applyCrop,x:o,y:t,controlled:!0,bounds:{bottom:a,right:n,top:d,left:p},ref:"topLeft",className:j()(r,r+"-nwse")}),v.a.createElement(B,{onDrag:this.onTopRightDrag,onStop:this.applyCrop,y:t,x:n,controlled:!0,bounds:{bottom:a,left:o,top:d,right:c},ref:"topRight",className:j()(r,r+"-nesw")}),v.a.createElement(B,{onDrag:this.onBottomRightDrag,onStop:this.applyCrop,y:a,x:n,controlled:!0,bounds:{top:t,left:o,bottom:u,right:c},ref:"bottomRight",className:j()(r,r+"-nwse")}),v.a.createElement(B,{onDrag:this.onBottomLeftDrag,onStop:this.applyCrop,y:a,x:o,controlled:!0,bounds:{top:t,right:n,bottom:u,left:p},ref:"bottomLeft",className:j()(r,r+"-nesw")}))}}]),t}(b.Component);q.propTypes={degrees:f.a.number,bounds:f.a.shape({topBound:f.a.number,leftBound:f.a.number,bottomBound:f.a.number,rightBound:f.a.number}),crop:f.a.shape({topRatio:f.a.number,leftRatio:f.a.number,widthRatio:f.a.number,heightRatio:f.a.number}),aspectRatio:f.a.string,imageEditorCrop:f.a.func,imageEditorComputedCrop:f.a.func,minCropSize:f.a.shape({width:f.a.number,height:f.a.number}),imageEditorHasChanges:f.a.bool},q.defaultProps={degrees:0,bounds:{topBound:0,leftBound:0,bottomBound:100,rightBound:100},imageEditorCrop:y.noop,imageEditorComputedCrop:y.noop,minCropSize:{width:50,height:50},imageEditorHasChanges:!1};var V=Object(E.b)(function(e){var t=Object(H.c)(e),o=Object(H.b)(e),n=Object(H.a)(e),a=Object(H.e)(e),i=a.degrees;return{bounds:t,crop:o,aspectRatio:n,degrees:i,originalAspectRatio:W(e),imageEditorHasChanges:Object(H.f)(e)}},{imageEditorCrop:F.b,imageEditorComputedCrop:F.a})(q),Z=o("./client/lib/media/utils.js");function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M.c.WIDTH,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.c.HEIGHT,n=W(e);if(n){var a=n.width,i=n.height;if(Object(y.isInteger)(a)&&Object(y.isInteger)(i)&&a>t&&i>o)return!0}return!1}var U=function(e){function t(e){var o;return s()(this,t),o=p()(this,u()(t).call(this,e)),o.frameRateInterval=1e3/30,o.requestAnimationFrameId=null,o.lastTimestamp=null,o.onWindowResize=function(){o.requestAnimationFrameId=window.requestAnimationFrame(o.updateCanvasPosition)},o.onLoadComplete=o.onLoadComplete.bind(S()(S()(o))),o.updateCanvasPosition=o.updateCanvasPosition.bind(S()(S()(o))),o.isVisible=!1,o}return h()(t,e),l()(t,[{key:"componentDidMount",value:function(){this.isVisible=!0}},{key:"componentWillReceiveProps",value:function(e){this.props.src!==e.src&&this.getImage(e.src)}},{key:"isBlobSrc",value:function(e){return Object(y.startsWith)(e,"blob")}},{key:"getImage",value:function(e){var t=this,o=this.props,n=o.onLoadError,a=o.mimeType,i=new XMLHttpRequest;this.isBlobSrc(e)||(e+="?"),i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){if(t.isVisible){var e=window.URL.createObjectURL(new Blob([i.response],{type:a}));t.initImage(e)}},i.onerror=function(e){return n(e)},i.send()}},{key:"initImage",value:function(e){this.image=new Image,this.image.src=e,this.image.onload=this.onLoadComplete,this.image.onerror=this.onLoadComplete}},{key:"onLoadComplete",value:function(e){"load"===e.type&&this.isVisible&&(this.drawImage(),this.updateCanvasPosition(),"undefined"!=typeof window&&(this.lastTimestamp=window.performance.now(),window.addEventListener("resize",this.onWindowResize)),this.props.setImageEditorImageHasLoaded(this.image.width,this.image.height))}},{key:"componentWillUnmount",value:function(){"undefined"!=typeof window&&this.onWindowResize&&(window.removeEventListener("resize",this.onWindowResize),window.cancelAnimationFrame(this.requestAnimationFrameId)),this.isVisible=!1}},{key:"componentDidUpdate",value:function(){this.drawImage(),this.updateCanvasPosition()}},{key:"toBlob",value:function(e){var t=this.props.crop,o=t.leftRatio,n=t.topRatio,a=t.widthRatio,i=t.heightRatio,s=this.props,r=s.mimeType,l=s.transform,d=T.a.findDOMNode(this.refs.canvas),p=d.getContext("2d"),c=l.degrees%180!=0,u=c?this.image.height:this.image.width,m=c?this.image.width:this.image.height,h=o*u,g=n*m,f=a*u,b=i*m,v=p.getImageData(h,g,f,b),E=document.createElement("canvas");E.width=f,E.height=b;var C=E.getContext("2d");C.putImageData(v,0,0),Object(Z.b)(E,e,r,1)}},{key:"drawImage",value:function(){if(this.image){var e=T.a.findDOMNode(this.refs.canvas),t=this.image.width,o=this.image.height,n=this.props.transform,a=n.degrees%180!=0;e.width=a?o:t,e.height=a?t:o;var i=e.getContext("2d");i.clearRect(0,0,e.width,e.height),i.save(),i.setTransform(1,0,0,1,e.width/2,e.height/2),i.scale(n.scaleX,n.scaleY),i.rotate(n.degrees*Math.PI/180),i.drawImage(this.image,-t/2,-o/2),i.restore()}}},{key:"updateCanvasPosition",value:function(e){var t=e,o=t-this.lastTimestamp;if(!(o<this.frameRateInterval)){this.lastTimestamp=t-o%this.frameRateInterval;var n=this.props.crop,a=n.leftRatio,i=n.topRatio,s=n.widthRatio,r=n.heightRatio,l=T.a.findDOMNode(this.refs.canvas),d=-50*s-100*a,p=-50*r-100*i,c=l.offsetTop,u=l.offsetLeft,m=l.offsetWidth,h=l.offsetHeight;this.props.setImageEditorCropBounds(c-h*-p/100,u-m*-d/100,c+h*(1+p/100),u+m*(1+d/100))}}},{key:"preventDrag",value:function(e){return e.preventDefault(),!1}},{key:"render",value:function(){var e=this.props.crop,t=e.leftRatio,o=e.topRatio,n=e.widthRatio,a=e.heightRatio,i=this.props,s=i.isImageLoaded,r=i.showCrop,l=-50*n-100*t,d=-50*a-100*o,p={transform:"translate("+l+"%, "+d+"%)",maxWidth:85/n+"%",maxHeight:85/a+"%"},c=j()("image-editor__canvas",{"is-placeholder":!s});return v.a.createElement("div",{className:"image-editor__canvas-container"},v.a.createElement("canvas",{ref:"canvas",style:p,onMouseDown:this.preventDrag,className:c}),r&&v.a.createElement(V,null))}}]),t}(b.Component);U.propTypes={src:f.a.string,mimeType:f.a.string,transform:f.a.shape({degrees:f.a.number,scaleX:f.a.number,scaleY:f.a.number}),crop:f.a.shape({topRatio:f.a.number,leftRatio:f.a.number,widthRatio:f.a.number,heightRatio:f.a.number}),setImageEditorCropBounds:f.a.func,setImageEditorImageHasLoaded:f.a.func,onLoadError:f.a.func,isImageLoaded:f.a.bool,showCrop:f.a.bool},U.defaultProps={transform:{degrees:0,scaleX:1,scaleY:1},crop:{cropTopRatio:0,cropLeftRatio:0,cropWidthRatio:1,cropHeightRatio:1},setImageEditorCropBounds:y.noop,setImageEditorImageHasLoaded:y.noop,onLoadError:y.noop,isImageLoaded:!1,showCrop:!0};var Y=Object(E.b)(function(e){var t=Object(H.e)(e),o=Object(H.d)(e),n=o.src,a=o.mimeType,i=Object(H.b)(e),s=Object(H.g)(e),r=X(e);return{src:n,mimeType:a,transform:t,crop:i,isImageLoaded:s,showCrop:!(!s||!r)}},{setImageEditorCropBounds:F.h,setImageEditorImageHasLoaded:F.k},null,{withRef:!0})(U),G=o("./node_modules/gridicons/dist/index.js"),K=o.n(G),J=o("./client/components/popover/menu.jsx"),Q=o("./client/components/popover/menu-item.jsx"),$=function(e){function t(e){var o;return s()(this,t),o=p()(this,u()(t).call(this,e)),o.state={showAspectPopover:!1},o.setAspectMenuContext=o.setAspectMenuContext.bind(S()(S()(o))),o.onAspectOpen=o.onAspectOpen.bind(S()(S()(o))),o.onAspectClose=o.onAspectClose.bind(S()(S()(o))),o.rotate=o.rotate.bind(S()(S()(o))),o.flip=o.flip.bind(S()(S()(o))),o}return h()(t,e),l()(t,[{key:"rotate",value:function(){this.props.imageEditorRotateCounterclockwise()}},{key:"flip",value:function(){this.props.imageEditorFlip()}},{key:"onAspectOpen",value:function(e){e.preventDefault();var t=this.props,o=t.isAspectRatioDisabled,n=t.onShowNotice,a=t.translate;if(o){var i=a("To change the aspect ratio, the height and width must be bigger than {{strong}}%(width)dpx{{/strong}}.",{args:{width:M.c.WIDTH,height:M.c.HEIGHT},components:{strong:v.a.createElement("strong",null)}});n(i)}else this.setState({showAspectPopover:!0})}},{key:"onAspectClose",value:function(e){this.setState({showAspectPopover:!1}),"string"==typeof e&&this.props.setImageEditorAspectRatio(e)}},{key:"setAspectMenuContext",value:function(e){this.setState({popoverContext:e})}},{key:"renderAspectMenu",value:function(){var e=this.state,t=e.popoverContext,o=e.showAspectPopover,n=this.props,a=n.translate,i=n.aspectRatio,s=n.allowedAspectRatios;if(t&&1!==s.length){var r=[{action:M.a.FREE,label:a("Free")},{action:M.a.ORIGINAL,label:a("Original")},{action:M.a.ASPECT_1X1,label:a("Square")},{action:M.a.ASPECT_16X9,label:a("16:9")},{action:M.a.ASPECT_4X3,label:a("4:3")},{action:M.a.ASPECT_3X2,label:a("3:2")}];return v.a.createElement(J.a,{isVisible:o,onClose:this.onAspectClose,position:"top",context:t,className:"image-editor__toolbar-popover popover is-dialog-visible"},r.map(function(e){return-1!==s.indexOf(e.action)?v.a.createElement(Q.a,{key:"image-editor-toolbar-aspect-"+e.action,action:e.action},i===e.action&&v.a.createElement(K.a,{icon:"checkmark",size:12}),e.label):null}))}}},{key:"renderButtons",value:function(){var e=this.props,t=e.translate,o=e.allowedAspectRatios,n=e.isAspectRatioDisabled,a=[{tool:"rotate",icon:"rotate",text:t("Rotate"),onClick:this.rotate},1===o.length?null:{tool:"aspect",ref:this.setAspectMenuContext,icon:"crop",text:t("Crop"),onClick:this.onAspectOpen,disabled:n},{tool:"flip-vertical",icon:"flip-vertical",text:t("Flip"),onClick:this.flip}];return a.map(function(e){var t=j()("image-editor__toolbar-button",{"is-disabled":e&&e.disabled});return e?v.a.createElement("button",{key:"image-editor-toolbar-"+e.tool,ref:e.ref,className:t,onClick:e.onClick},v.a.createElement(K.a,{icon:e.icon}),v.a.createElement("span",null,e.text)):null})}},{key:"render",value:function(){return v.a.createElement("div",{className:"image-editor__toolbar"},this.renderButtons(),this.renderAspectMenu())}}]),t}(b.Component);$.propTypes={aspectRatio:f.a.string,imageEditorRotateCounterclockwise:f.a.func,imageEditorFlip:f.a.func,setImageEditorAspectRatio:f.a.func,allowedAspectRatios:f.a.array,onShowNotice:f.a.func,isAspectRatioDisabled:f.a.bool},$.defaultProps={imageEditorRotateCounterclockwise:y.noop,imageEditorFlip:y.noop,setImageEditorAspectRatio:y.noop,allowedAspectRatios:Object(y.values)(M.a),onShowNotice:y.noop,isAspectRatioDisabled:!1};var ee=Object(E.b)(function(e){var t=Object(H.a)(e),o=X(e);return{aspectRatio:t,isAspectRatioDisabled:!o}},{imageEditorRotateCounterclockwise:F.d,imageEditorFlip:F.c,setImageEditorAspectRatio:F.g})(Object(R.localize)($)),te=o("./client/components/button/index.jsx"),oe=function(e){function t(){return s()(this,t),p()(this,u()(t).apply(this,arguments))}return h()(t,e),l()(t,[{key:"render",value:function(){var e=this.props,t=e.hasChanges,o=e.onCancel,n=e.src,a=e.onDone,i=e.onReset,s=e.translate,r=e.doneButtonText;return v.a.createElement("div",{className:"image-editor__buttons"},o&&v.a.createElement(te.a,{className:"image-editor__buttons-button",onClick:o,"data-e2e-button":"cancel"},s("Cancel")),v.a.createElement(te.a,{className:"image-editor__buttons-button",disabled:!t,onClick:i,"data-e2e-button":"reset"},s("Reset")),v.a.createElement(te.a,{className:"image-editor__buttons-button",disabled:!n,primary:!0,onClick:a,"data-e2e-button":"done","data-tip-target":"image-editor-button-done"},r||s(" Done ")))}}]),t}(b.Component);oe.propTypes={src:f.a.string,hasChanges:f.a.bool,resetImageEditorState:f.a.func,onDone:f.a.func,onCancel:f.a.func,onReset:f.a.func,doneButtonText:f.a.string},oe.defaultProps={src:"",hasChanges:!1,resetImageEditorState:y.noop,onDone:y.noop,onCancel:y.noop,onReset:y.noop,doneButtonText:""};var ne=Object(E.b)(function(e){var t=Object(H.d)(e),o=t.src,n=Object(H.f)(e);return{src:o,hasChanges:n}})(Object(R.localize)(oe)),ae=o("./client/state/ui/selectors.js"),ie=o("./client/state/sites/selectors.js"),se=o("./client/components/data/query-sites/index.jsx");function re(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M.b;return Object(y.includes)(t,e)||(e=Object(y.get)(t,"0",M.a.FREE)),Object(y.includes)(M.b,e)?e:re(e)}var le=function(e){function t(){var e,o;s()(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return o=p()(this,(e=u()(t)).call.apply(e,[this].concat(i))),o.state={noticeText:null,noticeStatus:"is-info"},o.setDefaultAspectRatio=function(){var e=o.props,t=e.defaultAspectRatio,n=e.allowedAspectRatios;o.props.setImageEditorDefaultAspectRatio(re(t,n))},o.updateFileInfo=function(e){var t,n=o.props.site,a="default",i="image/png",s="default";e&&(t=e.src||Object(Z.s)(e,{photon:n&&!n.is_private}),a=e.file||D.a.basename(t),i=Object(Z.h)(e)||i,s=e.title||s),o.props.resetImageEditorState(),o.props.setImageEditorFileInfo(t,a,i,s)},o.convertBlobToImage=function(e){var t=o.props.onDone,n=document.createElement("img"),i=URL.createObjectURL(e),s=o.getImageEditorProps();n.onload=function(){URL.revokeObjectURL(i),t(null,e,a()({},s,{width:n.width,height:n.height}))},n.onerror=function(){t(null,e,s)},n.src=i},o.onDone=function(){var e=o.props,t=e.isImageLoaded,n=e.onDone;if(t){var a=o.refs.editCanvas.getWrappedInstance();a.toBlob(o.convertBlobToImage)}else n(new Error("Image not loaded yet."),null,o.getImageEditorProps())},o.onCancel=function(){o.props.onCancel(o.getImageEditorProps())},o.onReset=function(){o.props.resetImageEditorState(),o.props.onReset(o.getImageEditorProps())},o.getImageEditorProps=function(){var e=o.props,t=e.src,n=e.fileName,a=e.media,i=e.mimeType,s=e.title,r=e.site,l={src:t,fileName:n,mimeType:i,title:s,site:r,resetAllImageEditorState:o.props.resetAllImageEditorState};return a&&a.ID&&(l.ID=a.ID),l},o.showNotice=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"is-info";o.setState({noticeText:e,noticeStatus:t})},o.clearNoticeState=function(){o.setState({noticeText:null,noticeStatus:"is-info"})},o.renderNotice=function(){if(!o.state.noticeText)return null;var e="is-info"===o.state.noticeStatus;return v.a.createElement(k.b,{status:o.state.noticeStatus,showDismiss:e,text:o.state.noticeText,isCompact:!1,onDismissClick:o.clearNoticeState,className:"image-editor__notice"})},o.onLoadCanvasError=function(){var e=o.props.translate;o.showNotice(e("Sorry, there was a problem loading the image. Please close this editor and try selecting the image again."),"is-error")},o}return h()(t,e),l()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.media;e.media&&!Object(y.isEqual)(e.media,t)&&(this.props.resetAllImageEditorState(),this.updateFileInfo(e.media),this.setDefaultAspectRatio())}},{key:"componentDidMount",value:function(){this.updateFileInfo(this.props.media),this.setDefaultAspectRatio()}},{key:"render",value:function(){var e=this.props,t=e.className,o=e.siteId,n=e.allowedAspectRatios,a=this.state.noticeText,i=j()("image-editor",t);return v.a.createElement("div",{className:i},a&&this.renderNotice(),v.a.createElement(_.a,{onEscape:this.onCancel}),v.a.createElement(se.a,{siteId:o}),v.a.createElement("figure",null,v.a.createElement("div",{className:"image-editor__content"},v.a.createElement(Y,{ref:"editCanvas",onLoadError:this.onLoadCanvasError}),v.a.createElement(ee,{onShowNotice:this.showNotice,allowedAspectRatios:n}),v.a.createElement(ne,{onCancel:this.props.onCancel&&this.onCancel,onDone:this.onDone,onReset:this.onReset,doneButtonText:this.props.doneButtonText}))))}}]),t}(v.a.Component);le.propTypes={media:f.a.object,siteId:f.a.number,onDone:f.a.func,onCancel:f.a.func,onReset:f.a.func,className:f.a.string,defaultAspectRatio:f.a.oneOf(M.b),allowedAspectRatios:f.a.arrayOf(f.a.oneOf(M.b)),site:f.a.object,fileName:f.a.string,setImageEditorFileInfo:f.a.func,setImageEditorDefaultAspectRatio:f.a.func,translate:f.a.func,isImageLoaded:f.a.bool},le.defaultProps={media:null,onDone:y.noop,onCancel:null,onReset:y.noop,isImageLoaded:!1,defaultAspectRatio:M.a.FREE,allowedAspectRatios:M.b,setImageEditorDefaultAspectRatio:y.noop};t.a=Object(E.b)(function(e,t){var o=t.siteId;return o||(o=Object(ae.e)(e)),a()({},Object(H.d)(e),{site:Object(ie.l)(e,o),isImageLoaded:Object(H.g)(e)})},function(e,t){var o=re(t.defaultAspectRatio,t.allowedAspectRatios),n={aspectRatio:o};return Object(C.b)({setImageEditorFileInfo:F.j,setImageEditorDefaultAspectRatio:F.i,resetImageEditorState:Object(y.partial)(F.f,n),resetAllImageEditorState:Object(y.partial)(F.e,n)},e)})(Object(R.localize)(le))},"./client/components/drop-zone/index.jsx":function(e,t,o){"use strict";var n=o("./node_modules/@babel/runtime/helpers/classCallCheck.js"),a=o.n(n),i=o("./node_modules/@babel/runtime/helpers/createClass.js"),s=o.n(i),r=o("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=o.n(r),d=o("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),p=o.n(d),c=o("./node_modules/@babel/runtime/helpers/inherits.js"),u=o.n(c),m=o("./node_modules/react-dom/index.js"),h=o.n(m),g=o("./node_modules/react/index.js"),f=o.n(g),b=o("./node_modules/prop-types/index.js"),v=o.n(b),E=o("./node_modules/react-redux/es/index.js"),C=o("./node_modules/classnames/index.js"),y=o.n(C),w=o("./node_modules/gridicons/dist/index.js"),D=o.n(w),R=o("./node_modules/i18n-calypso/index.js"),x=o("./node_modules/lodash/lodash.js"),j=o("./client/components/root-child/index.jsx");var _=o("./client/components/translatable/proptype.js"),k=function(e){function t(){var e,o;a()(this,t);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return o=l()(this,(e=p()(t)).call.apply(e,[this].concat(i))),o.state={isDraggingOverDocument:!1,isDraggingOverElement:!1,lastVisibleState:!1},o.resetDragState=function(){(o.state.isDraggingOverDocument||o.state.isDraggingOverElement)&&(o.setState({isDraggingOverDocument:!1,isDraggingOverElement:!1}),o.toggleDropZoneReduxState(!1))},o.toggleMutationObserver=function(){o.disconnectMutationObserver(),o.state.isDraggingOverDocument&&(o.observer=new window.MutationObserver(o.detectNodeRemoval),o.observer.observe(document.body,{childList:!0,subtree:!0}))},o.disconnectMutationObserver=function(){o.observer&&(o.observer.disconnect(),delete o.observer)},o.detectNodeRemoval=function(e){e.forEach(function(e){e.removedNodes.length&&(o.dragEnterNodes=Object(x.without)(o.dragEnterNodes,Array.from(e.removedNodes)))})},o.toggleDraggingOverDocument=function(e){"dragenter"!==e.type||Object(x.includes)(o.dragEnterNodes,e.target)?"dragleave"===e.type&&(o.dragEnterNodes=Object(x.without)(o.dragEnterNodes,e.target)):o.dragEnterNodes.push(e.target);var t=window.CustomEvent&&e instanceof window.CustomEvent?e.detail:e,n=o.props.onVerifyValidTransfer(t.dataTransfer),a=n&&o.dragEnterNodes.length;o.setState({isDraggingOverDocument:a,isDraggingOverElement:a&&(o.props.fullScreen||o.isWithinZoneBounds(t.clientX,t.clientY))}),window.CustomEvent&&e instanceof window.CustomEvent&&(o.dragEnterNodes=Object(x.without)(o.dragEnterNodes,window)),o.toggleDropZoneReduxState(!(!o.state.isDraggingOverDocument&&!o.state.isDraggingOverElement))},o.toggleDropZoneReduxState=function(e){o.state.lastVisibleState!==e&&(e?o.props.showDropZone(o.props.dropZoneName):o.props.hideDropZone(o.props.dropZoneName),o.setState({lastVisibleState:e}))},o.preventDefault=function(e){e.preventDefault()},o.isWithinZoneBounds=function(e,t){if(!o.refs.zone)return!1;var n=o.refs.zone.getBoundingClientRect();return n.bottom!==n.top&&n.left!==n.right&&(e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom)},o.onDrop=function(e){e.dataTransfer&&e.dataTransfer.files.length,o.resetDragState(),e.preventDefault(),(o.props.fullScreen||h.a.findDOMNode(o.refs.zone).contains(e.target))&&(o.props.onDrop(e),o.props.onVerifyValidTransfer(e.dataTransfer)&&(e.dataTransfer&&o.props.onFilesDrop(Array.prototype.slice.call(e.dataTransfer.files)),e.stopPropagation()))},o.renderContent=function(){var e=o.props.textLabel?o.props.textLabel:o.props.translate("Drop files to upload");return f.a.createElement("div",{className:"drop-zone__content"},o.props.children?o.props.children:f.a.createElement("div",null,f.a.createElement("span",{className:"drop-zone__content-icon"},o.props.icon),f.a.createElement("span",{className:"drop-zone__content-text"},e)))},o}return u()(t,e),s()(t,[{key:"componentDidMount",value:function(){this.dragEnterNodes=[],window.addEventListener("dragover",this.preventDefault),window.addEventListener("drop",this.onDrop),window.addEventListener("dragenter",this.toggleDraggingOverDocument),window.addEventListener("dragleave",this.toggleDraggingOverDocument),window.addEventListener("mouseup",this.resetDragState)}},{key:"componentDidUpdate",value:function(e,t){t.isDraggingOverDocument!==this.state.isDraggingOverDocument&&this.toggleMutationObserver()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("dragover",this.preventDefault),window.removeEventListener("drop",this.onDrop),window.removeEventListener("dragenter",this.toggleDraggingOverDocument),window.removeEventListener("dragleave",this.toggleDraggingOverDocument),window.removeEventListener("mouseup",this.resetDragState),this.disconnectMutationObserver()}},{key:"render",value:function(){var e=y()("drop-zone",this.props.className,{"is-active":this.state.isDraggingOverDocument||this.state.isDraggingOverElement,"is-dragging-over-document":this.state.isDraggingOverDocument,"is-dragging-over-element":this.state.isDraggingOverElement,"is-full-screen":this.props.fullScreen}),t=f.a.createElement("div",{ref:"zone",className:e},this.renderContent());return this.props.fullScreen?f.a.createElement(j.a,null,t):t}}]),t}(f.a.Component);k.propTypes={className:v.a.string,fullScreen:v.a.bool,icon:v.a.node,onDrop:v.a.func,onVerifyValidTransfer:v.a.func,onFilesDrop:v.a.func,textLabel:_.a,translate:v.a.func,showDropZone:v.a.func.isRequired,hideDropZone:v.a.func.isRequired,dropZoneName:v.a.string},k.defaultProps={className:null,onDrop:x.noop,onVerifyValidTransfer:function(){return!0},onFilesDrop:x.noop,fullScreen:!1,icon:f.a.createElement(D.a,{icon:"cloud-upload",size:48}),translate:x.identity,dropZoneName:null};var O={showDropZone:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return{type:"DROPZONE_SHOW",dropZoneName:e}},hideDropZone:function(e){return{type:"DROPZONE_HIDE",dropZoneName:e}}};t.a=Object(E.b)(null,O)(Object(R.localize)(k))},"./client/components/file-picker/index.jsx":function(e,t,o){"use strict";o.d(t,"a",function(){return w});var n=o("./node_modules/@babel/runtime/helpers/classCallCheck.js"),a=o.n(n),i=o("./node_modules/@babel/runtime/helpers/createClass.js"),s=o.n(i),r=o("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=o.n(r),d=o("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),p=o.n(d),c=o("./node_modules/@babel/runtime/helpers/inherits.js"),u=o.n(c),m=o("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=o.n(m),g=o("./node_modules/prop-types/index.js"),f=o.n(g),b=o("./node_modules/react/index.js"),v=o.n(b),E=o("./node_modules/lodash/lodash.js"),C=o("./node_modules/component-file-picker/index.js"),y=o.n(C),w=function(e){function t(e){var o;return a()(this,t),o=l()(this,p()(t).call(this,e)),o.showPicker=o.showPicker.bind(h()(h()(o))),o}return u()(t,e),s()(t,[{key:"showPicker",value:function(){this.props.onClick(),y()(Object(E.assign)({},this.props),this.props.onPick)}},{key:"render",value:function(){return v.a.createElement("span",{className:"file-picker",onClick:this.showPicker},this.props.children)}}]),t}(v.a.Component);w.displayName="FilePicker",w.propTypes={multiple:f.a.bool,directory:f.a.bool,accept:f.a.string,onClick:f.a.func,onPick:f.a.func},w.defaultProps={multiple:!1,directory:!1,accept:null,onClick:E.noop,onPick:E.noop}},"./client/components/forms/form-checkbox/index.jsx":function(e,t,o){"use strict";var n=o("./node_modules/@babel/runtime/helpers/extends.js"),a=o.n(n),i=o("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),s=o.n(i),r=o("./node_modules/react/index.js"),l=o.n(r),d=o("./node_modules/classnames/index.js"),p=o.n(d);t.a=function(e){var t=e.className,o=s()(e,["className"]);return l.a.createElement("input",a()({},o,{type:"checkbox",className:p()(t,"form-checkbox")}))}},"./client/components/popover/menu.jsx":function(e,t,o){"use strict";var n=o("./node_modules/@babel/runtime/helpers/classCallCheck.js"),a=o.n(n),i=o("./node_modules/@babel/runtime/helpers/createClass.js"),s=o.n(i),r=o("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=o.n(r),d=o("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),p=o.n(d),c=o("./node_modules/@babel/runtime/helpers/inherits.js"),u=o.n(c),m=o("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=o.n(m),g=o("./node_modules/react/index.js"),f=o.n(g),b=o("./node_modules/prop-types/index.js"),v=o.n(b),E=o("./node_modules/lodash/lodash.js"),C=o("./client/components/popover/index.jsx"),y=function(e){return"HR"===e.tagName},w=function(e){function t(){var e,o;a()(this,t);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return o=l()(this,(e=p()(t)).call.apply(e,[this].concat(i))),o.menu=f.a.createRef(),o._setPropsOnChild=function(e){if(null==e)return e;var t=o._onClose.bind(h()(h()(o)),e.props.action),n=t;return e.props.onClick&&(n=Object(E.over)([e.props.onClick,t])),f.a.cloneElement(e,{onClick:n})},o._onShow=function(){var e=o.menu.current;o._previouslyFocusedElement=document.activeElement,e&&e.focus()},o._getClosestSibling=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=o.menu.current,a=n.firstChild,i=n.lastChild;if(t||(a=n.lastChild,i=n.firstChild),e===n)return a;var s=e[t?"nextSibling":"previousSibling"],r=s||i;return y(r)?o._getClosestSibling(r,t):r},o._onKeyDown=function(e){var t,n=e.target,a=!1;switch(e.keyCode){case 9:o.props.onClose(),a=!0;break;case 38:t=o._getClosestSibling(n,!1),a=!0;break;case 40:t=o._getClosestSibling(n,!0),a=!0}t&&t.focus(),a&&e.preventDefault()},o._onClose=function(e){o._previouslyFocusedElement&&(o._previouslyFocusedElement.focus(),o._previouslyFocusedElement=null),o.props.onClose&&o.props.onClose(e)},o}return u()(t,e),s()(t,[{key:"componentWillUnmount",value:function(){this._previouslyFocusedElement=null}},{key:"render",value:function(){var e=this.props,t=e.popoverComponent,o=e.autoPosition,n=e.className,a=e.context,i=e.customPosition,s=e.isVisible,r=e.popoverTitle,l=e.position,d=e.rootClassName;return f.a.createElement(t,{onClose:this._onClose,onShow:this._onShow,autoPosition:o,className:n,context:a,customPosition:i,isVisible:s,popoverTitle:r,position:l,rootClassName:d},f.a.createElement("div",{ref:this.menu,role:"menu",className:"popover__menu",onKeyDown:this._onKeyDown,tabIndex:"-1"},f.a.Children.map(this.props.children,this._setPropsOnChild,this)))}}]),t}(g.Component);w.propTypes={autoPosition:v.a.bool,isVisible:v.a.bool.isRequired,onClose:v.a.func.isRequired,position:v.a.string,className:v.a.string,rootClassName:v.a.string,popoverComponent:v.a.func,popoverTitle:v.a.string,customPosition:v.a.object},w.defaultProps={autoPosition:!0,position:"top",popoverComponent:C.a},t.a=w}}]);