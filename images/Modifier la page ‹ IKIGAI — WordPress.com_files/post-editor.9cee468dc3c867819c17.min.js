(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{"./client/blocks/post-status/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/prop-types/index.js"),o=n.n(a),i=n("./node_modules/react/index.js"),s=n.n(i),r=n("./node_modules/react-redux/es/index.js"),l=n("./node_modules/classnames/index.js"),c=n.n(l),d=n("./node_modules/i18n-calypso/index.js"),u=n("./node_modules/gridicons/dist/index.js"),p=n.n(u),m=n("./client/state/posts/selectors.js");function h(e){var t=e.translate,n=e.post,a=e.showAll,o=e.showIcon,i=void 0===o||o;if(!n)return null;var r,l,d,u=n.sticky,m=n.status;if(u?(r=t("Sticky"),l="is-sticky",d="bookmark-outline"):"pending"===m?(r=t("Pending Review"),l="is-pending",d="aside"):a&&"future"===m?(r=t("Scheduled"),l="is-scheduled",d="calendar"):a&&"trash"===m?(r=t("Trashed"),l="is-trash",d="trash"):a&&"draft"===m?(r=t("Draft"),l="is-draft",d="aside"):a&&"publish"===m&&(r=t("Published"),l="is-published",d="aside"),!r)return null;var h=c()("post-status",l);return s.a.createElement("span",{className:h},i&&s.a.createElement(p.a,{icon:d,size:18,className:"post-status__icon"}),s.a.createElement("span",{className:"post-status__text"},r))}h.displayName="PostStatus",h.propTypes={globalId:o.a.string,translate:o.a.func,post:o.a.object,showAll:o.a.bool,showIcon:o.a.bool},t.a=Object(r.b)(function(e,t){var n=t.globalId;return{post:Object(m.d)(e,n)}})(Object(d.localize)(h))},"./client/blocks/shortcode/index.js":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/extends.js"),o=n.n(a),i=n("./node_modules/react-redux/es/index.js"),s=n("./node_modules/classnames/index.js"),r=n.n(s),l=n("./node_modules/prop-types/index.js"),c=n.n(l),d=n("./node_modules/react/index.js"),u=n.n(d),p=n("./node_modules/lodash/lodash.js"),m=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),h=n.n(m),f=n("./node_modules/@babel/runtime/helpers/createClass.js"),g=n.n(f),b=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),v=n.n(b),y=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),E=n.n(y),j=n("./node_modules/@babel/runtime/helpers/inherits.js"),w=n.n(j),_=n("./client/lib/wp/browser.js");var C=function(e){function t(){return h()(this,t),v()(this,E()(t).apply(this,arguments))}return w()(t,e),g()(t,[{key:"componentWillMount",value:function(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.props.siteId===e.siteId&&this.props.shortcode===e.shortcode||this.request(e)}},{key:"request",value:function(e){e.requestingShortcode||e.fetchShortcode(e.siteId,e.shortcode)}},{key:"render",value:function(){return null}}]),t}(d.Component);C.propTypes={siteId:c.a.number.isRequired,shortcode:c.a.string.isRequired,requestingShortcode:c.a.bool,fetchShortcode:c.a.func};var S=Object(i.b)(function(e,t){var n=t.siteId,a=t.shortcode;return{requestingShortcode:function(e,t,n){return Object(p.get)(e.shortcodes.requesting,[t,n],!1)}(e,n,a)}},{fetchShortcode:function(e,t){return function(n){return n({type:"SHORTCODE_REQUEST",siteId:e,shortcode:t}),_.a.undocumented().site(e).shortcodes({shortcode:t}).then(function(a){n({type:"SHORTCODE_REQUEST_SUCCESS",siteId:e,shortcode:t}),n({type:"SHORTCODE_RECEIVE",siteId:e,shortcode:t,data:a})}).catch(function(a){n({type:"SHORTCODE_REQUEST_FAILURE",siteId:e,shortcode:t,error:a})})}}})(C),x=n("./client/lib/embed-frame-markup/index.jsx"),k=n("./client/components/resizable-iframe/index.jsx"),I=function(e){function t(){var e,n;h()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=v()(this,(e=E()(t)).call.apply(e,[this].concat(o))),n.state={html:""},n.updateHtmlState=function(e){n.setState({html:Object(x.a)(e)})},n.onFrameLoad=function(e){e.target.contentWindow.postMessage(JSON.stringify({content:n.state.html}),"*"),n.props.onLoad(e)},n}return w()(t,e),g()(t,[{key:"componentDidMount",value:function(){this.updateHtmlState(this.props)}},{key:"componentWillReceiveProps",value:function(e){Object(p.isEqual)(this.props,e)||this.updateHtmlState(e)}},{key:"shouldComponentUpdate",value:function(e,t){return t.html!==this.state.html}},{key:"render",value:function(){var e=r()("shortcode-frame",this.props.className);if(!this.state.html)return null;var t=Math.random();return u.a.createElement(k.a,o()({key:t},Object(p.omit)(this.props,"body","scripts","styles"),{src:"https://wpcomwidgets.com/render/",onLoad:this.onFrameLoad,frameBorder:"0",sandbox:"allow-scripts",className:e}))}}]),t}(u.a.Component);I.displayName="ShortcodeFrame",I.propTypes={body:c.a.string,scripts:c.a.object,style:c.a.object,onLoad:c.a.func,className:c.a.string},I.defaultProps={onLoad:function(){}};var O=function(e){var t=e.siteId,n=e.className,a=e.children,i=e.filterRenderResult,s=e.shortcode,l=r()("shortcode",n),c={};return s&&(s.body=s.result,c=i(Object(p.omit)(s,"shortcode"))),u.a.createElement(d.Fragment,null,u.a.createElement(S,{siteId:t,shortcode:a}),u.a.createElement(I,o()({},Object(p.omit)(e,"siteId","filterRenderResult","shortcode","dispatch"),c,{className:l})))};O.propTypes={siteId:c.a.number.isRequired,children:c.a.string.isRequired,filterRenderResult:c.a.func.isRequired,className:c.a.string,shortcode:c.a.object},O.defaultProps={filterRenderResult:p.identity};t.a=Object(i.b)(function(e,t){var n=t.siteId,a=t.children;return{shortcode:function(e,t,n){return Object(p.get)(e.shortcodes.items,[t,n])}(e,n,a)}},null)(O)},"./client/blocks/term-form-dialog/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n.n(f),b=n("./node_modules/react-redux/es/index.js"),v=n("./node_modules/i18n-calypso/index.js"),y=n("./node_modules/lodash/lodash.js"),E=n("./client/components/dialog/index.jsx"),j=n("./client/blocks/term-tree-selector/terms.jsx"),w=n("./client/components/forms/form-input-validation/index.jsx"),_=n("./client/components/forms/form-textarea/index.jsx"),C=n("./client/components/forms/form-text-input/index.jsx"),S=n("./client/components/forms/form-section-heading/index.jsx"),x=n("./client/components/forms/form-toggle/index.jsx"),k=n("./client/components/forms/form-label/index.jsx"),I=n("./client/components/forms/form-legend/index.jsx"),O=n("./client/components/forms/form-fieldset/index.jsx"),T=n("./client/lib/viewport/index.js"),P=n("./client/state/ui/selectors.js"),D=n("./client/state/post-types/taxonomies/selectors.js"),N=n("./client/state/terms/selectors.js"),R=n("./client/state/terms/actions.js"),M=n("./client/state/analytics/actions.js"),A=function(e){function t(e){var n;return o()(this,t),n=l()(this,d()(t).call(this,e)),n.onSearch=function(e){n.setState({searchTerm:e})},n.closeDialog=function(){n.state.saving||n.props.onClose()},n.onParentChange=function(e){n.setState({selectedParent:[e.ID],isTopLevel:!1},n.isValid)},n.onTopLevelChange=function(){var e=n.state.isTopLevel?y.noop:n.isValid;n.setState(function(e){var t=e.isTopLevel;return{isTopLevel:!t,selectedParent:[]}},e)},n.onNameChange=function(e){n.setState({name:e.target.value})},n.onDescriptionChange=function(e){n.setState({description:e.target.value})},n.validateInput=function(e){13===e.keyCode?n.saveTerm():n.isValid()},n.saveTerm=function(){var e=n.getFormValues();if(n.isValid()&&!n.state.saving){n.setState({saving:!0});var t=n.props,a=t.siteId,o=t.taxonomy,i={mc:"edited_"+o,ga:"Edited "+o},s=!n.props.term,r=s?n.props.addTerm(a,o,e):n.props.updateTerm(a,o,n.props.term.ID,n.props.term.slug,e);s&&(i.mc="created_"+o,i.ga="Created New "+o),n.props.bumpStat("taxonomy_manager",i.mc),n.props.recordGoogleEvent("Taxonomy Manager",i.ga),r.then(function(e){n.setState({saving:!1}),n.props.onSuccess(e),n.closeDialog()})}},n.state=n.constructor.initialState,n}return p()(t,e),s()(t,[{key:"init",value:function(e){if(!e.term)return e.searchTerm&&e.searchTerm.trim().length?void this.setState(Object(y.assign)({},this.constructor.initialState,{name:e.searchTerm}),this.isValid):void this.setState(this.constructor.initialState);var t=e.term,n=t.name,a=t.description,o=t.parent,i=void 0!==o&&o;this.setState(Object(y.assign)({},this.constructor.initialState,{name:n,description:a,isTopLevel:!i,selectedParent:i?[i]:[]}))}},{key:"componentWillReceiveProps",value:function(e){(this.props.term!==e.term||this.props.showDialog!==e.showDialog&&e.showDialog)&&this.init(e)}},{key:"componentDidMount",value:function(){this.init(this.props)}},{key:"getFormValues",value:function(){var e=this.state.name.trim(),t={name:e};if(this.props.isHierarchical&&(t.parent=this.state.selectedParent.length?this.state.selectedParent[0]:0),this.props.showDescriptionInput){var n=this.state.description.trim();t.description=n}return t}},{key:"isValid",value:function(){var e=this,t={},n=this.getFormValues();n.name.length||(t.name=this.props.translate("Name required",{textOnly:!0}));var a=n.name.toLowerCase(),o=Object(y.find)(this.props.terms,function(t){return t.name.toLowerCase()===a&&(!e.props.term||t.ID!==e.props.term.ID)});o&&(t.name=this.props.translate("Name already exists",{context:"Terms: Add term error message - duplicate term name exists",comment:'Term here refers to a hierarchical taxonomy, e.g. "Category"',textOnly:!0})),!this.props.isHierarchical||this.state.isTopLevel||n.parent||(t.parent=this.props.translate('Parent item required when "Top level" is unchecked',{context:"Terms: Add term error message",comment:'Term here refers to a hierarchical taxonomy, e.g. "Category"',textOnly:!0}));var i=!Object.keys(t).length;return this.setState({errors:t,isValid:i}),i}},{key:"renderParentSelector",value:function(){var e=this.props,t=e.labels,n=e.siteId,a=e.taxonomy,o=e.translate,i=e.terms,s=this.state,r=s.isTopLevel,l=s.searchTerm,c=s.selectedParent,d={};l&&l.length&&(d.search=l);var u=Object(y.get)(this.props.term,"ID"),p=!!this.state.errors.parent;return u&&i&&1===i.length?null:g.a.createElement(O.a,null,g.a.createElement(k.a,null,g.a.createElement(x.a,{checked:r,onChange:this.onTopLevelChange}),g.a.createElement("span",null,o("Top level %(term)s",{args:{term:t.singular_name},context:"Terms: New term being created is top level",comment:'term is the singular_name label of a hierarchical taxonomy, e.g. "Category"'})),r&&g.a.createElement("span",{className:"term-form-dialog__top-level-description"},o("Disable to select a %(parentTerm)s",{args:{parentTerm:t.parent_item},comment:'parentTerm is the parent_item label of a hierarchical taxonomy, e.g. "Parent Category"'}))),!r&&g.a.createElement("div",{className:"term-form-dialog__parent-tree-selector"},g.a.createElement(I.a,null,o("Choose a %(parentTerm)s",{args:{parentTerm:t.parent_item},comment:'parentTerm is the parent_item label of a hierarchical taxonomy, e.g. "Parent Category"'})),g.a.createElement(j.a,{siteId:n,taxonomy:a,isError:p,onSearch:this.onSearch,onChange:this.onParentChange,query:d,selected:c,hideTermAndChildren:u}),p&&g.a.createElement(w.a,{isError:!0,text:this.state.errors.parent})))}},{key:"render",value:function(){var e=this.props,t=e.isHierarchical,n=e.labels,a=e.term,o=e.translate,i=e.showDescriptionInput,s=e.showDialog,r=this.state,l=r.name,c=r.description,d=!a,u=o(d?"Add":"Update"),p=[{action:"cancel",label:o("Cancel")},{action:d?"add":"update",label:this.state.saving?o("Savingâ€¦"):u,isPrimary:!0,disabled:!this.state.isValid||this.state.saving,onClick:this.saveTerm}],m=!!this.state.errors.name;return g.a.createElement(E.a,{autoFocus:!1,isVisible:s,buttons:p,onClose:this.closeDialog,additionalClassNames:"term-form-dialog"},g.a.createElement(S.a,null,d?n.add_new_item:n.edit_item),g.a.createElement(O.a,null,g.a.createElement(C.a,{autoFocus:s&&!Object(T.c)(),placeholder:n.new_item_name,ref:"termName",isError:m,onKeyUp:this.validateInput,value:l,onChange:this.onNameChange}),m&&g.a.createElement(w.a,{isError:!0,text:this.state.errors.name})),i&&g.a.createElement(O.a,null,g.a.createElement(I.a,null,o("Description",{context:"Terms: Term description label",comment:'Term here refers to a hierarchical taxonomy, e.g. "Category"'})),g.a.createElement(_.a,{ref:"termDescription",onKeyUp:this.validateInput,value:c,onChange:this.onDescriptionChange})),t&&this.renderParentSelector())}}]),t}(f.Component);A.initialState={description:"",name:"",selectedParent:[],isTopLevel:!0,isValid:!1,errors:{},saving:!1},A.propTypes={labels:h.a.object,onClose:h.a.func,onSuccess:h.a.func,postType:h.a.string,searchTerm:h.a.string,showDescriptionInput:h.a.bool,showDialog:h.a.bool,siteId:h.a.number,taxonomy:h.a.string,term:h.a.object,terms:h.a.array,translate:h.a.func,recordGoogleEvent:h.a.func,bumpStat:h.a.func},A.defaultProps={onClose:y.noop,onSuccess:y.noop,showDescriptionInput:!1,showDialog:!1},t.a=Object(b.b)(function(e,t){var n=t.taxonomy,a=t.postType,o=Object(P.e)(e),i=Object(D.b)(e,o,a,n),s=Object(y.get)(i,"labels",{}),r=Object(y.get)(i,"hierarchical",!1);return{terms:Object(N.c)(e,o,n),isHierarchical:r,labels:s,siteId:o}},{addTerm:R.a,updateTerm:R.d,recordGoogleEvent:M.g,bumpStat:M.a})(Object(v.localize)(A))},"./client/blocks/term-tree-selector/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n.n(f),b=n("./node_modules/classnames/index.js"),v=n.n(b),y=n("./client/blocks/term-tree-selector/terms.jsx"),E=n("./node_modules/react-redux/es/index.js"),j=n("./node_modules/lodash/lodash.js"),w=n("./node_modules/gridicons/dist/index.js"),_=n.n(w),C=n("./client/components/button/index.jsx"),S=n("./client/blocks/term-form-dialog/index.jsx"),x=n("./client/components/data/query-taxonomies/index.jsx"),k=n("./client/state/ui/selectors.js"),I=n("./client/state/post-types/taxonomies/selectors.js"),O=n("./client/state/terms/selectors.js"),T=function(e){function t(e){var n;return o()(this,t),n=l()(this,d()(t).call(this,e)),n.openDialog=function(e){e.preventDefault(),n.setState({showDialog:!0})},n.closeDialog=function(){n.setState({showDialog:!1})},n.state={showDialog:!1},n}return p()(t,e),s()(t,[{key:"render",value:function(){var e=this.props,t=e.siteId,n=e.labels,a=e.onSuccess,o=e.postType,i=e.terms,s=e.taxonomy,r=i?i.length:0,l=v()("term-tree-selector__add-term",{"is-compact":r<8});return g.a.createElement("div",{className:l},t&&g.a.createElement(x.a,{siteId:t,postType:o}),g.a.createElement(C.a,{borderless:!0,compact:!0,onClick:this.openDialog},g.a.createElement(_.a,{icon:"folder"})," ",n.add_new_item),g.a.createElement(S.a,{showDialog:this.state.showDialog,onClose:this.closeDialog,postType:o,taxonomy:s,onSuccess:a}))}}]),t}(f.Component);T.propTypes={labels:h.a.object,onSuccess:h.a.func,taxonomy:h.a.string,terms:h.a.array,postType:h.a.string},T.defaultProps={onSuccess:j.noop};var P=Object(E.b)(function(e,t){var n=t.taxonomy,a=t.postType,o=Object(k.e)(e),i=Object(I.b)(e,o,a,n),s=Object(j.get)(i,"labels",{});return{siteId:o,terms:Object(O.c)(e,o,n),labels:s}})(T);n.d(t,"a",function(){return D});var D=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.state={search:""},n.onSearch=function(e){e!==n.state.search&&n.setState({search:e})},n}return p()(t,e),s()(t,[{key:"componentWillReceiveProps",value:function(e){e.taxonomy!==this.props.taxonomy&&this.setState({search:""})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.taxonomy,a=e.onChange,o=e.selected,i=e.createLink,s=e.multiple,r=e.height,l=e.compact,c=e.addTerm,d=e.postType,u=e.onAddTermSuccess,p=e.podcastingCategoryId,m=v()(t),h=this.state.search,f={};return h&&h.length&&(f.search=h),g.a.createElement("div",{className:m,ref:"wrapper"},g.a.createElement(y.a,{taxonomy:n,onSearch:this.onSearch,onChange:a,query:f,selected:o,createLink:i,multiple:s,height:r,compact:l,podcastingCategoryId:p}),c&&g.a.createElement(P,{taxonomy:n,postType:d,onSuccess:u}))}}]),t}(g.a.Component);D.displayName="TermTreeSelector",D.propTypes={multiple:h.a.bool,className:h.a.string,onChange:h.a.func.isRequired,selected:h.a.array,createLink:h.a.string,analyticsPrefix:h.a.string,taxonomy:h.a.string,height:h.a.number,compact:h.a.bool,addTerm:h.a.bool,postType:h.a.string,onAddTermSuccess:h.a.func,podcastingCategoryId:h.a.number},D.defaultProps={analyticsPrefix:"Category Selector",selected:[],taxonomy:"category",onChange:function(){},height:300,addTerm:!1,postType:"post",onAddTermSuccess:function(){}}},"./client/blocks/user-mentions/suggestion-list.jsx":function(e,t,n){"use strict";var a=n("./node_modules/prop-types/index.js"),o=n.n(a),i=n("./node_modules/react/index.js"),s=n.n(i),r=n("./node_modules/lodash/lodash.js"),l=n("./client/components/popover/menu.jsx"),c=n("./client/components/popover/menu-item.jsx"),d=function(e){var t=e.avatarUrl,n=e.fullName,a=e.query,o=e.username,i=function(e,t){var n={username:"(^"+a+")(\\w*)\\s*",fullName:"(^.*?)(\\b"+a+")(.*)"},o=new RegExp(n[t],"ig").exec(e);return o?o.map(function(e,t){return 0===t?"":a.toLowerCase()===e.toLowerCase()?s.a.createElement("mark",{className:"user-mentions__highlight",key:t},e):e}):[e]},r=i(o,"username"),l=i(n,"fullName");return r.unshift("@"),s.a.createElement("div",null,s.a.createElement("img",{className:"user-mentions__avatar",src:t,alt:""}),s.a.createElement("span",{className:"user-mentions__username"},r),s.a.createElement("small",{className:"user-mentions__fullname"},l))};d.propTypes={avatarUrl:o.a.string,fullName:o.a.string,query:o.a.string,username:o.a.string},d.defaultProps={avatarUrl:"",fullName:"",query:"",username:""};var u=d,p=function(e){var t=e.onClick,n=e.onClose,a=e.popoverContext,o=e.popoverPosition,i=e.query,d=e.selectedSuggestionId,p=e.suggestions;return s.a.createElement(l.a,{className:"user-mentions__suggestions",context:a,isVisible:!0,autoPosition:!1,position:"bottom right",onClose:n,customPosition:o},p.map(function(e){return s.a.createElement(c.a,{className:"user-mentions__suggestion",key:e.ID,isSelected:e.ID===d,onClick:Object(r.bind)(t,null,e)},s.a.createElement(u,{avatarUrl:e.image_URL,username:e.user_login,fullName:e.display_name,query:i}))}))};p.propTypes={onClick:o.a.func,onClose:o.a.func,query:o.a.string,popoverContext:o.a.object,popoverPosition:o.a.shape({top:o.a.number,left:o.a.number,positionClass:o.a.oneOf(["top","right","bottom","left"])}),selectedSuggestionId:o.a.number,suggestions:o.a.array},p.defaultProps={onClick:function(){},onClose:function(){},query:"",popoverContext:{},popoverPosition:null,selectedSuggestionId:0,suggestions:[]};t.a=p},"./client/components/accordion/section.jsx":function(e,t,n){"use strict";n.d(t,"a",function(){return b});var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/react/index.js"),h=n.n(m),f=n("./node_modules/classnames/index.js"),g=n.n(f),b=function(e){function t(){return o()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"render",value:function(){return h.a.createElement("section",{className:g()("accordion__section",this.props.className)},this.props.children)}}]),t}(m.Component)},"./client/components/data/media-library-selected-data/index.jsx":function(e,t,n){"use strict";n.d(t,"a",function(){return E});var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/react/index.js"),h=n.n(m),f=n("./node_modules/prop-types/index.js"),g=n.n(f),b=n("./client/lib/media/library-selected-store.js"),v=n("./client/lib/react-pass-to-children/index.js");function y(e){return{mediaLibrarySelectedItems:b.a.getAll(e)}}var E=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.state=y(n.props.siteId),n.updateState=function(){n.setState(y(n.props.siteId))},n}return p()(t,e),s()(t,[{key:"componentDidMount",value:function(){b.a.on("change",this.updateState)}},{key:"componentWillUnmount",value:function(){b.a.off("change",this.updateState)}},{key:"componentWillReceiveProps",value:function(e){this.props.siteId!==e.siteId&&this.setState(y(e.siteId))}},{key:"render",value:function(){return Object(v.a)(this,this.state)}}]),t}(h.a.Component);E.displayName="MediaLibrarySelectedData",E.propTypes={siteId:g.a.number.isRequired}},"./client/components/data/query-jetpack-plugins/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n("./node_modules/react-redux/es/index.js"),b=n("./node_modules/lodash/lodash.js"),v=n("./client/state/plugins/installed/actions.js"),y=n("./client/state/plugins/installed/selectors.js"),E=function(e){function t(){return o()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"componentWillMount",value:function(){this.props.siteIds&&!this.props.isRequestingForSites&&this.props.fetchPlugins(this.props.siteIds)}},{key:"componentWillReceiveProps",value:function(e){Object(b.isEqual)(e.siteIds,this.props.siteIds)||this.refresh(e.isRequestingForSites,e.siteIds)}},{key:"refresh",value:function(e,t){e||this.props.fetchPlugins(t)}},{key:"render",value:function(){return null}}]),t}(f.Component);E.propTypes={siteIds:h.a.arrayOf(h.a.oneOfType([h.a.string,h.a.number]).isRequired).isRequired,isRequestingForSites:h.a.bool,fetchPlugins:h.a.func},t.a=Object(g.b)(function(e,t){return{isRequestingForSites:Object(y.h)(e,t.siteIds)}},{fetchPlugins:v.b})(E)},"./client/components/data/query-media/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n("./node_modules/react-pure-render/shallowEqual.js"),b=n.n(g),v=n("./node_modules/react-redux/es/index.js"),y=n("./client/state/media/actions.js"),E={requestMedia:y.e,requestMediaItem:y.f},j=function(e){function t(){return o()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"componentDidMount",value:function(){this.request()}},{key:"componentDidUpdate",value:function(e){this.props.siteId===e.siteId&&this.props.mediaId===e.mediaId&&b()(this.props.query,e.query)||this.request()}},{key:"request",value:function(){var e=this.props,t=e.siteId,n=e.mediaId,a=e.query,o=!!n;o?this.props.requestMediaItem(t,n):this.props.requestMedia(t,a)}},{key:"render",value:function(){return null}}]),t}(f.Component);j.propTypes={siteId:h.a.number.isRequired,query:h.a.object,mediaId:h.a.number,request:h.a.func},j.defaultProps={request:function(){}},t.a=Object(v.b)(null,E)(j)},"./client/components/data/query-simple-payments/index.js":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/react/index.js"),h=n("./node_modules/prop-types/index.js"),f=n.n(h),g=n("./node_modules/react-redux/es/index.js"),b=n("./client/state/simple-payments/product-list/actions.js"),v=function(e){function t(){return o()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"componentWillMount",value:function(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function(e){e.siteId===this.props.siteId&&e.productId===this.props.productId||this.request(e)}},{key:"request",value:function(e){var t=e.siteId,n=e.productId;t&&0!==n&&(n?e.requestProduct(t,n):e.requestProducts(t))}},{key:"render",value:function(){return null}}]),t}(m.Component);v.propTypes={productId:f.a.number,siteId:f.a.number.isRequired,requestProduct:f.a.func,requestProducts:f.a.func},v.defaultProps={productId:null},t.a=Object(g.b)(null,{requestProduct:b.d,requestProducts:b.e})(v)},"./client/components/data/query-taxonomies/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n("./node_modules/react-redux/es/index.js"),b=n("./client/lib/wp/browser.js");var v=n("./client/state/post-types/taxonomies/selectors.js"),y=function(e){function t(){return o()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"componentWillMount",value:function(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.props.siteId===e.siteId&&this.props.postType===e.postType||this.request(e)}},{key:"request",value:function(e){!e.requesting&&e.siteId&&e.requestPostTypeTaxonomies(e.siteId,e.postType)}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return null}}]),t}(f.Component);y.propTypes={siteId:h.a.number,postType:h.a.string.isRequired,requesting:h.a.bool.isRequired,requestPostTypeTaxonomies:h.a.func.isRequired};t.a=Object(g.b)(function(e,t){return{requesting:Object(v.c)(e,t.siteId,t.postType)}},{requestPostTypeTaxonomies:function(e,t){return function(n){return n({type:"POST_TYPES_TAXONOMIES_REQUEST",siteId:e,postType:t}),b.a.site(e).postType(t).taxonomiesList().then(function(a){var o=a.taxonomies;n(function(e,t,n){return{type:"POST_TYPES_TAXONOMIES_RECEIVE",siteId:e,postType:t,taxonomies:n}}(e,t,o)),n({type:"POST_TYPES_TAXONOMIES_REQUEST_SUCCESS",siteId:e,postType:t})}).catch(function(a){n({type:"POST_TYPES_TAXONOMIES_REQUEST_FAILURE",siteId:e,postType:t,error:a})})}}})(y)},"./client/components/data/query-users-suggestions/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n("./node_modules/react-redux/es/index.js"),b=n("./client/state/users/suggestions/selectors.js"),v=n("./client/lib/wp/browser.js");var y=function(e){function t(){return o()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"componentWillMount",value:function(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.props.siteId!==e.siteId&&this.request(e)}},{key:"request",value:function(e){!e.isRequesting&&e.siteId&&e.requestUserSuggestions(e.siteId)}},{key:"render",value:function(){return null}}]),t}(f.Component);y.propTypes={siteId:h.a.number,isRequesting:h.a.bool,requestUserSuggestions:h.a.func},y.defaultProps={requestUserSuggestions:function(){},isRequesting:!1};t.a=Object(g.b)(function(e,t){return{isRequesting:Object(b.b)(e,t.siteId)}},{requestUserSuggestions:function(e){return function(t){return t({type:"USER_SUGGESTIONS_REQUEST",siteId:e}),v.a.users().suggest({site_id:e}).then(function(n){t(function(e,t){return{type:"USER_SUGGESTIONS_RECEIVE",suggestions:t,siteId:e}}(e,n.suggestions)),t({type:"USER_SUGGESTIONS_REQUEST_SUCCESS",siteId:e,data:n})}).catch(function(n){return t({type:"USER_SUGGESTIONS_REQUEST_FAILURE",siteId:e,error:n})})}}})(y)},"./client/components/email-verification/email-verification-dialog/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n.n(f),b=n("./node_modules/lodash/lodash.js"),v=n("./node_modules/i18n-calypso/index.js"),y=n("./node_modules/react-redux/es/index.js"),E=n("./client/components/dialog/index.jsx"),j=n("./client/components/button/index.jsx"),w=n("./client/components/spinner/index.jsx"),_=n("./client/state/current-user/selectors.js"),C=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.handleClose=function(){n.props.resetVerifyEmailState(),n.props.onClose()},n}return p()(t,e),s()(t,[{key:"getResendButtonLabel",value:function(){return"sent"===this.props.emailVerificationStatus||"error"===this.props.emailVerificationStatus?this.props.translate("Email Sent"):"requesting"===this.props.emailVerificationStatus?g.a.createElement(w.a,{className:"email-verification-dialog__confirmation-dialog-spinner"}):this.props.translate("Resend Email")}},{key:"getDialogButtons",value:function(){return[g.a.createElement(j.a,{key:"resend",primary:!1,disabled:Object(b.includes)(["requesting","sent","error"],this.props.emailVerificationStatus),onClick:this.props.verifyEmail},this.getResendButtonLabel()),g.a.createElement(j.a,{key:"close",primary:!0,onClick:this.handleClose},this.props.translate("OK"))]}},{key:"render",value:function(){var e={confirmHeading:this.props.translate("Please verify your email address:"),confirmExplanation:this.props.translate("When you first signed up for a WordPress.com account we sent you an email. Please open it and click on the blue button to verify your email address."),confirmReasoning:this.props.translate("Verifying your email allows us to assist you if you ever lose access to your account in the future."),confirmEmail:this.props.translate("{{wrapper}}%(email)s{{/wrapper}} {{emailPreferences}}change{{/emailPreferences}}",{components:{wrapper:g.a.createElement("span",{className:"email-verification-dialog__confirmation-dialog-email-wrapper"}),emailPreferences:g.a.createElement("a",{href:"/me/account"})},args:{email:this.props.email}})};return g.a.createElement(E.a,{isVisible:!0,buttons:this.getDialogButtons(),additionalClassNames:"email-verification-dialog__confirmation-dialog is-narrow"},g.a.createElement("h1",{className:"email-verification-dialog__confirmation-dialog-heading is-variable-height"},e.confirmHeading),g.a.createElement("p",{className:"email-verification-dialog__confirmation-dialog-email"},e.confirmEmail),g.a.createElement("p",{className:"email-verification-dialog__confirmation-dialog-explanation"},e.confirmExplanation),g.a.createElement("p",{className:"email-verification-dialog__confirmation-dialog-reasoning"},e.confirmReasoning))}}]),t}(f.Component);C.propTypes={onClose:h.a.func,translate:h.a.func,email:h.a.string,emailVerificationStatus:h.a.string},C.defaultProps={onClose:b.noop};t.a=Object(y.b)(function(e){return{email:Object(_.f)(e),emailVerificationStatus:Object(b.get)(e,"currentUser.emailVerification.status")}},{verifyEmail:function(){return{type:"EMAIL_VERIFY_REQUEST"}},resetVerifyEmailState:function(){return{type:"EMAIL_VERIFY_STATE_RESET"}}})(Object(v.localize)(C))},"./client/components/foldable-card/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n.n(f),b=n("./node_modules/classnames/index.js"),v=n.n(b),y=n("./node_modules/i18n-calypso/index.js"),E=n("./node_modules/lodash/lodash.js"),j=n("./client/components/card/index.jsx"),w=n("./client/components/card/compact.jsx"),_=n("./node_modules/gridicons/dist/index.js"),C=n.n(_),S=n("./client/components/screen-reader-text/index.js"),x=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.state={expanded:n.props.expanded},n.onClick=function(){n.props.children&&n.setState({expanded:!n.state.expanded}),n.props.onClick&&n.props.onClick(),n.state.expanded?n.props.onClose(n.props.cardKey):n.props.onOpen(n.props.cardKey)},n}return p()(t,e),s()(t,[{key:"componentWillReceiveProps",value:function(e){e.expanded!==this.props.expanded&&this.setState({expanded:e.expanded})}},{key:"getClickAction",value:function(){if(!this.props.disabled)return this.onClick}},{key:"getActionButton",value:function(){return this.state.expanded&&this.props.actionButtonExpanded||this.props.actionButton}},{key:"renderActionButton",value:function(){var e=this.props.clickableHeader?null:this.getClickAction();if(this.props.actionButton)return g.a.createElement("div",{className:"foldable-card__action",onClick:e},this.getActionButton());if(this.props.children){var t=this.props.screenReaderText||this.props.translate("More");return g.a.createElement("button",{disabled:this.props.disabled,type:"button",className:"foldable-card__action foldable-card__expand",onClick:e},g.a.createElement(S.a,null,t),g.a.createElement(C.a,{icon:this.props.icon,size:24}))}}},{key:"renderContent",value:function(){return g.a.createElement("div",{className:"foldable-card__content"},this.props.children)}},{key:"renderHeader",value:function(){var e=this.props.summary?g.a.createElement("span",{className:"foldable-card__summary"},this.props.summary," "):null,t=this.props.expandedSummary?g.a.createElement("span",{className:"foldable-card__summary-expanded"},this.props.expandedSummary," "):null,n=this.props.clickableHeader?this.getClickAction():null,a=v()("foldable-card__header",{"is-clickable":!!this.props.clickableHeader,"has-border":!!this.props.summary});return g.a.createElement("div",{className:a,onClick:n},g.a.createElement("span",{className:"foldable-card__main"},this.props.header," "),g.a.createElement("span",{className:"foldable-card__secondary"},e,t,this.renderActionButton()))}},{key:"render",value:function(){var e=this.props.compact?w.a:j.a,t=v()("foldable-card",this.props.className,{"is-disabled":!!this.props.disabled,"is-expanded":!!this.state.expanded,"has-expanded-summary":!!this.props.expandedSummary});return g.a.createElement(e,{className:t},this.renderHeader(),this.state.expanded&&this.renderContent())}}]),t}(f.Component);x.displayName="FoldableCard",x.propTypes={actionButton:h.a.element,actionButtonExpanded:h.a.element,cardKey:h.a.string,compact:h.a.bool,disabled:h.a.bool,expandedSummary:h.a.oneOfType([h.a.string,h.a.element]),expanded:h.a.bool,icon:h.a.string,onClick:h.a.func,onClose:h.a.func,onOpen:h.a.func,screenReaderText:h.a.oneOfType([h.a.string,h.a.bool]),summary:h.a.oneOfType([h.a.string,h.a.element])},x.defaultProps={onOpen:E.noop,onClose:E.noop,cardKey:"",icon:"chevron-down",expanded:!1,screenReaderText:!1},t.a=Object(y.localize)(x)},"./client/components/forms/form-select/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/extends.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/createClass.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),p=n.n(u),m=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),h=n.n(m),f=n("./node_modules/@babel/runtime/helpers/inherits.js"),g=n.n(f),b=n("./node_modules/react/index.js"),v=n.n(b),y=n("./node_modules/classnames/index.js"),E=n.n(y),j=function(e){function t(){return l()(this,t),p()(this,h()(t).apply(this,arguments))}return g()(t,e),d()(t,[{key:"render",value:function(){var e=this.props,t=e.inputRef,n=e.className,a=e.isError,i=s()(e,["inputRef","className","isError"]),r=E()(n,"form-select",{"is-error":a});return v.a.createElement("select",o()({},i,{ref:t,className:r}),this.props.children)}}]),t}(v.a.Component);j.defaultProps={isError:!1},t.a=j},"./client/components/forms/sortable-list/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/extends.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/createClass.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),p=n.n(u),m=n("./node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(m),f=n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),g=n.n(f),b=n("./node_modules/react/index.js"),v=n.n(b),y=n("./node_modules/prop-types/index.js"),E=n.n(y),j=n("./node_modules/i18n-calypso/index.js"),w=n("./node_modules/lodash/lodash.js"),_=n("./node_modules/classnames/index.js"),C=n.n(_),S=n("./node_modules/debug/src/browser.js"),x=n.n(S),k=n("./node_modules/gridicons/dist/index.js"),I=n.n(k),O=n("./client/lib/touch-detect/index.js"),T=x()("calypso:forms:sortable-list"),P=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return n=d()(this,(e=p()(t)).call.apply(e,[this].concat(i))),n.state={activeIndex:null,activeOrder:null,position:null},n.getPositionForCursorElement=function(e,t){return{top:t.clientY-e.clientHeight/2,left:t.clientX-e.clientWidth/2}},n.compareCursorVerticalToElement=function(e,t){var n=e.getBoundingClientRect();return t.clientY<n.top?-1:t.clientY>n.bottom?1:0},n.isCursorBeyondElementThreshold=function(e,t,n,a){var o=e.getBoundingClientRect();switch(t){case"top":return a.clientY<=o.top+o.height/2;case"right":return a.clientX>=o.left+o.width/2&&("top"===n||a.clientY>=o.top)&&("bottom"===n||a.clientY<=o.bottom);case"bottom":return a.clientY>=o.top+o.height/2;case"left":return a.clientX<=o.left+o.width/2&&("top"===n||a.clientY>=o.top)&&("bottom"===n||a.clientY<=o.bottom);default:return!1}},n.getAdjustedElementIndex=function(e){return n.state.activeOrder?n.state.activeOrder[e]:e},n.getCursorElementIndex=function(e){var t,a=n.compareCursorVerticalToElement(n.refs.list,e),o=n.getAdjustedElementIndex(n.state.activeIndex),i=n.refs["wrap-shadow-"+n.state.activeIndex].getBoundingClientRect();return t=Object(w.findIndex)(n.props.children,function(t,s){var r,l,c;return s!==n.state.activeIndex&&(l=n.getAdjustedElementIndex(s),"horizontal"===n.props.direction&&(1===a&&n.refs["wrap-"+s].getBoundingClientRect().top>=i.top?c="bottom":-1===a&&n.refs["wrap-"+s].getBoundingClientRect().bottom<=i.bottom&&(c="top")),l<o?r=n.isCursorBeyondElementThreshold(n.refs["wrap-"+s],"horizontal"===n.props.direction?"left":"top",c,e):l>o&&(r=r||n.isCursorBeyondElementThreshold(n.refs["wrap-"+s],"horizontal"===n.props.direction?"right":"bottom",c,e)),r)}),n.getAdjustedElementIndex(t)},n.moveItem=function(e){var t="previous"===e?-1:1,a=Object.keys(n.props.children).map(Number);a[n.state.activeIndex+t]=n.state.activeIndex,a[n.state.activeIndex]=n.state.activeIndex+t,n.props.onChange(a),n.setState({activeIndex:a[n.state.activeIndex]})},n.onMouseDown=function(e,t){n.setState({activeIndex:e,position:n.getPositionForCursorElement(t.currentTarget.firstChild,t)})},n.onMouseMove=function(e){var t,a;if(null!==n.state.activeIndex&&n.props.allowDrag&&!Object(O.a)()){if(t=n.state.activeOrder,a=n.getCursorElementIndex(e),a>=0)if(n.state.activeIndex===a)t=null;else{t=Object.keys(n.props.children).map(Number);for(var o=0,i=t.length;o<i;o++)o>=a&&o<n.state.activeIndex?t[o]=o+1:o<=a&&o>n.state.activeIndex&&(t[o]=o-1);t[n.state.activeIndex]=a}n.setState({position:n.getPositionForCursorElement(n.refs["wrap-"+n.state.activeIndex].firstChild,e),activeOrder:t})}},n.onMouseUp=function(){n.state.activeOrder&&n.props.onChange(n.state.activeOrder),n.setState({activeIndex:null,activeOrder:null,position:null})},n.onClick=function(e){n.setState({activeIndex:e})},n.getOrderedListItemElements=function(){return v.a.Children.map(n.props.children,function(e,t){var n,a=this.state.activeIndex===t,i=this.props.allowDrag&&!Object(O.a)(),s=i?["onMouseDown","onMouseUp"]:["onClick"],r={order:this.getAdjustedElementIndex(t)},l=C()({"sortable-list__item":!0,"is-active":a,"is-draggable":i});return s=Object(w.fromPairs)(s.map(function(e){return[e,this[e].bind(null,t)]},this)),a&&Object(w.assign)(r,this.state.position),n=v.a.createElement("li",o()({ref:"wrap-"+t,key:"wrap-"+t},s,{className:l,style:r}),e),a&&i?[v.a.createElement("li",{ref:"wrap-shadow-"+t,key:"wrap-shadow-"+t,className:"sortable-list__item is-shadow",style:r},e),n]:n},g()(g()(n)))},n.getNavigationElement=function(){if(!n.props.allowDrag||Object(O.a)())return v.a.createElement("div",{className:"sortable-list__navigation"},v.a.createElement("button",{type:"button",onClick:n.moveItem.bind(null,"previous"),className:"sortable-list__navigation-button is-previous",disabled:null===n.state.activeIndex||0===n.state.activeIndex},v.a.createElement("span",{className:"screen-reader-text"},n.props.translate("Move previous")),v.a.createElement(I.a,{icon:"chevron-down",size:24})),v.a.createElement("button",{type:"button",onClick:n.moveItem.bind(null,"next"),className:"sortable-list__navigation-button is-next",disabled:null===n.state.activeIndex||n.state.activeIndex===n.props.children.length-1},v.a.createElement("span",{className:"screen-reader-text"},n.props.translate("Move next")),v.a.createElement(I.a,{icon:"chevron-up",size:24})))},n}return h()(t,e),l()(t,[{key:"componentWillMount",value:function(){T("Mounting "+this.constructor.displayName+" React component.")}},{key:"componentDidMount",value:function(){Object(O.a)()||(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)}},{key:"render",value:function(){var e=C()({"sortable-list":!0,"is-horizontal":"horizontal"===this.props.direction,"is-vertical":"vertical"===this.props.direction});return v.a.createElement("div",{className:e},v.a.createElement("ol",{ref:"list",className:"sortable-list__list"},this.getOrderedListItemElements()),this.getNavigationElement())}}]),t}(v.a.Component);P.propTypes={direction:E.a.oneOf(["horizontal","vertical"]),allowDrag:E.a.bool,onChange:E.a.func},P.defaultProps={direction:"horizontal",allowDrag:!0,onChange:w.noop},t.a=Object(j.localize)(P)},"./client/components/gallery-shortcode/index.jsx":function(e,t,n){"use strict";n.d(t,"a",function(){return O});var a=n("./node_modules/@babel/runtime/helpers/extends.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/createClass.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),p=n.n(u),m=n("./node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(m),f=n("./node_modules/prop-types/index.js"),g=n.n(f),b=n("./node_modules/react/index.js"),v=n.n(b),y=n("./node_modules/classnames/index.js"),E=n.n(y),j=n("./node_modules/debug/src/browser.js"),w=n.n(j),_=n("./node_modules/lodash/lodash.js"),C=n("./client/blocks/shortcode/index.js"),S=n("./client/lib/shortcode/index.js"),x=n("./client/lib/media/utils.js"),k=n("./client/lib/media/constants.js"),I=w()("calypso:gallery-shortcode"),O=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=d()(this,(e=p()(t)).call.apply(e,[this].concat(o))),n.filterRenderResult=function(e){if(!e.body&&!e.scripts&&!e.styles)return e;var t=Object(_.assign)({},e,{scripts:{"tiled-gallery":{src:"https://s0.wp.com/wp-content/mu-plugins/tiled-gallery/tiled-gallery.js"}},styles:{"tiled-gallery":{src:"https://s0.wp.com/wp-content/mu-plugins/tiled-gallery/tiled-gallery.css"},"gallery-styles":{src:"https://widgets.wp.com/gallery-preview/style.css"}}});return"slideshow"===n.getAttributes().type&&Object(_.assign)(t,{scripts:{"jquery-cycle":{src:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/js/jquery.cycle.min.js"},"jetpack-slideshow":{src:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/js/slideshow-shortcode.js",extra:'var jetpackSlideshowSettings = { "spinner": "https://s0.wp.com/wp-content/mu-plugins/shortcodes/img/slideshow-loader.gif" };'}},styles:{"jetpack-slideshow":{src:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/css/slideshow-shortcode.css"}}}),t},n.getAttributes=function(){var e=Object(_.pick)(n.props,"items","type","columns","orderBy","link","size");return n.props.children&&Object(_.assign)(e,Object(S.b)(n.props.children).attrs.named),e},n.getShortcode=function(){return n.props.children?n.props.children:Object(x.e)(n.getAttributes())},n}return h()(t,e),l()(t,[{key:"render",value:function(){var e=this.getShortcode();if(!e)return null;var t=E()("gallery-shortcode",this.props.className);return I(e),v.a.createElement(C.a,o()({},Object(_.omit)(this.props,Object.keys(this.constructor.propTypes)),{siteId:this.props.siteId,filterRenderResult:this.filterRenderResult,className:t}),e)}}]),t}(v.a.Component);O.propTypes={siteId:g.a.number.isRequired,children:g.a.string,items:g.a.array,type:g.a.string,columns:g.a.number,orderBy:g.a.string,link:g.a.string,size:g.a.string,className:g.a.string},O.defaultProps=k.b},"./client/components/header-cake/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n.n(f),b=n("./node_modules/classnames/index.js"),v=n.n(b),y=n("./client/components/card/index.jsx"),E=n("./node_modules/i18n-calypso/index.js"),j=n("./node_modules/gridicons/dist/index.js"),w=n.n(j),_=n("./node_modules/lodash/lodash.js"),C=n("./client/components/button/index.jsx"),S=n("./client/lib/viewport/index.js"),x=480,k=8,I=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.state={windowWidth:Object(S.a)()},n.handleWindowResize=function(){n.setState({windowWidth:Object(S.a)()})},n}return p()(t,e),s()(t,[{key:"componentDidMount",value:function(){this.resizeThrottled=Object(_.throttle)(this.handleWindowResize,100),window.addEventListener("resize",this.resizeThrottled)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resizeThrottled)}},{key:"hideText",value:function(e){return!this.props.alwaysShowActionText&&(this.state.windowWidth<=x&&e.length>=k||this.state.windowWidth<=300)}},{key:"render",value:function(){var e=this.props,t=e.href,n=e.icon,a=e.onClick,o=e.spacer,i=e.text,s=e.translate,r=void 0===i?s("Back"):i,l=v()({"header-cake__back":!0,"is-spacer":o,"is-action":!!n});return g.a.createElement(C.a,{compact:!0,borderless:!0,className:l,href:t,onClick:a,disabled:o},g.a.createElement(w.a,{icon:n||"arrow-left",size:18}),!this.hideText(r)&&r)}}]),t}(f.Component);I.propTypes={onClick:h.a.func,href:h.a.string,text:h.a.string,spacer:h.a.bool,alwaysShowActionText:h.a.bool},I.defaultProps={spacer:!1,disabled:!1,alwaysShowActionText:!1};var O=Object(E.localize)(I);n.d(t,"a",function(){return T});var T=function(e){function t(){return o()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"render",value:function(){var e=this.props,t=e.backText,n=e.backHref,a=e.actionButton,o=e.actionText,i=e.actionIcon,s=e.actionHref,r=e.actionOnClick,l=e.alwaysShowActionText,c=v()("header-cake",this.props.className,{"is-compact":this.props.isCompact});return g.a.createElement(y.a,{className:c},g.a.createElement(O,{text:t,href:n,onClick:this.props.onClick}),g.a.createElement("div",{className:"header-cake__title",onClick:this.props.onTitleClick},this.props.children),a||g.a.createElement(O,{text:o||t,href:s||n,onClick:r,icon:i,alwaysShowActionText:l,spacer:!r}))}}]),t}(f.Component);T.displayName="HeaderCake",T.propTypes={onClick:h.a.func,onTitleClick:h.a.func,backText:h.a.string,backHref:h.a.string,actionButton:h.a.element,actionText:h.a.string,actionHref:h.a.string,actionIcon:h.a.string,actionOnClick:h.a.func,alwaysShowActionText:h.a.bool},T.defaultProps={isCompact:!1,alwaysShowActionText:!1}},"./client/components/popover/menu-item.jsx":function(e,t,n){"use strict";n.d(t,"a",function(){return S});var a=n("./node_modules/@babel/runtime/helpers/extends.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/createClass.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),p=n.n(u),m=n("./node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(m),f=n("./node_modules/prop-types/index.js"),g=n.n(f),b=n("./node_modules/react/index.js"),v=n.n(b),y=n("./node_modules/classnames/index.js"),E=n.n(y),j=n("./node_modules/lodash/lodash.js"),w=n("./node_modules/gridicons/dist/index.js"),_=n.n(w),C=n("./client/components/external-link/index.jsx"),S=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=d()(this,(e=p()(t)).call.apply(e,[this].concat(o))),n.handleMouseOver=function(e){var t=n.props.focusOnHover;t&&e.target.focus(),n.props.onMouseOver()},n}return h()(t,e),l()(t,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.className,a=e.href,i=e.icon,s=e.isSelected,r=e.isExternalLink,l=Object(j.omit)(this.props,"icon","focusOnHover","isSelected","isExternalLink","className","itemComponent"),c=E()("popover__menu-item",n,{"is-selected":s}),d=this.props.itemComponent;return r&&a?(d=C.a,l.icon=!0):a&&(d="a"),v.a.createElement(d,o()({role:"menuitem",onMouseOver:this.handleMouseOver,tabIndex:"-1",className:c},l),i&&v.a.createElement(_.a,{icon:i,size:18}),t)}}]),t}(b.Component);S.propTypes={href:g.a.string,className:g.a.string,isSelected:g.a.bool,icon:g.a.string,focusOnHover:g.a.bool,onMouseOver:g.a.func,isExternalLink:g.a.bool,itemComponent:g.a.oneOfType([g.a.func,g.a.string])},S.defaultProps={isSelected:!1,focusOnHover:!0,onMouseOver:j.noop,itemComponent:"button"}},"./client/components/progress-bar/index.jsx":function(e,t,n){"use strict";n.d(t,"a",function(){return E});var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n.n(f),b=n("./node_modules/classnames/index.js"),v=n.n(b),y=n("./client/components/screen-reader-text/index.js"),E=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.state={allTimeMax:n.props.value},n}return p()(t,e),s()(t,[{key:"getCompletionPercentage",value:function(){var e=Math.ceil((this.props.canGoBackwards?this.props.value:this.state.allTimeMax)/this.props.total*100);return Math.min(e,100)}},{key:"renderBar",value:function(){var e=this.props.title?g.a.createElement(y.a,null,this.props.title):null,t={width:this.getCompletionPercentage()+"%"};return this.props.color&&(t.backgroundColor=this.props.color),g.a.createElement("div",{className:"progress-bar__progress",style:t},e)}},{key:"render",value:function(){var e=v()(this.props.className,"progress-bar",{"is-compact":this.props.compact,"is-pulsing":this.props.isPulsing});return g.a.createElement("div",{className:e},this.renderBar())}}],[{key:"getDerivedStateFromProps",value:function(e,t){return{allTimeMax:Math.max(t.allTimeMax,e.value)}}}]),t}(f.PureComponent);E.defaultProps={total:100,compact:!1,isPulsing:!1,canGoBackwards:!1},E.propTypes={value:h.a.number.isRequired,total:h.a.number,color:h.a.string,title:h.a.string,compact:h.a.bool,className:h.a.string,isPulsing:h.a.bool,canGoBackwards:h.a.bool}},"./client/components/redux-forms/redux-form-fieldset/index.jsx":function(e,t,n){"use strict";n.d(t,"a",function(){return g});var a=n("./node_modules/@babel/runtime/helpers/extends.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),s=n.n(i),r=n("./node_modules/prop-types/index.js"),l=n.n(r),c=n("./node_modules/react/index.js"),d=n.n(c),u=n("./node_modules/redux-form/es/Field.js"),p=n("./client/components/forms/form-fieldset/index.jsx"),m=n("./client/components/forms/form-label/index.jsx"),h=n("./client/components/forms/form-input-validation/index.jsx"),f=n("./client/components/forms/form-setting-explanation/index.jsx"),g=function(e){var t=e.inputComponent,n=e.input,a=e.meta,i=e.label,r=e.explanation,l=s()(e,["inputComponent","input","meta","label","explanation"]),c=!(!a.touched||!a.error);return d.a.createElement(p.a,null,i&&d.a.createElement(m.a,{htmlFor:n.name},i),d.a.createElement(t,o()({id:n.name,isError:c},n,l)),c&&d.a.createElement(h.a,{isError:!0,text:a.error}),r&&d.a.createElement(f.a,null,r))},b=function(e){var t=e.component,n=s()(e,["component"]);return d.a.createElement(u.a,o()({component:g,inputComponent:t},n))};b.propTypes={name:l.a.string.isRequired,component:l.a.func.isRequired,label:l.a.node,explanation:l.a.node},t.b=b},"./client/components/remove-button/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/gridicons/dist/index.js"),h=n.n(m),f=n("./node_modules/prop-types/index.js"),g=n.n(f),b=n("./node_modules/react/index.js"),v=n.n(b),y=n("./node_modules/i18n-calypso/index.js"),E=n("./client/components/button/index.jsx"),j=function(e){function t(){return o()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"render",value:function(){var e=this.props,t=e.onRemove,n=e.translate;return v.a.createElement(E.a,{onClick:t,compact:!0,className:"remove-button"},v.a.createElement("span",{className:"remove-button__label screen-reader-text"},n("Remove")),v.a.createElement(h.a,{icon:"cross",size:24,className:"remove-button__icon"}))}}]),t}(v.a.Component);j.propTypes={onRemove:g.a.func.isRequired,translate:g.a.func.isRequired},t.a=Object(y.localize)(j)},"./client/components/tinymce/i18n.js":function(e,t,n){"use strict";var a=n("./node_modules/i18n-calypso/index.js"),o=n.n(a);t.a={Formats:o.a.translate("Formats",{context:"TinyMCE"}),Headings:o.a.translate("Headings",{context:"TinyMCE"}),"Heading 1":o.a.translate("Heading 1"),"Heading 2":o.a.translate("Heading 2"),"Heading 3":o.a.translate("Heading 3"),"Heading 4":o.a.translate("Heading 4"),"Heading 5":o.a.translate("Heading 5"),"Heading 6":o.a.translate("Heading 6"),Blocks:o.a.translate("Blocks",{context:"TinyMCE",comment:"block tags"}),Paragraph:o.a.translate("Paragraph"),Blockquote:o.a.translate("Blockquote"),Div:o.a.translate("Div",{context:"HTML tag"}),Pre:o.a.translate("Pre",{context:"HTML tag"}),Preformatted:o.a.translate("Preformatted",{context:"HTML tag"}),Address:o.a.translate("Address",{context:"HTML tag"}),Inline:o.a.translate("Inline",{context:"HTML elements"}),Underline:o.a.translate("Underline"),Strikethrough:o.a.translate("Strikethrough"),Subscript:o.a.translate("Subscript"),Superscript:o.a.translate("Superscript"),"Clear formatting":o.a.translate("Clear formatting"),Bold:o.a.translate("Bold"),Italic:o.a.translate("Italic"),"Source code":o.a.translate("Source code"),"Font Family":o.a.translate("Font Family"),"Font Sizes":o.a.translate("Font Sizes"),"Align center":o.a.translate("Align center"),"Align right":o.a.translate("Align right"),"Align left":o.a.translate("Align left"),Justify:o.a.translate("Justify"),"Increase indent":o.a.translate("Increase indent"),"Decrease indent":o.a.translate("Decrease indent"),Cut:o.a.translate("Cut"),Copy:o.a.translate("Copy"),Paste:o.a.translate("Paste"),"Select all":o.a.translate("Select all"),Undo:o.a.translate("Undo"),Redo:o.a.translate("Redo"),Ok:o.a.translate("OK"),Cancel:o.a.translate("Cancel"),Close:o.a.translate("Close"),"Visual aids":o.a.translate("Visual aids"),"Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off.":o.a.translate("Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off.")+"\n\n"+o.a.translate("If youâ€™re looking to paste rich content from Microsoft Word, try turning this option off. The editor will clean up text pasted from Word automatically."),"Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help":o.a.translate("Rich Text Area. Press Alt-Shift-H for help"),"You have unsaved changes are you sure you want to navigate away?":o.a.translate("The changes you made will be lost if you navigate away from this page."),"Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.":o.a.translate("Your browser does not support direct access to the clipboard. Please use keyboard shortcuts or your browserâ€™s edit menu instead."),"Bullet list":o.a.translate("Bulleted list"),"Numbered list":o.a.translate("Numbered list"),"Toolbar Toggle":o.a.translate("Toolbar Toggle"),"Insert Read More tag":o.a.translate("Insert Read More tag"),"Insert Page Break tag":o.a.translate("Insert Page Break tag"),"No alignment":o.a.translate("No alignment"),Remove:o.a.translate("Remove"),"Edit ":o.a.translate("Edit"),"Horizontal line":o.a.translate("Horizontal line"),"Text color":o.a.translate("Text color"),"Paste as text":o.a.translate("Paste as text")}},"./client/components/tinymce/plugins/simple-payments/dialog/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/objectSpread.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/createClass.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),p=n.n(u),m=n("./node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(m),f=n("./node_modules/prop-types/index.js"),g=n.n(f),b=n("./node_modules/react/index.js"),v=n.n(b),y=n("./node_modules/react-redux/es/index.js"),E=n("./node_modules/redux-form/es/getFormValues.js"),j=n("./node_modules/i18n-calypso/index.js"),w=n("./node_modules/lodash/lodash.js"),_=n("./client/state/ui/selectors.js"),C=n("./client/state/sites/selectors.js"),S=n("./client/state/selectors/get-simple-payments.js"),x=n("./client/components/data/query-simple-payments/index.js"),k=n("./client/components/data/query-site-plans/index.jsx"),I=n("./client/components/dialog/index.jsx"),O=n("./client/components/button/index.jsx"),T=n("./client/components/notice/index.jsx"),P=n("./client/components/tinymce/plugins/simple-payments/dialog/navigation.jsx"),D=n("./node_modules/@babel/runtime/helpers/extends.js"),N=n.n(D),R=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),M=n.n(R),A=n("./node_modules/redux-form/es/isValid.js"),L=n("./node_modules/redux-form/es/isDirty.js"),B=n("./node_modules/redux-form/es/Field.js"),U=n("./node_modules/redux-form/es/Fields.js"),F=n("./node_modules/redux-form/es/reduxForm.js"),q=n("./node_modules/email-validator/index.js"),z=n.n(q),V=n("./client/components/external-link/index.jsx"),H=n("./client/components/forms/form-text-input/index.jsx"),W=n("./client/components/forms/form-textarea/index.jsx"),G=n("./client/components/forms/form-currency-input/index.jsx"),K=n("./client/components/forms/form-toggle/compact.jsx"),Y=n("./client/components/redux-forms/redux-form-fieldset/index.jsx"),$=n("./client/lib/format-currency/index.js"),J=n("./node_modules/gridicons/dist/index.js"),Q=n.n(J),Z=n("./client/components/async-load/index.jsx"),X=n("./client/components/data/media-library-selected-data/index.jsx"),ee=n("./client/post-editor/editor-featured-image/preview-container.jsx"),te=n("./client/components/remove-button/index.jsx"),ne=n("./client/state/media/actions.js"),ae=n("./client/lib/media/actions.js"),oe=function(e){Promise.all([n.e(160),n.e(22),n.e(107),n.e(76),n.e(26),n.e(35)]).then(function(t){e(n("./client/post-editor/media-modal/index.jsx").__esModule?n("./client/post-editor/media-modal/index.jsx").default:n("./client/post-editor/media-modal/index.jsx"))}.bind(null,n)).catch(n.oe)},ie=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=d()(this,(e=p()(t)).call.apply(e,[this].concat(o))),n.state={isSelecting:!1},n.showMediaModal=function(e){e.key&&"Enter"!==e.key||n.setState({isSelecting:!0})},n.setImage=function(e){n.setState({isSelecting:!1},function(){e&&(n.props.input.onChange(e.items[0].ID),n.props.requestMediaItem(n.props.siteId,e.items[0].ID))})},n.removeCurrentImage=function(e){e.stopPropagation(),n.props.input.onChange(!1)},n.onImageChange=function(e){n.props.input.onChange(e),ae.a.setLibrarySelectedItems(n.props.siteId,[{ID:e}])},n}return h()(t,e),l()(t,[{key:"getImagePlaceholder",value:function(){return v.a.createElement("div",{className:"dialog__product-image-placeholder",onClick:this.showMediaModal,onKeyDown:this.showMediaModal,role:"button",tabIndex:0},v.a.createElement(Q.a,{icon:"add-image",size:36}),this.props.translate("Add an Image"))}},{key:"getCurrentImage",value:function(){var e=this.props.siteId;return v.a.createElement("div",{className:"dialog__product-image",onClick:this.showMediaModal,onKeyDown:this.showMediaModal,role:"button",tabIndex:0},v.a.createElement(ee.a,{siteId:e,itemId:this.props.input.value,onImageChange:this.onImageChange,showEditIcon:!0}),v.a.createElement(te.a,{onRemove:this.removeCurrentImage}))}},{key:"render",value:function(){var e=this.props,t=e.siteId,n=e.translate,a=e.makeDirtyAfterImageEdit,o=this.state.isSelecting;if(t)return v.a.createElement("div",{className:"dialog__product-image-picker"},v.a.createElement(X.a,{siteId:t},v.a.createElement(Z.a,{require:oe,siteId:t,onClose:this.setImage,enabledFilters:["images"],visible:o,isBackdropVisible:!1,labels:{confirm:n("Add")},single:!0,imageEditorProps:{doneButtonText:n("Update Payment Button")},onImageEditorDoneHook:a,onRestoreMediaHook:a})),v.a.createElement("div",{className:"dialog__product-image-container"},this.props.input.value&&this.getCurrentImage(),!this.props.input.value&&this.getImagePlaceholder()))}}]),t}(b.Component);ie.propTypes={siteId:g.a.number,translate:g.a.func};var se=Object(y.b)(function(e){return{siteId:Object(_.e)(e)}},{requestMediaItem:ne.f})(Object(j.localize)(ie)),re=["USD","EUR","AUD","BRL","CAD","CZK","DKK","HKD","HUF","ILS","JPY","MYR","MXN","TWD","NZD","NOK","PHP","PLN","GBP","RUB","SGD","SEK","CHF","THB"].map(function(e){var t=Object($.b)(e),n=t.symbol,a=n===e?e:e+" "+Object(w.trimEnd)(n,".");return{code:e,label:a}});var le=function(e){var t=e.price,n=e.currency,a=M()(e,["price","currency"]),o=Object($.b)(n.input.value),i=o.precision,s=i>0?Object(w.padEnd)("1.",i+2,"0"):"1";return v.a.createElement(Y.a,N()({inputComponent:G.a},t,Object(w.omit)(a,["names"]),{currencySymbolPrefix:n.input.value,onCurrencyChange:n.input.onChange,currencyList:re,placeholder:s}))},ce=function(e){function t(){return s()(this,t),d()(this,p()(t).apply(this,arguments))}return h()(t,e),l()(t,[{key:"render",value:function(){var e=this.props,t=e.translate,n=e.makeDirtyAfterImageEdit;return v.a.createElement("form",{className:"editor-simple-payments-modal__form"},v.a.createElement(B.a,{name:"featuredImageId",component:se,makeDirtyAfterImageEdit:n}),v.a.createElement("div",{className:"editor-simple-payments-modal__form-fields"},v.a.createElement(Y.b,{name:"title",label:t("What is this payment for?"),component:H.a,explanation:t("For example: event tickets, charitable donations, training courses, coaching fees, etc.")}),v.a.createElement(Y.b,{name:"description",label:t("Description"),component:W.a}),v.a.createElement(U.a,{names:["price","currency"],label:t("Price"),component:le}),v.a.createElement("div",null,v.a.createElement(Y.b,{name:"multiple",type:"checkbox",component:K.a},t("Allow people to buy more than one item at a time.")),v.a.createElement(Y.b,{name:"email",label:t("Email"),explanation:t("This is where PayPal will send your money. To claim a payment, you'll need a {{paypalLink}}PayPal account{{/paypalLink}} connected to a bank account.",{components:{paypalLink:v.a.createElement(V.a,{href:"https://paypal.com",target:"_blank"})}}),component:H.a}))))}}]),t}(b.Component),de=Object(w.flowRight)(j.localize,Object(F.a)({form:"simplePaymentsForm",enableReinitialize:!0,validate:function(e,t){var n,a,o=t.translate,i=Object($.b)(e.currency),s=i.precision,r={};if(e.title||(r.title=o("People need to know what they're paying for! Please add a brief title.")),e.price&&0!==parseFloat(e.price)){if(NaN===parseFloat(e.price))r.price=o("Invalid price");else if(parseFloat(e.price)<0)r.price=o("Your price is negative â€” now that doesn't sound right, does it?");else if(n=e.price,a=(""+n).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/),(a?Math.max(0,(a[1]?a[1].length:0)-(a[2]?+a[2]:0)):0)>s)if(0===s)r.price=o("We know every penny counts, but prices can't contain decimal values.");else{var l=o("%(precision)d decimal place","%(precision)d decimal places",{count:s,args:{precision:s}});r.price=o("Price cannot have more than %(countDecimal)s.",{args:{countDecimal:l}})}}else r.price=o("Everything comes with a price tag these days. Add yours here.");return e.email?z.a.validate(e.email)||(r.email=o("%(email)s is not a valid email address.",{args:{email:e.email}})):r.email=o("We want to make sure payments reach you, so please add an email address."),r}}))(ce),ue=n("./client/components/tinymce/plugins/simple-payments/dialog/list.jsx"),pe=n("./client/state/current-user/selectors.js"),me=n("./client/lib/wp/browser.js"),he=n("./client/lib/accept/index.js"),fe=n("./client/state/data-layer/wpcom/sites/simple-payments/index.js"),ge=n("./client/state/simple-payments/product-list/actions.js"),be=n("./client/lib/plans/constants.js"),ve=n("./client/state/sites/plans/selectors.js"),ye=n("./client/my-sites/upgrade-nudge/index.jsx"),Ee=n("./client/lib/analytics/track-component-view/index.jsx"),je=n("./client/state/analytics/actions.js"),we=n("./client/components/empty-content/index.jsx"),_e=n("./client/components/banner/index.jsx"),Ce=function(e){return Array.isArray(e)&&0===e.length},Se=function(e){return Object(fe.c)(function(e){return Object(E.a)("simplePaymentsForm")(e)}(e))},xe=function(e){return function(t,n){var a=Se(n());return me.a.site(e).addPost(a).then(function(n){var a=Object(fe.a)(n);return t(Object(je.k)(Object(je.b)(Object(je.i)("calypso_simple_payments_button_create",{price:a.price,currency:a.currency,id:a.ID}),Object(je.a)("calypso_simple_payments","button_created")),Object(ge.c)(e,a))),a})}},ke=function(e,t){return function(n,a){var o=Se(a());return me.a.site(e).post(t).update(o).then(function(a){var o=Object(fe.a)(a);return n(Object(je.k)(Object(je.b)(Object(je.i)("calypso_simple_payments_button_update",{id:t,currency:o.currency,price:o.price}),Object(je.a)("calypso_simple_payments","button_updated")),Object(ge.c)(e,o))),o})}},Ie=function(e,t){return function(n){var a=me.a.site(e).post(t);return a.delete().then(function(){return a.delete()}).then(function(){return n(Object(je.k)(Object(je.b)(Object(je.i)("calypso_simple_payments_button_delete",{id:t}),Object(je.a)("calypso_simple_payments","button_deleted")),Object(ge.a)(e,t)))})}},Oe=function(e){function t(e){var n;s()(this,t),n=d()(this,p()(t).call(this,e)),n.handleDialogClose=function(){n.checkUnsavedForm().then(function(e){return e&&n.props.onClose()})},n.handleChangeTabs=function(e){"form"===e?n.showButtonForm(null):n.checkUnsavedForm().then(function(e){return e&&n.showButtonList()})},n.showButtonForm=function(e){var t=n.getInitialFormFields(e);n.setState({activeTab:"form",editedPaymentId:e,initialFormValues:t})},n.handleSelectedChange=function(e){return n.setState({selectedPaymentId:e})},n.showError=function(e){return n._isMounted&&n.setState({errorMessage:e})},n.dismissError=function(){return n._isMounted&&n.setState({errorMessage:null})},n.handleInsert=function(){var e,t=n.props,a=t.siteId,o=t.dispatch,i=t.translate,s=n.state.activeTab;n.setIsSubmitting(!0),e="list"===s?Promise.resolve(n.state.selectedPaymentId):o(xe(a)).then(function(e){return e.ID}),e.then(function(e){return o(function(t,a){return Object(S.a)(a(),n.props.siteId,e)})}).then(function(e){n.props.onInsert({id:e.ID}),o(Object(je.b)(Object(je.i)("calypso_simple_payments_button_insert",{id:e.ID}),Object(je.a)("calypso_simple_payments","button_inserted")))}).catch(function(){return n.showError(i("The payment button could not be inserted."))}).then(function(){return n.setIsSubmitting(!1)})},n.handleSave=function(){n.setIsSubmitting(!0);var e=n.props,t=e.siteId,a=e.dispatch,o=e.translate,i=n.state.editedPaymentId;a(ke(t,i)).then(n.handleFormClose).catch(function(){return n.showError(o("The payment button could not be updated."))}).then(function(){return n.setIsSubmitting(!1)})},n.handleFormClose=function(){n.isDirectEdit()?n.props.onClose():n.showButtonList()},n.handleTrash=function(e){var t=n.props.translate,a=t("Are you sure you want to delete this item? It will be disabled and removed from all locations where it currently appears.");Object(he.a)(a,function(a){if(a){n.setIsSubmitting(!0);var o=n.props,i=o.siteId,s=o.dispatch;s(Ie(i,e)).catch(function(){return n.showError(t("The payment button could not be deleted."))}).then(function(){return n.setIsSubmitting(!1)})}},t("Delete"),null,{isScary:!0})},n.makeDirtyAfterImageEdit=function(){return n.setState({isDirtyAfterImageEdit:!0})},n._isMounted=!1;var a=n.props,o=a.editPaymentId,i=a.paymentButtons;return n.state={activeTab:o||Ce(i)?"form":"list",editedPaymentId:o,initialFormValues:n.getInitialFormFields(o),selectedPaymentId:null,isSubmitting:!1,errorMessage:null,isDirtyAfterImageEdit:!1},n}return h()(t,e),l()(t,[{key:"componentDidUpdate",value:function(e){this.props.showDialog&&!e.showDialog&&(this.props.editPaymentId?this.showButtonForm(this.props.editPaymentId):Ce(this.props.paymentButtons)?this.showButtonForm(null):this.showButtonList()),null===e.paymentButtons&&Ce(this.props.paymentButtons)&&this.showButtonForm(null)}},{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"getInitialFormFields",value:function(e){var t=this.constructor.initialFields,n=this.props,a=n.paymentButtons,i=n.currencyCode,s=n.currentUserEmail;if(Object(w.isNumber)(e)){var r=Object(w.find)(a,function(t){return t.ID===e});if(r)return Object(w.pick)(r,Object.keys(t))}var l=i||"USD",c=Object(w.get)(a,"0.email",s);return o()({},t,{currency:l,email:c})}},{key:"isDirectEdit",value:function(){return Object(w.isNumber)(this.props.editPaymentId)}},{key:"checkUnsavedForm",value:function(){var e=this,t="form"===this.state.activeTab&&this.props.formIsDirty;return t?new Promise(function(t){var n=e.props.translate;Object(he.a)(n("Wait! You have unsaved changes. Do you really want to discard them?"),t,n("Discard"),null,{isScary:!0})}):Promise.resolve(!0)}},{key:"showButtonList",value:function(){this.setState({activeTab:"list"})}},{key:"setIsSubmitting",value:function(e){this._isMounted&&this.setState({isSubmitting:e})}},{key:"getActionButtons",value:function(){var e,t,n,a,o=this.props,i=o.formIsValid,s=o.formIsDirty,r=o.translate,l=o.featuredImageId,c=this.state,d=c.activeTab,u=c.editedPaymentId,p=c.isSubmitting,m=c.isDirtyAfterImageEdit,h=i&&(s||m);"form"===d&&Object(w.isNumber)(u)?(e=this.handleFormClose,t=this.handleSave,n=!h,a=r("Done")):(e=this.props.onClose,t=this.handleInsert,n="form"===d&&!h||"list"===d&&null===this.state.selectedPaymentId,a=r("Insert"));var f=!Object(w.isEmpty)(l)&&!Object(w.isNumber)(l);return[v.a.createElement(O.a,{onClick:e,disabled:p},r("Cancel")),v.a.createElement(O.a,{onClick:t,busy:p,disabled:p||n||f,primary:!0},p?r("Savingâ€¦"):a)]}},{key:"renderEmptyDialog",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.props,a=n.onClose,o=n.translate,i=n.showDialog;return v.a.createElement(I.a,{isVisible:i,onClose:a,buttons:[v.a.createElement(O.a,{onClick:a},o("Close"))],additionalClassNames:"editor-simple-payments-modal"},v.a.createElement(Ee.a,{eventName:"calypso_simple_payments_dialog_view"}),!t&&v.a.createElement(P.a,{activeTab:"list",paymentButtons:[],onChangeTabs:w.noop}),e)}},{key:"returnTrue",value:function(){return!0}},{key:"render",value:function(){var e=this.props,t=e.showDialog,n=e.siteId,a=e.siteSlug,o=e.paymentButtons,i=e.currencyCode,s=e.isJetpackNotSupported,r=e.translate,l=e.planHasSimplePaymentsFeature,c=e.shouldQuerySitePlans,d=this.state,u=d.activeTab,p=d.initialFormValues,m=d.errorMessage,h="list"===u||"form"===u&&!this.isDirectEdit()&&!Ce(o);return!c&&s?this.renderEmptyDialog(v.a.createElement(we.a,{className:"upgrade-jetpack",illustration:"/calypso/images/illustrations/illustration-jetpack.svg",title:r("Upgrade Jetpack to use Simple Payments"),illustrationWidth:600,action:v.a.createElement(_e.a,{icon:"star",title:r("Upgrade your Jetpack!"),description:r("Simple Payments requires Jetpack version 5.2 or later."),feature:be.s,plan:be.X,href:"../../plugins/jetpack/"+a})}),!0):c||l?v.a.createElement(I.a,{isVisible:t,onClose:this.handleDialogClose,buttons:this.getActionButtons(),additionalClassNames:"editor-simple-payments-modal"},v.a.createElement(Ee.a,{eventName:"calypso_simple_payments_dialog_view"}),v.a.createElement(x.a,{siteId:n}),(!i||c)&&v.a.createElement(k.a,{siteId:n}),h&&v.a.createElement(P.a,{activeTab:u,paymentButtons:o,onChangeTabs:this.handleChangeTabs}),m&&v.a.createElement(T.b,{status:"is-error",text:m,onDismissClick:this.dismissError}),"form"===u?v.a.createElement(de,{initialValues:p,showError:this.showError,makeDirtyAfterImageEdit:this.makeDirtyAfterImageEdit}):v.a.createElement(ue.a,{siteId:n,paymentButtons:o,selectedPaymentId:this.state.selectedPaymentId,onSelectedChange:this.handleSelectedChange,onTrashClick:this.handleTrash,onEditClick:this.showButtonForm})):this.renderEmptyDialog(v.a.createElement(we.a,{illustration:"/calypso/images/illustrations/type-e-commerce.svg",illustrationWidth:300,title:r("Want to add a payment button to your site?"),action:v.a.createElement(ye.a,{className:"editor-simple-payments-modal__nudge-nudge",title:r("Upgrade your plan to our Premium or Business plan!"),message:r("Get simple payments, advanced social media tools, your own domain, and more."),feature:be.s,event:"editor_simple_payments_modal_nudge",shouldDisplay:this.returnTrue}),secondaryAction:v.a.createElement("a",{className:"empty-content__action button",href:"https://support.wordpress.com/simple-payments/"},r("Learn more about Simple Payments"))}),!0)}}]),t}(b.Component);Oe.propTypes={showDialog:g.a.bool.isRequired,editPaymentId:g.a.number,onClose:g.a.func.isRequired,onInsert:g.a.func.isRequired,isJetpackNotSupported:g.a.bool},Oe.initialFields={title:"",description:"",price:"",currency:"USD",multiple:!1,email:"",featuredImageId:null};t.a=Object(y.b)(function(e,t){var n=t.siteId;return n||(n=Object(_.e)(e)),{siteId:n,siteSlug:Object(C.w)(e,n),paymentButtons:Object(S.a)(e,n),currencyCode:Object(pe.d)(e),shouldQuerySitePlans:null===Object(ve.g)(e,n),isJetpackNotSupported:Object(C.K)(e,n)&&!Object(C.I)(e,n,"5.2"),planHasSimplePaymentsFeature:Object(ve.i)(e,n,be.s),formIsValid:function(e){return Object(A.a)("simplePaymentsForm")(e)}(e),formIsDirty:function(e){return Object(L.a)("simplePaymentsForm")(e)}(e),currentUserEmail:Object(pe.f)(e),featuredImageId:Object(w.get)(Object(E.a)("simplePaymentsForm")(e),"featuredImageId")}})(Object(j.localize)(Oe))},"./client/components/tinymce/plugins/simple-payments/dialog/list.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n.n(f),b=n("./node_modules/lodash/lodash.js"),v=n("./node_modules/i18n-calypso/index.js"),y=n("./node_modules/classnames/index.js"),E=n.n(y),j=n("./client/lib/format-currency/index.js"),w=n("./client/components/card/compact.jsx"),_=n("./client/components/ellipsis-menu/index.jsx"),C=n("./client/components/forms/form-radio/index.jsx"),S=n("./client/lib/catch-js-errors/log.js"),x=n("./client/components/popover/menu-item.jsx"),k=n("./node_modules/react-redux/es/index.js"),I=n("./client/lib/media/utils.js"),O=n("./client/components/data/query-media/index.jsx"),T=n("./client/state/selectors/get-media-item.js"),P=Object(k.b)(function(e,t){var n=t.siteId,a=t.imageId;return{image:a?Object(T.a)(e,n,a):null}})(function(e){var t=e.siteId,n=e.imageId,a=e.image;if(!t||!n)return null;if(!a)return g.a.createElement("figure",{className:"dialog__editor-simple-payments-modal-figure is-placeholder"},g.a.createElement(O.a,{siteId:t,mediaId:n}));var o=Object(I.s)(a,{size:"medium"});return g.a.createElement("div",{className:"dialog__editor-simple-payments-modal-figure-container"},g.a.createElement("figure",{className:"dialog__editor-simple-payments-modal-figure"},g.a.createElement("img",{className:"dialog__editor-simple-payments-modal-image",src:o,alt:"product"})))}),D=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.handleRadioChange=function(){return n.props.onSelectedChange(n.props.paymentId)},n.handleEditClick=function(){return n.props.onEditClick(n.props.paymentId)},n.handleTrashClick=function(){return n.props.onTrashClick(n.props.paymentId)},n}return p()(t,e),s()(t,[{key:"formatPrice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"USD";if(isNaN(e))return Object(S.default)("Simple Payments: invalid price value",{siteId:this.props.siteId,paymentId:this.props.paymentId,price:e}),"---- "+t;var n=Object(j.c)(e,t),a=n.integer,o=n.fraction;return""+a+o+" "+t}},{key:"render",value:function(){var e=this.props,t=e.siteId,n=e.paymentId,a=e.title,o=e.price,i=e.currency,s=e.featuredImageId,r=e.isSelected,l=e.translate,c="simple-payments-list-item-radio-"+n,d=E()({"editor-simple-payments-modal__list-label":!0,"is-error":isNaN(o)});return g.a.createElement(w.a,{className:"editor-simple-payments-modal__list-item"},g.a.createElement(C.a,{name:"selection",id:c,value:n,checked:r,onChange:this.handleRadioChange}),g.a.createElement("label",{className:d,htmlFor:c},g.a.createElement("div",{className:"editor-simple-payments-modal__list-name"},a),g.a.createElement("div",null,this.formatPrice(o,i))),g.a.createElement(P,{siteId:t,imageId:s}),g.a.createElement(_.a,{className:"editor-simple-payments-modal__list-menu",popoverClassName:"is-dialog-visible",position:"bottom left"},g.a.createElement(x.a,{icon:"pencil",onClick:this.handleEditClick},l("Edit")),g.a.createElement(x.a,{icon:"trash",onClick:this.handleTrashClick},l("Trash"))))}}]),t}(f.Component);D.propTypes={onSelectedChange:h.a.func,onEditClick:h.a.func,onTrashClick:h.a.func},D.defaultProps={onSelectedChange:b.noop,onEditClick:b.noop,onTrashClick:b.noop};var N=Object(v.localize)(D),R=Object(v.localize)(function(e){var t=e.translate;return g.a.createElement(w.a,{className:"editor-simple-payments-modal__list-item is-placeholder"},g.a.createElement("div",{className:"editor-simple-payments-modal__list-label"},g.a.createElement("div",null,g.a.createElement("span",{className:"placeholder-text"},t("Loading payment buttonsâ€¦"))),g.a.createElement("div",null,g.a.createElement("span",{className:"placeholder-text"},"$1000"))))}),M=function(e){function t(){return o()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"renderListItems",value:function(){var e=this.props,t=e.siteId,n=e.paymentButtons,a=e.selectedPaymentId,o=e.onSelectedChange,i=e.onEditClick,s=e.onTrashClick;return n?n.map(function(e){var n=e.ID,r=e.title,l=e.price,c=e.currency,d=e.featuredImageId;return g.a.createElement(N,{key:n,siteId:t,paymentId:n,isSelected:a===n,title:r,price:l,currency:c,featuredImageId:d,onSelectedChange:o,onEditClick:i,onTrashClick:s})}):Object(b.range)(2).map(function(e){return g.a.createElement(R,{key:e})})}},{key:"render",value:function(){return g.a.createElement("div",{className:"editor-simple-payments-modal__list"},this.renderListItems())}}]),t}(f.Component);M.propTypes={siteId:h.a.number.isRequired,paymentButtons:h.a.array,selectedPaymentId:h.a.number,onSelectedChange:h.a.func,onEditClick:h.a.func,onTrashClick:h.a.func},M.defaultProps={selectedPaymentId:null,onSelectedChange:b.noop,onEditClick:b.noop,onTrashClick:b.noop};t.a=M},"./client/components/tinymce/plugins/simple-payments/dialog/navigation.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n.n(f),b=n("./node_modules/i18n-calypso/index.js"),v=n("./node_modules/gridicons/dist/index.js"),y=n.n(v),E=n("./client/components/section-header/index.jsx"),j=n("./client/components/header-cake/index.jsx"),w=n("./client/components/button/index.jsx"),_=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.onChangeTabs=function(e){return function(){return n.props.onChangeTabs(e)}},n}return p()(t,e),s()(t,[{key:"render",value:function(){var e=this.props,t=e.paymentButtons,n=e.activeTab,a=e.translate,o="editor-simple-payments-modal__navigation";return"form"===n?g.a.createElement(j.a,{className:o,onClick:this.onChangeTabs("list"),backText:a("Payment Buttons")}):t?g.a.createElement(E.a,{className:o,label:a("Payment Buttons"),count:t.length},g.a.createElement(w.a,{compact:!0,onClick:this.onChangeTabs("form")},g.a.createElement(y.a,{icon:"plus-small"})," ",a("Add New"))):g.a.createElement(E.a,{className:o})}}]),t}(f.Component);_.propTypes={activeTab:h.a.oneOf(["list","form"]).isRequired,onChangeTabs:h.a.func.isRequired,paymentButtons:h.a.array},t.a=Object(b.localize)(_)},"./client/components/tinymce/plugins/wplink/plugin.js":function(e,t,n){"use strict";var a=n("./node_modules/react-dom/index.js"),o=n.n(a),i=n("./node_modules/react/index.js"),s=n.n(i),r=n("./node_modules/tinymce/tinymce.js"),l=n.n(r),c=n("./node_modules/i18n-calypso/index.js"),d=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),u=n.n(d),p=n("./node_modules/@babel/runtime/helpers/createClass.js"),m=n.n(p),h=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),f=n.n(h),g=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),b=n.n(g),v=n("./node_modules/@babel/runtime/helpers/inherits.js"),y=n.n(v),E=n("./node_modules/prop-types/index.js"),j=n.n(E),w=n("./node_modules/react-redux/es/index.js"),_=n("./node_modules/lodash/lodash.js"),C=n("./node_modules/gridicons/dist/index.js"),S=n.n(C),x=n("./client/lib/media-serialization/index.js"),k=n("./client/lib/media/store.js"),I=n("./client/lib/media/utils.js"),O=n("./client/components/dialog/index.jsx"),T=n("./client/components/forms/form-text-input/index.jsx"),P=n("./client/components/forms/form-checkbox/index.jsx"),D=n("./client/components/forms/form-button/index.jsx"),N=n("./client/components/forms/form-fieldset/index.jsx"),R=n("./client/components/forms/form-label/index.jsx"),M=n("./client/my-sites/post-selector/index.jsx"),A=n("./client/state/ui/selectors.js"),L=n("./client/state/posts/selectors.js"),B=n("./client/lib/formatting/index.js"),U=n("./client/state/posts/stats.js"),F=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,q=/^(https?|ftp):\/\/[A-Z0-9.-]+\.[A-Z]{2,4}[^ "]*$/i,z=/^(?:[a-z]+:|#|\?|\.|\/)/,V=function(e){function t(){var e,n;u()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=f()(this,(e=b()(t)).call.apply(e,[this].concat(o))),n.getLink=function(){var e=n.props.editor;return e.dom.getParent(e.selection.getNode(),"a")},n.getCorrectedUrl=function(){var e=n.state.url.trim();return F.test(e)?"mailto:"+e:z.test(e)?e:"http://"+e},n.updateEditor=function(){var e,t,a,o=n.props.editor;o.focus(),l.a.isIE&&o.selection.moveToBookmark(o.windowManager.bookmark),n.state.url?(t=n.getLink(),a=n.state.linkText,e={href:n.getCorrectedUrl(),target:n.state.newWindow?"_blank":""},t?(a&&("innerText"in t?t.innerText=a:t.textContent=a),o.dom.setAttribs(t,e)):a?(a=o.dom.encode(a),o.selection.setNode(o.dom.create("a",e,a))):o.execCommand("mceInsertLink",!1,e),n.closeDialog()):n.removeLink()},n.hasSelectedText=function(e){var t,a,o=n.props.editor,i=o.selection.getContent();if(/</.test(i)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(i)||-1===i.indexOf("href=")))return!1;if(e){if(t=e.childNodes,0===t.length)return!1;for(a=t.length-1;a>=0;a--)if(3!==t[a].nodeType)return!1}return!0},n.getInferredUrl=function(){var e,t,a,o=n.props.editor.selection.getContent();if(F.test(o))return"mailto:"+o;if(q.test(o))return o.replace(/&amp;|&#0?38;/gi,"&");if(e=n.props.editor.selection.getNode(),e&&"IMG"===e.nodeName){if(t=Object(x.a)(e),n.props.site&&t.media.ID)return a=k.a.get(n.props.site.ID,t.media.ID)||t.media,Object(I.s)(a,{size:"full"});if(t.media.URL)return t.media.URL}},n.getState=function(){var e=n.props.editor,t=e.selection.getNode(),a=e.dom.getParent(t,"a[href]"),o=n.hasSelectedText(a),i={isNew:!0,newWindow:!1,showLinkText:!0,linkText:"",url:"",isUserDefinedLinkText:!1};return a?(i.linkText=a.innerText||a.textContent,i.url=e.dom.getAttrib(a,"href"),i.newWindow="_blank"===e.dom.getAttrib(a,"target"),i.isNew=!1):o&&(i.linkText=e.selection.getContent({format:"text"})),a||(i.url=n.getInferredUrl()||""),n.hasSelectedText(a)||(i.showLinkText=!1),i},n.closeDialog=function(){n.props.onClose()},n.setUrl=function(e){n.setState({url:e.target.value})},n.setLinkText=function(e){n.setState({linkText:e.target.value,isUserDefinedLinkText:!0})},n.setNewWindow=function(e){n.setState({newWindow:e.target.checked})},n.onInputKeyDown=function(e){"Enter"===e.key&&(e.preventDefault(),n.updateEditor())},n.removeLink=function(){n.props.editor.execCommand("unlink"),n.closeDialog()},n.getButtons=function(){var e,t;return e=n.state.isNew?n.props.translate("Add Link"):n.props.translate("Save"),t=[s.a.createElement(D.a,{key:"save",onClick:n.updateEditor},e),s.a.createElement(D.a,{key:"cancel",isPrimary:!1,onClick:n.closeDialog},n.props.translate("Cancel"))],n.state.url&&!n.state.isNew&&t.push(s.a.createElement("button",{className:"wplink__remove-link",onClick:n.removeLink},s.a.createElement(S.a,{icon:"link-break"}),n.props.translate("Remove"))),t},n.setExistingContent=function(e){var t={url:e.URL},a=!n.state.isUserDefinedLinkText&&!n.props.editor.selection.getContent()&&!n.getLink();a&&Object.assign(t,{linkText:Object(B.b)(e.title)}),n.props.recordEditorStat("link-existing-content"),n.props.recordEditorEvent("Set link to existing content"),n.setState(t)},n.getSelectedPostId=function(){if(n.state.url&&n.props.sitePosts){var e=Object(_.find)(n.props.sitePosts,{URL:n.state.url});return e?e.ID:void 0}},n.state=n.getState(),n}return y()(t,e),m()(t,[{key:"componentWillReceiveProps",value:function(e){e.visible&&!this.props.visible&&this.setState(this.getState())}},{key:"render",value:function(){return s.a.createElement(O.a,{isVisible:this.props.visible,onClose:this.closeDialog,buttons:this.getButtons(),autoFocus:!1,additionalClassNames:"wplink__dialog"},s.a.createElement(N.a,null,s.a.createElement(R.a,null,s.a.createElement("span",null,this.props.translate("URL")),s.a.createElement(T.a,{ref:"url",autoFocus:!0,onChange:this.setUrl,value:this.state.url,onKeyDown:this.onInputKeyDown})),this.state.showLinkText?s.a.createElement(R.a,null,s.a.createElement("span",null,this.props.translate("Link Text")),s.a.createElement(T.a,{onChange:this.setLinkText,value:this.state.linkText,onKeyDown:this.onInputKeyDown})):null),s.a.createElement(N.a,null,s.a.createElement(R.a,null,s.a.createElement(P.a,{onChange:this.setNewWindow,checked:this.state.newWindow}),s.a.createElement("span",null,this.props.translate("Open link in a new window/tab")))),s.a.createElement(N.a,null,s.a.createElement(R.a,null,s.a.createElement("span",null,this.props.translate("Link to existing content")),this.props.site&&s.a.createElement(M.a,{siteId:this.props.site.ID,type:"any",excludePrivateTypes:!0,status:"publish",orderBy:"date",order:"DESC",selected:this.getSelectedPostId(),onChange:this.setExistingContent,suppressFirstPageLoad:!this.props.firstLoad,emptyMessage:this.props.translate("No posts found")}))))}}]),t}(s.a.Component);V.propTypes={visible:j.a.bool,editor:j.a.object,onClose:j.a.func,site:j.a.object,sitePosts:j.a.array,firstLoad:j.a.bool},V.defaultProps={onClose:function(){},firstLoad:!1};var H=Object(w.b)(function(e){var t=Object(A.d)(e);return{site:t,sitePosts:t?Object(L.m)(e,t.ID):null}},{recordEditorEvent:U.a,recordEditorStat:U.b})(Object(c.localize)(V)),W=n("./client/lib/react-helpers/index.js");
/**
 * Adapted from the WordPress wplink TinyMCE plugin.
 *
 *
 * @format
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 */
function G(e){var t,n,a;e.on("init",function(){t=e.getContainer().appendChild(document.createElement("div"))}),e.on("remove",function(){o.a.unmountComponentAtNode(t),t.parentNode.removeChild(t),t=null}),e.addCommand("WP_Link",function(){return function n(){var o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Object(W.b)(s.a.createElement(H,{visible:o,editor:e,firstLoad:!a,onClose:function(){return n(!1)}}),t,e.getParam("redux_store")),o&&(a=!0),o||e.focus()}()}),e.addShortcut("access+a","","WP_Link"),e.addShortcut("meta+k","","WP_Link"),e.addButton("link",{icon:"link",tooltip:Object(c.translate)("Insert/edit link"),cmd:"WP_Link",stateSelector:"a[href]"}),e.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink"}),e.addMenuItem("link",{icon:"link",text:Object(c.translate)("Insert/edit link"),cmd:"WP_Link",stateSelector:"a[href]",context:"insert",prependToContext:!0}),e.on("pastepreprocess",function(t){var n=t.content;e.selection.isCollapsed()||(n=n.replace(/<[^>]+>/g,""),n=l.a.trim(n),/^(?:https?:)?\/\/\S+$/i.test(n)&&(e.execCommand("mceInsertLink",!1,{href:e.dom.decode(n)}),t.preventDefault()))}),l.a.ui.Factory.add("WPLinkPreview",l.a.ui.Control.extend({url:"#",renderHtml:function(){return'<div id="'+this._id+'" class="wp-link-preview"><a href="'+this.url+'" target="_blank" rel="noopener noreferrer" tabindex="-1">'+this.url+"</a></div>"},setURL:function(e){var t,n;this.url!==e&&(this.url=e,e=window.decodeURIComponent(e),e=e.replace(/^(?:https?:)?\/\/(?:www\.)?/,""),-1!==(t=e.indexOf("?"))&&(e=e.slice(0,t)),-1!==(t=e.indexOf("#"))&&(e=e.slice(0,t)),e=e.replace(/(?:index)?\.html$/,""),"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1)),e.length>40&&-1!==(t=e.indexOf("/"))&&-1!==(n=e.lastIndexOf("/"))&&n!==t&&(t+e.length-n<40&&(n=-(40-(t+1))),e=e.slice(0,t+1)+"â€¦"+e.slice(n)),l.a.$(this.getEl().firstChild).attr("href",this.url).text(e))}})),e.addButton("wp_link_preview",{type:"WPLinkPreview",onPostRender:function(){var t=this;e.on("wptoolbar",function(a){var o,i,s=e.dom.getParent(a.element,"a");s&&(o=e.$(s),i=o.attr("href"),i&&!o.find("img").length&&(t.setURL(i),a.element=s,a.toolbar=n))})}}),e.addButton("wp_link_edit",{tooltip:"Edit ",icon:"dashicon dashicons-edit",cmd:"WP_Link"}),e.addButton("wp_link_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",cmd:"unlink"}),e.on("preinit",function(){e.wp&&e.wp._createToolbar&&(n=e.wp._createToolbar(["wp_link_preview","wp_link_edit","wp_link_remove"],!0))})}t.a=function(){l.a.PluginManager.add("wplink",G)}},"./client/lib/analytics/page-view-tracker/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/debug/src/browser.js"),h=n.n(m),f=n("./node_modules/prop-types/index.js"),g=n.n(f),b=n("./node_modules/react/index.js"),v=n.n(b),y=n("./node_modules/lodash/lodash.js"),E=n("./node_modules/react-redux/es/index.js"),j=n("./client/lib/route/index.js"),w=n("./client/state/analytics/actions.js"),_=n("./client/state/utils.js"),C=n("./client/state/ui/selectors.js"),S=n("./client/state/sites/selectors.js"),x=h()("calypso:analytics:PageViewTracker"),k=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.state={timer:null},n.queuePageView=function(){var e=n.props,t=e.delay,a=void 0===t?0:t,o=e.path,i=e.recorder,s=void 0===i?y.noop:i,r=e.hasSelectedSiteLoaded,l=e.title,c=e.properties;if(x('Queuing Page View: "'+l+'" at "'+o+'" with '+a+"ms delay"),r&&!n.state.timer)return a?void n.setState({timer:setTimeout(function(){return s(o,l)},a)}):s(o,l,"default",c)},n}return p()(t,e),s()(t,[{key:"componentDidMount",value:function(){x("Component has mounted."),this.queuePageView()}},{key:"componentWillUnmount",value:function(){x("Component has unmounted."),clearTimeout(this.state.timer)}},{key:"componentDidUpdate",value:function(e){e.path===this.props.path&&e.selectedSiteId===this.props.selectedSiteId||this.queuePageView()}},{key:"render",value:function(){return null}}]),t}(v.a.Component);k.displayName="PageViewTracker",k.propTypes={delay:g.a.number,path:g.a.string.isRequired,recorder:g.a.func,hasSelectedSiteLoaded:g.a.bool,selectedSiteId:g.a.number,title:g.a.string.isRequired,properties:g.a.object};var I={recorder:Object(_.f)(w.h,[w.c])};t.a=Object(E.b)(function(e){var t=Object(C.e)(e),n=Object(S.w)(e,t),a="undefined"==typeof window?"":Object(j.d)(Object(y.get)(window,"location.pathname","")),o=!a||Object(y.isNumber)(a)&&a===t||a===n;return{hasSelectedSiteLoaded:o,selectedSiteId:t}},I)(k)},"./client/lib/media-serialization/index.js":function(e,t,n){"use strict";var a={};n.r(a),n.d(a,"deserialize",function(){return S});var o={};n.r(o),n.d(o,"deserialize",function(){return O});var i={};n.r(i),n.d(i,"deserialize",function(){return N});var s={};n.r(s),n.d(s,"deserialize",function(){return R});var r={};n.r(r),n.d(r,"deserialize",function(){return M});var l={};n.r(l),n.d(l,"deserialize",function(){return A});var c=n("./node_modules/@babel/runtime/helpers/typeof.js"),d=n.n(c),u=n("./node_modules/lodash/lodash.js"),p="DOM",m="STRING",h="SHORTCODE",f="OBJECT",g="API",b="UNKNOWN",v={IMAGE:"IMAGE",VIDEO:"VIDEO",AUDIO:"AUDIO",UNKNOWN:"UNKNOWN"},y=n("./client/lib/media/utils.js"),E=["closed","self-closing","single"],j=function(e){return"string"==typeof e?m:"object"===d()(e)&&"string"==typeof e.nodeName?p:e&&e.tag&&Object(u.includes)(E,e.type)?h:e&&e.type&&Object(u.includes)(v,e.type)?f:Object(y.g)(e)?g:b},w=/\bsize-(\w+)\b/,_=/\bwp-image-((media-)?\d+)\b/,C=/\balign(left|center|right|none)\b/;function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{media:{},appearance:{}};switch(e.nodeName){case"IMG":t=function(e,t){return t.type=v.IMAGE,t.media.URL=e.getAttribute("src"),t.media.alt=e.getAttribute("alt"),t.media.transient=e.hasAttribute("data-istransient"),["width","height"].forEach(function(n){var a="natural"+n[0].toUpperCase()+n.slice(1),o=e.getAttribute(n)||e[a]||e[n];o&&isFinite(o)&&(t.media[n]=parseInt(o,10))}),w.test(e.className)&&(t.appearance.size=e.className.match(w)[1]),C.test(e.className)&&(t.appearance.align=e.className.match(C)[1]),_.test(e.className)&&(t.media.ID=e.className.match(_)[1],isFinite(t.media.ID)&&(t.media.ID=parseInt(t.media.ID,10))),t}(e,t)}return t}var x=n("./client/lib/shortcode/index.js"),k=n("./client/lib/post-normalizer/utils.js"),I=function(e){var t;if(document.implementation&&document.implementation.createHTMLDocument)t=document.implementation.createHTMLDocument("").body;else try{return Object(k.b)(e).firstChild}catch(e){}return t=t||document.createElement("div"),t.innerHTML=e,t.firstChild};function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{media:{},appearance:{}};return[function(e,t){var n=Object(x.b)(e);return n?B(n,t):t},function(e,t){var n=I(e);return n instanceof window.Element?B(n,t):t}].reduce(function(n,a){return Object.assign(n,a(e,t))},{})}var T=/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i,P=/attachment_(\d+)/,D=/align(\w+)/;function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{media:{},appearance:{}};switch(e.tag){case"caption":t=function(e,t){if(e.attrs&&e.attrs.named&&(D.test(e.attrs.named.align)&&(t.appearance.align=e.attrs.named.align.match(D)[1]),P.test(e.attrs.named.id)&&(t.media.ID=parseInt(e.attrs.named.id.match(P)[1],10)),t.media.width&&isFinite(e.attrs.named.width)&&(t.media.width=parseInt(e.attrs.named.width,10))),!e.content)return t;var n=e.content.match(T);return n&&n[2]&&(t.media.caption=n[2].trim()),n?B(n[1],t):t}(e,t)}return t}function R(e){return e}function M(e){var t={media:Object(u.assign)({transient:!1},e),appearance:{}};switch(Object(y.g)(e)){case"image":t.type=v.IMAGE;break;case"audio":t.type=v.AUDIO;break;case"video":t.type=v.VIDEO}return t}function A(){return{type:v.UNKNOWN,media:{},appearance:{}}}var L={dom:a,string:o,shortcode:i,object:s,api:r,unknown:l};function B(e,t){var n=j(e);return L[n.toLowerCase()].deserialize(e,t)}n.d(t,"a",function(){return B})},"./client/lib/media/library-selected-store.js":function(e,t,n){"use strict";var a=n("./node_modules/lodash/lodash.js"),o=n("./client/lib/media/store.js"),i=n("./client/dispatcher/index.js"),s=n("./client/lib/mixins/emitter/index.js"),r={_media:{}};function l(e,t){r._media[e]=Object(a.map)(t,"ID")}function c(e,t){!function(e){e in r._media||(r._media[e]=[])}(e),r._media[e].push(t.ID)}function d(e,t,n){var a;n||(n=t.ID),n&&e in r._media&&(a=r._media[e].indexOf(n),-1!==a&&r._media[e].splice(a,1,t.ID))}function u(e,t){var n;e in r._media&&(n=r._media[e].indexOf(t.ID),-1!==n&&r._media[e].splice(n,1))}Object(s.a)(r),r.get=function(e,t){return o.a.get(e,t)},r.getAll=function(e){return e in r._media?r._media[e].map(function(t){return o.a.get(e,t)}).filter(function(e){return e&&(e.guid||e.transient)}):[]},r.dispatchToken=i.a.register(function(e){var t,n,a=e.action;switch(i.a.waitFor([o.a.dispatchToken]),a.type){case"CHANGE_MEDIA_SOURCE":l(a.siteId,[]),r.emit("change");break;case"SET_MEDIA_LIBRARY_SELECTED_ITEMS":if(a.error||!a.siteId||!a.data||!Array.isArray(a.data))break;l(a.siteId,a.data),r.emit("change");break;case"CREATE_MEDIA_ITEM":!a.error&&a.siteId&&a.data&&(c(a.siteId,a.data),r.emit("change"));break;case"RECEIVE_MEDIA_ITEM":if(a.error&&a.siteId&&a.id&&(u(a.siteId,{ID:a.id}),r.emit("change")),!a.siteId||!a.data||a.error)break;d(a.siteId,a.data,a.id),r.emit("change");break;case"RECEIVE_MEDIA_ITEMS":!a.error&&a.siteId&&a.data&&a.data.media&&(t=a.siteId,n=a.data.media,n.forEach(function(e){d(t,e)}),r.emit("change"));break;case"REMOVE_MEDIA_ITEM":if(!a.siteId||!a.data||a.error)break;u(a.siteId,a.data),r.emit("change")}}),t.a=r},"./client/lib/react-helpers/index.js":function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return c});var a=n("./node_modules/react-dom/index.js"),o=n.n(a),i=n("./node_modules/react/index.js"),s=n.n(i),r=n("./node_modules/react-redux/es/index.js");function l(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join(" â€º ")}function c(e,t,n){var a="string"==typeof t?document.getElementById(t):t;return o.a.render(s.a.createElement(r.a,{store:n},e),a)}},"./client/lib/react-pass-to-children/index.js":function(e,t,n){"use strict";var a=n("./node_modules/lodash/lodash.js"),o=n("./node_modules/react/index.js"),i=n.n(o);t.a=function(e,t){var n,o=Object(a.assign)({},e.props,t);return delete o.children,i.a.Children.count(e.props.children)>1?(n=i.a.Children.map(e.props.children,function(e){return i.a.isValidElement(e)?i.a.cloneElement(e,o):e}),i.a.createElement("div",null,n)):i.a.cloneElement(e.props.children,o)}},"./client/lib/seo/index.js":function(e,t,n){"use strict";n.d(t,"a",function(){return i});var a=n("./node_modules/lodash/lodash.js"),o=["Yoast SEO","Yoast SEO Premium","All In One SEO Pack","All in One SEO Pack Pro"],i=function(e){return function(e){return e.filter(function(e){var t=e.name;return Object(a.includes)(o,t)}).map(function(e){var t=e.name,n=e.slug;return{name:t,slug:n}})}(e)[0]}},"./client/my-sites/post-selector/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n.n(f),b=n("./node_modules/lodash/lodash.js"),v=n("./node_modules/@babel/runtime/helpers/objectSpread.js"),y=n.n(v),E=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),j=n.n(E),w=n("./node_modules/i18n-calypso/index.js"),_=n("./node_modules/react-redux/es/index.js"),C=n("./node_modules/classnames/index.js"),S=n.n(C),x=n("./node_modules/dom-helpers/util/scrollbarSize.js"),k=n.n(x),I=n("./node_modules/react-virtualized/dist/commonjs/List/index.js"),O=n.n(I),T=n("./node_modules/react-virtualized/dist/commonjs/AutoSizer/index.js"),P=n.n(T),D=function(e){function t(){return o()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"render",value:function(){var e,t;return t=this.props.translate("No results. Please try a different search."),this.props.createLink&&(e=this.props.translate("You may want to {{a}}create a new page{{/a}}.",{context:"Menus: item search/listing results",comment:"This is used when no posts or pages match the given search.",components:{a:g.a.createElement("a",{className:"create-link",href:this.props.createLink,target:"_blank",rel:"noopener noreferrer"})}})),g.a.createElement("span",{className:"is-empty-content"},t,"Â ",e)}}]),t}(g.a.Component);D.displayName="PostSelectorNoResults",D.propTypes={createLink:h.a.string};var N=Object(w.localize)(D),R=n("./client/lib/analytics/index.js"),M=n("./node_modules/gridicons/dist/index.js"),A=n.n(M),L=function(e){function t(){return o()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"render",value:function(){return g.a.createElement("div",{className:"post-selector__search"},g.a.createElement(A.a,{icon:"search",size:18}),g.a.createElement("input",{type:"search",placeholder:this.props.translate("Searchâ€¦",{textOnly:!0}),value:this.props.searchTerm,onChange:this.props.onSearch}))}}]),t}(g.a.Component);L.displayName="PostSelectorSearch",L.propTypes={searchTerm:h.a.string,onSearch:h.a.func.isRequired};var B=Object(w.localize)(L),U=n("./client/lib/formatting/index.js"),F=n("./client/state/posts/selectors.js"),q=n("./client/state/post-types/selectors.js"),z=n("./client/state/sites/selectors.js"),V=n("./client/components/data/query-post-types/index.jsx"),H=n("./client/components/data/query-posts/index.jsx"),W=25,G=20,K=10,Y=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.state={searchTerm:"",requestedPages:[1]},n.recomputeRowHeights=function(){n.list&&(n.list.recomputeRowHeights(),n.isCompact()&&n.forceUpdate())},n.setListRef=function(e){n.list=e},n.setItemRef=function(e,t){if(t&&e){var a=n.itemHeights[e.global_ID]||W,o=t.clientHeight;n.itemHeights[e.global_ID]=o,a!==o&&n.queueRecomputeRowHeights()}},n.hasNoSearchResults=function(){return!n.props.loading&&n.props.posts&&!n.props.posts.length&&n.state.searchTerm},n.hasNoPosts=function(){return!n.props.loading&&n.props.posts&&!n.props.posts.length},n.getItem=function(e){if(n.props.posts)return n.props.posts[e]},n.isCompact=function(){return!(!n.props.posts||n.state.searchTerm||n.hasNoPosts())&&n.props.posts.length<n.props.searchThreshold},n.isTypeLabelsVisible=function(){return"boolean"==typeof n.props.showTypeLabels?n.props.showTypeLabels:"any"===n.props.queryWithVersion.type},n.isLastPage=function(){var e=n.props,t=e.lastPage,a=e.loading,o=n.state.requestedPages;return Object(b.includes)(o,t)&&!a},n.getPostChildren=function(e){var t=n.props.posts;return Object(b.filter)(t,function(t){var n=t.parent;return n&&n.ID===e})},n.getItemHeight=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?e.parent&&!t&&Object(b.includes)(n.postIds,e.parent.ID)?0:n.itemHeights[e.global_ID]?n.itemHeights[e.global_ID]:Object(b.reduce)(n.getPostChildren(e.ID),function(e,t){return e+n.getItemHeight(t,!0)},W):W},n.getRowHeight=function(e){var t=e.index;return n.getItemHeight(n.getItem(t))},n.getCompactContainerHeight=function(){return Object(b.range)(0,n.getRowCount()).reduce(function(e,t){return e+n.getRowHeight({index:t})},0)},n.getPageForIndex=function(e){var t=n.props,a=t.queryWithVersion,o=t.lastPage,i=a.number||G,s=Math.ceil(e/i);return Math.max(Math.min(s,o||1/0),1)},n.getRowCount=function(){var e=0;return n.props.posts&&(e+=n.props.posts.length),n.isLastPage()||(e+=1),e},n.setRequestedPages=function(e){var t=e.startIndex,a=e.stopIndex,o=n.state.requestedPages,i=Object(b.difference)(Object(b.range)(n.getPageForIndex(t-K),n.getPageForIndex(a+K)+1),o);i.length&&n.setState({requestedPages:o.concat(i)})},n.onSearch=function(e){var t=e.target.value;n.state.searchTerm&&!t&&n.props.onSearch(""),t!==n.state.searchTerm&&(n.hasPerformedSearch||(n.hasPerformedSearch=!0,R.default.ga.recordEvent(n.props.analyticsPrefix,"Performed Post Search")),n.setState({searchTerm:t}),n.debouncedSearch())},n.renderItem=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(n.props.excludePost===e.ID||e.parent&&!t&&Object(b.includes)(n.postIds,e.parent.ID))){var a=n.getPostChildren(e.ID);return g.a.createElement("div",{key:e.global_ID,ref:function(){for(var t,a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(t=n).setItemRef.apply(t,[e].concat(o))},className:"post-selector__list-item"},g.a.createElement("label",null,g.a.createElement("input",{name:"posts",type:n.props.multiple?"checkbox":"radio",value:e.ID,onChange:function(){for(var t,a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(t=n.props).onChange.apply(t,[e].concat(o))},checked:n.props.selected===e.ID,className:"post-selector__input"}),g.a.createElement("span",{className:"post-selector__label"},Object(U.b)(e.title||n.props.translate("Untitled")),n.isTypeLabelsVisible()&&g.a.createElement("span",{className:"post-selector__label-type",style:{paddingRight:n.isCompact()?0:k()()}},Object(U.b)(Object(b.get)(n.props.postTypes,[e.type,"labels","singular_name"],""))))),a.length>0&&g.a.createElement("div",{className:"post-selector__nested-list"},a.map(function(e){return n.renderItem(e,!0)})))}},n.renderEmptyContent=function(){var e;if(n.hasNoSearchResults()?e=g.a.createElement(N,{createLink:n.props.createLink,noResultsMessage:n.props.noResultsMessage}):n.hasNoPosts()&&(e=n.props.emptyMessage),e)return g.a.createElement("div",{key:"no-results",className:"post-selector__list-item is-empty"},e)},n.renderRow=function(e){var t=e.index,a=n.getItem(t);return a?n.renderItem(a):g.a.createElement("div",{key:"placeholder",className:"post-selector__list-item is-placeholder"},g.a.createElement("label",null,g.a.createElement("input",{type:n.props.multiple?"checkbox":"radio",disabled:!0,className:"post-selector__input"}),g.a.createElement("span",{className:"post-selector__label"},n.props.translate("Loadingâ€¦"))))},n.cellRendererWrapper=function(e){var t=e.key,a=e.style,o=j()(e,["key","style"]);return g.a.createElement("div",{key:t,style:a},n.renderRow(o))},n}return p()(t,e),s()(t,[{key:"componentWillMount",value:function(){var e=this;this.itemHeights={},this.hasPerformedSearch=!1,this.postIds=Object(b.map)(this.props.posts,"ID"),this.getPostChildren=Object(b.memoize)(this.getPostChildren),this.queueRecomputeRowHeights=Object(b.debounce)(this.recomputeRowHeights),this.debouncedSearch=Object(b.debounce)(function(){e.props.onSearch(e.state.searchTerm)},800)}},{key:"componentWillReceiveProps",value:function(e){Object(b.isEqual)(this.props.queryWithVersion,e.queryWithVersion)&&this.props.siteId===e.siteId||this.setState({requestedPages:[1]}),this.props.posts!==e.posts&&(this.getPostChildren.cache.clear(),this.postIds=Object(b.map)(e.posts,"ID"))}},{key:"componentDidUpdate",value:function(e){var t=e.selected!==this.props.selected||e.loading&&!this.props.loading;t&&this.list.forceUpdateGrid(),this.props.posts!==e.posts&&this.recomputeRowHeights()}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,a=t.siteId,o=t.queryWithVersion,i=t.suppressFirstPageLoad,s=t.posts,r=t.postTypes,l=this.state,c=l.requestedPages,d=l.searchTerm,u=this.isCompact(),p=this.isTypeLabelsVisible(),m=d.length>0||!u,h=S()("post-selector",n,{"is-compact":u,"is-type-labels-visible":p}),f=Object(b.filter)(c,function(e){return 1!==e||!i||!s});return g.a.createElement("div",{className:h},f.map(function(e){return g.a.createElement(H.a,{key:"page-"+e,siteId:a,query:y()({},o,{page:e})})}),p&&a&&!r&&g.a.createElement(V.a,{siteId:a}),m&&g.a.createElement(B,{searchTerm:d,onSearch:this.onSearch}),g.a.createElement("div",{className:"post-selector__results"},g.a.createElement(P.a,{key:JSON.stringify(o),disableHeight:u},function(t){var n=t.height,a=t.width;return g.a.createElement(O.a,{ref:e.setListRef,width:a,height:u?e.getCompactContainerHeight():n,onRowsRendered:e.setRequestedPages,noRowsRenderer:e.renderEmptyContent,rowCount:e.getRowCount(),estimatedRowSize:W,rowHeight:e.getRowHeight,rowRenderer:e.cellRendererWrapper})})))}}]),t}(g.a.Component);Y.displayName="PostSelectorPosts",Y.propTypes={siteId:h.a.number.isRequired,query:h.a.object,queryWithVersion:h.a.object,posts:h.a.array,lastPage:h.a.number,loading:h.a.bool,emptyMessage:h.a.string,createLink:h.a.string,selected:h.a.number,excludePost:h.a.number,onSearch:h.a.func,onChange:h.a.func,multiple:h.a.bool,showTypeLabels:h.a.bool},Y.defaultProps={analyticsPrefix:"Post Selector",searchThreshold:8,loading:!0,emptyMessage:"",posts:[],onSearch:function(){},onChange:function(){}};var $=Object(_.b)(function(e,t){var n=t.siteId,a=t.query,o=!Object(z.K)(e,n)||Object(z.I)(e,n,"5.0")?"1.2":void 0,i=y()({},a,{apiVersion:o});return{posts:Object(F.i)(e,n,i),found:Object(F.j)(e,n,i),lastPage:Object(F.k)(e,n,i),loading:Object(F.t)(e,n,i),postTypes:Object(q.b)(e,n),queryWithVersion:i}})(Object(w.localize)(Y));n.d(t,"a",function(){return J});var J=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.state={search:""},n.onSearch=function(e){e!==n.state.search&&n.setState({search:e})},n.getQuery=function(){var e=n.props,t=e.type,a=e.status,o=e.excludeTree,i=e.orderBy,s=e.order,r=e.excludePrivateTypes,l=n.state.search;return Object(b.reduce)({type:t,status:a,excludeTree:o,orderBy:i,order:s,excludePrivateTypes:r,search:l},function(e,t,n){return null===t||void 0===t?e:("orderBy"===n&&""!==l&&(t="date"),"order"===n&&""!==l&&(t="DESC"),e[Object(b.snakeCase)(n)]=t,e)},{})},n}return p()(t,e),s()(t,[{key:"render",value:function(){var e=this.props,t=e.siteId,n=e.multiple,a=e.onChange,o=e.emptyMessage,i=e.createLink,s=e.selected,r=e.excludeTree,l=e.showTypeLabels,c=e.suppressFirstPageLoad;return g.a.createElement($,{siteId:t,query:this.getQuery(),onSearch:this.onSearch,multiple:n,onChange:a,emptyMessage:o,createLink:i,selected:s,excludePost:r,showTypeLabels:l,suppressFirstPageLoad:c})}}]),t}(g.a.PureComponent);J.displayName="PostSelector",J.propTypes={type:h.a.string,excludePrivateTypes:h.a.bool,siteId:h.a.number.isRequired,status:h.a.string,multiple:h.a.bool,onChange:h.a.func,selected:h.a.number,excludeTree:h.a.number,emptyMessage:h.a.string,createLink:h.a.string,orderBy:h.a.oneOf(["title","date","modified","comment_count","ID"]),order:h.a.oneOf(["ASC","DESC"]),showTypeLabels:h.a.bool,suppressFirstPageLoad:h.a.bool},J.defaultProps={type:"post",status:"publish,private",multiple:!1,orderBy:"title",order:"ASC",suppressFirstPageLoad:!1}},"./client/post-editor/editor-drawer/label.jsx":function(e,t,n){"use strict";n.d(t,"a",function(){return l});var a=n("./node_modules/prop-types/index.js"),o=n.n(a),i=n("./node_modules/react/index.js"),s=n.n(i),r=n("./client/components/info-popover/index.jsx");function l(e){var t=e.children,n=e.labelText,a=e.helpText;return s.a.createElement("label",{className:"editor-drawer__label"},s.a.createElement("span",{className:"editor-drawer__label-text"},n,a&&s.a.createElement(r.a,{position:"top left"},a)),t)}l.propTypes={helpText:o.a.string,labelText:o.a.string}},"./client/post-editor/editor-featured-image/dropzone.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/react/index.js"),h=n.n(m),f=n("./node_modules/react-redux/es/index.js"),g=n("./node_modules/lodash/lodash.js"),b=n("./node_modules/i18n-calypso/index.js"),v=n("./client/components/drop-zone/index.jsx"),y=n("./client/lib/media/actions.js"),E=n("./client/lib/media/store.js"),j=n("./client/lib/media/utils.js"),w=function(){return h.a.createElement("svg",{width:"55",height:"42",viewBox:"0 0 55 42",xmlns:"http://www.w3.org/2000/svg"},h.a.createElement("title",null,"Featured Image"),h.a.createElement("g",{fillRule:"nonzero",fill:"#542B06"},h.a.createElement("path",{d:"M22 11c0-1.656 1.344-3 3-3s3 1.344 3 3-1.344 3-3 3-3-1.344-3-3zm18-7v12.33l-3.173 8.29-12.01.637L31.992 32H4c-2.21 0-4-1.79-4-4V4c0-2.21 1.79-4 4-4h32c2.21 0 4 1.79 4 4zm-4 0H4v14.888L12 10l11.79 13.1 3.174-3.7c1.596-1.864 4.48-1.864 6.074 0L36 22.852V4z"}),h.a.createElement("path",{d:"M41 16.667l3.443 9.27 9.89.406-7.762 6.136L49.24 42 41 36.52 32.76 42l2.67-9.52-7.763-6.14 9.89-.404"})))},_=n("./client/state/media/actions.js"),C=n("./client/state/posts/actions.js"),S=n("./client/state/ui/selectors.js"),x=n("./client/state/ui/editor/selectors.js"),k=n("./client/state/analytics/actions.js"),I=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.onFilesDrop=function(e){var t=Object(g.head)(Object(j.d)(e,"image"));if(!t)return!1;var a=Object(g.uniqueId)("featured-image"),o=n.props,i=o.siteId,s=o.site;E.a.on("change",function e(){var t=E.a.get(i,a),o=t&&Object(j.k)(t),s=!t;s?n.props.deleteMedia(i,a):n.props.receiveMedia(i,t),o||(E.a.off("change",e),t&&n.props.recordTracksEvent("calypso_editor_featured_image_upload",{source:"dropzone",type:"dragdrop"})),n.props.editPost(i,n.props.postId,{featured_image:t.ID})}),y.a.add(s,{ID:a,fileContents:t,fileName:t.name})},n}return p()(t,e),s()(t,[{key:"render",value:function(){return h.a.createElement(v.a,{className:"editor-featured-image__dropzone",dropZoneName:"featuredImage",icon:h.a.createElement(w,null),textLabel:this.props.translate("Set as Featured Image"),onFilesDrop:this.onFilesDrop})}}]),t}(m.Component);t.a=Object(f.b)(function(e){return{siteId:Object(S.e)(e),postId:Object(x.f)(e),site:Object(S.d)(e)}},{editPost:C.e,deleteMedia:_.a,receiveMedia:_.d,recordTracksEvent:k.i})(Object(b.localize)(I))},"./client/post-editor/editor-featured-image/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/react/index.js"),h=n.n(m),f=n("./node_modules/prop-types/index.js"),g=n.n(f),b=n("./node_modules/classnames/index.js"),v=n.n(b),y=n("./node_modules/gridicons/dist/index.js"),E=n.n(y),j=n("./node_modules/react-redux/es/index.js"),w=n("./node_modules/lodash/lodash.js"),_=n("./client/components/data/media-library-selected-data/index.jsx"),C=n("./client/post-editor/media-modal/index.jsx"),S=n("./client/lib/media/actions.js"),x=n("./client/state/posts/stats.js"),k=n("./client/post-editor/editor-featured-image/preview-container.jsx"),I=n("./client/post-editor/editor-featured-image/dropzone.jsx"),O=n("./client/state/selectors/is-drop-zone-visible.js"),T=n("./client/components/button/index.jsx"),P=n("./client/components/remove-button/index.jsx"),D=n("./client/state/selectors/get-media-item.js"),N=n("./client/state/posts/utils.js"),R=n("./client/components/data/query-media/index.jsx"),M=n("./node_modules/i18n-calypso/index.js"),A=n("./client/state/analytics/actions.js"),L=n("./client/state/ui/selectors.js"),B=n("./client/state/ui/editor/selectors.js"),U=n("./client/state/posts/selectors.js"),F=n("./client/state/posts/actions.js"),q=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.state={isSelecting:!1},n.showMediaModal=function(){var e=n.props,t=e.siteId,a=e.featuredImage;a&&S.a.setLibrarySelectedItems(t,[a]),n.setState({isSelecting:!0})},n.hideMediaModal=function(){n.setState({isSelecting:!1})},n.setImage=function(e){n.hideMediaModal(),n.props.onImageSelected(),e&&(n.props.editPost(n.props.siteId,n.props.postId,{featured_image:e.items[0].ID}),n.props.recordEditorStat("featured_image_set"),n.props.recordEditorEvent("Featured image set"),n.props.recordTracksEvent("calypso_editor_featured_image_upload",{source:"medialibrary",type:"click"}))},n.removeImage=function(){n.props.editPost(n.props.siteId,n.props.postId,{featured_image:""}),n.props.recordEditorStat("featured_image_removed"),n.props.recordEditorEvent("Featured image removed")},n.onImageChange=function(e){e!==n.props.featuredImageId&&n.props.editPost(n.props.siteId,n.props.postId,{featured_image:e})},n}return p()(t,e),s()(t,[{key:"renderMediaModal",value:function(){if(this.props.siteId)return h.a.createElement(_.a,{siteId:this.props.siteId},h.a.createElement(C.default,{visible:this.props.selecting||this.state.isSelecting,onClose:this.setImage,siteId:this.props.siteId,labels:{confirm:this.props.translate("Set Featured Image")},enabledFilters:["images"],single:!0}))}},{key:"renderCurrentImage",value:function(){var e=this.props,t=e.siteId,n=e.featuredImageId;if(n)return h.a.createElement(k.a,{siteId:t,itemId:n,maxWidth:this.props.maxWidth,onImageChange:this.onImageChange})}},{key:"render",value:function(){var e=this.props,t=e.siteId,n=e.featuredImageId,a=v()("editor-featured-image",{"is-assigned":!!n,"has-active-drop-zone":this.props.hasDropZone&&this.props.isDropZoneVisible});return h.a.createElement("div",{className:a},n&&h.a.createElement(R.a,{siteId:t,mediaId:n}),this.renderMediaModal(),h.a.createElement("div",{className:"editor-featured-image__inner-content"},h.a.createElement(T.a,{className:"editor-featured-image__current-image",onClick:this.showMediaModal,borderless:!0,compact:!0,"data-tip-target":"editor-featured-image-current-image"},this.renderCurrentImage(),h.a.createElement(E.a,{icon:"pencil",className:"editor-featured-image__edit-icon"})),n&&h.a.createElement(P.a,{onRemove:this.removeImage})),this.props.hasDropZone&&h.a.createElement(I.a,null))}}]),t}(m.Component);q.propTypes={featuredImage:g.a.object,hasDropZone:g.a.bool,isDropZoneVisible:g.a.bool,maxWidth:g.a.number,recordTracksEvent:g.a.func,selecting:g.a.bool,translate:g.a.func,onImageSelected:g.a.func},q.defaultProps={hasDropZone:!1,isDropZoneVisible:!1,maxWidth:450,onImageSelected:w.noop},t.a=Object(j.b)(function(e){var t=Object(L.e)(e),n=Object(B.f)(e),a=Object(U.a)(e,t,n),o=Object(N.g)(a);return{siteId:t,postId:n,featuredImageId:o,featuredImage:Object(D.a)(e,t,o),isDropZoneVisible:Object(O.a)(e,"featuredImage")}},{editPost:F.e,recordEditorStat:x.b,recordEditorEvent:x.a,recordTracksEvent:A.i})(Object(M.localize)(q))},"./client/post-editor/editor-featured-image/preview-container.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n.n(f),b=n("./node_modules/lodash/lodash.js"),v=n("./client/lib/media/actions.js"),y=n("./client/lib/media/store.js"),E=n("./node_modules/react-redux/es/index.js"),j=n("./node_modules/classnames/index.js"),w=n.n(j),_=n("./node_modules/gridicons/dist/index.js"),C=n.n(_),S=n("./client/lib/media/utils.js"),x=n("./client/components/spinner/index.jsx"),k=n("./client/components/spinner-line/index.jsx"),I=n("./client/components/image-preloader/index.jsx"),O=n("./client/state/ui/selectors.js"),T=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.state=n.constructor.initialState,n.isReceivingPersistedImage=function(e,t){var a=n.props.siteId;if(a!==t.siteId)return!1;var o=n.props.image;if(!o||!o.transient||!t.image)return!1;var i=y.a.get(a,o.ID);return i&&i.ID===t.image.ID},n.src=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props;if(e.image)return Object(S.s)(e.image,{maxWidth:n.props.maxWidth,size:"post-thumbnail"})},n.clearState=function(){Object(b.some)(n.state)&&n.setState(n.constructor.initialState)},n}return p()(t,e),s()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.src();if(t&&t!==this.src(e)){var n={height:this.refs.preview.clientHeight};this.isReceivingPersistedImage(this.props,e)&&(n.transientSrc=t),this.setState(n)}}},{key:"render",value:function(){var e,t=this.state.height,n=w()("editor-featured-image__preview",{"is-transient":Object(b.get)(this.props.image,"transient"),"has-assigned-height":!!t});return e=this.state.transientSrc?g.a.createElement("img",{src:this.state.transientSrc,className:"editor-featured-image__preview-image",alt:"placeholder"}):g.a.createElement(k.a,null),g.a.createElement("div",{ref:"preview",className:n,style:{height:t}},g.a.createElement(x.a,null),g.a.createElement(I.a,{placeholder:e,src:this.src(),onLoad:this.clearState,className:"editor-featured-image__preview-image"}),this.props.showEditIcon&&g.a.createElement(C.a,{icon:"pencil",className:"editor-featured-image__edit-icon"}))}}]),t}(f.Component);T.propTypes={siteId:h.a.number,image:h.a.object,maxWidth:h.a.number,showEditIcon:h.a.bool},T.initialState={height:null,transientSrc:null,showEditIcon:!1};var P=Object(E.b)(function(e){return{siteId:Object(O.e)(e)}})(T);n.d(t,"a",function(){return D});var D=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.state={image:null},n.fetchImage=function(){n.updateImageState(function(){n.state.image||Object(b.defer)(function(){v.a.fetch(n.props.siteId,n.props.itemId)})})},n.updateImageState=function(e){var t=y.a.get(n.props.siteId,n.props.itemId);n.setState({image:t},function(){"function"==typeof e&&e()}),Object(b.defer)(function(){n.props.onImageChange&&t&&t.ID&&n.props.onImageChange(t.ID)})},n}return p()(t,e),s()(t,[{key:"componentDidMount",value:function(){this.fetchImage(),y.a.on("change",this.updateImageState)}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.siteId,a=t.itemId;n===e.siteId&&a===e.itemId||this.fetchImage()}},{key:"componentWillUnmount",value:function(){y.a.off("change",this.updateImageState)}},{key:"render",value:function(){return g.a.createElement(P,{image:this.state.image,maxWidth:this.props.maxWidth,showEditIcon:!0})}}]),t}(g.a.Component);D.displayName="EditorFeaturedImagePreviewContainer",D.propTypes={siteId:h.a.number.isRequired,itemId:h.a.oneOfType([h.a.number,h.a.string]).isRequired,maxWidth:h.a.number,onImageChange:h.a.func,showEditIcon:h.a.bool}},"./client/post-editor/editor-theme-help/index.jsx":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(u),m=n("./node_modules/prop-types/index.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n.n(f),b=n("./node_modules/react-redux/es/index.js"),v=n("./node_modules/i18n-calypso/index.js"),y=n("./client/state/ui/selectors.js"),E=n("./client/state/sites/selectors.js"),j=n("./client/state/posts/stats.js"),w=function(e){function t(){var e,n;o()(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=l()(this,(e=d()(t)).call.apply(e,[this].concat(i))),n.recordClick=function(){return n.props.recordEditorStat("clicked_theme_help_link")},n}return p()(t,e),s()(t,[{key:"render",value:function(){var e=this.props,t=e.translate,n=e.themeHelpPath,a=e.className;return n?g.a.createElement("a",{className:a,href:n,onClick:this.recordClick},t("Need help setting up your site?")):null}}]),t}(f.PureComponent);w.propTypes={themeHelpPath:h.a.string,classname:h.a.string},t.a=Object(b.b)(function(e){var t=Object(y.e)(e);return{themeHelpPath:Object(E.x)(e,t)}},{recordEditorStat:j.b})(Object(v.localize)(w))},"./client/post-editor/index.js":function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"match",function(){return Lt}),n.d(a,"serialize",function(){return Bt}),n.d(a,"edit",function(){return Ut}),n.d(a,"getComponent",function(){return Ft});var o={};n.r(o),n.d(o,"match",function(){return Yt}),n.d(o,"serialize",function(){return $t}),n.d(o,"getComponent",function(){return Jt});var i=n("./node_modules/page/page.js"),s=n.n(i),r=n("./client/my-sites/controller.js"),l=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),c=n.n(l),d=n("./node_modules/react-dom/server.browser.js"),u=n.n(d),p=n("./node_modules/react/index.js"),m=n.n(p),h=n("./node_modules/i18n-calypso/index.js"),f=n.n(h),g=n("./node_modules/qs/lib/index.js"),b=n("./node_modules/valid-url/index.js"),v=n("./node_modules/lodash/lodash.js"),y=n("./client/lib/perfmon/index.js"),E=n("./client/state/posts/actions.js"),j=n("./client/lib/route/index.js"),w=n("./node_modules/@babel/runtime/helpers/extends.js"),_=n.n(w),C=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),S=n.n(C),x=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),k=n.n(x),I=n("./node_modules/@babel/runtime/helpers/createClass.js"),O=n.n(I),T=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),P=n.n(T),D=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),N=n.n(D),R=n("./node_modules/@babel/runtime/helpers/inherits.js"),M=n.n(R),A=n("./node_modules/react-dom/index.js"),L=n.n(A),B=n("./node_modules/prop-types/index.js"),U=n.n(B),F=n("./node_modules/react-redux/es/index.js"),q=n("./node_modules/classnames/index.js"),z=n.n(q),V=n("./node_modules/tinymce/tinymce.js"),H=n.n(V),W=n("./node_modules/uuid/index.js"),G=n("./client/components/async-load/index.jsx"),K=n("./node_modules/gridicons/dist/index.js"),Y=n.n(K),$=n("./client/components/tooltip/index.jsx"),J=n("./client/components/button/index.jsx"),Q=n("./client/state/posts/stats.js"),Z=n("./client/state/ui/selectors.js"),X=n("./client/state/ui/editor/selectors.js"),ee=n("./client/state/posts/selectors.js"),te=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={tooltip:!1},n.toggleStickyStatus=function(){var e,t;n.props.sticky?(e="advanced_sticky_disabled_toolbar",t="Off"):(e="advanced_sticky_enabled_toolbar",t="On"),n.props.recordEditorStat(e),n.props.recordEditorEvent("Changed Sticky Setting",t),n.props.editPost(n.props.siteId,n.props.postId,{sticky:!n.props.sticky}),n.setState({tooltip:!1})},n.enableTooltip=function(){n.setState({tooltip:!0})},n.disableTooltip=function(){n.setState({tooltip:!1})},n.stickyPostButtonRef=m.a.createRef(),n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.sticky,n=e.translate,a=z()("editor-sticky",{"is-sticky":t}),o=t?m.a.createElement("span",null,n("Marked as sticky")):m.a.createElement("div",null,n("Mark as sticky"),m.a.createElement("span",{className:"editor-sticky__explanation"},n("Stick post to the front page")));return m.a.createElement(J.a,{borderless:!0,className:a,onClick:this.toggleStickyStatus,onMouseEnter:this.enableTooltip,onMouseLeave:this.disableTooltip,"aria-label":n("Stick post to the front page"),ref:this.stickyPostButtonRef},m.a.createElement(Y.a,{icon:"bookmark"}),m.a.createElement($.a,{className:"editor-sticky__tooltip",context:this.stickyPostButtonRef.current,isVisible:this.state.tooltip,position:"bottom left"},o))}}]),t}(m.a.Component);te.displayName="EditorSticky",te.propTypes={postId:U.a.number,siteId:U.a.number,sticky:U.a.bool};var ne=Object(F.b)(function(e){var t=Object(X.f)(e),n=Object(Z.e)(e),a=Object(ee.c)(e,n,t,"sticky");return{postId:t,siteId:n,sticky:a}},{editPost:E.e,recordEditorStat:Q.b,recordEditorEvent:Q.a})(Object(h.localize)(te)),ae=n("./client/state/posts/utils.js"),oe=n("./client/lib/formatting/index.js"),ie=n("./client/components/data/query-post-types/index.jsx"),se=n("./client/state/post-types/selectors.js"),re=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={viewLinkTooltip:!1},n.showViewLinkTooltip=function(){n.setState({viewLinkTooltip:!0})},n.hideViewLinkTooltip=function(){n.setState({viewLinkTooltip:!1})},n.viewLinkTooltipContext=m.a.createRef(),n}return M()(t,e),O()(t,[{key:"getTooltipLabel",value:function(){var e=this.props,t=e.translate,n=e.currentPost,a=e.currentPostTypeObject;return"page"===n.type?t("View page"):"post"===n.type?t("View post"):a?Object(oe.b)(a.labels.view_item):t("View",{context:"verb"})}},{key:"render",value:function(){var e=this.props,t=e.siteId,n=e.currentPost;if(!n||!Object(ae.z)(n))return null;var a=n&&!Object(v.includes)(["page","post"],n.type);return m.a.createElement(J.a,{href:n.URL,target:"_blank",rel:"noopener noreferrer",ref:this.viewLinkTooltipContext,onMouseEnter:this.showViewLinkTooltip,onMouseLeave:this.hideViewLinkTooltip,borderless:!0},m.a.createElement(Y.a,{icon:"external"}),m.a.createElement($.a,{className:"editor-action-bar__view-post-tooltip",context:this.viewLinkTooltipContext.current,isVisible:this.state.viewLinkTooltip,position:"bottom left"},m.a.createElement("span",{className:"editor-action-bar__view-label"},t&&a&&m.a.createElement(ie.a,{siteId:t}),this.getTooltipLabel())))}}]),t}(m.a.Component),le=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.l)(e,t,n),o=a&&Object(se.a)(e,t,a.type);return{siteId:t,currentPost:a,currentPostTypeObject:o}})(Object(h.localize)(re));function ce(e){var t,n=e.translate,a=e.siteId,o=e.typeSlug,i=e.type,s=e.className,r=z()("editor-status-label__placeholder",s);return t="post"===o?n("Loading Postâ€¦"):"page"===o?n("Loading Pageâ€¦"):i?n("Loading %(postType)sâ€¦",{args:{postType:Object(oe.b)(i.labels.singular_name)}}):n("Loadingâ€¦"),m.a.createElement("button",{className:r},"post"!==o&&"page"!==o&&a&&m.a.createElement(ie.a,{siteId:a}),m.a.createElement("strong",null,t))}ce.propTypes={translate:U.a.func,siteId:U.a.number,typeSlug:U.a.string,type:U.a.object,className:U.a.string};var de=Object(F.b)(function(e){var t=Object(Z.e)(e),n={siteId:t},a=Object(ee.a)(e,t,Object(X.f)(e));return a?Object.assign(n,{typeSlug:a.type,type:Object(se.a)(e,t,a.type)}):n})(Object(h.localize)(ce)),ue=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={currentTime:Date.now()},n.updateCurrentTime=function(){n.setState({currentTime:Date.now()})},n}return M()(t,e),O()(t,[{key:"componentDidMount",value:function(){this.currentTimeTimer=setInterval(this.updateCurrentTime,6e4)}},{key:"componentWillReceiveProps",value:function(e){e.post!==this.props.post&&this.updateCurrentTime()}},{key:"componentWillUnmount",value:function(){clearInterval(this.currentTimeTimer)}},{key:"render",value:function(){if(!this.props.post&&!this.props.isNew)return m.a.createElement(de,{className:"editor-status-label"});var e=z()("editor-status-label","is-plain","is-"+Object(v.get)(this.props.post,"status","draft"));return m.a.createElement("span",{className:e},this.renderLabel())}},{key:"renderLabel",value:function(){var e=this.props,t=e.isNew,n=e.post,a=e.translate,o=e.moment;if(t)return a("New Draft");var i=o(ae.f(n));"draft"===n.status&&i.isAfter(this.state.currentTime)&&(i=o(this.state.currentTime));var s=i.from(this.state.currentTime);switch(n.status){case"publish":return a("{{strong}}Published{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:s},components:{strong:m.a.createElement("strong",null)}});case"private":return a("{{strong}}Published Privately{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:s},components:{strong:m.a.createElement("strong",null)}});case"draft":return a("{{strong}}Saved{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:s},components:{strong:m.a.createElement("strong",null)}});case"pending":return a("{{strong}}Pending Review{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:s},components:{strong:m.a.createElement("strong",null)}});case"future":return a("{{strong}}Scheduled{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:s},components:{strong:m.a.createElement("strong",null)}});case"trash":return a("{{strong}}Trashed{{/strong}}",{components:{strong:m.a.createElement("strong",null)}})}return""}}]),t}(m.a.Component);ue.propTypes={post:U.a.object};var pe=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.l)(e,t,n),o=Object(X.m)(e);return{isNew:o,post:a}})(Object(h.localize)(ue)),me=n("./client/components/podcast-indicator/index.jsx"),he=n("./client/components/data/query-site-settings/index.js"),fe=n("./client/state/selectors/get-podcasting-category-id.js"),ge=n("./client/state/sites/selectors.js"),be=function(e){n.e(7).then(function(t){e(n("./client/post-editor/editor-author/index.jsx").__esModule?n("./client/post-editor/editor-author/index.jsx").default:n("./client/post-editor/editor-author/index.jsx"))}.bind(null,n)).catch(n.oe)},ve=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.isPostPrivateOrPasswordProtected,n=e.isPodcastEpisode,a=e.multiUserSite,o=e.siteId,i=e.type,s="post"===i&&!t;return m.a.createElement("div",{className:"editor-action-bar"},o&&m.a.createElement(he.a,{siteId:o}),m.a.createElement("div",{className:"editor-action-bar__cell is-left"},m.a.createElement(pe,null)),m.a.createElement("div",{className:"editor-action-bar__cell is-center"},a&&m.a.createElement(G.a,{require:be})),m.a.createElement("div",{className:"editor-action-bar__cell is-right"},s&&m.a.createElement(ne,null),n&&m.a.createElement(me.a,{className:"editor-action-bar__podcasting-indicator",size:24,tooltipType:"episode"}),m.a.createElement(le,null)))}}]),t}(p.Component);ve.propTypes={siteId:U.a.number,multiUserSite:U.a.bool,post:U.a.object,type:U.a.string,isPostPrivateOrPasswordProtected:U.a.bool};var ye=Object(F.b)(function(e){var t=Object(Z.e)(e),n=!1===Object(ge.R)(e,t),a=Object(X.f)(e),o=Object(ee.a)(e,t,a),i=Object(ee.c)(e,t,a,"type"),s=ae.y(o)||"password"===ae.p(o),r=Object(fe.a)(e,t),l=!1;if(r){var c=Object(ee.c)(e,t,a,"terms"),d=c&&c.category;Object(v.some)(d,{ID:r})&&(l=!0)}return{siteId:t,multiUserSite:n,postId:a,post:o,type:i,isPostPrivateOrPasswordProtected:s,isPodcastEpisode:l}})(ve),Ee=n("./client/post-editor/editor-featured-image/index.jsx"),je=n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),we=n.n(je),_e=n("./client/components/track-input-changes/index.jsx"),Ce=n("./client/components/forms/form-text-input/index.jsx"),Se=function(e){function t(){var e;return k()(this,t),e=P()(this,N()(t).apply(this,arguments)),e.state={isSlugFocused:!1},e.onSlugKeyDown=e.onSlugKeyDown.bind(we()(we()(e))),e.onSlugChange=e.onSlugChange.bind(we()(we()(e))),e.onBlur=e.onBlur.bind(we()(we()(e))),e.onFocus=e.onFocus.bind(we()(we()(e))),e.focusSlug=e.focusSlug.bind(we()(we()(e))),e.recordChangeStats=e.recordChangeStats.bind(we()(we()(e))),e.statTracked=!1,e}return M()(t,e),O()(t,[{key:"onSlugChange",value:function(e){var t=this.props,n=t.siteId,a=t.postId;this.props.editPost(n,a,{slug:e.target.value})}},{key:"onSlugKeyDown",value:function(e){if("Enter"===e.key||"Escape"===e.key){var t=this.props,n=t.onEscEnter,a=t.isEditable;this.setState({isSlugFocused:!1},function(){n(),a&&L.a.findDOMNode(this.refs.slugField).blur()})}}},{key:"onBlur",value:function(){this.state.isSlugFocused&&this.setState({isSlugFocused:!1})}},{key:"onFocus",value:function(){this.setState({isSlugFocused:!0})}},{key:"focusSlug",value:function(){this.props.isEditable&&L.a.findDOMNode(this.refs.slugField).focus()}},{key:"recordChangeStats",value:function(){switch(this.props.instanceName){case"post-sidebar":this.props.recordEditorStat("slug-edited-post-sidebar"),this.props.recordEditorEvent("Slug Edited (Post Sidebar)");break;case"post-popover":this.props.recordEditorStat("slug-edited-post-popover"),this.props.recordEditorEvent("Slug Edited (Post Permalink Popover)");break;case"page-sidebar":this.props.recordEditorStat("slug-edited-page-sidebar"),this.props.recordEditorEvent("Slug Edited (Page Sidebar)");break;case"page-permalink":this.props.recordEditorStat("slug-edited-page-permalink"),this.props.recordEditorEvent("Slug Edited (Page Permalink)")}}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.translate,a=e.slug,o=e.children,i=e.path,s=e.isEditable,r=z()("editor-slug",t,{"is-focused":this.state.isSlugFocused});return m.a.createElement("div",{className:r,onClick:this.focusSlug},o,m.a.createElement("span",{className:"editor-slug__url-path",onClick:this.focusSlug},i),s&&m.a.createElement(_e.a,{onNewValue:this.recordChangeStats},m.a.createElement(Ce.a,{ref:"slugField",value:a,onChange:this.onSlugChange,onKeyDown:this.onSlugKeyDown,onBlur:this.onBlur,onFocus:this.onFocus,"aria-label":n("Enter slug")})))}}]),t}(p.Component);Se.propTypes={path:U.a.string,slug:U.a.string,onEscEnter:U.a.func,className:U.a.string,isEditable:U.a.bool,instanceName:U.a.string,translate:U.a.func,siteId:U.a.number,postId:U.a.number},Se.defaultProps={onEscEnter:function(){},isEditable:!0,slug:""};var xe=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.b)(e,t,n);return{siteId:t,postId:n,slug:a}},{editPost:E.e,recordEditorStat:Q.b,recordEditorEvent:Q.a})(Object(h.localize)(Se)),ke=n("./client/components/popover/index.jsx"),Ie=n("./client/components/forms/clipboard-button/index.jsx"),Oe=function(e){function t(){var e;return k()(this,t),e=P()(this,N()(t).apply(this,arguments)),e.permalinkToggleReference=m.a.createRef(),e.showPopover=e.showPopover.bind(we()(we()(e))),e.showTooltip=e.showTooltip.bind(we()(we()(e))),e.onCopy=e.onCopy.bind(we()(we()(e))),e.hideTooltip=e.hideTooltip.bind(we()(we()(e))),e.closePopover=e.closePopover.bind(we()(we()(e))),e.state={showPopover:!1,showCopyConfirmation:!1,tooltip:!1},e}return M()(t,e),O()(t,[{key:"componentWillUnmount",value:function(){clearTimeout(this.dismissCopyConfirmation)}},{key:"showPopover",value:function(){this.setState({showPopover:!this.state.showPopover,tooltip:!1})}},{key:"showTooltip",value:function(){this.state.showPopover||this.setState({tooltip:!0})}},{key:"onCopy",value:function(){var e=this;this.setState({showCopyConfirmation:!0}),clearTimeout(this.dismissCopyConfirmation),this.dismissCopyConfirmation=setTimeout(function(){e.setState({showCopyConfirmation:!1})},4e3)}},{key:"hideTooltip",value:function(){this.setState({tooltip:!1})}},{key:"closePopover",value:function(){this.setState({showPopover:!1})}},{key:"renderCopyButton",value:function(){var e,t=this.props,n=t.path,a=t.slug,o=t.translate;return e=this.state.showCopyConfirmation?o("Copied!"):o("Copy",{context:"verb"}),m.a.createElement(Ie.a,{text:n+a,onCopy:this.onCopy,compact:!0},e)}},{key:"render",value:function(){var e,t=this.props.translate;return e=this.props.isEditable?t("Edit post URL"):t("View post URL"),m.a.createElement("div",{className:"editor-permalink",onMouseEnter:this.showTooltip,onMouseLeave:this.hideTooltip},m.a.createElement(Y.a,{className:"editor-permalink__toggle",icon:"link",onClick:this.showPopover,ref:this.permalinkToggleReference}),m.a.createElement(ke.a,{isVisible:this.state.showPopover,onClose:this.closePopover,position:"bottom right",context:this.permalinkToggleReference.current,className:"editor-permalink__popover"},m.a.createElement(xe,_()({},Object(v.pick)(this.props,"path","isEditable"),{onEscEnter:this.closePopover,instanceName:"post-popover"})),this.renderCopyButton()),m.a.createElement($.a,{context:this.permalinkToggleReference.current,isVisible:this.state.tooltip,position:"bottom"},e))}}]),t}(p.Component);Oe.propTypes={path:U.a.string,isEditable:U.a.bool,translate:U.a.func,slug:U.a.string};var Te=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e);return{slug:Object(ee.b)(e,t,n)}})(Object(h.localize)(Oe)),Pe=n("./client/components/textarea-autosize/index.jsx"),De=n("./client/lib/viewport/index.js");function Ne(e,t){var n=Object(ge.s)(e,t,"permalink_structure");return!!n&&/\/%postname%\/?/.test(n)}var Re=/[\r\n]+/g,Me=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.onChange=function(e){var t=n.props,a=t.siteId,o=t.editedPostId,i=e.target.value.replace(Re," ");n.props.editPost(a,o,{title:i}),n.props.onChange(i)},n.resizeAfterNewlineInput=function(e){var t=e.target.value;Re.test(t)&&(e.target.value=t.replace(Re," "),n.refs.titleInput.resize())},n.recordChangeStats=function(){var e=ae.w(n.props.post);n.props.recordEditorStat(e?"page_title_changed":"post_title_changed"),n.props.recordEditorEvent(e?"Changed Page Title":"Changed Post Title")},n}return M()(t,e),O()(t,[{key:"componentDidUpdate",value:function(e){if(!Object(De.c)()){var t=this.props,n=t.isNew,a=t.siteId;if(n&&!e.isNew||n&&e.siteId!==a){var o=L.a.findDOMNode(this.refs.titleInput);o.focus()}}}},{key:"render",value:function(){var e=this.props,t=e.post,n=e.isPermalinkEditable,a=e.isNew,o=e.tabIndex,i=e.translate,s=z()("editor-title",{"is-loading":!t});return m.a.createElement("div",{className:s},t&&t.ID&&!ae.w(t)&&m.a.createElement(Te,{path:n?ae.k(t):t.URL,isEditable:n}),m.a.createElement(_e.a,{onNewValue:this.recordChangeStats},m.a.createElement(Pe.a,{tabIndex:o,className:"editor-title__input",placeholder:i("Title"),onChange:this.onChange,onInput:this.resizeAfterNewlineInput,onBlur:this.onBlur,autoFocus:a&&!Object(De.c)(),value:t&&t.title?t.title:"","aria-label":i("Edit title"),ref:"titleInput",rows:"1"})))}}]),t}(p.Component);Me.propTypes={editPost:U.a.func,isNew:U.a.bool,onChange:U.a.func,post:U.a.object,site:U.a.object,siteId:U.a.number,tabIndex:U.a.number,translate:U.a.func},Me.defaultProps={isNew:!0,onChange:function(){}};var Ae=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Ne(e,t),a=Object(X.f)(e),o=Object(ee.a)(e,t,a),i=Object(X.m)(e);return{editedPostId:a,isPermalinkEditable:n,isNew:i,post:o,siteId:t}},{editPost:E.e,recordEditorStat:Q.b,recordEditorEvent:Q.a})(Object(h.localize)(Me)),Le=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"render",value:function(){return this.props.isDisplayed?m.a.createElement(xe,{path:this.props.path,instanceName:"page-permalink"},m.a.createElement(Y.a,{icon:"link"})):null}}]),t}(p.PureComponent);Le.propTypes={isDisplayed:U.a.bool,path:U.a.string};var Be=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ge.l)(e,t),o=Object(ee.a)(e,t,n),i=t&&ae.w(o),s=function(e,t){var n=e?e.URL+"/":null;return t&&t.URL&&t.URL!==n?ae.j(t):n}(a,o);return{isDisplayed:i,path:s}})(Le),Ue=n("./node_modules/@babel/runtime/helpers/objectSpread.js"),Fe=n.n(Ue),qe=n("./node_modules/autosize/dist/autosize.js"),ze=n.n(qe);n("./node_modules/tinymce/themes/modern/theme.js"),n("./node_modules/tinymce/plugins/colorpicker/plugin.js"),n("./node_modules/tinymce/plugins/directionality/plugin.js"),n("./node_modules/tinymce/plugins/hr/plugin.js"),n("./node_modules/tinymce/plugins/lists/plugin.js"),n("./node_modules/tinymce/plugins/media/plugin.js"),n("./node_modules/tinymce/plugins/paste/plugin.js"),n("./node_modules/tinymce/plugins/tabfocus/plugin.js"),n("./node_modules/tinymce/plugins/textcolor/plugin.js");
/**
 * Adapted from the WordPress wp TinyMCE plugin.
 *
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 */
function Ve(e){var t,n=H.a.DOM,a=H.a.each;e.on("focus",function(){window.wpActiveEditor=e.id}),e.on("BeforeSetContent",function(e){var t;e.content&&(-1!==e.content.indexOf("\x3c!--more")&&(t=Object(h.translate)("Read moreâ€¦"),e.content=e.content.replace(/<!--more(.*?)-->/g,function(e,n){return'<img src="'+H.a.Env.transparentSrc+'" data-wp-more="more" data-wp-more-text="'+n+'" class="wp-more-tag mce-wp-more" title="'+t+'" data-mce-resize="false" data-mce-placeholder="1" />'})),-1!==e.content.indexOf("\x3c!--nextpage--\x3e")&&(t=Object(h.translate)("Page break"),e.content=e.content.replace(/<!--nextpage-->/g,'<img src="'+H.a.Env.transparentSrc+'" data-wp-more="nextpage" class="wp-more-tag mce-wp-nextpage" title="'+t+'" data-mce-resize="false" data-mce-placeholder="1" />')),e.load&&"raw"!==e.format&&(e.content=Object(oe.g)(e.content)))}),e.on("PostProcess",function(e){e.get&&(e.content=e.content.replace(/<img[^>]+>/g,function(e){var t,n="";return-1!==e.indexOf('data-wp-more="more"')?((t=e.match(/data-wp-more-text="([^"]+)"/))&&(n=t[1]),e="\x3c!--more"+n+"--\x3e"):-1!==e.indexOf('data-wp-more="nextpage"')&&(e="\x3c!--nextpage--\x3e"),e}))}),e.on("ResolveName",function(t){var n;"IMG"===t.target.nodeName&&(n=e.dom.getAttrib(t.target,"data-wp-more"))&&(t.name=n)}),e.addCommand("WP_More",function(t){var n,a,o,i="wp-more-tag",s=e.dom,r=e.selection.getNode();t=t||"more",i+=" mce-wp-"+t,o="more"===t?Object(h.translate)("Read moreâ€¦"):Object(h.translate)("Next page"),a='<img src="'+H.a.Env.transparentSrc+'" title="'+o+'" class="'+i+'" data-wp-more="'+t+'" data-mce-resize="false" data-mce-placeholder="1" />',"BODY"===r.nodeName||"P"===r.nodeName&&"BODY"===r.parentNode.nodeName?e.insertContent(a):(n=s.getParent(r,function(e){return!(!e.parentNode||"BODY"!==e.parentNode.nodeName)},e.getBody()),n&&("P"===n.nodeName?n.appendChild(s.create("p",null,a).firstChild):s.insertAfter(s.create("p",null,a),n),e.nodeChanged()))}),e.addCommand("WP_Code",function(){e.formatter.toggle("code")}),e.addCommand("WP_Page",function(){e.execCommand("WP_More","nextpage")}),e.addButton("wp_more",{tooltip:Object(h.translate)("Insert Read More tag"),onclick:function(){e.execCommand("WP_More","more")}}),e.addButton("wp_page",{tooltip:Object(h.translate)("Page break"),onclick:function(){e.execCommand("WP_More","nextpage")}}),e.addButton("wp_help",{tooltip:Object(h.translate)("Keyboard Shortcuts"),cmd:"WP_Help"}),e.addButton("wp_charmap",{icon:"charmap",tooltip:Object(h.translate)("Special Characters"),cmd:"Wpcom_CharMap"}),e.addButton("wp_code",{tooltip:Object(h.translate)("Code"),cmd:"WP_Code",stateSelector:"code"}),e.addMenuItem("wp_more",{text:Object(h.translate)("Insert Read More tag"),icon:"wp_more",context:"insert",onclick:function(){e.execCommand("WP_More","more")}}),e.addMenuItem("wp_page",{text:Object(h.translate)("Page break"),icon:"wp_page",context:"insert",onclick:function(){e.execCommand("WP_More","nextpage")}}),e.on("BeforeExecCommand",function(n){!H.a.Env.webkit||"InsertUnorderedList"!==n.command&&"InsertOrderedList"!==n.command||(t||(t=e.dom.create("style",{type:"text/css"},"#tinymce,#tinymce span,#tinymce li,#tinymce li>span,#tinymce p,#tinymce p>span{font:medium sans-serif;color:#000;line-height:normal;}")),e.getDoc().head.appendChild(t))}),e.on("ExecCommand",function(n){H.a.Env.webkit&&t&&("InsertUnorderedList"===n.command||"InsertOrderedList"===n.command)&&e.dom.remove(t)}),e.on("init",function(){var t=H.a.Env,n=["mceContentBody"],o=e.getDoc(),i=e.dom;H.a.Env.iOS&&i.addClass(o.documentElement,"ios"),"rtl"===e.getParam("directionality")&&(n.push("rtl"),i.setAttrib(o.documentElement,"dir","rtl")),t.ie?9===parseInt(t.ie,10)?n.push("ie9"):8===parseInt(t.ie,10)?n.push("ie8"):t.ie<8&&n.push("ie7"):t.webkit&&n.push("webkit"),n.push("wp-editor"),a(n,function(e){e&&i.addClass(o.body,e)}),e.on("BeforeSetContent",function(e){e.content&&(e.content=e.content.replace(/<p>\s*<(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre)( [^>]*)?>/gi,"<$1$2>").replace(/<\/(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre)>\s*<\/p>/gi,"</$1>"))}),e.getParam("wp_paste_filters",!0)&&(e.on("PastePreProcess",function(e){e.content=e.content.replace(/<br class="?Apple-interchange-newline"?>/gi,""),H.a.Env.webkit||(e.content=e.content.replace(/(<[^>]+) style="[^"]*"([^>]*>)/gi,"$1$2"),e.content=e.content.replace(/(<[^>]+) data-mce-style=([^>]+>)/gi,"$1 style=$2"))}),e.on("PastePostProcess",function(e){a(i.select("p",e.node),function(e){i.isEmpty(e)&&i.remove(e)})}))}),e.on("SaveContent",function(t){e.inline||!e.isHidden()?(t.content=t.content.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>"),t.content=Object(oe.e)(t.content)):t.content=t.element.value}),e.on("BeforeSetContent",function(e){var t;e.content&&(e.content=(t=e.content,t.replace(/<p>([^<>]+)<\/p>/gi,function(e,t){return"&nbsp;"!==t&&/\S/.test(t)?e:"<p><br /></p>"})))}),e.on("preInit",function(){e.schema.addValidElements("@[id|accesskey|class|dir|lang|style|tabindex|title|contenteditable|draggable|dropzone|hidden|spellcheck|translate],i,b"),H.a.Env.iOS&&(e.settings.height=300),a({c:"JustifyCenter",r:"JustifyRight",l:"JustifyLeft",j:"JustifyFull",q:"mceBlockQuote",u:"InsertUnorderedList",o:"InsertOrderedList",s:"unlink",m:"WP_Medialib",t:"WP_More",d:"Strikethrough",h:"WP_Help",p:"WP_Page",x:"WP_Code"},function(t,n){e.shortcuts.add("access+"+n,"",t)})}),e.on("preinit",function(){var t,o,i,s,r,l,c=H.a.ui.Factory,d=e.settings,u=e.getContainer(),p=document.getElementById("wpadminbar"),m=document.getElementById(e.id+"_ifr"),h="rtl"===e.getParam("directionality")&&/Chrome/.test(navigator.userAgent);function f(e){t&&(t.hide(),"hide"===e.type||"blur"===e.type?t=!1:"resizewindow"!==e.type&&"scrollwindow"!==e.type||(clearTimeout(i),i=setTimeout(function(){t&&"function"==typeof t.show&&t.show()},250)))}u&&(s=H.a.$(".mce-toolbar-grp",u)[0],r=H.a.$(".mce-statusbar",u)[0]),"content"===e.id&&(l=document.getElementById("post-status-info")),e.shortcuts.add("alt+119","",function(){var e;t&&(e=t.find("toolbar")[0],e&&e.focus(!0))}),e.on("nodechange",function(n){var a=e.selection.isCollapsed(),i={element:n.element,parents:n.parents,collapsed:a};e.fire("wptoolbar",i),o=i.selection||i.element,t&&t.hide(),i.toolbar?(t=i.toolbar,t.show()):t=!1}),e.on("focus",function(){t&&t.show()}),n.bind(window,"resize scroll",f),e.on("remove",function(){n.unbind(window,"resize scroll",f)}),e.on("blur hide",f),e.wp=e.wp||{},e.wp._createToolbar=function(t,i){var u,f,g=[];return a(t,function(t){var n;function a(){var a=e.selection;"bullist"===n&&a.selectorChanged("ul > li",function(e,n){for(var a,o=n.parents.length;o--&&(a=n.parents[o].nodeName,"OL"!==a&&"UL"!==a););t.active(e&&"UL"===a)}),"numlist"===n&&a.selectorChanged("ol > li",function(e,n){for(var a,o=n.parents.length;o--&&(a=n.parents[o].nodeName,"OL"!==a&&"UL"!==a););t.active(e&&"OL"===a)}),t.settings.stateSelector&&a.selectorChanged(t.settings.stateSelector,function(e){t.active(e)},!0),t.settings.disabledStateSelector&&a.selectorChanged(t.settings.disabledStateSelector,function(e){t.disabled(e)})}"|"===t?f=null:c.has(t)?(t={type:t},d.toolbar_items_size&&(t.size=d.toolbar_items_size),g.push(t),f=null):(f||(f={type:"buttongroup",items:[]},g.push(f)),e.buttons[t]&&(n=t,t=e.buttons[n],"function"==typeof t&&(t=t()),t.type=t.type||"button",d.toolbar_items_size&&(t.size=d.toolbar_items_size),t=c.create(t),f.items.push(t),e.initialized?a():e.on("init",a)))}),u=c.create({type:"panel",layout:"stack",classes:"toolbar-grp inline-toolbar-grp",ariaRoot:!0,ariaRemember:!0,items:[{type:"toolbar",layout:"flow",items:g}]}),u.bottom=i,u.on("show",function(){this.reposition(),h&&e.$(".mce-widget.mce-tooltip",document.body).addClass("wp-hide-mce-tooltip")}),u.on("keydown",function(t){27===t.keyCode&&(this.hide(),e.focus())}),e.on("remove",function(){u.remove()}),u.reposition=function(){if(!o)return this;var e,t,a=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop,c=window.innerWidth,d=window.innerHeight,u=m?m.getBoundingClientRect():{top:0,right:c,bottom:d,left:0,width:c,height:d},h=this.getEl(),f=h.offsetWidth,g=h.offsetHeight,b=o.getBoundingClientRect(),v=(b.left+b.right)/2,y=g+8+5,E=p?p.getBoundingClientRect().bottom:0,j=s?s.getBoundingClientRect().bottom:0,w=r?d-r.getBoundingClientRect().top:0,_=l?d-l.getBoundingClientRect().top:0,C=Math.max(0,E,j,u.top),S=Math.max(0,w,_,d-u.bottom),x=b.top+u.top-C,k=d-u.top-b.bottom-S,I=d-C-S,O="";return x>=I||k>=I?this.hide():(this.bottom?k>=y?(O=" mce-arrow-up",e=b.bottom+u.top+i):x>=y&&(O=" mce-arrow-down",e=b.top+u.top+i-g-8):x>=y?(O=" mce-arrow-down",e=b.top+u.top+i-g-8):k>=y&&I/2>b.bottom+u.top-C&&(O=" mce-arrow-up",e=b.bottom+u.top+i),void 0===e&&(e=i+C+5),t=v-f/2+u.left+a,b.left<0||b.right>u.width?t=u.left+a+(u.width-f)/2:f>=c?(O+=" mce-arrow-full",t=0):t<0&&b.left+f>c||t+f>c&&b.right-f<0?t=(c-f)/2:t<u.left+a?(O+=" mce-arrow-left",t=b.left+u.left+a):t+f>u.width+u.left+a&&(O+=" mce-arrow-right",t=b.right-f+u.left+a),h.className=h.className.replace(/ ?mce-arrow-[\w]+/g,"")+O,n.setStyles(h,{left:t,top:e}),this)},u.hide().renderTo(document.body),u}},!0)}
/**
 * WordPress TinyMCE Auto Resize plugin
 *
 * Adapted from WordPress.
 *
 *
 * @format
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 */
function He(e){var t=e.settings,n=0;function a(o){var i,s,r,l,c,d,u,p,m,h,f,g,b=H.a.DOM;s=e.getDoc(),s&&(r=s.body,l=s.documentElement,c=t.autoresize_min_height,!r||o&&"setcontent"===o.type&&o.initial||e.plugins.fullscreen&&e.plugins.fullscreen.isFullscreen()?r&&l&&(r.style.overflowY="auto",l.style.overflowY="auto"):(u=e.dom.getStyle(r,"margin-top",!0),p=e.dom.getStyle(r,"margin-bottom",!0),m=e.dom.getStyle(r,"padding-top",!0),f=e.dom.getStyle(r,"border-top-width",!0),g=e.dom.getStyle(r,"border-bottom-width",!0),h=e.getParam("autoresize_bottom_margin",50),d=r.offsetHeight+parseInt(u,10)+parseInt(p,10)+parseInt(m,10)+parseInt(h,10)+parseInt(f,10)+parseInt(g,10),d&&d<l.offsetHeight&&(d=l.offsetHeight),(isNaN(d)||d<=0)&&(d=H.a.Env.ie?r.scrollHeight:H.a.Env.webkit&&0===r.clientHeight?0:r.offsetHeight),d>t.autoresize_min_height&&(c=d),t.autoresize_max_height&&d>t.autoresize_max_height?(c=t.autoresize_max_height,r.style.overflowY="auto",l.style.overflowY="auto"):(r.style.overflowY="hidden",l.style.overflowY="hidden",r.scrollTop=0),c!==n&&(i=c-n,b.setStyle(e.iframeElement,"height",c+"px"),n=c,H.a.isWebKit&&i<0&&a(o),(o&&"keyup"===o.type||o&&"nodechange"===o.type&&o.element&&"BR"===o.element.tagName)&&function(){var t,n,a,o,i;if(t=e.selection.getRng(),0===t.startOffset&&0!==t.endOffset||!t.collapsed)return!1;n=t.startContainer,a=e.getBody(),o=n;do{if(i=o,o=o.parentNode,o.childNodes[o.childNodes.length-1]!==i)return!1}while(o!==a);return!0}()&&window.scrollTo(0,document.body.scrollHeight))))}function o(e,t,n){setTimeout(function(){a({}),e--?o(e,t,n):n&&n()},t)}e.settings.inline||H.a.Env.iOS||(t.autoresize_min_height=parseInt(e.getParam("autoresize_min_height",e.getElement().offsetHeight),10),t.autoresize_max_height=parseInt(e.getParam("autoresize_max_height",0),10),e.on("init",function(){var t,n;t=e.getParam("autoresize_overflow_padding",1),n=e.getParam("autoresize_bottom_margin",50),!1!==t&&e.dom.setStyles(e.getBody(),{paddingLeft:t,paddingRight:t}),!1!==n&&e.dom.setStyles(e.getBody(),{paddingBottom:n})}),e.on("nodechange setcontent keyup FullscreenStateChanged",a),e.getParam("autoresize_on_init",!0)&&e.on("init",function(){e.dom.addClass(e.getBody(),"wp-autoresize"),o(20,100,function(){o(5,1e3)})}),e.addCommand("wpcomAutoResize",a))}var We=n("./client/components/dialog/index.jsx"),Ge=n("./client/components/forms/form-button/index.jsx"),Ke=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.defaultShortcuts=function(){var e=n.props.translate;return[[{shortcut:"c",action:e("Copy")},{shortcut:"x",action:e("Cut")}],[{shortcut:"v",action:e("Paste")},{shortcut:"a",action:e("Select all")}],[{shortcut:"z",action:e("Undo")},{shortcut:"y",action:e("Redo")}],[{shortcut:"b",action:e("Bold")},{shortcut:"i",action:e("Italic")}],[{shortcut:"u",action:e("Underline")},{shortcut:"k",action:e("Insert/edit link")}]]},n.additionalShortcuts=function(){var e=n.props.translate;return[[{shortcut:1,action:e("Heading 1")},{shortcut:2,action:e("Heading 2")}],[{shortcut:3,action:e("Heading 3")},{shortcut:4,action:e("Heading 4")}],[{shortcut:5,action:e("Heading 5")},{shortcut:6,action:e("Heading 6")}],[{shortcut:"l",action:e("Align left")},{shortcut:"c",action:e("Align center")}],[{shortcut:"r",action:e("Align right")},{shortcut:"j",action:e("Justify")}],[{shortcut:"d",action:e("Strikethrough")},{shortcut:"q",action:e("Blockquote")}],[{shortcut:"u",action:e("Bulleted list")},{shortcut:"o",action:e("Numbered list")}],[{shortcut:"a",action:e("Insert/edit link")},{shortcut:"s",action:e("Remove link")}],[{shortcut:"m",action:e("Insert/edit image")},{shortcut:"t",action:e("Insert Read More tag")}],[{shortcut:"h",action:e("Keyboard Shortcuts")},{shortcut:"x",action:e("Code")}],[{shortcut:"p",action:e("Insert Page Break tag")}]]},n.spaceFormatShortcuts=function(){var e=n.props.translate;return[[{shortcut:"*",action:e("Bulleted list")},{shortcut:"1.",action:e("Numbered list")}],[{shortcut:"-",action:e("Bulleted list")},{shortcut:"1)",action:e("Numbered list")}]]},n.enterFormatShortcuts=function(){var e=n.props.translate;return[[{shortcut:">",action:e("Blockquote")},{shortcut:"##",action:e("Heading 2")}],[{shortcut:"###",action:e("Heading 3")},{shortcut:"####",action:e("Heading 4")}],[{shortcut:"#####",action:e("Heading 5")},{shortcut:"######",action:e("Heading 6")}],[{shortcut:"---",action:e("Horizontal line")}]]},n.renderRow=function(e,t){var n=[];return Object(v.forEach)(e,function(e){n.push(m.a.createElement("th",{className:"wpcom-help__key",key:e.shortcut},m.a.createElement("kbd",null,e.shortcut))),n.push(m.a.createElement("td",{className:"wpcom-help__action",key:e.action},e.action))}),m.a.createElement("tr",{key:t},n)},n.getButtons=function(){return[m.a.createElement(Ge.a,{key:"close",isPrimary:!1,onClick:n.props.onClose},n.props.translate("Close"))]},n.getKeyLabel=function(){return n.props.translate("Key",{context:"Computer key used in keyboard shortcut"})},n.getActionLabel=function(){return n.props.translate("Action",{context:"Action taken when pressing keyboard shortcut"})},n.getTableHead=function(){return m.a.createElement("thead",null,m.a.createElement("tr",null,m.a.createElement("th",{className:"wpcom-help__key"},n.getKeyLabel()),m.a.createElement("th",{className:"wpcom-help__action"},n.getActionLabel()),m.a.createElement("th",{className:"wpcom-help__key"},n.getKeyLabel()),m.a.createElement("th",{className:"wpcom-help__action"},n.getActionLabel())))},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props.translate,t=this.props.macosx?e("Default shortcuts. Command + key:",{context:"Mac shortcuts"}):e("Default shortcuts. Ctrl + key:",{context:"Windows shortcuts"}),n=this.props.macosx?e("Additional shortcuts. Control + Option + key:",{context:"Mac shortcuts"}):e("Additional shortcuts. Shift + Alt + key:",{context:"Windows shortcuts"}),a=this.getTableHead();return m.a.createElement(We.a,{isVisible:this.props.showDialog,buttons:this.getButtons(),additionalClassNames:"wpcom-help__dialog",onClose:this.props.onClose},m.a.createElement("h2",{className:"wpcom-help__heading"},e("Keyboard Shortcuts")),m.a.createElement("p",null,t),m.a.createElement("table",{className:"wpcom-help__table"},a,m.a.createElement("tbody",null,this.defaultShortcuts().map(this.renderRow,this))),m.a.createElement("p",null,n),m.a.createElement("table",{className:"wpcom-help__table"},a,m.a.createElement("tbody",null,this.additionalShortcuts().map(this.renderRow,this))),m.a.createElement("p",null,e("Formatting shortcuts. Start a new paragraph with the shortcut and press Space to apply the formatting.")),m.a.createElement("table",{className:"wpcom-help__table"},m.a.createElement("tbody",null,this.spaceFormatShortcuts().map(this.renderRow,this))),m.a.createElement("p",null,e("Formatting shortcuts. These shortcuts are turned into formatting when you press Enter.")),m.a.createElement("table",{className:"wpcom-help__table"},m.a.createElement("tbody",null,this.enterFormatShortcuts().map(this.renderRow,this))))}}]),t}(m.a.Component);Ke.propTypes={onClose:U.a.func,macosx:U.a.bool,showDialog:U.a.bool};var Ye=Object(h.localize)(Ke);function $e(e){var t;e.on("init",function(){t=e.getContainer().appendChild(document.createElement("div"))}),e.on("remove",function(){L.a.unmountComponentAtNode(t),t.parentNode.removeChild(t),t=null}),e.addCommand("WP_Help",function(){function n(){e.focus(),a("hide")}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";L.a.render(m.a.createElement(Ye,{showDialog:"show"===e,onClose:n,macosx:H.a.Env.mac}),t)}a("show")})}var Je=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.defaultCharMap=function(){return[["160","no-break space"],["173","soft hyphen"],["34","quotation mark"],["162","cent sign"],["8364","euro sign"],["163","pound sign"],["165","yen sign"],["169","copyright sign"],["174","registered sign"],["8482","trade mark sign"],["8240","per mille sign"],["181","micro sign"],["183","middle dot"],["8226","bullet"],["8230","three dot leader"],["8242","minutes / feet"],["8243","seconds / inches"],["167","section sign"],["182","paragraph sign"],["223","sharp s / ess-zed"],["8249","single left-pointing angle quotation mark"],["8250","single right-pointing angle quotation mark"],["171","left pointing guillemet"],["187","right pointing guillemet"],["8216","left single quotation mark"],["8217","right single quotation mark"],["8220","left double quotation mark"],["8221","right double quotation mark"],["8218","single low-9 quotation mark"],["8222","double low-9 quotation mark"],["60","less-than sign"],["62","greater-than sign"],["8804","less-than or equal to"],["8805","greater-than or equal to"],["8211","en dash"],["8212","em dash"],["175","macron"],["8254","overline"],["164","currency sign"],["166","broken bar"],["168","diaeresis"],["161","inverted exclamation mark"],["191","turned question mark"],["710","circumflex accent"],["732","small tilde"],["176","degree sign"],["8722","minus sign"],["177","plus-minus sign"],["247","division sign"],["8260","fraction slash"],["215","multiplication sign"],["185","superscript one"],["178","superscript two"],["179","superscript three"],["188","fraction one quarter"],["189","fraction one half"],["190","fraction three quarters"],["402","function / florin"],["8747","integral"],["8721","n-ary sumation"],["8734","infinity"],["8730","square root"],["8764","similar to"],["8773","approximately equal to"],["8776","almost equal to"],["8800","not equal to"],["8801","identical to"],["8712","element of"],["8713","not an element of"],["8715","contains as member"],["8719","n-ary product"],["8743","logical and"],["8744","logical or"],["172","not sign"],["8745","intersection"],["8746","union"],["8706","partial differential"],["8704","for all"],["8707","there exists"],["8709","diameter"],["8711","backward difference"],["8727","asterisk operator"],["8733","proportional to"],["8736","angle"],["180","acute accent"],["184","cedilla"],["170","feminine ordinal indicator"],["186","masculine ordinal indicator"],["8224","dagger"],["8225","double dagger"],["192","A - grave"],["193","A - acute"],["194","A - circumflex"],["195","A - tilde"],["196","A - diaeresis"],["197","A - ring above"],["198","ligature AE"],["199","C - cedilla"],["200","E - grave"],["201","E - acute"],["202","E - circumflex"],["203","E - diaeresis"],["204","I - grave"],["205","I - acute"],["206","I - circumflex"],["207","I - diaeresis"],["208","ETH"],["209","N - tilde"],["210","O - grave"],["211","O - acute"],["212","O - circumflex"],["213","O - tilde"],["214","O - diaeresis"],["216","O - slash"],["338","ligature OE"],["352","S - caron"],["217","U - grave"],["218","U - acute"],["219","U - circumflex"],["220","U - diaeresis"],["221","Y - acute"],["376","Y - diaeresis"],["222","THORN"],["224","a - grave"],["225","a - acute"],["226","a - circumflex"],["227","a - tilde"],["228","a - diaeresis"],["229","a - ring above"],["230","ligature ae"],["231","c - cedilla"],["232","e - grave"],["233","e - acute"],["234","e - circumflex"],["235","e - diaeresis"],["236","i - grave"],["237","i - acute"],["238","i - circumflex"],["239","i - diaeresis"],["240","eth"],["241","n - tilde"],["242","o - grave"],["243","o - acute"],["244","o - circumflex"],["245","o - tilde"],["246","o - diaeresis"],["248","o slash"],["339","ligature oe"],["353","s - caron"],["249","u - grave"],["250","u - acute"],["251","u - circumflex"],["252","u - diaeresis"],["253","y - acute"],["254","thorn"],["255","y - diaeresis"],["913","Alpha"],["914","Beta"],["915","Gamma"],["916","Delta"],["917","Epsilon"],["918","Zeta"],["919","Eta"],["920","Theta"],["921","Iota"],["922","Kappa"],["923","Lambda"],["924","Mu"],["925","Nu"],["926","Xi"],["927","Omicron"],["928","Pi"],["929","Rho"],["931","Sigma"],["932","Tau"],["933","Upsilon"],["934","Phi"],["935","Chi"],["936","Psi"],["937","Omega"],["945","alpha"],["946","beta"],["947","gamma"],["948","delta"],["949","epsilon"],["950","zeta"],["951","eta"],["952","theta"],["953","iota"],["954","kappa"],["955","lambda"],["956","mu"],["957","nu"],["958","xi"],["959","omicron"],["960","pi"],["961","rho"],["962","final sigma"],["963","sigma"],["964","tau"],["965","upsilon"],["966","phi"],["967","chi"],["968","psi"],["969","omega"],["8501","alef symbol"],["982","pi symbol"],["8476","real part symbol"],["978","upsilon - hook symbol"],["8472","Weierstrass p"],["8465","imaginary part"],["8592","leftwards arrow"],["8593","upwards arrow"],["8594","rightwards arrow"],["8595","downwards arrow"],["8596","left right arrow"],["8629","carriage return"],["8656","leftwards double arrow"],["8657","upwards double arrow"],["8658","rightwards double arrow"],["8659","downwards double arrow"],["8660","left right double arrow"],["8756","therefore"],["8834","subset of"],["8835","superset of"],["8836","not a subset of"],["8838","subset of or equal to"],["8839","superset of or equal to"],["8853","circled plus"],["8855","circled times"],["8869","perpendicular"],["8901","dot operator"],["8968","left ceiling"],["8969","right ceiling"],["8970","left floor"],["8971","right floor"],["9001","left-pointing angle bracket"],["9002","right-pointing angle bracket"],["9674","lozenge"],["9824","black spade suit"],["9827","black club suit"],["9829","black heart suit"],["9830","black diamond suit"],["8194","en space"],["8195","em space"],["8201","thin space"],["8204","zero width non-joiner"],["8205","zero width joiner"],["8206","left-to-right mark"],["8207","right-to-left mark"]]},n.renderCell=function(e){return m.a.createElement("div",{key:e[0],onClick:n.onCellClick,role:"button",title:e[1],className:"wpcom-charmap__character"},String.fromCharCode(parseInt(e[0],10)))},n.onCellClick=function(e){n.props.editor.execCommand("mceInsertContent",!1,e.target.textContent.trim())},n.getButtons=function(){return[m.a.createElement(Ge.a,{isPrimary:!1,"aria-label":n.props.translate("Close special characters dialog"),onClick:n.props.onClose},n.props.translate("Close"))]},n}return M()(t,e),O()(t,[{key:"render",value:function(){return m.a.createElement(We.a,{isVisible:this.props.showDialog,buttons:this.getButtons(),additionalClassNames:"wpcom-charmap__dialog",onClose:this.props.onClose},m.a.createElement("h2",{className:"wpcom-charmap__heading"},this.props.translate("Special characters")),m.a.createElement("div",{className:"wpcom-charmap__table"},this.defaultCharMap().map(this.renderCell,this)))}}]),t}(m.a.Component);
/**
 * Reactified port of the TinyMCE charmap plugin.
 *
 * Adapted from WordPress.
 *
 *
 * @format
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 * @see https:
 */Je.displayName="CharMap",Je.propTypes={onClose:U.a.func,showDialog:U.a.bool,editor:U.a.object};var Qe=Object(h.localize)(Je);function Ze(e){var t;e.on("init",function(){t=document.createElement("div"),t.setAttribute("class","charmap-dialog-container"),e.getContainer().appendChild(t)}),e.on("remove",function(){L.a.unmountComponentAtNode(t),t.parentNode.removeChild(t),t=null}),e.addCommand("Wpcom_CharMap",function(){function n(){e.focus(),a("hide")}function a(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";L.a.render(m.a.createElement(Qe,{showDialog:"show"===a,onClose:n,editor:e}),t)}a("show")})}var Xe=n("./node_modules/events/events.js"),et=n.n(Xe),tt=n("./client/lib/shortcode/index.js"),nt=n("./client/components/gallery-shortcode/index.jsx"),at=function(e){function t(e){var n;return k()(this,t),n=P()(this,N()(t).call(this,e)),n.state={wrapper:null},n}return M()(t,e),O()(t,null,[{key:"match",value:function(e){var t=Object(tt.a)("gallery",e);if(t)return{index:t.index,content:t.content,options:{shortcode:t.shortcode}}}},{key:"serialize",value:function(e){return encodeURIComponent(e)}},{key:"edit",value:function(e,t){e.execCommand("wpcomEditGallery",t)}}]),O()(t,[{key:"componentDidMount",value:function(){this.setState({wrapper:L.a.findDOMNode(this.refs.view)}),window.MutationObserver&&(this.observer=new MutationObserver(this.props.onResize),this.observer.observe(L.a.findDOMNode(this.refs.view),{attributes:!0,childList:!0,subtree:!0}))}},{key:"componentWillUnmount",value:function(){this.observer&&this.observer.disconnect()}},{key:"renderShortcode",value:function(){if(this.state.wrapper)return m.a.createElement(nt.a,{siteId:this.props.siteId,width:this.state.wrapper.clientWidth},this.props.content)}},{key:"render",value:function(){return m.a.createElement("div",{ref:"view",className:"wpview-content wpview-type-gallery"},this.renderShortcode())}}]),t}(p.Component);at.propTypes={siteId:U.a.number,content:U.a.string,onResize:U.a.func},at.defaultProps={onResize:function(){}};var ot=at,it=n("./node_modules/@babel/runtime/helpers/typeof.js"),st=n.n(it),rt=n("./node_modules/@babel/runtime/helpers/get.js"),lt=n.n(rt),ct=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),dt=n.n(ct),ut=n("./node_modules/flux/utils.js"),pt=n("./client/dispatcher/index.js"),mt=/\(\?P?<([\w$]+)>/g,ht=/^([^\w\s\\])(.*)([^\w\s\\])([gim])?$/,ft=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"getInitialState",value:function(){return{}}},{key:"get",value:function(e){return this.getState()[e]}},{key:"reduce",value:function(e,t){switch(t=t.action,t.type){case"FETCH_EMBEDS":e=Object.assign({},e,dt()({},t.siteId,{status:"LOADING"}));break;case"RECEIVE_EMBEDS":if(t.error)e=Object.assign({},e,dt()({},t.siteId,{status:"ERROR"}));else{var n=t.embeds.map(function(e){e=e.replace(mt,"(");var t=e.match(ht);if(t&&t[1]===t[3])return new RegExp(t[2],t[4]);try{return new RegExp(e)}catch(e){return!1}}).filter(Boolean);e=Object.assign({},e,dt()({},t.siteId,{status:"LOADED",embeds:n}))}}return e}}]),t}(ut.ReduceStore),gt=new ft(pt.a),bt=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"getInitialState",value:function(){return{}}},{key:"get",value:function(e){var t=this.getState()[e];return t||{}}},{key:"reduce",value:function(e,t){switch(t=t.action,t.type){case"STOP_EDITING_POST":e={};break;case"FETCH_EMBED":e=Object.assign({},e,dt()({},t.url,{status:"LOADING"}));break;case"RECEIVE_EMBED":t.error?e=Object.assign({},e,dt()({},t.url,{status:"ERROR"})):t.data&&(e=Object.assign({},e,dt()({},t.url,{status:"LOADED",body:t.data.result,scripts:t.data.scripts,styles:t.data.styles})))}return e}}]),t}(ut.ReduceStore),vt=new bt(pt.a),yt=n("./client/lib/wp/browser.js"),Et=function(e,t){var n,a=yt.a.undocumented().site(e);t?(pt.a.handleViewAction({type:"FETCH_EMBED",siteId:e,url:t}),n={embed_url:t,force:"wpcom"}):pt.a.handleViewAction({type:"FETCH_EMBEDS",siteId:e}),a.embeds(n,function(n,a){t?pt.a.handleServerAction({type:"RECEIVE_EMBED",siteId:e,url:t,data:a,error:n}):pt.a.handleServerAction({type:"RECEIVE_EMBEDS",siteId:e,embeds:a?a.embeds:null,error:n})})},jt=n("./client/components/resizable-iframe/index.jsx"),wt=n("./client/lib/embed-frame-markup/index.jsx"),_t=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"componentDidMount",value:function(){this.setState({wrapper:this.refs.view},this.setHtml)}},{key:"componentDidUpdate",value:function(e,t){this.state.body!==t.body&&this.setHtml(),this.constrainEmbedDimensions()}},{key:"constrainEmbedDimensions",value:function(){if(this.refs.iframe){var e=L.a.findDOMNode(this.refs.view),t=L.a.findDOMNode(this.refs.iframe);if(t.contentDocument){var n=t.contentDocument.querySelector("iframe");if(n&&n.width){var a=parseInt(n.width,10);if(!(a<=e.clientWidth)&&(n.style.width=e.clientWidth+"px",n.height)){var o=parseInt(n.height,10)/a;n.style.height=Math.round(e.clientWidth*o)+"px"}}}}}},{key:"setHtml",value:function(){if(this.state.body&&this.refs.iframe){var e=L.a.findDOMNode(this.refs.iframe);if(e.contentDocument){var t=Object(wt.a)(Object(v.pick)(this.state,"body","scripts","styles"));e.contentDocument.open(),e.contentDocument.write(t),e.contentDocument.body.style.width="100%",e.contentDocument.body.style.overflow="hidden",e.contentDocument.close()}}}},{key:"renderFrame",value:function(){if(this.state.wrapper)return m.a.createElement(jt.a,{ref:"iframe",onResize:this.props.onResize,frameBorder:"0",seamless:!0,width:"100%"})}},{key:"render",value:function(){return m.a.createElement("div",{ref:"view",className:"wpview-content wpview-type-embed"},this.renderFrame())}}],[{key:"getStores",value:function(){return[vt]}},{key:"calculateState",value:function(e,t){return vt.get(t.content)}}]),t}(p.Component);_t.propTypes={siteId:U.a.number,content:U.a.string,onResize:U.a.func},_t.defaultProps={onResize:function(){}};var Ct=ut.Container.create(_t,{withProps:!0}),St=Ct,xt=function(e){function t(){var e;return k()(this,t),e=P()(this,N()(t).call(this)),e.sitesListener=e.updateSite.bind(we()(we()(e))),e}return M()(t,e),O()(t,[{key:"onChange",value:function(){this.emit("change"),this.fetchSiteEmbeds()}},{key:"updateSite",value:function(e){var t=e||Object(Z.e)(this.store.getState());this.hasOwnProperty("siteId")?this.siteId!==t&&(this.siteId=t,this.onChange()):(this.siteId=t,this.fetchSiteEmbeds())}},{key:"addListener",value:function(e,n,a){lt()(N()(t.prototype),"addListener",this).call(this,e,n),"change"===e&&1===this.listeners(e).length&&(this.store=a,this.selectedSiteSubscriberId=Object(v.uniqueId)(),a.dispatch({type:"SELECTED_SITE_SUBSCRIBE",listener:this.sitesListener}),this.embedsListListener=gt.addListener(this.onChange.bind(this)),this.embedsListener=vt.addListener(this.onChange.bind(this)),this.updateSite())}},{key:"removeListener",value:function(e,n){lt()(N()(t.prototype),"removeListener",this).call(this,e,n),"change"!==e||this.listeners(e).length||(this.store.dispatch({type:"SELECTED_SITE_UNSUBSCRIBE",listener:this.sitesListener}),this.embedsListListener&&this.embedsListListener.remove(),this.embedsListener&&this.embedsListener.remove())}},{key:"fetchSiteEmbeds",value:function(){this.siteId&&!gt.get(this.siteId)&&Et(this.siteId)}},{key:"fetchEmbed",value:function(e){this.siteId&&!vt.get(e).status&&Et(this.siteId,e)}},{key:"match",value:function(e){var t=this;if(this.siteId){var n=gt.get(this.siteId);if(n&&"LOADED"===n.status)for(var a,o=/(^|<p>)(https?:\/\/[^\s"]+?)(<\/p>\s*|$)/gi,i=function(){var e=a[2],o=n.embeds.some(function(t){return t.test(e)});if(!o)return"continue";var i=vt.get(e);return i.body?{v:{index:a.index+a[1].length,content:e}}:(Object(v.defer)(function(){return t.fetchEmbed(e)}),"continue")};a=o.exec(e);){var s=i();switch(s){case"continue":continue;default:if("object"===st()(s))return s.v}}}}},{key:"serialize",value:function(e){return encodeURIComponent(e)}},{key:"getComponent",value:function(){return St}},{key:"edit",value:function(e,t){e.execCommand("embedDialog",t)}}]),t}(et.a);function kt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.to,n=e.subject,a=e.fields,o=void 0===a?[]:a,i=o.map(function(e){var t=e.label,n=e.type,a=e.options,o=e.required;if(t&&n){var i={tag:"contact-field",type:"self-closing",attrs:Object(v.pickBy)({label:t,type:n,options:a})};return o&&(i.attrs.required=1),Object(tt.c)(i)}}).join("");return Object(tt.c)({tag:"contact-form",type:"closed",content:i,attrs:Object(v.pickBy)({to:t,subject:n})})}function It(e){if(!e)return null;var t=Object(tt.b)(e);return t?function(e){var t=e.attrs;t=void 0===t?{}:t;var n=t.named;n=void 0===n?{}:n;for(var a,o=n.to,i=n.subject,s=e.content,r=[];s&&(a=Object(tt.a)("contact-field",s));){if("attrs"in a.shortcode){var l=a.shortcode.attrs.named,c=l.label,d=l.type,u=l.options,p=l.required,m=Object(v.pickBy)({label:c,type:d,options:u,required:p});"required"in m&&(m.required=!0),r.push(m)}s=s.slice(a.index+a.content.length)}return Object(v.pickBy)({to:o,subject:i,fields:r})}(t):{}}var Ot=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"render",value:function(){return m.a.createElement("fieldset",_()({},Object(v.omit)(this.props,"className"),{className:"wpview-type-contact-form-field"}),this.props.children)}}]),t}(m.a.Component);Ot.displayName="ContactFormViewPreviewFieldset";var Tt=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"render",value:function(){return this.props.required?m.a.createElement("em",null,"Â (",this.props.translate("required"),")"):null}}]),t}(m.a.Component);Tt.displayName="ContactFormViewPreviewRequired";var Pt=Object(h.localize)(Tt),Dt=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"render",value:function(){return m.a.createElement("legend",null,this.props.label,m.a.createElement(Pt,this.props))}}]),t}(m.a.Component);Dt.displayName="PreviewLegend";var Nt=function(e,t){return m.a.createElement(Ot,{key:"contact-form-field-"+t},m.a.createElement(Dt,e),m.a.createElement("input",{type:"text"}))},Rt={name:Nt,email:Nt,url:Nt,text:Nt,textarea:function(e,t){return m.a.createElement(Ot,{key:"contact-form-field-"+t},m.a.createElement(Dt,e),m.a.createElement("textarea",null))},checkbox:function(e,t){return m.a.createElement(Ot,{key:"contact-form-field-"+t},m.a.createElement("label",null,m.a.createElement("input",{type:"checkbox"}),e.label,m.a.createElement(Pt,{required:e.required})))},select:function(e,t){return m.a.createElement(Ot,{key:"contact-form-field-"+t},m.a.createElement(Dt,e),m.a.createElement("select",null,[].concat(e.options.split(",")).map(function(e,t){return m.a.createElement("option",{key:"contact-form-select-option-"+t},e)})))},radio:function(e,t){return m.a.createElement(Ot,{key:"contact-form-field-"+t},m.a.createElement(Dt,e),[].concat(e.options.split(",")).map(function(e,t){return m.a.createElement("label",{key:"contact-form-radio-"+t},m.a.createElement("input",{type:"radio"}),m.a.createElement("span",null,e))}))}},Mt=function(e){return Rt.hasOwnProperty(e.type)?Rt[e.type].apply(this,arguments):null},At=Object(h.localize)(function(e){var t=e.content,n=e.translate,a=It(t),o=a.fields;return m.a.createElement("div",{className:"wpview-content wpview-type-contact-form"},[].concat(o).map(Mt),m.a.createElement("button",{disabled:!0},n("Submit")))});function Lt(e){var t=Object(tt.a)("contact-form",e);if(t)return{index:t.index,content:t.content,options:{shortcode:t.shortcode}}}function Bt(e){return encodeURIComponent(e)}function Ut(e,t){e.execCommand("wpcomContactForm",t)}function Ft(){return At}var qt=n("./client/blocks/shortcode/index.js");function zt(e){var t=e.siteId,n=e.content,a=e.width;if(!t||!a)return null;var o=Object(tt.c)(Object(v.merge)({attrs:{named:{w:a}}},Object(tt.b)(n)));return m.a.createElement(qt.a,{siteId:t,width:a},o)}zt.propTypes={siteId:U.a.number,content:U.a.string,width:U.a.number};var Vt,Ht,Wt,Gt,Kt=Object(F.b)(function(e){return{siteId:Object(Z.e)(e)}})((Vt=zt,Gt=Vt.displayName||Vt.name||"",Wt=Ht=function(e){function t(){var e;return k()(this,t),e=P()(this,N()(t).apply(this,arguments)),e.boundSetWrapperState=e.setWrapperState.bind(we()(we()(e))),e.state={wrapper:null},e}return M()(t,e),O()(t,[{key:"setWrapperState",value:function(e){e&&(this.setState({wrapper:e}),this.disconnectObserver(),this.observer=new MutationObserver(this.props.onResize),this.observer.observe(e,{attributes:!0,childList:!0,subtree:!0}))}},{key:"componentWillUnmount",value:function(){this.disconnectObserver()}},{key:"disconnectObserver",value:function(){this.observer&&this.observer.disconnect()}},{key:"render",value:function(){var e;return this.state.wrapper&&(e={width:this.state.wrapper.clientWidth}),m.a.createElement("div",{ref:this.boundSetWrapperState},m.a.createElement(Vt,_()({},this.props,e)))}}]),t}(p.PureComponent),Ht.displayName="ResizableView("+Gt+")",Ht.propTypes={onResize:U.a.func},Ht.defaultProps={onResize:function(){}},Wt));function Yt(e){var t=Object(tt.a)("wpvideo",e);if(t)return{index:t.index,content:t.content,options:{shortcode:t.shortcode}}}function $t(e){return encodeURIComponent(e)}function Jt(){return Kt}var Qt=n("./client/config/index.js");function Zt(e){var t=e.id,n=e.isMembership;return Qt.a.isEnabled("memberships")&&n?Object(tt.c)({tag:"membership",type:"single",attrs:{id:t}}):Object(tt.c)({tag:"simple-payment",type:"single",attrs:{id:t}})}function Xt(e){if(!e)return null;var t=Object(tt.b)(e),n={},a=parseInt(Object(v.get)(t,"attrs.named.id",null));return n.id=isNaN(a)?null:a,n}var en=n("./client/state/selectors/get-media-item.js"),tn=n("./client/state/selectors/get-simple-payments.js"),nn=n("./client/lib/format-currency/index.js"),an=n("./client/components/data/query-simple-payments/index.js"),on=n("./client/components/data/query-media/index.jsx"),sn=n("./client/state/sites/plans/selectors.js"),rn=n("./client/lib/plans/constants.js"),ln=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.translate,n=e.productId,a=e.product,o=e.siteId,i=e.planHasSimplePaymentsFeature;if(!a)return m.a.createElement(an.a,{siteId:o,productId:n});if(!i)return m.a.createElement("div",{className:"wpview-content wpview-type-simple-payments"},m.a.createElement("div",{className:"wpview-type-simple-payments__unsupported"},m.a.createElement("div",{className:"wpview-type-simple-payments__unsupported-icon"},m.a.createElement(Y.a,{icon:"cross"})),m.a.createElement("p",{className:"wpview-type-simple-payments__unsupported-message"},t("Your plan doesn't include Simple Payments."))));var s=this.props.productImage,r=a.title,l=a.description,c=a.price,d=a.currency,u=a.multiple,p=a.featuredImageId;return m.a.createElement("div",{className:"wpview-content wpview-type-simple-payments"},p&&m.a.createElement(on.a,{siteId:o,mediaId:p}),m.a.createElement("div",{className:"wpview-type-simple-payments__wrapper"},s&&m.a.createElement("div",{className:"wpview-type-simple-payments__image-part"},m.a.createElement("figure",{className:"wpview-type-simple-payments__image-figure"},m.a.createElement("img",{className:"wpview-type-simple-payments__image",src:s.URL}))),m.a.createElement("div",{className:"wpview-type-simple-payments__text-part"},m.a.createElement("div",{className:"wpview-type-simple-payments__title"},r),m.a.createElement("div",{className:"wpview-type-simple-payments__description"},l),m.a.createElement("div",{className:"wpview-type-simple-payments__price-part"},Object(nn.a)(c,d)),m.a.createElement("div",{className:"wpview-type-simple-payments__pay-part"},u&&m.a.createElement("div",{className:"wpview-type-simple-payments__pay-quantity"},m.a.createElement("input",{className:"wpview-type-simple-payments__pay-quantity-input",type:"text",value:"1",readOnly:!0})),m.a.createElement("div",{className:"wpview-type-simple-payments__pay-paypal-button-wrapper"},m.a.createElement("div",{className:"wpview-type-simple-payments__pay-paypal-button-content"},m.a.createElement("span",{className:"wpview-type-simple-payments__pay-paypal-button-text"},t("Pay with")),m.a.createElement("span",{className:"wpview-type-simple-payments_paypal-logo"})))))))}}]),t}(p.Component);ln=Object(F.b)(function(e,t){var n=t.content,a=Xt(n),o=a.id,i=void 0===o?null:o,s=Object(Z.e)(e),r=Object(tn.a)(e,s,i);return{shortcodeData:a,productId:i,siteId:s,product:r,productImage:Object(en.a)(e,s,Object(v.get)(r,"featuredImageId")),planHasSimplePaymentsFeature:Object(sn.i)(e,s,rn.s)}})(Object(h.localize)(ln)),ln.match=function(e){var t=Object(tt.a)("simple-payment",e);if(t)return{index:t.index,content:t.content,options:{shortcode:t.shortcode}}},ln.serialize=function(e){return encodeURIComponent(e)},ln.edit=function(e,t){e.execCommand("simplePaymentsButton",t)};var cn=ln,dn={gallery:ot,embed:new xt,contactForm:a,video:o,simplePayments:cn},un=Object(v.mapValues)(dn,function(e){return"function"==typeof e.getComponent?e.getComponent():e}),pn=Object(v.values)(dn).filter(function(e){return e instanceof et.a}),mn={setMarkers:function(e){var t,n=[{content:e}];return Object(v.forEach)(dn,function(e,a){t=n.slice(),n=[],Object(v.forEach)(t,function(t){var o,i=t.content;if(t.processed)n.push(t);else{for(;i&&(o=e.match(i));)o.index&&n.push({content:i.substring(0,o.index)}),n.push({content:'<p class="wpview-marker" data-wpview-text="'+e.serialize(o.content,o.options)+'" data-wpview-type="'+a+'">.</p>',processed:!0}),i=i.slice(o.index+o.content.length);i&&n.push({content:i})}})}),e=Object(v.map)(n,"content").join(""),e.replace(/<p>\s*<p data-wpview-marker=/g,"<p data-wpview-marker=").replace(/<\/p>\s*<\/p>/g,"</p>")},isEditable:function(e){return!(!dn[e]||!dn[e].edit)},edit:function(e,t,n){this.isEditable(e)&&dn[e].edit(t,n)},components:un,emitters:pn},hn=n("./client/lib/react-helpers/index.js");
/**
 * Adapted from the WordPress wp-view TinyMCE plugin.
 *
 *
 * @format
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 */
function fn(e){var t,n,a,o,i,s,r,l,c=e.$,d=H.a.Env,u=H.a.util.VK,p=H.a.dom.TreeWalker,h=!1,g=!0,b=/iPad|iPod|iPhone/.test(navigator.userAgent);function y(){e.nodeChanged()}function E(){if(t=c(".wpview-marker"),t.length&&(t.each(function(t,n){var a=e.dom.getAttrib(n,"data-wpview-text"),o=e.dom.getAttrib(n,"data-wpview-type");e.dom.replace(e.dom.createFragment('<div class="wpview-wrap" data-wpview-text="'+a+'" data-wpview-type="'+o+'"><p class="wpview-selection-before">Â </p><div class="wpview-body" contenteditable="false"></div><p class="wpview-selection-after">Â </p></div>'),n)}),1)){var t,n=e.getParam("redux_store"),a=Object(Z.e)(n.getState());c(".wpview-wrap").each(function(e,t){var o=c(t);if(void 0===o.attr("data-wpview-rendered")){var i=o.attr("data-wpview-type");Object(hn.b)(m.a.createElement(mn.components[i],{content:j(t),siteId:a,onResize:Object(v.debounce)(y,500)}),o.find(".wpview-body")[0],n),o.attr("data-wpview-rendered","")}})}}function j(e){return decodeURIComponent(c(e).attr("data-wpview-text")||"")}function w(e){return _(e,"wpview-wrap")}function _(e,t){for(;e&&e.parentNode;){if(e.className&&-1!==(" "+e.className+" ").indexOf(" "+t+" "))return e;e=e.parentNode}return!1}function C(e){e.stopPropagation()}function S(t,n){var a=t?"before":"after",o=t?0:1;O(),e.selection.setCursorLocation(e.dom.select(".wpview-selection-"+a,n)[0],o),e.nodeChanged()}function x(t,n,a){var o=e.dom,i=o.create("p");d.ie&&d.ie<11||(i.innerHTML='<br data-mce-bogus="1">'),n?t.parentNode.insertBefore(i,t):o.insertAfter(i,t),O(),n&&a===u.ENTER?S(n,t):e.selection.setCursorLocation(i,0),e.nodeChanged()}function k(t){e.undoManager.transact(function(){x(t),L.a.unmountComponentAtNode(c(t).find(".wpview-body")[0]),e.dom.remove(t),e.focus()})}function I(n){var a,o=e.dom;n&&(n!==t&&(i||e.getBody().focus(),O(),t=n,o.setAttrib(n,"data-mce-selected",1),a=o.create("div",{class:"wpview-clipboard",contenteditable:"true"},j(n)),e.dom.select(".wpview-body",n)[0].appendChild(a),o.bind(a,"beforedeactivate focusin focusout",C),o.bind(t,"beforedeactivate focusin focusout",C),b?e.selection.select(a):e.selection.select(a,!0)),e.nodeChanged(),e.fire("wpview-selected",n))}function O(){var n,a=e.dom;t&&(n=e.dom.select(".wpview-clipboard",t)[0],a.unbind(n),a.remove(n),a.unbind(t,"beforedeactivate focusin focusout click mouseup",C),a.setAttrib(t,"data-mce-selected",null)),t=null}function T(e,t){return"<p>"+window.decodeURIComponent(t)+"</p>"}function P(e){return e.replace(/<div[^>]+data-wpview-text="([^"]+)"[^>]*>(?:[\s\S]+?wpview-selection-after[^>]+>[^<>]*<\/p>\s*|\.)<\/div>/g,T).replace(/<p [^>]*?data-wpview-text="([^"]+)"[^>]*>[\s\S]*?<\/p>/g,T)}function D(){var t,n;e.isHidden()||(t=e.getContent({format:"raw"}),n=mn.setMarkers(t),t!==n&&e.setContent(n,{format:"raw",isSettingMarkers:!0}))}function N(e){c("div.wpview-wrap, p.wpview-marker",e).each(function(e,t){t.innerHTML="."})}function R(e){return e<=47&&e!==u.SPACEBAR&&e!==u.ENTER&&e!==u.DELETE&&e!==u.BACKSPACE&&(e<37||e>40)||e>=224||e>=144&&e<=150||e>=91&&e<=93||e>=112&&e<=135}e.on("BeforeAddUndo",function(e){e.level.content&&(e.level.content=P(e.level.content))}),e.on("BeforeSetContent",function(n){var a;if(n.selection||c(".wpview-wrap .wpview-body").each(function(e,t){L.a.unmountComponentAtNode(t)}),n.content){if(!n.load&&(t&&k(t),a=e.selection.getNode(),a&&a!==e.getBody()&&/^\s*https?:\/\/\S+\s*$/i.test(n.content))){if(a=e.dom.getParent(a,"p"),!a||!/^[\s\uFEFF\u00A0]*$/.test(c(a).text()||""))return;a.innerHTML=""}n.isSettingMarkers||(n.content=mn.setMarkers(n.content))}}),e.on("pastePreProcess",function(e){var t=e.content;if(t){t=H.a.trim(t.replace(/<[^>]+>/g,""));var n=/(https?:\/\/[^<]*)(\.jpg|\.jpeg|\.gif|\.png)\??.*$/i.exec(t);n?e.content='<img src="'+n[1]+n[2]+'" style="max-width:100%;" />':/^https?:\/\/\S+$/i.test(t)&&(e.content=t)}}),e.on("SetContent",function(){E()}),e.on("click",function(t){var n,a,o,i=t.clientX,s=t.clientY,r=e.getBody(),l=r.getBoundingClientRect(),c=r.firstChild,d=r.lastChild;c&&d&&(n=c.getBoundingClientRect(),a=d.getBoundingClientRect(),s<n.top&&(o=w(c))?(S(!0,o),t.preventDefault()):s>a.bottom&&(o=w(d))?(S(!1,o),t.preventDefault()):(i<l.left||i>l.right)&&H.a.each(e.dom.select(".wpview-wrap"),function(e){var n=e.getBoundingClientRect();return!(s<n.top)&&(s>=n.top&&s<=n.bottom?(i<l.left?(S(!0,e),t.preventDefault()):i>l.right&&(S(!1,e),t.preventDefault()),!1):void 0)}))}),e.on("init",function(){var t=!1,n=e.selection,a=window.MutationObserver||window.WebKitMutationObserver;e.on("BeforeSetContent",function(){var t,a,o=w(n.getNode());o&&(!o.nextSibling||w(o.nextSibling)?(a=e.getDoc().createTextNode(""),e.dom.insertAfter(a,o)):(t=new p(o.nextSibling,o.nextSibling),a=t.next()),n.select(a),n.collapse(!0))}),e.dom.bind(e.getDoc(),"touchmove",function(){t=!0}),e.on("mousedown mouseup click touchend",function(e){var n=w(e.target);if(g=!1,n)return e.stopImmediatePropagation(),e.preventDefault(),"touchend"===e.type&&t?t=!1:I(n),!1;"touchend"!==e.type&&"mousedown"!==e.type||O(),"touchend"===e.type&&t&&(t=!1)},!0),a&&new a(function(){e.fire("wp-body-class-change")}).observe(e.getBody(),{attributes:!0,attributeFilter:["class"]})}),e.on("preinit show",function(){mn.emitters.forEach(function(t){t.addListener("change",D,e.getParam("redux_store"))}),D()}),e.on("hide remove",function(){mn.emitters.forEach(function(e){e.removeListener("change",D)})}),e.on("PreProcess",function(e){N(e.node)},!0),e.on("hide",function(){O(),N()}),e.on("GetContent",function(e){"raw"===e.format&&e.content&&!e.selection&&(e.content=P(e.content))}),e.on("PostProcess",function(e){e.content&&(e.content=e.content.replace(/<div [^>]*?data-wpview-text="([^"]+)"[^>]*>[\s\S]*?<\/div>/g,T).replace(/<p [^>]*?data-wpview-text="([^"]+)"[^>]*>[\s\S]*?<\/p>/g,T))}),e.on("keydown",function(n){var o,i,s,r,l,c,d,p=n.keyCode,m=e.dom,f=e.selection;if(t){if((n.metaKey||n.ctrlKey)&&p!==u.BACKSPACE&&86!==p||p>=112&&p<=123)return void((n.metaKey||n.ctrlKey)&&88===p&&(h=t));if(i=w(f.getNode()),i!==t)return void O();p===u.LEFT?(S(!0,i),n.preventDefault()):p===u.UP?(i.previousSibling?w(i.previousSibling)?S(!0,i.previousSibling):(O(),f.select(i.previousSibling,!0),f.collapse()):S(!0,i),n.preventDefault()):p===u.RIGHT?(S(!1,i),n.preventDefault()):p===u.DOWN?(i.nextSibling?w(i.nextSibling)?S(!1,i.nextSibling):(O(),f.setCursorLocation(i.nextSibling,0)):S(!1,i),n.preventDefault()):R(p)||(k(t),p!==u.ENTER&&p!==u.DELETE&&p!==u.BACKSPACE||n.preventDefault())}else{if(n.metaKey||n.ctrlKey||p>=112&&p<=123)return;if(o=f.getNode(),a=o,i=w(o),f.isCollapsed()||(l=f.getRng(),(i=w(l.endContainer))?(c=l.cloneRange(),f.select(i.previousSibling,!0),f.collapse(),d=f.getRng(),c.setEnd(d.endContainer,d.endOffset),f.setRng(c)):(i=w(l.startContainer))&&(c=l.cloneRange(),c.setStart(i.nextSibling,0),f.setRng(c))),!i)return void(n.keyCode===u.BACKSPACE&&(e.dom.isEmpty(o)?(i=w(o.previousSibling))&&(S(!1,i),e.dom.remove(o),n.preventDefault()):(l=f.getRng())&&0===l.startOffset&&0===l.endOffset&&(i=w(o.previousSibling))&&(S(!1,i),n.preventDefault())));if(!(s=m.hasClass(i,"wpview-selection-before"))&&!(r=m.hasClass(i,"wpview-selection-after")))return;if(R(p))return;r&&p===u.UP||s&&p===u.BACKSPACE?(i.previousSibling?w(i.previousSibling)?S(!1,i.previousSibling):m.isEmpty(i.previousSibling)&&p===u.BACKSPACE?m.remove(i.previousSibling):(f.select(i.previousSibling,!0),f.collapse()):S(!0,i),n.preventDefault()):!r||p!==u.DOWN&&p!==u.RIGHT?!s||p!==u.UP&&p!==u.LEFT?s&&p===u.DOWN?(i.nextSibling?w(i.nextSibling)?S(!0,i.nextSibling):f.setCursorLocation(i.nextSibling,0):S(!1,i),n.preventDefault()):r&&p===u.LEFT||s&&p===u.RIGHT?(I(i),n.preventDefault()):r&&p===u.BACKSPACE?(k(i),n.preventDefault()):r?x(i):s&&x(i,!0,p):(i.previousSibling&&(w(i.previousSibling)?S(p===u.UP,i.previousSibling):(f.select(i.previousSibling,!0),f.collapse())),n.preventDefault()):(i.nextSibling&&(w(i.nextSibling)?S(p===u.RIGHT,i.nextSibling):f.setCursorLocation(i.nextSibling,0)),n.preventDefault()),p===u.ENTER&&n.preventDefault()}}),e.on("keyup",function(){h&&(k(h),h=!1)}),e.on("focus",function(){var t;i=!0,e.dom.addClass(e.getBody(),"has-focus"),g&&(t=w(e.getBody().firstChild))&&S(!0,t),g=!1}),e.on("blur",function(){i=!1,e.dom.removeClass(e.getBody(),"has-focus")}),e.on("NodeChange",function(t){var s=e.dom,r=e.dom.select(".wpview-wrap"),l=t.element.className,c=w(t.element),d=a;if(a=!1,clearInterval(n),H.a.each(r,function(e){e.className&&(e.className=e.className.replace(/ ?\bwpview-(?:selection-before|selection-after|cursor-hide)\b/g,""))}),i&&c)if("wpview-selection-before"!==l&&"wpview-selection-after"!==l||!e.selection.isCollapsed())_(t.element,"wpview-clipboard")||o||(O(),o++,S(!0,c));else{if(o=0,O(),d===c.previousSibling)return void S(!0,c);if(d===c.nextSibling)return void S(!1,c);s.addClass(c,l),n=setInterval(function(){s.hasClass(c,"wpview-cursor-hide")?s.removeClass(c,"wpview-cursor-hide"):s.addClass(c,"wpview-cursor-hide")},500)}}),e.on("BeforeExecCommand",function(){var t,n=e.selection.getNode();n&&((r="wpview-selection-before"===n.className)||"wpview-selection-after"===n.className)&&(t=w(n))&&(x(t,r),s=t)}),e.on("ExecCommand",function(n){var a,o;"embedDialog"!==n.command&&(t&&(a=t,O(),I(a)),s&&(o=s[r?"previousSibling":"nextSibling"],o&&"P"===o.nodeName&&e.dom.isEmpty(o)&&(e.dom.remove(o),S(r,s)),s=!1))}),e.on("ResolveName",function(t){e.dom.hasClass(t.target,"wpview-wrap")?(t.name=e.dom.getAttrib(t.target,"data-wpview-type")||"wpview",t.stopPropagation()):w(t.target)&&(t.preventDefault(),t.stopPropagation())}),e.addButton("wp_view_edit",{tooltip:f.a.translate("Edit",{context:"verb"}),icon:"dashicon dashicons-edit",onPostRender:function(){e.on("wptoolbar",function(){var n;t&&(n=e.dom.getAttrib(t,"data-wpview-type"),this.visible(mn.isEditable(n)))}.bind(this))},onClick:function(){var n;t&&(n=e.dom.getAttrib(t,"data-wpview-type"),mn.edit(n,e,j(t)))}}),e.addButton("wp_view_remove",{tooltip:f.a.translate("Remove"),icon:"dashicon dashicons-no",onClick:function(){t&&k(t)}}),e.once("preinit",function(){l=e.wp._createToolbar(["wp_view_edit","wp_view_remove"])}),e.on("wptoolbar",function(e){t&&(e.element=t,e.toolbar=l)})}var gn=new RegExp("(?:<p>\\s*)?(?:<pre>\\s*)?(\\[(code|sourcecode)[^\\]]*\\][\\s\\S]*?\\[\\/\\2\\])(?:\\s*<\\/pre>)?(?:\\s*<\\/p>)?","gi");function bn(e){var t=e.content;return t&&-1!==t.indexOf("[")?t.replace(gn,function(e,t){return t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),"<p>"+t+"</p>"}):t}function vn(e){e.on("BeforeSetContent",function(e){var t,n,a,o;e.content&&"html"!==e.mode&&(e.content=(t=e,n=t.content,a=t.initial,o=t.load,n.replace(gn,function(e,t){return t=t.replace(/\r/,""),t=t.replace(/<br ?\/?>\n?/g,"\n").replace(/<\/?p( [^>]*)?>\n?/g,"\n"),a&&!o||(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),"<pre>"+t+"</pre>"})))}),e.on("GetContent",function(e){"raw"===e.format&&e.content&&!e.selection&&(e.content=bn(e))}),e.on("PostProcess",function(e){e.content&&(e.content=bn(e))})}
/**
 * Adapted from the WordPress wp-editimage TinyMCE plugin.
 *
 *
 * @format
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 */
function yn(e){var t,n,a,o=H.a.each,i=H.a.Env.iOS;function s(t){return!(!e.dom.getAttrib(t,"data-mce-placeholder")&&!e.dom.getAttrib(t,"data-mce-object"))}function r(t){var n;"DIV"===t.nodeName&&e.dom.hasClass(t,"mceTemp")?n=t:"IMG"!==t.nodeName&&"DT"!==t.nodeName&&"A"!==t.nodeName||(n=e.dom.getParent(t,"div.mceTemp")),n?(n.nextSibling?e.selection.select(n.nextSibling):n.previousSibling?e.selection.select(n.previousSibling):e.selection.select(n.parentNode),e.selection.collapse(!0),e.dom.remove(n)):e.dom.remove(t),e.nodeChanged(),e.undoManager.add()}e.addButton("wp_img_remove",{tooltip:"Remove",icon:"dashicon dashicons-trash",onclick:function(){r(e.selection.getNode())}}),o({alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",alignnone:"No alignment"},function(t,n){var a=n.slice(5);e.addButton("wp_img_"+n,{tooltip:t,icon:"dashicon dashicons-align-"+a,cmd:"alignnone"===n?"wpAlignNone":"Justify"+a.slice(0,1).toUpperCase()+a.slice(1),onPostRender:function(){var t=this;e.on("NodeChange",function(a){if("IMG"===a.element.nodeName){var o=e.dom.getParent(a.element,".wp-caption")||a.element;"alignnone"===n?t.active(!/\balign(left|center|right)\b/.test(o.className)):t.active(e.dom.hasClass(o,n))}})}})}),e.once("preinit",function(){t=e.wp._createToolbar(["wp_img_alignleft","wp_img_aligncenter","wp_img_alignright","wp_img_alignnone","wpcom_img_size_decrease","wpcom_img_size_increase","wp_img_caption","wp_img_advanced","wp_img_edit","wp_img_remove"])}),e.on("wptoolbar",function(e){"IMG"!==e.element.nodeName||s(e.element)||(e.toolbar=t)}),i&&e.on("click",function(n){if("IMG"===n.target.nodeName){var a=n.target;window.setTimeout(function(){e.selection.select(a),e.nodeChanged()},200)}else t.hide()}),e.on("init",function(){var t=e.dom,a=e.getParam("wpeditimage_html5_captions")?"html5-captions":"html4-captions";t.addClass(e.getBody(),a),e.on("wpLoadImageForm",function(t){if(!e.getParam("wpeditimage_disable_captions")){t.data.splice(t.data.length-1,0,{type:"textbox",flex:1,name:"caption",minHeight:60,multiline:!0,scroll:!0,label:"Image caption"})}}),e.on("wpNewImageRefresh",function(e){var n,a;(n=t.getParent(e.node,"dl.wp-caption"))&&(n.style.width||(a=parseInt(e.node.clientWidth,10)+10,a=a?a+"px":"50%",t.setStyle(n,"width",a)))}),e.on("wpImageFormSubmit",function(a){var o,i,s,r,l,c=a.imgData.data,d=a.imgData.node,u=a.imgData.caption,p="",m="",h="";c.id="__wp-temp-img-id",a.imgData.cancel=!0,c.style||(c.style=null),c.src?(u&&(u=u.replace(/\r\n|\r/g,"\n").replace(/<\/?[a-zA-Z0-9]+( [^<>]+)?>/g,function(e){return e.replace(/[\r\n\t]+/," ")}),u=u.replace(/(<br[^>]*>)\s*\n\s*/g,"$1").replace(/\s*\n\s*/g,"<br />"),u=function(t){return!t||-1===t.indexOf("<")&&-1===t.indexOf(">")?t:(n||(n=new H.a.html.Serializer({},e.schema)),n.serialize(e.parser.parse(t,{forced_root_block:!1})))}(u)),d?(l=d.id||null,t.setAttribs(d,c),o=t.getParent(d,"dl.wp-caption"),u?o?(i=t.select("dd.wp-caption-dd",o)[0])&&(i.innerHTML=u):(d.className&&(p=d.className.match(/wp-image-([0-9]+)/),m=d.className.match(/align(left|right|center|none)/)),m?(m=m[0],d.className=d.className.replace(/align(left|right|center|none)/g,"")):m="alignnone",m=' class="wp-caption '+m+'"',p&&(p=' id="attachment_'+p[1]+'"'),h=c.width||d.clientWidth,h&&(h=parseInt(h,10),e.getParam("wpeditimage_html5_captions")||(h+=10),h=' style="width: '+h+'px"'),s=d.parentNode&&"A"===d.parentNode.nodeName?d.parentNode:d,r="<dl "+p+m+h+'><dt class="wp-caption-dt"></dt><dd class="wp-caption-dd">'+u+"</dd></dl>",o=t.create("div",{class:"mceTemp"},r),(i=t.getParent(s,"p"))?i.parentNode.insertBefore(o,i):s.parentNode.insertBefore(o,s),e.$(o).find("dt.wp-caption-dt").append(s),i&&t.isEmpty(i)&&t.remove(i)):o&&(r="A"===d.parentNode.nodeName?t.getOuterHTML(d.parentNode):t.getOuterHTML(d),i=t.create("p",{},r),t.insertAfter(i,o.parentNode),e.selection.select(i),e.nodeChanged(),t.remove(o.parentNode))):(r=t.createHTML("img",c),u?(s=e.selection.getNode(),c.width&&(h=parseInt(c.width,10),e.getParam("wpeditimage_html5_captions")||(h+=10),h=' style="width: '+h+'px"'),r='<dl class="wp-caption alignnone"'+h+'><dt class="wp-caption-dt">'+r+'</dt><dd class="wp-caption-dd">'+u+"</dd></dl>",i="P"===s.nodeName?s:t.getParent(s,"p"),i&&"P"===i.nodeName?(o=t.create("div",{class:"mceTemp"},r),i.parentNode.insertBefore(o,i),e.selection.select(o),e.nodeChanged(),t.isEmpty(i)&&t.remove(i)):e.selection.setContent('<div class="mceTemp">'+r+"</div>")):e.selection.setContent(r)),d=t.get("__wp-temp-img-id"),t.setAttrib(d,"id",l),a.imgData.node=d):d&&((o=t.getParent(d,"div.mceTemp"))?t.remove(o):"A"===d.parentNode.nodeName?t.remove(d.parentNode):t.remove(d),e.nodeChanged())}),e.on("wpLoadImageData",function(n){var a,o=n.imgData.data,i=n.imgData.node;(a=t.getParent(i,"dl.wp-caption"))&&(a=t.select("dd.wp-caption-dd",a)[0],a&&(o.caption=e.serializer.serialize(a).replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,"")))}),t.bind(e.getDoc(),"dragstart",function(n){var a=e.selection.getNode();"IMG"===a.nodeName&&t.getParent(a,".wp-caption")&&n.preventDefault()}),H.a.Env.ie&&H.a.Env.ie>10&&t.bind(e.getBody(),"mscontrolselect",function(n){"IMG"===n.target.nodeName&&t.getParent(n.target,".wp-caption")?e.getBody().focus():"DL"===n.target.nodeName&&t.hasClass(n.target,"wp-caption")&&n.target.focus()})}),e.on("ObjectResized",function(t){var n=t.target;"IMG"===n.nodeName&&e.undoManager.transact(function(){var a,o,i=e.dom;n.className=n.className.replace(/\bsize-[^ ]+/,""),(a=i.getParent(n,".wp-caption"))&&(o=t.width||i.getAttrib(n,"width"),o&&(o=parseInt(o,10),e.getParam("wpeditimage_html5_captions")||(o+=10),i.setStyle(a,"width",o+"px")))})}),e.on("pastePostProcess",function(t){e.dom.getParent(e.selection.getNode(),"dd.wp-caption-dd")&&(e.$("img, audio, video, object, embed, iframe, script, style",t.node).remove(),e.$("*",t.node).each(function(t,n){e.dom.isBlock(n)&&(H.a.trim(n.textContent||n.innerText)?(e.dom.insertAfter(e.dom.create("br"),n),e.dom.remove(n,!0)):e.dom.remove(n))}),e.$("br",t.node).each(function(t,n){n.nextSibling&&"BR"!==n.nextSibling.nodeName&&n.previousSibling&&"BR"!==n.previousSibling.nodeName||e.dom.remove(n)}),a=!0)}),e.on("BeforeExecCommand",function(n){var o,i,s,r,l,c,d=n.command,u=e.dom;if("mceInsertContent"===d){if(o=e.selection.getNode(),c=u.getParent(o,"div.mceTemp"),c){if(a)return void(a=!1);i=u.create("p"),u.insertAfter(i,c),e.selection.setCursorLocation(i,0),"IMG"!==o.nodeName&&"DT"!==o.nodeName||e.$(c).remove(),e.nodeChanged()}}else if("JustifyLeft"===d||"JustifyRight"===d||"JustifyCenter"===d||"wpAlignNone"===d){if(o=e.selection.getNode(),r="align"+d.slice(7).toLowerCase(),s=e.dom.getParent(o,".wp-caption"),"IMG"!==o.nodeName&&!s)return;o=s||o,l=e.dom.hasClass(o,r)?" alignnone":" "+r,o.className=o.className.replace(/ ?align(left|center|right|none)/g,"")+l,e.nodeChanged(),n.preventDefault(),t&&t.reposition(),e.fire("ExecCommand",{command:d,ui:n.ui,value:n.value})}}),e.on("keydown",function(t){var n,a,o,i,s=e.selection,l=t.keyCode,c=e.dom,d=H.a.util.VK;if(l===d.ENTER)n=s.getNode(),a=c.getParent(n,"div.mceTemp"),a&&(c.events.cancel(t),H.a.each(c.select("dt, dd",a),function(e){c.isEmpty(e)&&c.remove(e)}),i=H.a.Env.ie&&H.a.Env.ie<11?"":'<br data-mce-bogus="1" />',o=c.create("p",null,i),"DD"===n.nodeName?c.insertAfter(o,a):a.parentNode.insertBefore(o,a),e.nodeChanged(),s.setCursorLocation(o,0));else if((l===d.DELETE||l===d.BACKSPACE)&&(n=s.getNode(),"DIV"===n.nodeName&&c.hasClass(n,"mceTemp")?a=n:"IMG"!==n.nodeName&&"DT"!==n.nodeName&&"A"!==n.nodeName||(a=c.getParent(n,"div.mceTemp")),a))return c.events.cancel(t),r(n),!1}),H.a.Env.gecko&&e.on("undo redo",function(){"IMG"===e.selection.getNode().nodeName&&e.selection.collapse()}),e.wpSetImgCaption=function(t){return function(t){return t.replace(/(?:<p>)?\[(?:wp_)?caption([^\]]+)\]([\s\S]+?)\[\/(?:wp_)?caption\](?:<\/p>)?/g,function(t,n,a){var o,i,s,r,l,c,d=H.a.trim;return o=n.match(/id=['"]([^'"]*)['"] ?/),o&&(n=n.replace(o[0],"")),i=n.match(/align=['"]([^'"]*)['"] ?/),i&&(n=n.replace(i[0],"")),s=n.match(/class=['"]([^'"]*)['"] ?/),s&&(n=n.replace(s[0],"")),c=n.match(/width=['"]([0-9]*)['"] ?/),c&&(n=n.replace(c[0],"")),a=d(a),l=a.match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i),l&&l[2]?(r=d(l[2]),l=d(l[1])):(r=d(n).replace(/caption=['"]/,"").replace(/['"]$/,""),l=a),o=o&&o[1]?o[1].replace(/[<>&]+/g,""):"",i=i&&i[1]?i[1]:"alignnone",s=s&&s[1]?" "+s[1].replace(/[<>&]+/g,""):"",!c&&l&&(c=l.match(/width=['"]([0-9]*)['"]/)),c&&c[1]&&(c=c[1]),c&&r?(c=parseInt(c,10),e.getParam("wpeditimage_html5_captions")||(c+=10),'<div class="mceTemp"><dl id="'+o+'" class="wp-caption '+i+s+'" style="width: '+c+'px"><dt class="wp-caption-dt">'+l+'</dt><dd class="wp-caption-dd">'+r+"</dd></dl></div>"):a})}(t)},e.wpGetImgCaption=function(e){return function(e){return e.replace(/<div (?:id="attachment_|class="mceTemp)[^>]*>([\s\S]+?)<\/div>/g,function(e,t){var n="";return-1===t.indexOf("<img ")?(n=t.match(/<dd [^>]+>([\s\S]+?)<\/dd>/i),n&&n[1]?"<p>"+n[1]+"</p>":""):(n=t.replace(/\s*<dl ([^>]+)>\s*<dt [^>]+>([\s\S]+?)<\/dt>\s*<dd [^>]+>([\s\S]*?)<\/dd>\s*<\/dl>\s*/gi,function(e,t,n,a){var o,i,s;s=n.match(/width="([0-9]*)"/),s=s&&s[1]?s[1]:"",i=t.match(/class="([^"]*)"/),i=i&&i[1]?i[1]:"";var r=i.match(/align[a-z]+/i)||"alignnone";return s&&a?(o=t.match(/id="([^"]*)"/),o=o&&o[1]?o[1]:"",i=i.replace(/wp-caption ?|align[a-z]+ ?/gi,""),i&&(i=' class="'+i+'"'),a=a.replace(/\r\n|\r/g,"\n").replace(/<[a-zA-Z0-9]+( [^<>]+)?>/g,function(e){return e.replace(/[\r\n\t]+/," ")}),a=a.replace(/\s*\n\s*/g,"<br />"),'[caption id="'+o+'" align="'+r+'" width="'+s+'"'+i+"]"+n+" "+a+"[/caption]"):("alignnone"!==r[0]&&(n=n.replace(/><img/,' class="'+r[0]+'"><img')),n)}),-1===n.indexOf("[caption")&&(n=t.replace(/[\s\S]*?((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)(<p>[\s\S]*<\/p>)?[\s\S]*/gi,"<p>$1</p>$2")),n)})}(e)},e.on("BeforeSetContent",function(t){"raw"!==t.format&&(t.content=e.wpSetImgCaption(t.content))}),e.on("PostProcess",function(t){t.get&&(t.content=e.wpGetImgCaption(t.content))}),e.wp=e.wp||{},e.wp.isPlaceholder=s}var En=n("./client/components/tinymce/plugins/wplink/plugin.js"),jn=n("./node_modules/component-closest/index.js"),wn=n.n(jn),_n=n("./client/lib/media/constants.js"),Cn=n("./client/lib/media/actions.js"),Sn=n("./client/lib/media/utils.js"),xn=n("./client/lib/media-serialization/index.js"),kn=n("./client/post-editor/media-modal/markup.js"),In=n("./client/lib/media/store.js"),On=n("./client/components/data/media-library-selected-data/index.jsx"),Tn=n("./client/post-editor/media-modal/index.jsx"),Pn=n("./client/state/analytics/actions.js"),Dn=function(e){return{type:"EDITOR_SAVE_BLOCK",key:e}},Nn=function(e){return{type:"EDITOR_SAVE_UNBLOCK",key:e}},Rn=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.onClose=function(e){e?n.insertMedia(e):n.props.onClose()},n}return M()(t,e),O()(t,[{key:"insertMedia",value:function(e){var t,n,a=e.type,o=e.items,i=e.settings,s=this.props.site,r=Object(v.partial)(kn.a.get,s);switch(a){case"gallery":t="individual"===Object(v.get)(i,"type")?Object(v.map)(i.items,r).join(""):Object(Sn.e)(i),n="insert_gallery";break;case"media":default:t=Object(v.map)(o,r).join(""),n="insert_item"}Object(v.some)(o,"transient")&&this.props.blockSave("MEDIA_MODAL_TRANSIENT_INSERT"),t&&(this.props.onInsertMedia(t),n&&this.props.bumpStat("editor_media_actions",n)),this.props.onClose()}},{key:"render",value:function(){var e=this.props.site;return m.a.createElement(On.a,{siteId:Object(v.get)(e,"ID")},m.a.createElement(Tn.default,_()({},this.props,{onClose:this.onClose})))}}]),t}(p.Component);Rn.propTypes={site:U.a.object,onInsertMedia:U.a.func,onClose:U.a.func},Rn.defaultProps={onInsertMedia:function(){},onClose:function(){}};var Mn=Object(F.b)(function(e){return{site:Object(Z.d)(e)}},{blockSave:Dn,bumpStat:Pn.a})(Rn),An=n("./client/notices/index.js"),Ln=n("./client/lib/analytics/index.js"),Bn=n("./client/my-sites/media-library/drop-zone.jsx"),Un=n("./client/lib/media/library-selected-store.js"),Fn=n("./client/lib/media/validation-store.js"),qn=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={isDragging:!1},n.redirectEditorDragEvent=function(e){window.dispatchEvent(new CustomEvent(e.type,{detail:e})),n.setState({isDragging:!0})},n.fakeDragEnterIfNecessary=function(e){n.state.isDragging||n.redirectEditorDragEvent(Object.assign({},e,{type:"dragenter"}))},n.stopDragging=function(){n.setState({isDragging:!1})},n.insertMedia=function(){var e=n.props,t=e.site,a=e.onInsertMedia,o=e.onRenderModal;if(t){var i=Un.a.getAll(t.ID),s=1===i.length&&"image"===Object(Sn.g)(i[0]);s&&!Fn.a.hasErrors(t.ID)?(i[0].transient&&n.props.blockSave("MEDIA_MODAL_TRANSIENT_INSERT"),a(kn.a.get(t,i[0])),Cn.a.setLibrarySelectedItems(t.ID,[])):o({visible:!0}),Ln.default.mc.bumpStat("editor_upload_via","editor_drop")}},n}return M()(t,e),O()(t,[{key:"componentDidMount",value:function(){var e=this.props.editor;e.dom.bind(e.getWin(),"dragenter",this.redirectEditorDragEvent),window.addEventListener("dragleave",this.stopDragging),e.dom.bind(e.getWin(),"dragleave",this.stopDragging),e.dom.bind(e.getWin(),"dragover",this.fakeDragEnterIfNecessary)}},{key:"componentWillUnmount",value:function(){var e=this.props.editor;window.removeEventListener("dragleave",this.stopDragging),e.getWin()&&(e.dom.unbind(e.getWin(),"dragenter",this.redirectEditorDragEvent),e.dom.unbind(e.getWin(),"dragleave",this.stopDragging),e.dom.unbind(e.getWin(),"dragover",this.fakeDragEnterIfNecessary))}},{key:"render",value:function(){var e=this.props.site;return e?m.a.createElement(Bn.a,{site:e,fullScreen:!1,trackStats:!1,onAddMedia:this.insertMedia}):null}}]),t}(m.a.Component);qn.propTypes={editor:U.a.object,onInsertMedia:U.a.func,onRenderModal:U.a.func},qn.defaultProps={onInsertMedia:v.noop,onRenderModal:v.noop};var zn=Object(F.b)(function(e){return{site:Object(Z.d)(e)}},{blockSave:Dn})(qn),Vn=n("./client/lib/resize-image-url/index.js"),Hn=/(<img[^>]*?\ssrc=")([^"]*?)("[^>]*?\/?>)/gi,Wn=/(<img[^>]*?\ssrc=")([^"]*?)("[^>]*?)(\sdata-wpmedia-src="([^"]*?)")([^>]*?\/?>)/gi,Gn="( -webkit-min-device-pixel-ratio: 1.5 ), ( min--moz-device-pixel-ratio: 1.5 ), ( min-resolution: 1.5dppx )",Kn=680,Yn=function(){if(isFinite(window.devicePixelRatio))return Math.round(Kn*window.devicePixelRatio);if(window.matchMedia&&window.matchMedia(Gn).matches)return Math.round(2*Kn);return Kn}();function $n(e,t,n,a,o,i,s){return""+t+i+a+s}function Jn(e){var t=Object(xn.a)(e);return t.media.transient||!t.media.ID?null:{originalUrl:t.media.URL,resizedUrl:Object(Vn.a)(t.media.URL,Math.min(t.media.width||1/0,Yn))}}function Qn(e,t,n,a){if(-1!==e.indexOf("data-wpmedia-src"))return e;var o=Jn(e);return null===o?e:""+t+o.resizedUrl+'" data-wpmedia-src="'+o.originalUrl+a}function Zn(e){return e.replace(Wn,$n)}var Xn=function(e){e.on("BeforeSetContent BeforeSetWpcomMedia",function(e){var t;e.content&&"html"!==e.mode&&(e.content=(t=e.content,t.replace(Hn,Qn)))}),e.on("BeforeSetWpcomMedia",function(e){var t=Jn(e.content);null!==t&&(e.resizedImageUrl=t.resizedUrl)}),e.on("GetContent",function(e){"raw"===e.format&&e.content&&!e.selection&&(e.content=Zn(e.content))}),e.on("PostProcess",function(e){e.content&&(e.content=Zn(e.content))}),e.on("BeforeAddUndo",function(e){e.level.content&&(e.level.content=Zn(e.level.content))})},ea=n("./client/components/forms/form-fieldset/index.jsx"),ta=n("./client/components/forms/form-label/index.jsx"),na=function(e){function t(){var e;return k()(this,t),e=P()(this,N()(t).apply(this,arguments)),e.save=e.save.bind(we()(we()(e))),e}return M()(t,e),O()(t,[{key:"save",value:function(){var e=this.props.item,t=e.media,n=e.appearance,a=kn.a.get(this.props.selectedSite,Object.assign({},t,{alt:L.a.findDOMNode(this.refs.alt).value}),n);this.props.insertMedia(a)}},{key:"render",value:function(){var e=this.props,t=e.translate,n=e.visible,a=e.item,o=e.onClose,i=[m.a.createElement(J.a,{primary:!0,onClick:this.save},t("Save"))];return m.a.createElement(We.a,{isVisible:n,buttons:i,onClose:o},m.a.createElement("form",{onSubmit:this.save},m.a.createElement(ea.a,null,m.a.createElement(ta.a,null,t("Alt text"),m.a.createElement(Ce.a,{ref:"alt",defaultValue:a.media.alt})))))}}]),t}(p.Component);na.propTypes={translate:U.a.func,visible:U.a.bool,item:U.a.object,onClose:U.a.func,insertMedia:U.a.func},na.defaultProps={onClose:function(){},insertMedia:function(){}};var aa=Object(F.b)(function(e){return{selectedSite:Object(Z.d)(e)}})(Object(h.localize)(na)),oa=function(e){var t,n=e.getParam("redux_store");Qt.a.isEnabled("post-editor/media-advanced")&&n&&(e.addButton("wp_img_advanced",{tooltip:f.a.translate("Edit",{context:"verb"}),classes:"toolbar-segment-start",onPostRender:function(){this.innerHtml(u.a.renderToStaticMarkup(m.a.createElement("button",{type:"button",role:"presentation",tabIndex:"-1"},m.a.createElement(Y.a,{icon:"pencil",size:18}))))},onClick:function(){var t=e.selection.getStart(),n=Object(xn.a)(t);!function(e){a(!0,e)}(n)}}),e.on("remove",i));function a(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1?arguments[1]:void 0;if(t||(t=e.getContainer().appendChild(document.createElement("div"))),!a)return i();Object(hn.b)(m.a.createElement(aa,_()({visible:a,item:r},{onClose:o,insertMedia:s})),t,n)}function o(){a(!1)}function i(){t&&L.a.unmountComponentAtNode(t)}function s(t){e.execCommand("mceInsertContent",!1,t),o()}},ia=n("./client/state/ui/editor/actions.js"),sa=n("./client/state/ui/media-modal/constants.js"),ra=/<img\s[^>]*\/?>/gi,la=["thumbnail","medium","large","full"],ca=null,da=null;function ua(e){var t=e.getParam("redux_store");if(t){var a,o,i=t.dispatch,s=t.getState,r={},l=function(){return Object(Z.d)(s())},c=function(){var e={};return{isLoaded:function(t){return!!e[t]},onLoad:function(t){e[t]=!0,o()}}}();o=Object(v.debounce)(function(){var t,n,a=e.selection.getNode(),o=!1,r=0,d=l();if(d){var u=!e.isHidden();if(u)n=e.dom.select("img");else{if(t=Object(X.i)(s()),!t)return;n=t.match(ra)||[]}n.forEach(function(n){var a=Object(xn.a)(n);if(a.media.ID){var i=In.a.get(d.ID,a.media.ID),s=!1,l=null;if(i&&"deleted"===i.status)return l=e.dom.getParent(n,"div.mceTemp"),e.$(l||n).remove(),void e.nodeChanged();if(i&&i.isDirty){if(!ca||ca.ID!==i.ID){ca=i;var p=e.dom.select("img.wp-image-"+i.ID);da=p.length}a.media.transient=!0,l=e.dom.getParent(n,".mceTemp"),l&&(i.caption=e.dom.$(".wp-caption-dd",l).text(),s=!0)}if(a.media.transient?(r++,o=!0,e.dom.$(n).toggleClass("is-transient",!0)):e.dom.$(n).toggleClass("is-transient",!1),!(!a.media.transient||i&&i.transient)||a.media.transient&&i&&i.isDirty&&i.transient){var m;if(r--,i){if(i.ID===a.media.ID&&i.URL===a.media.URL)return;var h=!1;i.isDirty&&(h=i.width<a.media.width||i.height<a.media.height);var f=Object(v.assign)({},i,a.media,Object(v.pick)(i,"ID","URL",h?"width":"",h?"height":""),{transient:!!i.transient}),g=Object(v.assign)({},a.appearance,{forceResize:!i.transient&&a.media.width&&a.media.width!==i.width});s||delete f.caption,m=kn.a.get(d,f,g),s&&(m=e.wpSetImgCaption(m))}else An.a.error("An error occurred while uploading the file"),m="";var b={content:m,mode:u?"tinymce":"html"};e.fire("BeforeSetWpcomMedia",b);var y=b.resizedImageUrl||i.URL;if(!c.isLoaded(y)){var E=new Image;return E.src=y,E.onload=c.onLoad.bind(null,y),E.onerror=E.onload,void r++}var j="";s&&l.outerHTML?(j=l.outerHTML,l.outerHTML=b.content):n.outerHTML?(j=n.outerHTML,n.outerHTML=b.content):j=n,t&&(t=t.replace(j,b.content)),e.undoManager.data=e.undoManager.data.map(function(e){return e.content=e.content.replace(j,b.content),e}),da>0&&(da-=1)}}}),!r&&Object(X.n)(s(),"MEDIA_MODAL_TRANSIENT_INSERT")&&i(Nn("MEDIA_MODAL_TRANSIENT_INSERT")),o&&!r&&(u||e.fire("SetTextAreaContent",{content:t}),"IMG"===a.nodeName&&E(),e.fire("change")),ca&&ca.isDirty&&0===da&&(Cn.a.edit(d.ID,Fe()({},ca,{isDirty:!1})),da=null)}}),e.addCommand("wpcomAddMedia",function(){w(),b({visible:!0})}),e.addCommand("googleAddMedia",function(){w(),b({visible:!0,source:"google_photos"})}),e.addCommand("pexelsAddMedia",function(){w(),b({visible:!0,source:"pexels"})}),e.addButton("wpcom_add_media",{classes:"btn wpcom-icon-button media",cmd:"wpcomAddMedia",title:f.a.translate("Add Media"),onPostRender:function(){this.innerHtml(u.a.renderToStaticMarkup(m.a.createElement("button",{type:"button",role:"presentation",tabIndex:"-1"},m.a.createElement(Y.a,{icon:"image-multiple",size:20}))))}}),e.addButton("wp_img_edit",{tooltip:f.a.translate("Edit",{context:"verb"}),classes:"toolbar-segment-start",icon:"dashicon dashicons-edit",onclick:function(){var t=l();if(t){var n=t.ID,a=e.selection.getNode(),o=a.className.match(/wp-image-(\d+)/),i=o&&parseInt(o[1],10);if(i){var s=In.a.get(n,i);Cn.a.clearValidationErrors(n),b({visible:!0,labels:{confirm:f.a.translate("Update",{context:"verb"})}},{view:sa.a.DETAIL}),Cn.a.setLibrarySelectedItems(n,[s])}}}}),e.addButton("wp_img_caption",{tooltip:f.a.translate("Caption",{context:"verb"}),icon:"dashicon dashicons-admin-comments",classes:"toolbar-segment-start toolbar-segment-end",stateSelector:".wp-caption",onclick:function(){var t,n=e.selection.getStart(),a=Object(xn.a)(n),o=l();if(a&&o){var i=wn()(n,".wp-caption");if(i)return e.dom.replace(n,i.parentNode),e.selection.getStart()!==n&&e.selection.select(n),e.selection.controlSelection.showResizeRect(n),void e.nodeChanged();var s=In.a.get(o.ID,a.media.ID);t=s&&s.caption?s.caption:f.a.translate("Enter a caption"),["width","height"].forEach(function(e){null===n.getAttribute(e)&&a.media[e]&&n.setAttribute(e,a.media[e])});var r={width:a.media.width};a.media.ID&&(r.id="attachment_"+a.media.ID),a.appearance.align&&(r.align="align"+a.appearance.align);var c=Object(tt.c)({tag:"caption",attrs:r,content:[n.outerHTML,t].join(" ")});e.selection.setContent(c),e.selection.select(e.selection.getStart().querySelector(".wp-caption-dd"),!0),e.selection.controlSelection.hideResizeRect(),this.rootControl.hide()}}});var d,p=function(e,t){var n=Fe()({},t,e),a=n.width,o=n.height;return Math.min(a/t.width||1/0,o/t.height||1/0)};if(e.addButton("wpcom_img_size_decrease",{tooltip:f.a.translate("Decrease size"),classes:"toolbar-segment-start img-size-decrease",icon:"dashicon dashicons-minus",onPostRender:function(){e.on("wptoolbar",S.bind(this,!1))},onclick:function(){C(-1)}}),e.addButton("wpcom_img_size_increase",{tooltip:f.a.translate("Increase size"),classes:"toolbar-segment-end img-size-increase",icon:"dashicon dashicons-plus",onPostRender:function(){e.on("wptoolbar",S.bind(this,!0))},onclick:function(){C(1)}}),e.addCommand("WP_Medialib",function(){b({visible:!0})}),e.addCommand("wpcomEditGallery",function(e){var t=l();if(t){var n=Object(tt.b)(e);"gallery"===n.tag&&(n=Object(v.assign)({},_n.b,n.attrs.named),n.items=n.ids.split(",").map(function(e){e=parseInt(e,10);var n=In.a.get(t.ID,e);return n||Cn.a.fetch(t.ID,e),Object(v.assign)({ID:e},n)}),delete n.ids,n.columns&&(n.columns=parseInt(n.columns,10)),n.orderby&&(n.orderBy=n.orderby,delete n.orderby),Cn.a.setLibrarySelectedItems(t.ID,n.items),b({visible:!0,initialGallerySettings:n,labels:{confirm:f.a.translate("Update",{context:"verb"})}},{preserveFocus:!0,view:sa.a.GALLERY}))}}),a=Object(v.debounce)(function(){e.execCommand("wpcomAutoResize",null,null,{skip_focus:!0})},400,{leading:!0}),e.on("click",function(t){if(t.detail&&!(t.detail<2)){var n=wn()(t.target,".wp-caption-dd");n&&e.selection.select(n)}}),e.on("keydown",function(t){if(8===t.keyCode||46===t.keyCode){var n=e.selection.getStart(!0);if(e.dom.hasClass(n,"wp-caption-dd")){var a=e.selection.getRng();(8===t.keyCode&&0===a.startOffset||46===t.keyCode&&n.textContent.length===a.endOffset)&&t.preventDefault()}}}),Qt.a.isEnabled("desktop")){var h=n("electron").ipcRenderer;e.on("contextmenu",function(){h.send("mce-contextmenu",{sender:!0})})}e.on("touchstart touchmove touchend",(d=!1,function(t){switch(t.type){case"touchstart":d=!1;break;case"touchmove":d=!0;break;case"touchend":d||"IMG"!==t.target.nodeName||(e.selection.select(t.target),t.preventDefault())}})),e.on("init",function(){In.a.on("change",o),e.getDoc().addEventListener("load",x,!0),e.dom.bind(e.getDoc(),"dragstart dragend",j),e.selection.selectorChanged(".wp-caption",k)}),e.on("init show hide",function(){y({visible:!e.isHidden()})}),e.on("SetContent",function(e){var t=l();t&&(e.content.match(ra)||[]).forEach(function(e){var n=Object(xn.a)(e);n.media.ID&&!In.a.get(t.ID,n.media.ID)&&setTimeout(function(){Cn.a.fetch(t.ID,n.media.ID)},0)})}),e.on("remove",function(){Object(v.values)(r).forEach(function(e){L.a.unmountComponentAtNode(e),e.parentNode.removeChild(e)}),r={},In.a.off("change",o),e.getDoc().removeEventListener("load",x)}),Xn(e),oa(e)}function g(t){e.execCommand("mceInsertContent",!1,t)}function b(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=l();if(o){if(y({visible:!n.visible}),r.modal||(r.modal=e.getContainer().appendChild(document.createElement("div"))),n.visible&&!a.preserveFocus&&e.focus(!1),n.visible){var i=a.view,s=void 0===i?sa.a.LIST:i;t.dispatch(Object(ia.l)(s))}Object(hn.b)(m.a.createElement(Mn,_()({},n,{onClose:b.bind(null,{visible:!1}),onInsertMedia:function(e){g(e),b({visible:!1})}})),r.modal,t)}}function y(n){var a=n.visible;a?(r.dropzone||(r.dropzone=document.createElement("div"),e.getContainer().parentNode.insertBefore(r.dropzone,e.getContainer())),Object(hn.b)(m.a.createElement(zn,{editor:e,onInsertMedia:g,onRenderModal:b}),r.dropzone,t)):r.dropzone&&L.a.unmountComponentAtNode(r.dropzone)}function E(){var t=e.selection.getStart();"IMG"!==t.nodeName&&(t=t.querySelector("img")),t&&(e.selection.select(t),e.selection.controlSelection.showResizeRect(t))}function j(e){y({visible:"dragend"===e.type})}function w(){var e=l();e&&Cn.a.clearValidationErrors(e.ID)}function C(t){var n=e.selection.getStart(),a=Object(xn.a)(n),o=l();if(a&&o){var i=e.dom.getParent(n,".mceTemp");i&&(e.selection.select(i),a.media.caption=e.dom.$(".wp-caption-dd",i).text());var s=Object(v.assign)({},In.a.get(o.ID,a.media.ID));delete s.caption,s=Object(v.assign)({},a.media,s);var r=la.map(function(e){return p(Object(Sn.i)(e,o),s)}),c=la.indexOf(a.appearance.size),d=-1!==c?r[c]:p(a.media,s),u=t>0?v.find:v.findLast,m=u(la,function(e,n){return!(r[n]>1)&&(t>0?r[n]>d:r[n]<d)})||la[la.length-1],h=kn.a.get(o,s,Object(v.assign)(a.appearance,{size:m}));e.selection.setContent(h),E(),e.nodeChanged()}}function S(e,t){var n=l();if(t.element&&"IMG"===t.element.nodeName&&n){var a=Object(xn.a)(t.element),o=Object(v.assign)({width:1/0,height:1/0},In.a.get(n.ID,a.media.ID)),i=p(a.media,o),s=!!a.media.transient;if(this.classes.toggle("hidden",s),e){var r=i>=1;this.disabled(r)}else{var c=p(Object(Sn.i)(la[0],n),o),d=i<=c||la[0]===a.appearance.size;this.disabled(d)}}}function x(e){"IMG"===e.target.nodeName&&a()}function k(t){t||e.dom.select(".wp-caption-dd").forEach(function(t){if(!t.textContent.trim().length){var n=wn()(t.parentNode,".wp-caption"),a=n.querySelector("img");e.dom.replace(a,n.parentNode)}})}}var pa=n("./client/state/preferences/actions.js"),ma=n("./client/state/preferences/selectors.js");function ha(e){var t=e.getParam("redux_store");if(t){var n,a=t.dispatch,o=t.getState,i=t.subscribe,s=r();e.addButton("wpcom_advanced",{text:Object(h.translate)("Toggle Advanced"),tooltip:Object(h.translate)("Toggle Advanced"),classes:"btn wpcom-icon-button advanced",cmd:"WPCOM_ToggleAdvancedVisible",onPostRender:function(){n=this,this.innerHtml(u.a.renderToStaticMarkup(m.a.createElement("button",{type:"button",role:"presentation",tabIndex:"-1"},m.a.createElement(Y.a,{icon:"ellipsis",size:28}))))}}),e.addCommand("WPCOM_ToggleAdvancedVisible",function(){a(Object(pa.b)("editorAdvancedVisible",!s))}),e.on("init",function(){Object(ma.d)(o())||a(Object(pa.a)())}),e.on("preInit",function(){e.shortcuts.add("access+z","","WPCOM_ToggleAdvancedVisible")}),e.on("init show",l),window.addEventListener("resize",l),i(function(){var e=r();e!==s&&(s=e,l())})}function r(){return Object(ma.b)(o(),"editorAdvancedVisible")}function l(){var t=e.theme.panel.find(".toolbar:not(.menubar)"),a=Object(De.d)("<960px"),o=0;t.each(function(e,t){var n=a||0===t||s;e.visible(n),n&&(a?o=Math.max(o,e.getEl().clientHeight):o+=e.getEl().clientHeight)}),H.a.DOM.setStyles(e.getContainer(),{"padding-top":o}),n&&n.active(s)}}function fa(e){var t=e&&e.settings;if(t&&"tabindex"in t){var n=Math.min(32767,Number(t.tabindex));Number.isInteger(n)&&e.on("init",function(e){return function(){var t=document.getElementById(this.id+"_ifr");t&&t.setAttribute("tabIndex",e)}}(n))}}var ga=n("./node_modules/debug/src/browser.js"),ba=n.n(ga),va=n("./client/components/tinymce/plugins/wpcom-track-paste/sources.js"),ya=ba()("calypso:tinymce-plugins:wpcom-track-paste");function Ea(e){ya("init");var t=e.getParam("redux_store"),n=function(e){return"application/x-vnd.google-docs-image-clip+wrapped"===e||"application/x-vnd.google-docs-document-slice-clip+wrapped"===e},a=function(e,a){ya("track paste event");var o=Array.from(a),i=function(e){return e.some(n)?va.a:va.b}(o);t.dispatch(Object(Pn.k)(Object(Pn.i)("calypso_editor_content_paste",{mode:e,types:o.join(", "),source:i}),Object(ia.j)(i)))},o=function(e){return e.clipboardData&&a("visual-editor",e.clipboardData.types)},i=function(e){return e.clipboardData&&a("html-editor",e.clipboardData.types)};e.on("paste",o);var s=e.getParam("textarea");s&&s.addEventListener("paste",i),e.on("remove",function(){e.off("paste",o),s.removeEventListener("paste",i)})}function ja(e){e.on("init",function(){e.$(".mce-toolbar:not(.mce-menubar)",document.body).each(function(e,t){t.addEventListener("touchstart",function(e){e.stopImmediatePropagation()})}),e.$([e.$(".mce-inline-toolbar-grp .mce-container-body",document.body),e.$(".mce-toolbar-grp",e.theme.panel.getEl())]).each(function(t,n){n.on("scroll",Object(v.throttle)(function(t){var n,a=t.target;if(a.scrollLeft===a.scrollWidth-a.clientWidth?n="add":H.a.DOM.hasClass(a,"is-scrolled-full")&&(n="remove"),n){var o=e.$(a);o.hasClass("mce-container-body")||o.add(H.a.DOM.getParent(a,".mce-container-body")),o[n+"Class"]("is-scrolled-full")}},200))}),function(){function t(){e.$(".mce-toolbar-grp",e.theme.panel.getEl()).each(function(t,n){var a=n.scrollWidth>n.clientWidth;e.$(n).toggleClass("is-scrollable",a)})}window.addEventListener("resize",Object(v.throttle)(t,200)),t(),e.on("wptoolbar",function(t){setTimeout(function(){if(t.toolbar&&t.toolbar.visible()){var n=t.toolbar.getEl(),a=n.firstChild.scrollWidth>n.clientWidth;e.dom.toggleClass(n,"is-scrollable",a)}},0)})}()})}var wa=n("./client/state/current-user/selectors.js"),_a=ba()("calypso:posts:stats"),Ca=Math.random()<=.01||!1;function Sa(e){Ca&&Ln.default.mc.bumpStat("editor-button","calypso_"+e),Ln.default.ga.recordEvent("Editor","Clicked TinyMCE Button",e),_a("TinyMCE button click",e,"mc=",Ca)}function xa(e){function t(t,n){return wn()(t.target,n,e.container)}function n(n){if(t(n,".mce-colorbutton")&&!t(n,".mce-open"))Sa("forecolor_pick_current");else if(t(n,".mce-listbox"))Sa("format_dropdown");else if(wn()(n.target,".mce-menu-item")){var a=e.getParam("redux_store"),o=a?Object(wa.h)(a.getState()):"en";if("en"===o){var i=wn()(n.target,".mce-menu-item").textContent,s=i.toLowerCase().trim().replace(/[^a-z0-9]+/g,"_");Sa("format_dropdown_"+s)}else Sa("format_dropdown_non_english")}}Object.keys(e.buttons).forEach(function(n){var a=e.buttons[n],o=a.onPostRender;a.onPostRender=function(){this.on("click",function(e){var a=n.replace(/^(wp|wpcom)_/,"");"forecolor"===n&&(a=t(e,".mce-open")?"forecolor_toggle":t(e,".mce-custom-color-btn")?"forecolor_pick_custom":t(e,".mce-colorbtn-trans")?"forecolor_remove":"forecolor_pick_color"),Sa(a)}),"function"==typeof o&&o.apply(this,Array.prototype.slice.call(arguments))}}),e.on("init",function(){e.dom.bind(document.body,"click",n)}),e.on("remove",function(){e.dom.unbind(document.body,"click",n)})}var ka=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.splitMessage=function(){var e=n.props.message.split("\n\n");return e.map(function(e,t){return m.a.createElement("p",{key:"alert-"+t},e)})},n.getButtons=function(){return[m.a.createElement(Ge.a,{isPrimary:!1,"aria-label":n.props.translate("Dismiss alert message"),onClick:n.props.onClose},n.props.translate("OK"))]},n}return M()(t,e),O()(t,[{key:"render",value:function(){return m.a.createElement(We.a,{isVisible:this.props.isVisible,additionalClassNames:"editor-alert-modal",onClose:this.props.onClose,buttons:this.getButtons()},this.splitMessage())}}]),t}(m.a.Component);ka.displayName="Alert",ka.propTypes={isVisible:U.a.bool.isRequired,onClose:U.a.func.isRequired,message:U.a.string.isRequired};var Ia=Object(h.localize)(ka);function Oa(e){var t;e.on("init",function(){t=document.createElement("div"),t.setAttribute("class","alert-container"),e.getContainer().appendChild(t),e.windowManager.alert=function(n,a,o){function i(){s("hide"),"function"==typeof a?a.call(o||e.windowManager):e.focus()}function s(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";L.a.render(m.a.createElement(Ia,{isVisible:"show"===a,onClose:i,message:e.editorManager.i18n.translate(n)}),t)}s("show")},e.notificationManager.open=function(t){e.windowManager.alert(t.text)}}),e.on("remove",function(){L.a.unmountComponentAtNode(t),t.parentNode.removeChild(t),t=null})}var Ta=n("./client/components/section-header/index.jsx"),Pa=n("./client/components/card/index.jsx"),Da=n("./client/components/forms/form-input-validation/index.jsx"),Na=n("./client/components/forms/form-setting-explanation/index.jsx"),Ra=n("./node_modules/email-validator/index.js"),Ma=n.n(Ra);function Aa(e){var t=e?e.split(",").map(function(e){return e.trim()}):[];return Object(v.every)(t,Ma.a.validate)}var La=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.onToChange=function(e){n.props.onUpdate({to:e.target.value})},n.onSubjectChange=function(e){n.props.onUpdate({subject:e.target.value})},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=!Aa(this.props.to);return m.a.createElement("div",{className:"editor-contact-form-modal-settings"},m.a.createElement(Ta.a,{label:this.props.translate("Contact Form Notification Settings")}),m.a.createElement(Pa.a,null,m.a.createElement("p",null,"post"===this.props.postType?this.props.translate("If you donâ€™t make any changes here, feedback will be sent to the author of the post and the subject will be the name of this post."):this.props.translate("If you donâ€™t make any changes here, feedback will be sent to the author of the page and the subject will be the name of this page.")),m.a.createElement(ea.a,null,m.a.createElement(ta.a,null,this.props.translate("Enter your email address")),m.a.createElement(Ce.a,{value:this.props.to,placeholder:this.props.email,isError:e,onChange:this.onToChange}),e&&m.a.createElement(Da.a,{isError:!0,text:this.props.translate("%(email)s is not a valid email address.",{args:{email:this.props.to}})}),m.a.createElement(Na.a,null,this.props.translate("You can enter multiple email addresses in the Email address field, and separate them with commas. A notification email will then be sent to each email address."))),m.a.createElement(ea.a,null,m.a.createElement(ta.a,null,this.props.translate("What should the subject line be?")),m.a.createElement(Ce.a,{value:this.props.subject,placeholder:this.props.title,onChange:this.onSubjectChange}))))}}]),t}(m.a.Component);La.displayName="ContactFormDialogFormSettings",La.propTypes={to:U.a.string,subject:U.a.string,email:U.a.string,title:U.a.string,onUpdate:U.a.func.isRequired};var Ba=Object(h.localize)(La),Ua=n("./client/components/section-nav/index.jsx"),Fa=n("./client/components/section-nav/tabs.jsx"),qa=n("./client/components/section-nav/item.jsx"),za=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this;return m.a.createElement(Ua.a,{selectedText:"Form Fields"},m.a.createElement(Fa.a,null,["fields","settings"].map(function(t){return m.a.createElement(qa.a,{key:"contact-form-"+t,selected:e.props.activeTab===t,count:"fields"===t?e.props.fieldCount:null,onClick:function(){return e.props.onChangeTabs(t)}},"fields"===t?e.props.translate("Form Fields"):e.props.translate("Settings"))})))}}]),t}(m.a.Component);za.displayName="ContactFormDialogNavigation",za.propTypes={fieldCount:U.a.number.isRequired,activeTab:U.a.oneOf(["fields","settings"]).isRequired,onChangeTabs:U.a.func.isRequired};var Va=Object(h.localize)(za),Ha=n("./client/components/empty-content/index.jsx"),Wa={name:function(){return f.a.translate("Name")},email:function(){return f.a.translate("Email Address")},checkbox:function(){return f.a.translate("Checkbox")},select:function(){return f.a.translate("Dropdown")},radio:function(){return f.a.translate("Radio Button")},text:function(){return f.a.translate("Text")},textarea:function(){return f.a.translate("Text Area")},url:function(){return f.a.translate("Web Address")}},Ga=function(e){return Wa.hasOwnProperty(e)?Wa[e].call():null},Ka=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.getLegend=function(){if(n.props.options){var e=n.props.options.split(",").length;return n.props.required?n.props.translate('Required field "%(fieldName)s" with %(numOption)d option','Required field "%(fieldName)s" with %(numOption)d options',{count:e,args:{fieldName:Ga(n.props.type),numOption:e},comment:"Explains to the user the field settings. If required, type, and how many options it has."}):n.props.translate('Optional field "%(fieldName)s" with %(numOption)d option','Optional field "%(fieldName)s" with %(numOption)d options',{count:e,args:{fieldName:Ga(n.props.type),numOption:e},comment:"Explains to the user the field settings. If required, type, and how many options it has."})}return n.props.required?n.props.translate('Required field "%(fieldName)s"',{args:{fieldName:Ga(n.props.type)},comment:"Explain to the user the field settings for fields other than dropdown and select list."}):n.props.translate('Optional field "%(fieldName)s"',{args:{fieldName:Ga(n.props.type)},comment:"Explain to the user the field settings for fields other than dropdown and select list."})},n}return M()(t,e),O()(t,[{key:"render",value:function(){return m.a.createElement("div",{className:"editor-contact-form-modal-field-header"},m.a.createElement("div",null,this.props.label),m.a.createElement("div",null,m.a.createElement("small",null,this.getLegend())))}}]),t}(m.a.Component);Ka.displayName="ContactFormDialogFieldHeader",Ka.propTypes={label:U.a.string.isRequired,type:U.a.string.isRequired,options:U.a.string,required:U.a.bool};var Ya=Object(h.localize)(Ka),$a=n("./client/components/foldable-card/index.jsx"),Ja=n("./client/components/forms/form-checkbox/index.jsx"),Qa=n("./client/components/select-dropdown/index.jsx"),Za=n("./client/components/select-dropdown/item.jsx"),Xa=n("./client/components/token-field/index.jsx"),eo=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={showTooltip:!1},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this;return m.a.createElement("div",null,m.a.createElement(J.a,{ref:"removeField",borderless:!0,onMouseEnter:function(){return e.setState({showTooltip:!0})},onMouseLeave:function(){return e.setState({showTooltip:!1})},onClick:this.props.onRemove},m.a.createElement(Y.a,{icon:"trash",className:"editor-contact-form-modal-field__remove"})),m.a.createElement(ke.a,{isVisible:this.state.showTooltip,context:this.refs&&this.refs.removeField,onClose:function(){},position:"bottom",className:"popover tooltip is-dialog-visible"},this.props.translate("Remove Field",{context:"button tooltip"})))}}]),t}(m.a.PureComponent);eo.displayName="ContactFormDialogFieldRemoveButton",eo.propTypes={onRemove:U.a.func.isRequired};var to=Object(h.localize)(eo),no=function(e){function t(){var e;return k()(this,t),e=P()(this,N()(t).apply(this,arguments)),e.state={showTooltip:!1},e.handleMouseEnter=e.handleMouseEnter.bind(we()(we()(e))),e.handleMouseLeave=e.handleMouseLeave.bind(we()(we()(e))),e}return M()(t,e),O()(t,[{key:"handleMouseEnter",value:function(){this.setState({showTooltip:!0})}},{key:"handleMouseLeave",value:function(){this.setState({showTooltip:!1})}},{key:"render",value:function(){var e=this.props,t=e.expanded,n=e.translate,a=z()("editor-contact-form-modal-field__edit",{"is-expanded":t});return m.a.createElement("div",{className:"editor-contact-form-modal-field__edit-wrapper foldable-card__expand"},m.a.createElement(J.a,{className:"editor-contact-form-modal-field__edit-wrapper-button",ref:"editField",borderless:!0,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},m.a.createElement(Y.a,{icon:"pencil",className:a})),m.a.createElement(ke.a,{isVisible:this.state.showTooltip,context:this.refs&&this.refs.editField,onClose:v.noop,position:"bottom",className:"popover tooltip is-dialog-visible"},n("Edit Field",{context:"button tooltip"})))}}]),t}(p.PureComponent);no.propTypes={expanded:U.a.bool.isRequired};var ao=Object(h.localize)(no),oo=["checkbox","select","email","name","radio","text","textarea","url"],io=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.renderOptions=function(){if("radio"===n.props.type||"select"===n.props.type){var e=n.props.options;e=e?e.split(","):[];var t=!e||0===e.length;return m.a.createElement(ea.a,null,m.a.createElement(ta.a,null,n.props.translate("Options")),m.a.createElement(Xa.a,{value:e,onChange:function(e){return n.props.onUpdate({options:e.join()})}}),t&&m.a.createElement(Da.a,{isError:!0,text:n.props.translate("Options can not be empty.")}),m.a.createElement(Na.a,null,"Insert an option and press enter."))}},n.onLabelChange=function(e){n.props.onUpdate({label:e.target.value})},n.handleCardOpen=function(){n.props.onUpdate({isExpanded:!0})},n.handleCardClose=function(){n.props.onUpdate({isExpanded:!1})},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this,t=!this.props.label,n=m.a.createElement(to,{onRemove:this.props.onRemove});return m.a.createElement($a.a,{header:m.a.createElement(Ya,Object(v.omit)(this.props,["onUpdate"])),summary:n,expandedSummary:n,expanded:this.props.isExpanded,onClose:this.handleCardClose,onOpen:this.handleCardOpen,actionButton:m.a.createElement(ao,{expanded:!1}),actionButtonExpanded:m.a.createElement(ao,{expanded:!0})},m.a.createElement(ea.a,null,m.a.createElement(ta.a,null,this.props.translate("Field Label")),m.a.createElement(Ce.a,{value:this.props.label,onChange:this.onLabelChange,isError:t}),t&&m.a.createElement(Da.a,{isError:!0,text:this.props.translate("Field Label can not be empty.")})),m.a.createElement(ea.a,null,m.a.createElement(ta.a,null,this.props.translate("Field Type")),m.a.createElement(Qa.a,{selectedText:Ga(this.props.type)},oo.map(function(t){return m.a.createElement(Za.a,{key:"field-type-"+t,selected:e.props.type===t,onClick:function(){return e.props.onUpdate({type:t})}},Ga(t))}))),m.a.createElement(ea.a,null,m.a.createElement(ta.a,null,m.a.createElement(Ja.a,{checked:this.props.required,onChange:function(){return e.props.onUpdate({required:!e.props.required})}}),m.a.createElement("span",null,this.props.translate("Required")))),this.renderOptions())}}]),t}(m.a.PureComponent);io.displayName="ContactFormDialogField",io.propTypes={label:U.a.string.isRequired,type:U.a.string.isRequired,options:U.a.string,required:U.a.bool,onUpdate:U.a.func.isRequired,onRemove:U.a.func.isRequired,isExpanded:U.a.bool};var so=Object(h.localize)(io),ro=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this;return this.props.fields.length>0?m.a.createElement("div",{className:"editor-contact-form-modal-fields"},this.props.fields.map(function(t,n){return m.a.createElement(so,_()({key:n},t,{onRemove:function(){return e.props.onFieldRemove(n)},onUpdate:function(t){return e.props.onFieldUpdate(n,t)}}))})):m.a.createElement(Ha.a,{title:null,line:this.props.translate("An empty form is no fun! Go ahead and add some fields!"),action:this.props.translate("Add New Field"),actionCallback:this.props.onFieldAdd,isCompact:!0})}}]),t}(m.a.Component);ro.displayName="ContactFormDialogFieldList",ro.propTypes={fields:U.a.array.isRequired,onFieldAdd:U.a.func.isRequired,onFieldRemove:U.a.func.isRequired,onFieldUpdate:U.a.func.isRequired};var lo=Object(h.localize)(ro),co=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.getActionButtons=function(){var e,t=(e=n.props.contactForm.fields,!(!Array.isArray(e)||0===e.length)&&Object(v.every)(e,function(e){return"radio"!==e.type&&"select"!==e.type?!!e.label:!!e.label&&!!e.options})&&Aa(n.props.contactForm.to)),a=[m.a.createElement(Ge.a,{key:"save","data-e2e-button":"save",disabled:!t,onClick:n.props.onInsert},n.props.isEdit?n.props.translate("Update"):n.props.translate("Insert")),m.a.createElement(Ge.a,{key:"cancel",isPrimary:!1,"data-e2e-button":"cancel",onClick:n.props.onClose},n.props.translate("Cancel"))];return"fields"===n.props.activeTab?[m.a.createElement("div",{key:"secondaryActions",className:"editor-contact-form-modal__secondary-actions"},m.a.createElement(Ge.a,{key:"add",isPrimary:!1,"data-e2e-button":"add",onClick:n.props.onFieldAdd},n.props.translate("Add New Field")))].concat(a):a},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.activeTab,n=e.currentUser.email,a=e.post,o=e.contactForm,i=o.to,s=o.subject,r=o.fields,l=e.showDialog,c=e.onChangeTabs,d=e.onClose,u=e.onFieldAdd,p=e.onFieldUpdate,h=e.onFieldRemove,f=e.onSettingsUpdate,g=Object(v.get)(a,"title",null),b=Object(v.get)(a,"type",null),y="fields"===t?m.a.createElement(lo,{fields:r,onFieldAdd:u,onFieldRemove:h,onFieldUpdate:p}):m.a.createElement(Ba,{to:i,subject:s,email:n,title:g,postType:b,onUpdate:f});return m.a.createElement(We.a,{isVisible:l,onClose:d,buttons:this.getActionButtons(),additionalClassNames:"editor-contact-form-modal"},m.a.createElement(Va,{activeTab:t,onChangeTabs:c,fieldCount:r.length}),y)}}]),t}(m.a.Component);co.displayName="ContactFormDialog",co.propTypes={activeTab:U.a.oneOf(["fields","settings"]).isRequired,showDialog:U.a.bool.isRequired,isEdit:U.a.bool.isRequired,contactForm:U.a.shape({to:U.a.string,subject:U.a.string,fields:U.a.array.isRequired}).isRequired,onInsert:U.a.func.isRequired,onChangeTabs:U.a.func.isRequired,onClose:U.a.func.isRequired,onFieldAdd:U.a.func.isRequired,onFieldRemove:U.a.func.isRequired,onFieldUpdate:U.a.func.isRequired,onSettingsUpdate:U.a.func.isRequired};var uo=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e);return{post:Object(ee.a)(e,t,n),currentUser:Object(wa.b)(e),contactForm:e.ui.editor.contactForm}})(Object(h.localize)(co));function po(){return{type:"EDITOR_CONTACT_FORM_FIELD_ADD"}}function mo(e){return{type:"EDITOR_CONTACT_FORM_FIELD_REMOVE",index:e}}function ho(e,t){return{type:"EDITOR_CONTACT_FORM_FIELD_UPDATE",index:e,field:t}}function fo(e){return{type:"EDITOR_CONTACT_FORM_SETTINGS_UPDATE",settings:e}}var go=function(e){var t,n=e.getParam("redux_store");e.on("init",function(){t=e.getContainer().appendChild(document.createElement("div"))}),e.on("remove",function(){Object(A.unmountComponentAtNode)(t),t.parentNode.removeChild(t),t=null}),e.addCommand("wpcomContactForm",function(a){var o,i=!1;a?(n.dispatch((o=It(a),{type:"EDITOR_CONTACT_FORM_LOAD",contactForm:o})),i=!0):n.dispatch({type:"EDITOR_CONTACT_FORM_CLEAR"}),function a(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fields";Object(hn.b)(Object(p.createElement)(uo,{showDialog:"show"===o,activeTab:s,isEdit:i,onInsert:function(){var t=n.getState();e.execCommand("mceInsertContent",!1,kt(t.ui.editor.contactForm)),a("hide")},onChangeTabs:function(e){a("show",e)},onClose:function(){n.dispatch({type:"EDITOR_CONTACT_FORM_CLEAR"}),e.focus(),a("hide")},onFieldAdd:function(){n.dispatch({type:"EDITOR_CONTACT_FORM_FIELD_ADD"})},onFieldRemove:function(e){n.dispatch(mo(e))},onFieldUpdate:function(e,t){n.dispatch(ho(e,t))},onSettingsUpdate:function(e){n.dispatch(fo(e))}}),t,n)}()}),e.addButton("wpcom_add_contact_form",{classes:"btn wpcom-icon-button contact-form",title:f.a.translate("Add Contact Form"),cmd:"wpcomContactForm",onPostRender:function(){this.innerHtml(Object(d.renderToStaticMarkup)(m.a.createElement("button",{type:"button",role:"presentation"},m.a.createElement(Y.a,{icon:"mention"}))))}})},bo=n("./client/components/tinymce/plugins/simple-payments/dialog/index.jsx"),vo=function(e){var t,n=e.getParam("redux_store");e.on("init",function(){t=e.getContainer().appendChild(document.createElement("div"))}),e.on("remove",function(){Object(A.unmountComponentAtNode)(t),t.parentNode.removeChild(t),t=null}),e.addCommand("simplePaymentsButton",function(a){var o=null;if(a){var i=Xt(a);o=i.id||null}!function a(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";Object(hn.b)(Object(p.createElement)(bo.a,{showDialog:"show"===i,editPaymentId:o,onInsert:function(t){e.execCommand("mceInsertContent",!1,Zt(t)),a("hide")},onClose:function(){e.focus(),a("hide")}}),t,n)}()})};function yo(){this.ignore_types=["Bias Language","Cliches","Complex Expression","Diacritical Marks","Double Negatives","Hidden Verbs","Jargon Language","Passive voice","Phrases to Avoid","Redundant Expression"],this.ignore_strings={},this.i18n={}}function Eo(e){this.tokens=e,this.index=0,this.count=0,this.last=0}yo.prototype.setIgnoreStrings=function(e){var t=this;"string"==typeof e&&(e=e.split(/,\s*/g)),this.map(e,function(e){t.ignore_strings[e]=1})},yo.prototype.showTypes=function(e){var t=e.split(/,\s*/g),n={},a=[];n["Double Negatives"]=1,n["Hidden Verbs"]=1,n["Passive voice"]=1,n["Bias Language"]=1,n.Cliches=1,n["Complex Expression"]=1,n["Diacritical Marks"]=1,n["Jargon Language"]=1,n["Phrases to Avoid"]=1,n["Redundant Expression"]=1,this.map(t,function(e){n[e]=void 0}),this.map(this.ignore_types,function(e){void 0!==n[e]&&a.push(e)}),this.ignore_types=a},yo.prototype.makeError=function(e,t,n,a){var o={};return o.type=n,o.string=e,o.tokens=t,new RegExp("\\b"+e+"\\b").test(e)?o.regexp=new RegExp("(?!"+e+"<)\\b"+e.replace(/\s+/g,a)+"\\b"):new RegExp(e+"\\b").test(e)?o.regexp=new RegExp("(?!"+e+"<)"+e.replace(/\s+/g,a)+"\\b"):new RegExp("\\b"+e).test(e)?o.regexp=new RegExp("(?!"+e+"<)\\b"+e.replace(/\s+/g,a)):o.regexp=new RegExp("(?!"+e+"<)"+e.replace(/\s+/g,a)),o.used=!1,o},yo.prototype.addToErrorStructure=function(e,t,n,a){var o=this;this.map(t,function(t){var i=t.word.split(/\s+/),s=t.pre,r=i[0];void 0===e["__"+r]&&(e["__"+r]={},e["__"+r].pretoks={},e["__"+r].defaults=[]),""===s?e["__"+r].defaults.push(o.makeError(t.word,i,n,a,s)):(void 0===e["__"+r].pretoks["__"+s]&&(e["__"+r].pretoks["__"+s]=[]),e["__"+r].pretoks["__"+s].push(o.makeError(t.word,i,n,a,s)))})},yo.prototype.buildErrorStructure=function(e,t,n){var a=this._getSeparators(),o={};return this.addToErrorStructure(o,e,"hiddenSpellError",a),this.addToErrorStructure(o,n,"hiddenGrammarError",a),this.addToErrorStructure(o,t,"hiddenSuggestion",a),o},yo.prototype._getSeparators=function(){var e,t="",n='"s!#$%&()*+,./:;<=>?@[\\]^_{|}';for(e=0;e<n.length;e++)t+="\\"+n.charAt(e);return"(?:(?:[Â "+t+"])|(?:\\-\\-))+"},yo.prototype.processXML=function(e){var t,n,a,o,i,s,r,l,c,d,u,p,m,f,g,b;for(t={},this.map(this.ignore_types,function(e){t[e]=1}),this.suggestions=[],n=e.getElementsByTagName("error"),a=[],o=[],i=[],s=0;s<n.length;s++)if(null!==n[s].getElementsByTagName("string").item(0).firstChild&&(r=n[s].getElementsByTagName("string").item(0).firstChild.data,l=n[s].getElementsByTagName("type").item(0).firstChild.data,c=n[s].getElementsByTagName("description").item(0).firstChild.data,d=null!==n[s].getElementsByTagName("precontext").item(0).firstChild?n[s].getElementsByTagName("precontext").item(0).firstChild.data:"",void 0===this.ignore_strings[r])){if(u={},u.description=c,u.suggestions=[],u.matcher=new RegExp("^"+r.replace(/\s+/,this._getSeparators())+"$"),u.context=d,u.string=r,u.type=l,this.suggestions.push(u),null!==n[s].getElementsByTagName("suggestions").item(0))for(p=n[s].getElementsByTagName("suggestions").item(0).getElementsByTagName("option"),m=0;m<p.length;m++)u.suggestions.push(p[m].firstChild.data);null!==n[s].getElementsByTagName("url").item(0)&&(f=n[s].getElementsByTagName("url").item(0).firstChild.data,u.moreinfo=f+"&theme=tinymce"),void 0===t[c]&&("suggestion"===l&&i.push({word:r,pre:d}),"grammar"===l&&a.push({word:r,pre:d})),"spelling"!==l&&"Homophone"!==c||o.push({word:r,pre:d}),"Cliches"===c&&(u.description="ClichÃ©s"),"Spelling"===c&&(u.description=Object(h.translate)("Spelling",{comment:"Proofreading error description"})),"Repeated Word"===c&&(u.description=Object(h.translate)("Repeated Word",{comment:"Proofreading error description"})),"Did you mean..."===c&&(u.description=Object(h.translate)("Did you meanâ€¦",{comment:"Proofreading error description"}))}return b=o.length+a.length+i.length,g=b>0?this.buildErrorStructure(o,i,a):void 0,{errors:g,count:b,suggestions:this.suggestions}},yo.prototype.findSuggestion=function(e){var t,n,a=e.innerHTML,o=(this.getAttrib(e,"pre")+"").replace(/[\\,!\\?\\."\s]/g,""),i=this.suggestions.length;for(n=0;n<i;n++)if((""===o||o===this.suggestions[n].context)&&this.suggestions[n].matcher.test(a)){t=this.suggestions[n];break}return t},Eo.prototype.next=function(){var e=this.tokens[this.index];return this.count=this.last,this.last+=e.length+1,this.index++,""!==e&&("'"===e[0]&&(e=e.substring(1,e.length)),"'"===e[e.length-1]&&(e=e.substring(0,e.length-1))),e},Eo.prototype.hasNext=function(){return this.index<this.tokens.length},Eo.prototype.hasNextN=function(e){return this.index+e<this.tokens.length},Eo.prototype.skip=function(e,t){this.index+=e,this.last+=t,this.index<this.tokens.length&&(this.count=this.last-this.tokens[this.index].length)},Eo.prototype.getCount=function(){return this.count},Eo.prototype.peek=function(e){var t,n=[],a=this.index+e;for(t=this.index;t<a;t++)n.push(this.tokens[t]);return n},yo.prototype.markMyWords=function(e,t){var n,a,o=new RegExp(this._getSeparators()),i=[],s=0,r=this,l=this._isTinyMCE?' data-mce-bogus="1"':"",c='<span class="mceItemHidden"'+l+">&nbsp;</span>";function d(e,t,n){var a,o=e.nodeValue,i=o.search(t),s=o.match(t),l=[];return i<0||!s.length?[e]:(i>0&&l.push(document.createTextNode(o.substr(0,i))),l.push(r.create(s[0].replace(t,n))),a=i+s[0].length,a<o.length&&l.push(document.createTextNode(o.substr(a))),l)}return this._walk(e,function(e){3!==e.nodeType||r.isMarkedNode(e)||i.push(e)}),this.map(i,function(e){var i,u,p,m,h,f,g,b,v,y,E,j,w,_,C,S,x,k,I={};if(3===e.nodeType){for(i=e.nodeValue,u=e.nodeValue.split(o),p="",m=[],a=new Eo(u);a.hasNext();){if(h=a.next(),f=t["__"+h],void 0!==f&&void 0!==f.pretoks){var O=function(e){void 0!==e&&!e.used&&void 0===I["__"+e.string]&&e.regexp.test(y)&&(I["__"+e.string]=1,m.push([e.regexp,'<span class="'+e.type+'" pre="'+p+'"'+l+">$&</span>"]),e.used=!0,b=!0)};g=f.defaults,f=f.pretoks["__"+p],b=!1,v=i.substr(0,a.getCount()),y=i.substr(v.length,i.length),void 0!==f&&(p+=" ",r.map(f,O)),b||(p="",r.map(g,O))}p=h}if(m.length>0){for(E=e,j=0;j<m.length;j++){w=m[j][0],_=m[j][1],E=function(e){var t,a;if(3===e.nodeType){if(s++,r.isIE()&&e.nodeValue.length>0&&" "===e.nodeValue.substr(0,1))return r.create(c+e.nodeValue.substr(1,e.nodeValue.length-1).replace(w,_),!1);if(n)return r.create(e.nodeValue.replace(w,_),!1);if(t=r.create("<span />"),void 0===n&&(n="function"!=typeof t.appendChild,n))return r.remove(t),r.create(e.nodeValue.replace(w,_),!1);for(a=d(e,w,_),C=0;C<a.length;C++)t.appendChild(a[C]);return e=t,e}for(S=r.contents(e),x=0;x<S.length;x++)if(3===S[x].nodeType&&w.test(S[x].nodeValue))return k=r.isIE()&&S[x].nodeValue.length>0&&" "===S[x].nodeValue.substr(0,1)?r.create(c+S[x].nodeValue.substr(1,S[x].nodeValue.length-1).replace(w,_),!0):r.create(S[x].nodeValue.replace(w,_),!0),r.replaceWith(S[x],k),r.removeParent(k),s++,e;return e}(E)}r.replaceWith(e,E)}}}),s},yo.prototype._walk=function(e,t){var n;for(n=0;n<e.length;n++)t.call(t,e[n]),this._walk(this.contents(e[n]),t)},yo.prototype.removeWords=function(e,t){var n=0,a=this;return this.map(this.findSpans(e).reverse(),function(e){var o;e&&(a.isMarkedNode(e)||a.hasClass(e,"mceItemHidden")||a.isEmptySpan(e))&&("&nbsp;"===e.innerHTML?(o=document.createTextNode(" "),a.replaceWith(e,o)):t&&e.innerHTML!==t||(a.removeParent(e),n++))}),n},yo.prototype.isEmptySpan=function(e){return""===this.getAttrib(e,"class")&&""===this.getAttrib(e,"style")&&""===this.getAttrib(e,"id")&&!this.hasClass(e,"Apple-style-span")&&""===this.getAttrib(e,"mce_name")},yo.prototype.isMarkedNode=function(e){return this.hasClass(e,"hiddenGrammarError")||this.hasClass(e,"hiddenSpellError")||this.hasClass(e,"hiddenSuggestion")},yo.prototype.applySuggestion=function(e,t){var n;"(omit)"===t?this.remove(e):(n=this.create(t),this.replaceWith(e,n),this.removeParent(n))},yo.prototype.hasErrorMessage=function(e){return void 0!==e&&null!==e.getElementsByTagName("message").item(0)},yo.prototype.getErrorMessage=function(e){return e.getElementsByTagName("message").item(0)},yo.prototype.isIE=function(){return"Microsoft Internet Explorer"===navigator.appName};var jo=yo,wo=n("./node_modules/store/store.js"),_o=n.n(wo),Co=n("./client/lib/preferences/constants.js"),So=n("./client/lib/user/utils.js"),xo=yt.a.undocumented(),ko={},Io=0;function Oo(){return _o.a.get(Co.a.LOCALSTORAGE_KEY)}ko.mergePreferencesToLocalStorage=function(e){var t=Oo()||{};Object(v.forOwn)(e,function(e,n){null===e?delete t[n]:t[n]=e}),_o.a.set(Co.a.LOCALSTORAGE_KEY,t)},ko.fetch=function(){var e=Oo();So.default.isLoggedIn()&&(pt.a.handleViewAction({type:"FETCH_ME_SETTINGS"}),e&&pt.a.handleServerAction({type:"RECEIVE_ME_SETTINGS",data:dt()({},Co.a.USER_SETTING_KEY,e)}),xo.me().settings().get(function(e,t){!e&&t&&ko.mergePreferencesToLocalStorage(t[Co.a.USER_SETTING_KEY]),pt.a.handleServerAction({type:"RECEIVE_ME_SETTINGS",error:e,data:t})}))},ko.set=function(e,t){var n={},a={};n[e]=t,a[Co.a.USER_SETTING_KEY]=n,pt.a.handleViewAction({type:"UPDATE_ME_SETTINGS",data:a}),ko.mergePreferencesToLocalStorage(n),Io++,xo.me().settings().update(JSON.stringify(a),function(e,t){--Io||pt.a.handleServerAction({type:"RECEIVE_ME_SETTINGS",error:e,data:t})})},ko.remove=function(e){ko.set(e,null)};var To=ko,Po=n("./client/lib/preferences/store.js"),Do="service.afterthedeadline.com",No=["en","pt","de","es","fr"],Ro="editorProofreadIgnore";function Mo(e){var t,n,a,o,i=H.a.each,s=H.a.ui.Menu.extend({init:function(e){e.context="contextmenu",e.autofix=!1,this.throttledReposition=Object(v.throttle)(this.reposition.bind(this),200),this.on("autohide",function(e){return e.preventDefault()}),this.boundHideIfNotMarked=this.hideIfNotMarked.bind(this),this._super(e)},hideIfNotMarked:function(e){r(e.target)||this.hide()},hide:function(){this._super(),this.remove(),window.removeEventListener("scroll",this.throttledReposition),e.off("SpellcheckEnd click touchstart focusout",this.boundHideIfNotMarked)},postRender:function(){this._super(),this.reposition(),window.addEventListener("scroll",this.throttledReposition),e.on("SpellcheckEnd click touchstart focusout",this.boundHideIfNotMarked)},reposition:function(){var t=e.dom.getRoot(),n=H.a.DOM.getPos(e.getContentAreaContainer()),a=e.dom.getPos(this.settings.target);"BODY"===t.nodeName?(a.x-=t.ownerDocument.documentElement.scrollLeft||t.scrollLeft,a.y-=t.ownerDocument.documentElement.scrollTop||t.scrollTop):(a.x-=t.scrollLeft,a.y-=t.scrollTop),n.x+=a.x,n.y+=a.y,this.moveTo(n.x,n.y+this.settings.target.offsetHeight)}});function r(e){return e.className&&/\bhidden(GrammarError|SpellError|Suggestion)\b/.test(e.className)}function l(){e.dom.select("span.hiddenSpellError, span.hiddenGrammarError, span.hiddenSuggestion").length||(t&&t.hide(),d())}function c(t,n,a){a?i(e.dom.select("span.hiddenSpellError, span.hiddenGrammarError, span.hiddenSuggestion"),function(e){var t=e.innerText||e.textContent;t===n&&o.remove(e,!0)}):e.dom.remove(t,!0),l()}function d(){for(var t,a=new RegExp("mceItemHidden|hidden(((Grammar|Spell)Error)|Suggestion)"),o=e.dom.select("span"),i=o.length;i--;)t=o[i],t.className&&a.test(t.className)&&e.dom.remove(t,!0);e.setContent(e.getContent({format:"raw"}),{format:"raw"}),n=!1,e.nodeChanged(),e.fire("SpellcheckEnd")}function u(t,n,a){e.setProgressState(!0);var o,i,s=new XMLHttpRequest;s.open("POST","https://"+(o=Object(h.getLocaleSlug)(),i=Object(v.find)(No,function(e){return o===e||0===o.indexOf(e+"-")}),i?i+"."+Do:Do)+"/"+t),s.addEventListener("readystatechange",function(){4===s.readyState&&(e.setProgressState(),200===s.status&&a(""+s.responseText,s))});var r=e.getParam("atd_rpc_id");s.send(Object(g.stringify)({data:n,key:r}))}function p(n){var o=[],r=n.innerText||n.textContent,d=a.findSuggestion(n);d?(o.push({text:d.description,classes:"atd-menu-title",disabled:!0}),d.suggestions.length&&(o.push({text:"-"}),i(d.suggestions,function(e){o.push({text:e,onclick:function(){a.applySuggestion(n,e),l()}})}))):o.push({text:Object(h.translate)("No suggestions",{comment:"Editor proofreading no suggestions"}),classes:"atd-menu-title",disabled:!0}),d&&d.moreinfo&&(o.push({text:"-"}),o.push({text:Object(h.translate)("Explainâ€¦",{comment:"Editor proofreading menu item"}),onclick:function(){e.windowManager.open({title:Object(h.translate)("Explainâ€¦",{comment:"Editor proofreading menu item"}),url:d.moreinfo,width:480,height:380,inline:!0})}})),o.push.apply(o,[{text:"-"},{text:Object(h.translate)("Ignore suggestion",{comment:"Editor proofreading menu item"}),onclick:function(){c(n,r)}}]),e.getParam("atd_ignore_enable")?o.push({text:Object(h.translate)("Ignore always",{comment:"Editor proofreading menu item"}),onclick:function(){!function(e){var t=Po.a.get(Ro)||[];-1===t.indexOf(e)&&t.push(e),To.set(Ro,t)}(r),c(n,r,!0)}}):o.push({text:Object(h.translate)("Ignore all",{comment:"Editor proofreading menu item"}),onclick:function(){c(n,r,!0)}}),t=new s({items:o,target:n}),t.renderTo(document.body),t.on("hide",function(){t=null})}e.on("init",function(){o=e.dom,a=new jo,a.map=i,a._isTinyMCE=!0,a.getAttrib=function(e,t){return o.getAttrib(e,t)},a.findSpans=function(e){return void 0===e?o.select("span"):o.select("span",e)},a.hasClass=function(e,t){return o.hasClass(e,t)},a.contents=function(e){return e.childNodes},a.replaceWith=function(e,t){return o.replace(t,e)},a.create=function(e){return o.create("span",{class:"mceItemHidden","data-mce-bogus":1},e)},a.removeParent=function(e){return o.remove(e,!0),e},a.remove=function(e){o.remove(e)},a.setIgnoreStrings(e.getParam("atd_ignore_strings",[]).join(",")),a.showTypes(e.getParam("atd_show_types","")),e.addCommand("mceWritingImprovementTool",function(t){var o,i=0;"function"!=typeof t&&(t=function(){}),void 0!==window.AtD_proofread_click_count&&window.AtD_proofread_click_count++,n?d():u("checkDocument",e.getContent({format:"raw"}),function(s,r){var l;(e.setProgressState(),200===r.status&&"html"!==r.responseText.substr(1,4)&&r.responseXML)?null===r.responseXML.getElementsByTagName("message").item(0)?(o=a.processXML(r.responseXML),o.count>0&&(l=o.errors,i=a.markMyWords(a.contents(e.getBody()),l)),i?(n=!0,e.fire("SpellcheckStart")):e.windowManager.alert(Object(h.translate)("No writing errors were found.",{comment:"Editor proofreading success prompt"})),t(i)):e.windowManager.alert(r.responseXML.getElementsByTagName("message").item(0).firstChild.data,t(0)):e.windowManager.alert(Object(h.translate)("There was a problem communicating with the Proofreading service. Try again in one minute.",{comment:"Editor proofreading error"}),t(0))})}),!1!==e.settings.content_css&&o.addStyle(".hiddenSpellError{border-bottom:2px solid red;cursor:default;}.hiddenGrammarError{border-bottom:2px solid green;cursor:default;}.hiddenSuggestion{border-bottom:2px solid blue;cursor:default;}"),e.on("click",function(t){r(t.target)&&(t.preventDefault(),e.selection.select(t.target),p(t.target))})}),function(){function t(){var e=Po.a.get(Ro);e&&a.setIgnoreStrings(e)}e.getParam("atd_ignore_enable")&&(void 0===Po.a.getAll()&&To.fetch(),e.on("init",function(){Po.a.on("change",t)}),e.on("remove",function(){Po.a.off("change",t)}))}(),e.on("SpellcheckStart SpellcheckEnd",function(t){e.contentDocument.body.spellcheck="spellcheckend"===t.type,e.contentDocument.body.spellcheck||(e.contentDocument.body.focus(),e.contentDocument.body.blur())}),e.addMenuItem("spellchecker",{text:Object(h.translate)("Proofread Writing",{comment:"Editor proofreading toolbar tooltip"}),context:"tools",cmd:"mceWritingImprovementTool",onPostRender:function(){var t=this;e.on("SpellcheckStart SpellcheckEnd",function(){t.active(n)})}}),e.addButton("spellchecker",{tooltip:Object(h.translate)("Proofread Writing",{comment:"Editor proofreading button tooltip"}),cmd:"mceWritingImprovementTool",onPostRender:function(){var t=this;e.on("SpellcheckStart SpellcheckEnd",function(){t.active(n)})}}),e.on("remove",function(){t&&(t.remove(),t=null)})}
/**
 * Adapted from the WordPress wptextpattern TinyMCE plugin.
 *
 *
 * Text pattern plugin for TinyMCE
 *
 *
 * This plugin can automatically format text patterns as you type. It includes two patterns:
 *  - Unordered list (`* ` and `- `).
 *  - Ordered list (`1. ` and `1) `).
 *
 * If the transformation in unwanted, the user can undo the change by pressing backspace,
 * using the undo shortcut, or the undo button in the toolbar.
 *
 * @format
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 * @since 4.3.0
 */
function Ao(e){var t,n=H.a.util.VK,a=[{regExp:/^[*-]\s/,cmd:"InsertUnorderedList"},{regExp:/^1[.)]\s/,cmd:"InsertOrderedList"}],o=[{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:">",format:"blockquote"},{regExp:/^(-){3,}$/,element:"hr"}],i=[{start:"`",end:"`",format:"code"}],s=[];function r(){var n,a,o,r,l,c=e.selection.getRng(),d=c.startContainer,u=c.startOffset;d&&3===d.nodeType&&d.data.length&&u&&-1!==H.a.inArray(s,d.data.charAt(u-1))&&(n=function(e){for(var t,n=i.length;n--;)if(o=i[n],t=e.data.indexOf(o.end),-1!==t)return t}(d),a=d.data.lastIndexOf(o.end),n!==a&&-1!==a&&(a-n<=o.start.length||-1===d.data.slice(n+o.start.length,a).indexOf(o.start.slice(0,1))&&(r=e.formatter.get(o.format),r&&r[0].inline&&(e.undoManager.add(),e.undoManager.transact(function(){d.insertData(u,"â€‹"),d=d.splitText(n),l=d.splitText(u-n),d.deleteData(0,o.start.length),d.deleteData(d.data.length-o.end.length,o.end.length),e.formatter.apply(o.format,{},d),e.selection.setCursorLocation(l,1)}),setTimeout(function(){t="space",e.once("selectionchange",function(){var e;l&&(e=l.data.indexOf("â€‹"),-1!==e&&l.deleteData(e,e+1))})})))))}function l(t){var n,a=e.dom.getParent(t,"p");if(a){for(;(n=a.firstChild)&&3!==n.nodeType;)a=n;if(n)return n.data||(n=n.nextSibling&&3===n.nextSibling.nodeType?n.nextSibling:null),n}}function c(){var n,o,i=e.selection.getRng(),s=i.startContainer;s&&l(s)===s&&(n=s.parentNode,o=s.data,H.a.each(a,function(a){var r=o.match(a.regExp);if(r&&i.startOffset===r[0].length)return e.undoManager.add(),e.undoManager.transact(function(){s.deleteData(0,r[0].length),n.innerHTML||n.appendChild(document.createElement("br")),e.selection.setCursorLocation(n),e.execCommand(a.cmd)}),setTimeout(function(){t="space"}),!1}))}H.a.each(i,function(e){H.a.each((e.start+e.end).split(""),function(e){-1===H.a.inArray(s,e)&&s.push(e)})}),e.on("selectionchange",function(){t=null}),e.on("keydown",function(a){(t&&27===a.keyCode||"space"===t&&a.keyCode===n.BACKSPACE)&&(e.undoManager.undo(),a.preventDefault(),a.stopImmediatePropagation()),a.keyCode!==n.ENTER||n.modifierPressed(a)||function(){var n,a,i,s=e.selection.getRng(),r=s.startContainer,c=l(r),d=o.length;if(!c)return;n=c.data;for(;d--;)if(o[d].start){if(0===n.indexOf(o[d].start)){a=o[d];break}}else if(o[d].regExp&&o[d].regExp.test(n)){a=o[d];break}if(!a)return;if(c===r&&H.a.trim(n)===a.start)return;e.once("keyup",function(){e.undoManager.add(),e.undoManager.transact(function(){var t;a.format?(e.formatter.apply(a.format,{},c),c.replaceData(0,c.data.length,(t=c.data.slice(a.start.length),t?t.replace(/^\s+/,""):""))):a.element&&(i=c.parentNode&&c.parentNode.parentNode,i&&i.replaceChild(document.createElement(a.element),c.parentNode))}),setTimeout(function(){t="enter"})})}(),a.keyCode!==n.SPACEBAR||a.ctrlKey||a.metaKey||a.altKey?a.keyCode>47&&!(a.keyCode>=91&&a.keyCode<=93)&&setTimeout(r):setTimeout(c)},!0)}function Lo(e){var t,n=!1,a=!1;function o(n){a=n,e.dom.toggleClass(t,"is-pinned",a)}var i=Object(v.throttle)(function(){t&&(a&&window.pageYOffset<t.offsetTop?o(!1):!a&&window.pageYOffset>t.offsetTop&&o(!0))},50),s=Object(v.throttle)(function(a){var s=!e.isHidden(),r="remove"!==a.type&&s&&Object(De.d)(">660px");if(r!==n){var l=(r?"add":"remove")+"EventListener";window[l]("scroll",i),n=r,n?(t=e.getContainer(),i()):o(!1)}},200);e.on("init show hide remove",s),window.addEventListener("resize",s)}var Bo=function(e){var t=e.icon,n=e.label,a=e.e2e;return m.a.createElement("div",{className:"wpcom-insert-menu__menu"},m.a.createElement(Y.a,{className:"wpcom-insert-menu__menu-icon",icon:t}),m.a.createElement("span",{className:"wpcom-insert-menu__menu-label","data-e2e-insert-type":a},n))},Uo=[{name:"insert_media_item",item:m.a.createElement(Bo,{icon:"image",label:f.a.translate("Media"),e2e:"media"}),cmd:"wpcomAddMedia"}];Qt.a.isEnabled("external-media")&&(Qt.a.isEnabled("external-media/google-photos")&&Uo.push({name:"insert_from_google",item:m.a.createElement(Bo,{icon:"shutter",label:f.a.translate("Media from Google"),e2e:"google-media"}),cmd:"googleAddMedia"}),Qt.a.isEnabled("external-media/free-photo-library")&&Uo.push({name:"insert_from_pexels",item:m.a.createElement(Bo,{icon:"image-multiple",label:f.a.translate("Free photo library"),e2e:"stock-media-pexels"}),cmd:"pexelsAddMedia"})),Uo.push({name:"insert_contact_form",item:m.a.createElement(Bo,{icon:"mention",label:f.a.translate("Contact form"),e2e:"contact-form"}),cmd:"wpcomContactForm"}),Uo.push({name:"insert_payment_button",item:m.a.createElement(Bo,{icon:"money",label:f.a.translate("Payment button"),e2e:"payment-button"}),cmd:"simplePaymentsButton"}),Qt.a.isEnabled("memberships")&&Uo.push({name:"insert_memberships_button",item:m.a.createElement(Bo,{icon:"money",label:f.a.translate("Recurring Payment"),e2e:"memberships"}),cmd:"membershipsButton"});var Fo=function(e){Uo.forEach(function(t){return e.addMenuItem(t.name,{classes:"wpcom-insert-menu__menu-item",cmd:t.cmd,onPostRender:function(){this.innerHtml(Object(d.renderToString)(t.item))}})}),e.addButton("wpcom_insert_menu",{type:"menubutton",title:f.a.translate("Add content"),classes:"btn wpcom-insert-menu insert-menu",menu:Uo.map(function(t){var n=t.name;return e.menuItems[n]}),onPostRender:function(){var e=c()(this.$el[0].children,1),t=e[0];t.innerHTML=Object(d.renderToString)(m.a.createElement(Bo,{icon:"add-outline",label:f.a.translate("Add")}))}})},qo=n("./client/components/tinymce/plugins/embed/dialog.jsx"),zo=function(e){var t;e.addCommand("embedDialog",function(){return function n(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=e.selection.getNode(),i=e.getParam("redux_store"),s={embedUrl:o.innerText||o.textContent,isVisible:a,onCancel:function(){return n(!1)},onUpdate:function(t){e.execCommand("mceInsertContent",!1,t),n(!1)}};Object(hn.b)(m.a.createElement(qo.a,s),t,i),a||e.focus()}()}),e.on("init",function(){t=e.getContainer().appendChild(document.createElement("div"))}),e.on("remove",function(){L.a.unmountComponentAtNode(t),t.parentNode.removeChild(t),t=null})};function Vo(e){var t=e.getParam("redux_store");if(t){e.on("paste",o);var n=e.getParam("textarea");n&&n.addEventListener("paste",o)}function a(n,a){if(a&&e){var o=!e.isHidden();if(o){var i=!0,s=!1,r=void 0;try{for(var l,c=e.getBody().querySelectorAll("*")[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var d=l.value;if(Object(v.includes)(d.textContent,n)){d.textContent=d.textContent.replace(n,a.result),e.undoManager.add();break}}}catch(e){s=!0,r=e}finally{try{i||null==c.return||c.return()}finally{if(s)throw r}}}else{var u=Object(X.i)(t.getState());if(!Object(v.includes)(u,n))return;u=u.replace(n,a.result),e.fire("SetTextAreaContent",{content:u})}e.fire("change")}}function o(e){var n;e.clipboardData?n=e.clipboardData.getData("text/plain"):window.clipboardData&&(n=window.clipboardData.getData("Text")),n&&/^<.*>$/.test(n)&&yt.a.undocumented().site(Object(Z.e)(t.getState())).embedReversal(n).then(Object(v.partial)(a,n)).catch(function(){})}}var Ho=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={imageAlt:"",imageTitle:"",imageUrl:""},n.setImageAlt=function(e){n.setState({imageAlt:e.target.value})},n.setImageTitle=function(e){n.setState({imageTitle:e.target.value})},n.setImageUrl=function(e){n.setState({imageUrl:e.target.value})},n.onCloseDialog=function(){n.setState({imageAlt:"",imageTitle:"",imageUrl:""}),n.props.onClose()},n.onInsertImage=function(){var e=n.state,t=e.imageAlt,a=e.imageTitle,o=e.imageUrl;n.props.onInsert({alt:t,src:o,title:a}),n.onCloseDialog()},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.shouldDisplay,n=e.translate,a=this.state,o=a.imageAlt,i=a.imageTitle,s=a.imageUrl,r=[{action:"cancel",label:n("Cancel")},{action:"add-image",isPrimary:!0,label:n("Add Image"),onClick:this.onInsertImage}];return m.a.createElement(We.a,{isVisible:t,buttons:r,onClose:this.onCloseDialog,additionalClassNames:"editor-html-toolbar__dialog"},m.a.createElement(ea.a,null,m.a.createElement(ta.a,{htmlFor:"image_url"},n("URL")),m.a.createElement(Ce.a,{autoFocus:!0,id:"image_url",name:"image_url",onChange:this.setImageUrl,value:s})),m.a.createElement(ea.a,null,m.a.createElement(ta.a,{htmlFor:"image_title"},n("Title")),m.a.createElement(Ce.a,{id:"image_title",name:"image_title",onChange:this.setImageTitle,value:i})),m.a.createElement(ea.a,null,m.a.createElement(ta.a,{htmlFor:"image_alt"},n("Alt Text")),m.a.createElement(Ce.a,{id:"image_alt",name:"image_alt",onChange:this.setImageAlt,alue:o})))}}]),t}(p.Component);Ho.propTypes={onClose:U.a.func,onInsert:U.a.func,shouldDisplay:U.a.bool,translate:U.a.func};var Wo=Object(h.localize)(Ho),Go=n("./client/my-sites/post-selector/index.jsx"),Ko=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,Yo=/^(https?|ftp):\/\/[A-Z0-9.-]+\.[A-Z]{2,4}[^ "]*$/i,$o=/^(?:[a-z]+:|#|\?|\.|\/)/,Jo=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={linkNewTab:!1,linkText:"",linkUrl:"",selectedPost:{id:null,url:null}},n.bindLinkUrlRef=function(e){n.linkUrl=e},n.setLinkUrl=function(e){var t=n.state.selectedPost;n.setState({linkUrl:e.target.value,selectedPost:t.url===e.target.value?t:{id:null,url:null}})},n.setLinkText=function(e){n.setState({linkText:e.target.value})},n.setLinkNewTab=function(e){n.setState({linkNewTab:e.target.checked})},n.onSelectPost=function(e){n.setState({linkUrl:e.URL,selectedPost:{id:e.ID,url:e.URL}})},n.onCloseDialog=function(){n.setState({linkNewTab:!1,linkText:"",linkUrl:"",selectedPost:{id:null,url:null}}),n.props.onClose()},n.onInsertLink=function(){var e=n.state,t=e.linkNewTab,a=e.linkText;n.props.onInsert({href:n.correctUrl(),target:t?"_blank":""},a),n.onCloseDialog()},n}return M()(t,e),O()(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({linkUrl:this.inferUrl(e.selectedText),linkText:e.selectedText})}},{key:"correctUrl",value:function(){var e=this.state.linkUrl.trim();return Ko.test(e)?"mailto:"+e:$o.test(e)?e:"http://"+e}},{key:"inferUrl",value:function(e){return Ko.test(e)?"mailto:"+e:Yo.test(e)?e.replace(/&amp;|&#0?38;/gi,"&"):""}},{key:"render",value:function(){var e=this.props,t=e.shouldDisplay,n=e.siteId,a=e.translate,o=this.state,i=o.linkNewTab,s=o.linkText,r=o.linkUrl,l=o.selectedPost,c=[{action:"cancel",label:a("Cancel")},{action:"add-link",isPrimary:!0,label:a("Add Link"),onClick:this.onInsertLink}];return m.a.createElement(We.a,{isVisible:t,buttons:c,onClose:this.onCloseDialog,additionalClassNames:"editor-html-toolbar__dialog"},m.a.createElement(ea.a,null,m.a.createElement(ta.a,{htmlFor:"link_url"},a("URL")),m.a.createElement(Ce.a,{autoFocus:!0,id:"link_url",name:"link_url",onChange:this.setLinkUrl,ref:this.bindLinkUrlRef,value:r})),m.a.createElement(ea.a,null,m.a.createElement(ta.a,{htmlFor:"link_text"},a("Link Text")),m.a.createElement(Ce.a,{id:"link_text",name:"link_text",onChange:this.setLinkText,value:s})),m.a.createElement(ea.a,null,m.a.createElement(ta.a,null,m.a.createElement(Ja.a,{checked:i,name:"link_new_tab",onChange:this.setLinkNewTab}),m.a.createElement("span",null,a("Open link in a new window/tab")))),m.a.createElement(ea.a,null,m.a.createElement(ta.a,null,m.a.createElement("span",null,a("Link to existing content"))),m.a.createElement(Go.a,{emptyMessage:a("No posts found"),onChange:this.onSelectPost,order:"DESC",orderBy:"date",selected:l.id,showTypeLabels:!0,siteId:n,type:"any",excludePrivateTypes:!0})))}}]),t}(p.Component);Jo.propTypes={onClose:U.a.func,onInsert:U.a.func,selectedText:U.a.string,shouldDisplay:U.a.bool,siteId:U.a.number,translate:U.a.func};var Qo=Object(F.b)(function(e){return{siteId:Object(Z.e)(e)}})(Object(h.localize)(Jo)),Zo=n("./client/state/selectors/is-drop-zone-visible.js"),Xo=39,ei=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={contactFormDialogTab:"fields",isPinned:!1,isScrollable:!1,isScrolledFull:!1,openTags:[],selectedText:"",showContactFormDialog:!1,showImageDialog:!1,showInsertContentMenu:!1,showLinkDialog:!1,showMediaModal:!1,source:"",showSimplePaymentsDialog:!1,simplePaymentsDialogTab:"addNew"},n.bindButtonsRef=function(e){n.buttons=e},n.bindInsertContentButtonsRef=function(e){n.insertContentButtons=e},n.onWindowResize=function(){n.disablePinOnSmallScreens(),n.toggleToolbarScrollableOnResize()},n.pinToolbarOnScroll=function(){if(!Object(De.d)("<660px")){var e=n.props.content.offsetTop,t=n.state.isPinned;t&&window.pageYOffset<e-Xo?n.setState({isPinned:!1}):!t&&window.pageYOffset>e-Xo&&n.setState({isPinned:!0})}},n.disablePinOnSmallScreens=function(){n.state.isPinned&&Object(De.d)("<660px")&&n.setState({isPinned:!1})},n.toggleToolbarScrollableOnResize=function(){var e=n.buttons.scrollWidth>n.buttons.clientWidth;e!==n.state.isScrollable&&n.setState({isScrollable:e})},n.hideToolbarFadeOnFullScroll=function(e){var t=e.target,a=t.scrollLeft,o=t.scrollWidth,i=t.clientWidth,s=a>=o-i-10;s!==n.state.isScrolledFull&&n.setState({isScrolledFull:s})},n.clickOutsideInsertContentMenu=function(e){n.state.showInsertContentMenu&&!n.insertContentButtons.contains(e.target)&&n.setState({showInsertContentMenu:!1})},n.updateEditorContent=function(e,t,a){return V.Env.gecko?n.updateEditorContentFirefox(e,t,a):11===V.Env.ie?n.updateEditorContentIE11(e,t,a):n.insertEditorContent(e,t,a)},n.attributesToString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(v.reduce)(e,function(e,t,n){return t?e+" "+n+'="'+t+'"':e},"")},n.openHtmlTag=function(e){var t=e.name,a=e.attributes,o=void 0===a?{}:a,i=e.options,s=void 0===i?{}:i;return(s.paragraph?"\n":"")+(s.indent?"\t":"")+"<"+t+n.attributesToString(o)+">"+(s.paragraph?"\n":"")},n.closeHtmlTag=function(e){var t=e.name,n=e.options,a=void 0===n?{}:n;return"</"+t+">"+(a.newLineAfter?"\n":"")+(a.paragraph?"\n\n":"")},n.onClickBold=function(){n.insertHtmlTag({name:"strong"})},n.onClickItalic=function(){n.insertHtmlTag({name:"em"})},n.onClickLink=function(e,t){t?n.insertHtmlTagWithText({name:"a",attributes:e,options:{text:t}}):(n.insertHtmlTagOpenClose({name:"a",attributes:e}),n.setCursorPosition(n.props.content.selectionEnd,-4))},n.onClickQuote=function(){n.insertHtmlTag({name:"blockquote",options:{paragraph:!0}})},n.onClickDelete=function(){var e=n.props.moment().format();n.insertHtmlTag({name:"del",attributes:{datetime:e}})},n.onClickInsert=function(){var e=n.props.moment().format();n.insertHtmlTag({name:"ins",attributes:{datetime:e}})},n.onClickImage=function(e){n.insertHtmlTagSelfClosed({name:"img",attributes:e})},n.onClickUnorderedList=function(){n.insertHtmlTag({name:"ul",options:{paragraph:!0}})},n.onClickOrderedList=function(){n.insertHtmlTag({name:"ol",options:{paragraph:!0}})},n.onClickListItem=function(){n.insertHtmlTag({name:"li",options:{indent:!0,newLineAfter:!0}})},n.onClickCode=function(){n.insertHtmlTag({name:"code"})},n.onClickMore=function(){n.insertCustomContent("\x3c!--more--\x3e",{paragraph:!0})},n.onClickCloseTags=function(){var e=Object(v.reduce)(n.state.openTags,function(e,t){return n.closeHtmlTag({name:t})+e},"");n.insertCustomContent(e),n.setState({openTags:[]})},n.onInsertMedia=function(e){n.insertCustomContent(e)},n.onInsertContactForm=function(){n.insertCustomContent(kt(n.props.contactForm),{paragraph:!0}),n.closeContactFormDialog()},n.openImageDialog=function(){n.setState({showImageDialog:!0})},n.closeImageDialog=function(){n.setState({showImageDialog:!1})},n.openLinkDialog=function(){var e=n.splitEditorContent(),t=e.inner;n.setState({selectedText:t,showLinkDialog:!0})},n.closeLinkDialog=function(){n.setState({showLinkDialog:!1})},n.toggleInsertContentMenu=function(){n.setState({showInsertContentMenu:!n.state.showInsertContentMenu})},n.openContactFormDialog=function(){n.setState({contactFormDialogTab:"fields",showContactFormDialog:!0,showInsertContentMenu:!1})},n.toggleContactFormDialogTab=function(){n.setState({contactFormDialogTab:"fields"===n.state.contactFormDialogTab?"settings":"fields"})},n.closeContactFormDialog=function(){n.setState({showContactFormDialog:!1})},n.openMediaModal=function(){n.setState({showInsertContentMenu:!1,showMediaModal:!0,source:""})},n.openGoogleModal=function(){n.setState({showInsertContentMenu:!1,showMediaModal:!0,source:"google_photos"})},n.openPexelsModal=function(){n.setState({showInsertContentMenu:!1,showMediaModal:!0,source:"pexels"})},n.closeMediaModal=function(){n.setState({showMediaModal:!1})},n.openSimplePaymentsDialog=function(){n.setState({simplePaymentsDialogTab:"addNew",showSimplePaymentsDialog:!0,showInsertContentMenu:!1})},n.closeSimplePaymentsDialog=function(){n.setState({showSimplePaymentsDialog:!1})},n.changeSimplePaymentsDialogTab=function(e){n.setState({simplePaymentsDialogTab:e})},n.insertSimplePayment=function(e){n.insertCustomContent(Zt(e),{paragraph:!0}),n.closeSimplePaymentsDialog()},n.onFilesDrop=function(){var e=n.props.site,t=Un.a.getAll(e.ID),a=1===t.length&&"image"===Object(Sn.g)(t[0]);a&&!Fn.a.hasErrors(e.ID)?(t[0].transient&&n.props.blockSave("MEDIA_MODAL_TRANSIENT_INSERT"),n.onInsertMedia(kn.a.get(e,t[0])),Cn.a.setLibrarySelectedItems(e.ID,[])):n.openMediaModal()},n.isTagOpen=function(e){return-1!==n.state.openTags.indexOf(e)},n.renderAddEverythingDropdown=function(){var e=n.props.translate,t=z()("editor-html-toolbar__insert-content-dropdown",{"is-visible":n.state.showInsertContentMenu});return m.a.createElement("div",{className:t},m.a.createElement("button",{className:"editor-html-toolbar__insert-content-dropdown-item",onClick:n.openMediaModal},m.a.createElement(Y.a,{icon:"image"}),m.a.createElement("span",{"data-e2e-insert-type":"media"},e("Media"))),Qt.a.isEnabled("external-media/google-photos")&&m.a.createElement("button",{className:"editor-html-toolbar__insert-content-dropdown-item",onClick:n.openGoogleModal},m.a.createElement(Y.a,{icon:"shutter"}),m.a.createElement("span",{"data-e2e-insert-type":"google-media"},e("Media from Google"))),Qt.a.isEnabled("external-media/free-photo-library")&&m.a.createElement("button",{className:"editor-html-toolbar__insert-content-dropdown-item",onClick:n.openPexelsModal},m.a.createElement(Y.a,{icon:"image-multiple"}),m.a.createElement("span",{"data-e2e-insert-type":"pexels"},e("Free photo library"))),m.a.createElement("button",{className:"editor-html-toolbar__insert-content-dropdown-item",onClick:n.openContactFormDialog},m.a.createElement(Y.a,{icon:"mention"}),m.a.createElement("span",{"data-e2e-insert-type":"contact-form"},e("Contact form"))),m.a.createElement("button",{className:"editor-html-toolbar__insert-content-dropdown-item",onClick:n.openSimplePaymentsDialog},m.a.createElement(Y.a,{icon:"money"}),m.a.createElement("span",{"data-e2e-insert-type":"payment-button"},e("Payment button"))))},n}return M()(t,e),O()(t,[{key:"componentDidMount",value:function(){this.pinToolbarOnScroll=Object(v.throttle)(this.pinToolbarOnScroll,50),this.hideToolbarFadeOnFullScroll=Object(v.throttle)(this.hideToolbarFadeOnFullScroll,200),this.onWindowResize=Object(v.throttle)(this.onWindowResize,400),window.addEventListener("scroll",this.pinToolbarOnScroll),window.addEventListener("resize",this.onWindowResize),this.buttons.addEventListener("scroll",this.hideToolbarFadeOnFullScroll),document.addEventListener("click",this.clickOutsideInsertContentMenu),this.toggleToolbarScrollableOnResize()}},{key:"componentWillUnmount",value:function(){this.pinToolbarOnScroll.cancel(),this.onWindowResize.cancel(),this.hideToolbarFadeOnFullScroll.cancel(),window.removeEventListener("scroll",this.pinToolbarOnScroll),window.removeEventListener("resize",this.onWindowResize),this.buttons.removeEventListener("scroll",this.hideToolbarFadeOnFullScroll),document.removeEventListener("click",this.clickOutsideInsertContentMenu)}},{key:"splitEditorContent",value:function(){var e=this.props.content,t=e.selectionEnd,n=e.selectionStart,a=e.value;return{before:a.substring(0,n),inner:a.substring(n,t),after:a.substring(t,a.length)}}},{key:"setCursorPosition",value:function(e,t){this.props.content.selectionEnd=this.props.content.selectionStart=e+t}},{key:"insertEditorContent",value:function(e,t,n){var a=this.props,o=a.content,i=a.onToolbarChangeContent;o.focus(),document.execCommand("insertText",!1,t),i(e+t+n)}},{key:"updateEditorContentFirefox",value:function(e,t,n){var a=e+t+n,o=this.props,i=o.content,s=o.content,r=s.selectionEnd,l=s.value,c=o.onToolbarChangeContent;this.props.content.value=a,i.focus(),document.execCommand("insertText",!1,t),c(a),this.setCursorPosition(r,a.length-l.length),this.props.content.focus()}},{key:"updateEditorContentIE11",value:function(e,t,n){var a=e+t+n,o=this.props,i=o.content,s=i.selectionEnd,r=i.value,l=o.onToolbarChangeContent;this.props.content.value=a,l(a),this.setCursorPosition(s,a.length-r.length)}},{key:"insertHtmlTagOpen",value:function(e){var t=this.state.openTags,n=this.splitEditorContent(),a=n.before,o=n.after;this.updateEditorContent(a,this.openHtmlTag(e),o),this.setState({openTags:t.concat(e.name)})}},{key:"insertHtmlTagClose",value:function(e){var t=this.state.openTags,n=this.splitEditorContent(),a=n.before,o=n.after;this.updateEditorContent(a,this.closeHtmlTag(e),o),this.setState({openTags:t.filter(function(t){return t!==e.name})})}},{key:"insertHtmlTagOpenClose",value:function(e){var t=this.splitEditorContent(),n=t.before,a=t.inner,o=t.after;this.updateEditorContent(n,this.openHtmlTag(e)+a+this.closeHtmlTag(e),o)}},{key:"insertHtmlTagSelfClosed",value:function(e){var t=this.splitEditorContent(),n=t.before,a=t.inner,o=t.after,i="<"+e.name+this.attributesToString(e.attributes)+" />",s=e.options&&e.options.paragraph?"\n"+i+"\n\n":i;this.updateEditorContent(n,a+s,o)}},{key:"insertHtmlTagWithText",value:function(e){var t=this.splitEditorContent(),n=t.before,a=t.after;this.updateEditorContent(n,this.openHtmlTag(e)+e.options.text+this.closeHtmlTag(e),a)}},{key:"insertCustomContent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.splitEditorContent(),a=n.before,o=n.inner,i=n.after,s=t.paragraph?"\n":"";this.updateEditorContent(a,o+s+e+s+s,i)}},{key:"insertHtmlTag",value:function(e){var t=this.props.content,n=t.selectionEnd,a=t.selectionStart;n===a?this.isTagOpen(e.name)?this.insertHtmlTagClose(e):this.insertHtmlTagOpen(e):this.insertHtmlTagOpenClose(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.site,a=t.translate,o=z()("editor-html-toolbar",{"is-pinned":this.state.isPinned,"is-scrollable":this.state.isScrollable,"is-scrolled-full":this.state.isScrolledFull,"has-active-drop-zone":this.props.isDropZoneVisible}),i={strong:{label:"b",onClick:this.onClickBold},em:{label:"i",onClick:this.onClickItalic},a:{label:"link",onClick:this.openLinkDialog},blockquote:{label:"b-quote",onClick:this.onClickQuote},del:{onClick:this.onClickDelete},ins:{onClick:this.onClickInsert},img:{onClick:this.openImageDialog},ul:{onClick:this.onClickUnorderedList},ol:{onClick:this.onClickOrderedList},li:{onClick:this.onClickListItem},code:{onClick:this.onClickCode},more:{onClick:this.onClickMore},"close-tags":{disabled:!this.state.openTags.length,label:a("close tags"),onClick:this.onClickCloseTags}};return m.a.createElement("div",{className:o},m.a.createElement("div",{className:"editor-html-toolbar__wrapper"},m.a.createElement("div",{className:"editor-html-toolbar__wrapper-buttons"},m.a.createElement("div",{className:"editor-html-toolbar__buttons",ref:this.bindButtonsRef},m.a.createElement("div",{className:"editor-html-toolbar__button-insert-content",ref:this.bindInsertContentButtonsRef},m.a.createElement(J.a,{borderless:!0,className:"editor-html-toolbar__button-insert-content-dropdown",compact:!0,onClick:this.toggleInsertContentMenu},m.a.createElement(Y.a,{icon:"add-outline"}),m.a.createElement("span",null,a("Add")))),Object(v.map)(i,function(t,n){var a=t.disabled,o=t.label,i=t.onClick;return m.a.createElement(J.a,{borderless:!0,className:"editor-html-toolbar__button-"+n+" "+(e.isTagOpen(n)?"is-tag-open":""),compact:!0,disabled:a,key:n,onClick:i},o||n)})),this.renderAddEverythingDropdown())),m.a.createElement(Wo,{onClose:this.closeImageDialog,onInsert:this.onClickImage,shouldDisplay:this.state.showImageDialog}),m.a.createElement(Qo,{onClose:this.closeLinkDialog,onInsert:this.onClickLink,selectedText:this.state.selectedText,shouldDisplay:this.state.showLinkDialog}),m.a.createElement(uo,{activeTab:this.state.contactFormDialogTab,isEdit:!1,onChangeTabs:this.toggleContactFormDialogTab,onClose:this.closeContactFormDialog,onFieldAdd:this.props.fieldAdd,onFieldRemove:this.props.fieldRemove,onFieldUpdate:this.props.fieldUpdate,onInsert:this.onInsertContactForm,onSettingsUpdate:this.props.settingsUpdate,showDialog:this.state.showContactFormDialog}),m.a.createElement(Mn,{onClose:this.closeMediaModal,onInsertMedia:this.onInsertMedia,visible:this.state.showMediaModal,source:this.state.source}),m.a.createElement(Bn.a,{onAddMedia:this.onFilesDrop,site:n,fullScreen:!1}),m.a.createElement(bo.a,{showDialog:this.state.showSimplePaymentsDialog,activeTab:this.state.simplePaymentsDialogTab,isEdit:!1,onClose:this.closeSimplePaymentsDialog,onChangeTabs:this.changeSimplePaymentsDialogTab,onInsert:this.insertSimplePayment}))}}]),t}(p.Component);ei.propTypes={contactForm:U.a.object,content:U.a.object,fieldAdd:U.a.func,fieldRemove:U.a.func,fieldUpdate:U.a.func,isDropZoneVisible:U.a.bool.isRequired,moment:U.a.func,onToolbarChangeContent:U.a.func,settingsUpdate:U.a.func,site:U.a.object,translate:U.a.func};var ti={blockSave:Dn,fieldAdd:po,fieldRemove:mo,fieldUpdate:ho,settingsUpdate:fo},ni=Object(F.b)(function(e){return{contactForm:Object(v.get)(e,"ui.editor.contactForm",{}),isDropZoneVisible:Object(Zo.a)(e),site:Object(Z.d)(e)}},ti)(Object(h.localize)(ei)),ai=n("./client/blocks/user-mentions/suggestion-list.jsx"),oi=function(e){var t=e.username;return m.a.createElement("span",null,"@",t)};oi.propTypes={username:U.a.string.isRequired};var ii=oi,si=n("./client/components/data/query-users-suggestions/index.jsx"),ri=n("./client/state/users/suggestions/selectors.js"),li=H.a.util.VK,ci=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.matchingSuggestions=[],n.state={query:"",showPopover:!1},n.popoverContext=m.a.createRef(),n.insertSuggestion=function(e){var t=e.user_login;if(t){var a=n.props.editor.selection,o=m.a.createElement(ii,{username:t}),i=a.getRng(),s=document.createRange();s.setStart(i.startContainer,Math.max(i.startOffset-(n.state.query.length+1),0)),s.setEnd(i.endContainer,i.endOffset),a.setRng(s),a.setContent(a.getContent().replace(/@\S*/,u.a.renderToStaticMarkup(o))),n.props.editor.getBody().focus()}},n.onKeyDown=function(e){var t,a=e.keyCode,o=e.preventDefault,i=n.getSelectedSuggestionIndex();Object(v.includes)([li.DOWN,li.UP],a)&&-1!==i&&(o(),a===li.DOWN?t=(i+1)%n.matchingSuggestions.length:(t=i-1,t<0&&(t=n.matchingSuggestions.length-1)),n.setState({selectedSuggestionId:n.matchingSuggestions[t].ID}))},n.onKeyUp=function(e){var t=e.keyCode;if(!Object(v.includes)([li.DOWN,li.UP],t)){if(Object(v.includes)([li.SPACEBAR,27],t))return n.hidePopover();if(t===li.ENTER){if(!n.state.showPopover||0===n.matchingSuggestions.length)return;var a=n.getSuggestion();return a&&n.insertSuggestion(a),n.hidePopover()}var o=n.getQueryText();n.setState({showPopover:null!==o,selectedSuggestionId:null,query:o})}},n.hidePopover=function(){return n.setState({showPopover:!1})},n}return M()(t,e),O()(t,[{key:"componentDidMount",value:function(){var e=this.props.editor,t=this.getPosition(),n=t.left,a=t.top;e.on("keyup",this.onKeyUp),e.on("click",this.hidePopover),this.left=n,this.top=a}},{key:"componentWillUpdate",value:function(e,t){if(!this.state.showPopover&&t.showPopover)return this.updatePosition(t),void this.props.editor.on("keydown",this.onKeyDown);if(!this.state.showPopover||t.showPopover){if(t.showPopover){var n=this.getPosition(),a=n.top,o=n.left,i=this.top>a&&this.left<o,s=this.top<a&&this.left>o;(i||s)&&this.updatePosition(t,{top:a,left:o})}}else this.props.editor.off("keydown",this.onKeyDown)}},{key:"componentWillUnmount",value:function(){var e=this.props.editor;e.off("keydown",this.onKeyDown),e.off("keyup",this.onKeyUp),e.off("click",this.hidePopover)}},{key:"getMatchingSuggestions",value:function(e,t){if(t){t=Object(v.escapeRegExp)(t);var n=new RegExp("^"+t+"|\\s"+t,"ig");e=e.filter(function(e){var t=e.user_login,a=e.display_name;return n.test(t+" "+a)})}return e.slice(0,10)}},{key:"getPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,t=e.query,n=this.props.editor,a=n.selection.getRng(),o=document.createRange();o.setStart(a.startContainer,a.startOffset-t.length),o.setEnd(a.endContainer,a.endOffset);var i=o.getClientRects(),s=i.length>0?Object(v.last)(i):H.a.$(n.selection.getNode()).offset();return Object(v.pick)(s,["left","top"])}},{key:"updatePosition",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getPosition(e),a=n.left,o=n.top,i=this.props,s=i.editor,r=i.node,l=Object(v.get)(H.a.$(".mce-toolbar-grp",s.getContainer())[0],"offsetHeight",0),c=s.selection.getRng(),d=c.getClientRects();t=d.length>0?d[0].height:s.selection.getNode().offsetHeight,this.left=a,this.top=o,r.style.left=this.left+"px",r.style.top=l+this.top+t-10+"px"}},{key:"getQueryText",value:function(){var e=new RegExp("(?:^|\\s)@([A-Za-z0-9_+-]*)$","gi"),t=this.props.editor.selection.getRng(),n=t.startContainer.textContent.slice(0,t.startOffset),a=e.exec(n);return a&&a.length>1?a[1]:null}},{key:"getSelectedSuggestionIndex",value:function(){var e=this;return this.state.selectedSuggestionId?Object(v.findIndex)(this.matchingSuggestions,function(t){var n=t.ID;return n===e.state.selectedSuggestionId}):0}},{key:"getSuggestion",value:function(){var e=this.getSelectedSuggestionIndex();return e>-1?this.matchingSuggestions[e]:null}},{key:"render",value:function(){var e=this.props,t=e.siteId,n=e.suggestions,a=this.state,o=a.query,i=a.showPopover;this.matchingSuggestions=this.getMatchingSuggestions(n,o);var s=this.state.selectedSuggestionId||Object(v.get)(Object(v.head)(this.matchingSuggestions),"ID");return m.a.createElement("div",{ref:this.popoverContext},m.a.createElement(si.a,{siteId:t}),this.matchingSuggestions.length>0&&i&&m.a.createElement(ai.a,{query:o,suggestions:this.matchingSuggestions,selectedSuggestionId:s,popoverContext:this.popoverContext.current,onClick:this.insertSuggestion,onClose:this.hidePopover}))}}]),t}(p.Component);ci.propTypes={editor:U.a.object.isRequired,node:U.a.object.isRequired,siteId:U.a.number.isRequired,suggestions:U.a.array},ci.defaultProps={suggestions:[]};var di=Object(F.b)(function(e){var t=Object(Z.e)(e);return{siteId:t,suggestions:Object(ri.a)(e,t)}})(ci),ui=H.a.util.VK.ENTER;function pi(e){var t=document.createElement("div"),n=!1;e.on("init focus",function(){var a=e.getParam("redux_store"),o=Object(Z.d)(a.getState());n||!o||o.single_user_site||(t.setAttribute("class","mentions__container"),e.getContainer().appendChild(t),Object(hn.b)(m.a.createElement(di,{editor:e,node:t}),t,a),n=!0),n&&o&&o.single_user_site&&(L.a.unmountComponentAtNode(t),n=!1)}),e.on("keydown",function(e){document.querySelector(".user-mentions__suggestions")&&e.keyCode===ui&&e.preventDefault()})}var mi=n("./client/lib/create-selector/index.js"),hi=Object(mi.a)(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return null;var a=Object(v.get)(e,"memberships.productList.items."+t,null);if(!a)return null;if(!n)return Object(v.orderBy)(a,"ID","desc");var o=Object(v.find)(a,function(e){return e.ID===n});return o||null},function(e){return e.memberships.productList.items});function fi(e,t){return{siteId:e,type:"MEMBERSHIPS_PRODUCT_RECEIVE",product:t}}var gi=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"request",value:function(){this.props.requesting||this.props.siteId&&this.props.requestProducts(this.props.siteId)}},{key:"componentDidMount",value:function(){this.request()}},{key:"componentDidUpdate",value:function(e){this.props.siteId!==e.siteId&&this.request()}},{key:"render",value:function(){return null}}]),t}(p.Component);gi.propTypes={siteId:U.a.number.isRequired,requestProducts:U.a.func};var bi=Object(F.b)(null,{requestProducts:function(e){return{siteId:e,type:"MEMBERSHIPS_PRODUCTS_LIST"}}})(gi),vi=n("./client/components/data/query-site-plans/index.jsx"),yi=n("./client/components/notice/index.jsx"),Ei=n("./client/components/tinymce/plugins/simple-payments/dialog/navigation.jsx"),ji=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),wi=n.n(ji),_i=n("./node_modules/redux-form/es/getFormValues.js"),Ci=n("./node_modules/redux-form/es/isValid.js"),Si=n("./node_modules/redux-form/es/isDirty.js"),xi=n("./node_modules/redux-form/es/Fields.js"),ki=n("./node_modules/redux-form/es/reduxForm.js"),Ii=n("./client/components/forms/form-textarea/index.jsx"),Oi=n("./client/components/forms/form-currency-input/index.jsx"),Ti=n("./client/components/redux-forms/redux-form-fieldset/index.jsx"),Pi=n("./client/components/forms/form-select/index.jsx");function Di(){return function(e){return e({type:"MEMBERSHIPS_CONNECTED_ACCOUNTS_LIST"}),yt.a.req.get("/me/connected_accounts/list").then(function(t){var n=t.accounts.reduce(function(e,t){return e[t.connected_destination_account_id]=t,e},{});return e({type:"MEMBERSHIPS_CONNECTED_ACCOUNTS_RECEIVE",accounts:n}),Promise.resolve(n)})}}var Ni=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"componentDidMount",value:function(){this.props.isFetching||this.props.listMembershipsConnectedAccounts()}},{key:"render",value:function(){return null}}]),t}(p.Component),Ri=Object(F.b)(function(e){return{isFetching:Object(v.get)(e,["memberships","connectedAccounts","isFetching"],!1)}},{listMembershipsConnectedAccounts:Di})(Ni),Mi=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Ai=n.n(Mi),Li=n("./client/lib/sharing/index.js"),Bi=n("./node_modules/redux-form/es/index.js");function Ui(e,t){return Object(v.get)(e,["form",t,"values","stripe_account"],"")}var Fi=function(e){return Object(_i.a)("membershipsForm")(e)},qi=["USD","EUR","AUD","BRL","CAD","CZK","DKK","HKD","HUF","ILS","JPY","MYR","MXN","TWD","NZD","NOK","PHP","PLN","GBP","RUB","SGD","SEK","CHF","THB"].map(function(e){var t=Object(nn.b)(e),n=t.symbol,a=n===e?e:e+" "+Object(v.trimEnd)(n,".");return{code:e,label:a}});var zi=function(e){var t=e.price,n=e.currency,a=wi()(e,["price","currency"]),o=Object(nn.b)(n.input.value),i=o.precision,s=i>0?Object(v.padEnd)("1.",i+2,"0"):"1";return m.a.createElement(Ti.a,_()({inputComponent:Oi.a},t,Object(v.omit)(a,["names"]),{currencySymbolPrefix:n.input.value,onCurrencyChange:n.input.onChange,currencyList:qi,placeholder:s}))},Vi=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props.translate;return m.a.createElement("form",{className:"editor-simple-payments-modal__form"},m.a.createElement("div",{className:"editor-simple-payments-modal__form-fields"},m.a.createElement(Ti.b,{name:"title",label:e("What is this payment for?"),component:Ce.a,explanation:e("For example: event tickets, charitable donations, training courses, coaching fees, etc.")}),m.a.createElement(Ti.b,{name:"description",label:e("Description"),component:Ii.a}),m.a.createElement(xi.a,{names:["price","currency"],label:e("Price"),component:zi}),this.renderRecurringFields()))}},{key:"renderRecurringFields",value:function(){var e=this.props.translate;return m.a.createElement("div",null,m.a.createElement(Ri,null),m.a.createElement(Ti.b,{name:"stripe_account",explanation:e("This is the Stripe account where the funds will end up."),label:e("Stripe account"),component:Pi.a,children:Object.values(this.props.membershipsConnectedAccounts).map(function(e){return m.a.createElement("option",{value:e.connected_destination_account_id,key:e.connected_destination_account_id},e.payment_partner_account_id)}).concat([m.a.createElement("option",{value:"create",key:"create"},e("Create Stripe account for me")),m.a.createElement("option",{value:"authorize",key:"authorize"},e("I already have a Stripe account"))])}),this.props.isChoosingToAuthorizeStripeAccount&&m.a.createElement(J.a,{onClick:this.props.authorizeStripeAccount},e("Authorize Stripe account")),this.props.isChoosingToCreateStripeAccount&&m.a.createElement("div",null,m.a.createElement(Ti.b,{name:"email",label:e("Email"),explanation:e("New Stripe account will be tied to this email address."),component:Ce.a})),m.a.createElement(Ti.b,{name:"renewal_schedule",explanation:e("After what time should the subscription renew?"),label:e("Renewal Schedule"),component:Pi.a},m.a.createElement("option",{value:"1 month"},e("1 Month")),m.a.createElement("option",{value:"1 year"},e("1 Year"))))}}]),t}(p.Component),Hi=Object(v.flowRight)(h.localize,Object(ki.a)({form:"membershipsForm",enableReinitialize:!0,validate:function(e,t){var n,a,o=t.translate,i=Object(nn.b)(e.currency),s=i.precision,r={};if(e.title||(r.title=o("People need to know what they're paying for! Please add a brief title.")),e.price&&0!==parseFloat(e.price)){if(NaN===parseFloat(e.price))r.price=o("Invalid price");else if(parseFloat(e.price)<0)r.price=o("Your price is negative â€” now that doesn't sound right, does it?");else if(n=e.price,a=(""+n).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/),(a?Math.max(0,(a[1]?a[1].length:0)-(a[2]?+a[2]:0)):0)>s)if(0===s)r.price=o("We know every penny counts, but prices can't contain decimal values.");else{var l=o("%(precision)d decimal place","%(precision)d decimal places",{count:s,args:{precision:s}});r.price=o("Price cannot have more than %(countDecimal)s.",{args:{countDecimal:l}})}}else r.price=o("Everything comes with a price tag these days. Add yours here.");return e.renewal_schedule||(r.renewal_schedule="Please choose a renewal schedule"),e.stripe_account||(r.stripe_account="Choose or connect a new Stripe Account."),"create"!==e.stripe_account||e.email||(r.email=o("If you want us to create a Stripe account for you, you need to provide an email address.")),r}}),Object(F.b)(function(e){return{isChoosingToAuthorizeStripeAccount:"authorize"===Ui(e,"membershipsForm"),isChoosingToCreateStripeAccount:"create"===Ui(e,"membershipsForm"),membershipsConnectedAccounts:function(e){return Object(v.get)(e,["memberships","connectedAccounts","accounts"],{})}(e)}},{authorizeStripeAccount:function(){return function(e){return e({type:"MEMBERSHIPS_CONNECTED_ACCOUNTS_STRIPE_AUTHORIZE_REQUEST"}),yt.a.req.post("/me/stripe_connect/oauth/url").then(function(t){return Object(Li.a)(t.url,function(){return e(Di()).then(function(t){return e(Object(Bi.a)("simplePaymentsForm","stripe_account",Math.max.apply(Math,Ai()(Object.keys(t))),!1,!1))})})})}}}))(Vi),Wi=n("./client/components/tinymce/plugins/simple-payments/dialog/list.jsx"),Gi=n("./client/lib/accept/index.js"),Ki=n("./client/state/data-layer/wpcom/sites/memberships/index.js"),Yi=n("./client/my-sites/upgrade-nudge/index.jsx"),$i=n("./client/lib/analytics/track-component-view/index.jsx"),Ji=n("./client/components/banner/index.jsx"),Qi=function(e){return Array.isArray(e)&&0===e.length},Zi=function(e){return function(t,n){var a=Fi(n()),o=function(n){return yt.a.req.post("/sites/"+e+"/memberships/product",{title:n.title,description:n.description,connected_destination_account_id:n.stripe_account,interval:n.renewal_schedule,price:n.price,currency:n.currency}).then(function(n){var a=Object(Ki.b)(n.product);return t(fi(e,a)),a})};return"create"===a.stripe_account&&a.email?yt.a.req.post("/me/stripe_connect/create",{country:"US",email:a.email}).then(function(e){return a.stripe_account=e.result.account.connected_destination_account_id,o(a)}):o(a)}},Xi=function(e,t){return function(n,a){var o=Fi(a());return yt.a.req.post("/sites/"+e+"/memberships/product/"+t,{title:o.title,description:o.description,connected_destination_account_id:o.stripe_account,interval:o.renewal_schedule,price:o.price,currency:o.currency}).then(function(t){var a=Object(Ki.b)(t.product);return n(fi(e,a)),a})}},es=function(e,t){return function(n){var a=yt.a.site(e).post(t);return a.delete().then(function(){return a.delete()}).then(function(){return n(function(e,t){return{siteId:e,productId:t,type:"MEMBERSHIPS_PRODUCT_DELETE"}}(e,t))})}},ts=function(e){function t(e){var n;k()(this,t),n=P()(this,N()(t).call(this,e)),n.handleDialogClose=function(){n.checkUnsavedForm().then(function(e){return e&&n.props.onClose()})},n.handleChangeTabs=function(e){"form"===e?n.showButtonForm(null):n.checkUnsavedForm().then(function(e){return e&&n.showButtonList()})},n.showButtonForm=function(e){var t=n.getInitialFormFields(e);n.setState({activeTab:"form",editedPaymentId:e,initialFormValues:t})},n.handleSelectedChange=function(e){return n.setState({selectedPaymentId:e})},n.showError=function(e){return n._isMounted&&n.setState({errorMessage:e})},n.dismissError=function(){return n._isMounted&&n.setState({errorMessage:null})},n.handleInsert=function(){var e,t=n.props,a=t.siteId,o=t.dispatch,i=t.translate,s=n.state.activeTab;n.setIsSubmitting(!0),e="list"===s?Promise.resolve(n.state.selectedPaymentId):o(Zi(a)).then(function(e){return o(Object(Pn.i)("calypso_memberships_button_create",{price:e.price,currency:e.currency,id:e.ID})),e.ID}),e.then(function(e){return o(function(t,a){return hi(a(),n.props.siteId,e)})}).then(function(e){n.props.onInsert({id:e.ID,isMembership:!0}),o(Object(Pn.i)("calypso_simple_payments_button_insert",{id:e.ID}))}).catch(function(){return n.showError(i("The payment button could not be inserted."))}).then(function(){return n.setIsSubmitting(!1)})},n.handleSave=function(){n.setIsSubmitting(!0);var e=n.props,t=e.siteId,a=e.dispatch,o=e.translate,i=n.state.editedPaymentId;a(Xi(t,i)).then(n.handleFormClose).catch(function(){return n.showError(o("The payment button could not be updated."))}).then(function(){return n.setIsSubmitting(!1)})},n.handleFormClose=function(){n.isDirectEdit()?n.props.onClose():n.showButtonList()},n.handleTrash=function(e){var t=n.props.translate,a=t("Are you sure you want to delete this item? It will be disabled and removed from all locations where it currently appears.");Object(Gi.a)(a,function(a){if(a){n.setIsSubmitting(!0);var o=n.props,i=o.siteId,s=o.dispatch;s(Object(Pn.i)("calypso_simple_payments_button_delete",{id:e})),s(es(i,e)).catch(function(){return n.showError(t("The payment button could not be deleted."))}).then(function(){return n.setIsSubmitting(!1)})}},t("Delete"),null,{isScary:!0})},n._isMounted=!1;var a=n.props,o=a.editPaymentId,i=a.paymentButtons;return n.state={activeTab:o||Qi(i)?"form":"list",editedPaymentId:o,initialFormValues:n.getInitialFormFields(o),selectedPaymentId:null,isSubmitting:!1,errorMessage:null},n}return M()(t,e),O()(t,[{key:"componentDidUpdate",value:function(e){this.props.showDialog&&!e.showDialog&&(this.props.editPaymentId?this.showButtonForm(this.props.editPaymentId):Qi(this.props.paymentButtons)?this.showButtonForm(null):this.showButtonList())}},{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"getInitialFormFields",value:function(e){var t=this.constructor.initialFields,n=this.props,a=n.paymentButtons,o=n.currencyCode,i=n.currentUserEmail;if(Object(v.isNumber)(e)){var s=Object(v.find)(a,function(t){return t.ID===e});if(s)return Object(v.pick)(s,Object.keys(t))}var r=o||"USD",l=Object(v.get)(a,"0.email",i);return Fe()({},t,{currency:r,email:l})}},{key:"isDirectEdit",value:function(){return Object(v.isNumber)(this.props.editPaymentId)}},{key:"checkUnsavedForm",value:function(){var e=this,t="form"===this.state.activeTab&&this.props.formIsDirty;return t?new Promise(function(t){var n=e.props.translate;Object(Gi.a)(n("Wait! You have unsaved changes. Do you really want to discard them?"),t,n("Discard"),null,{isScary:!0})}):Promise.resolve(!0)}},{key:"showButtonList",value:function(){this.setState({activeTab:"list"})}},{key:"setIsSubmitting",value:function(e){this._isMounted&&this.setState({isSubmitting:e})}},{key:"getActionButtons",value:function(){var e,t,n,a,o=this.props,i=o.formIsValid,s=o.formIsDirty,r=o.translate,l=this.state,c=l.activeTab,d=l.editedPaymentId,u=l.isSubmitting,p=i&&s;return"form"===c&&Object(v.isNumber)(d)?(e=this.handleFormClose,t=this.handleSave,n=!p,a=r("Done")):(e=this.props.onClose,t=this.handleInsert,n="form"===c&&!p||"list"===c&&null===this.state.selectedPaymentId,a=r("Insert")),[m.a.createElement(J.a,{onClick:e,disabled:u},r("Cancel")),m.a.createElement(J.a,{onClick:t,busy:u,disabled:u||n,primary:!0},u?r("Savingâ€¦"):a)]}},{key:"renderEmptyDialog",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.props,a=n.onClose,o=n.translate,i=n.showDialog;return m.a.createElement(We.a,{isVisible:i,onClose:a,buttons:[m.a.createElement(J.a,{onClick:a},o("Close"))],additionalClassNames:"editor-simple-payments-modal"},m.a.createElement($i.a,{eventName:"calypso_simple_payments_dialog_view"}),!t&&m.a.createElement(Ei.a,{activeTab:"list",paymentButtons:[],onChangeTabs:v.noop}),e)}},{key:"returnTrue",value:function(){return!0}},{key:"render",value:function(){var e=this.props,t=e.showDialog,n=e.siteId,a=e.siteSlug,o=e.paymentButtons,i=e.currencyCode,s=e.isJetpackNotSupported,r=e.translate,l=e.planHasSimplePaymentsFeature,c=e.shouldQuerySitePlans,d=this.state,u=d.activeTab,p=d.initialFormValues,h=d.errorMessage,f="list"===u||"form"===u&&!this.isDirectEdit()&&!Qi(o);return!c&&s?this.renderEmptyDialog(m.a.createElement(Ha.a,{className:"upgrade-jetpack",illustration:"/calypso/images/illustrations/illustration-jetpack.svg",title:r("Upgrade Jetpack to use Simple Payments"),illustrationWidth:600,action:m.a.createElement(Ji.a,{icon:"star",title:r("Upgrade your Jetpack!"),description:r("Simple Payments requires Jetpack version 5.2 or later."),feature:rn.s,plan:rn.X,href:"../../plugins/jetpack/"+a})}),!0):c||l?m.a.createElement(We.a,{isVisible:t,onClose:this.handleDialogClose,buttons:this.getActionButtons(),additionalClassNames:"editor-simple-payments-modal"},m.a.createElement($i.a,{eventName:"calypso_simple_payments_dialog_view"}),m.a.createElement(bi,{siteId:n}),(!i||c)&&m.a.createElement(vi.a,{siteId:n}),f&&m.a.createElement(Ei.a,{activeTab:u,paymentButtons:o,onChangeTabs:this.handleChangeTabs}),h&&m.a.createElement(yi.b,{status:"is-error",text:h,onDismissClick:this.dismissError}),"form"===u?m.a.createElement(Hi,{initialValues:p,showError:this.showError}):m.a.createElement(Wi.a,{siteId:n,paymentButtons:o,selectedPaymentId:this.state.selectedPaymentId,onSelectedChange:this.handleSelectedChange,onTrashClick:this.handleTrash,onEditClick:this.showButtonForm})):this.renderEmptyDialog(m.a.createElement(Ha.a,{illustration:"/calypso/images/illustrations/type-e-commerce.svg",illustrationWidth:300,title:r("Want to add a payment button to your site?"),action:m.a.createElement(Yi.a,{className:"editor-simple-payments-modal__nudge-nudge",title:r("Upgrade your plan to our Premium or Business plan!"),message:r("Get simple payments, advanced social media tools, your own domain, and more."),feature:rn.s,event:"editor_simple_payments_modal_nudge",shouldDisplay:this.returnTrue}),secondaryAction:m.a.createElement("a",{className:"empty-content__action button",href:"https://support.wordpress.com/simple-payments/"},r("Learn more about Simple Payments"))}),!0)}}]),t}(p.Component);ts.propTypes={showDialog:U.a.bool.isRequired,editPaymentId:U.a.number,onClose:U.a.func.isRequired,onInsert:U.a.func.isRequired,isJetpackNotSupported:U.a.bool},ts.initialFields={title:"",description:"",price:"",currency:"USD",email:"",recurring:!1,stripe_account:"",renewal_schedule:"1 year"};var ns=Object(F.b)(function(e,t){var n=t.siteId;return n||(n=Object(Z.e)(e)),{siteId:n,siteSlug:Object(ge.w)(e,n),paymentButtons:hi(e,n),currencyCode:Object(wa.d)(e),shouldQuerySitePlans:null===Object(sn.g)(e,n),isJetpackNotSupported:Object(ge.K)(e,n)&&!Object(ge.I)(e,n,"5.2"),planHasSimplePaymentsFeature:Object(sn.i)(e,n,rn.s),formIsValid:function(e){return Object(Ci.a)("membershipsForm")(e)}(e),formIsDirty:function(e){return Object(Si.a)("membershipsForm")(e)}(e),currentUserEmail:Object(wa.f)(e)}})(Object(h.localize)(ts)),as=function(e){var t,n=e.getParam("redux_store");e.on("init",function(){t=e.getContainer().appendChild(document.createElement("div"))}),e.on("remove",function(){Object(A.unmountComponentAtNode)(t),t.parentNode.removeChild(t),t=null}),e.addCommand("membershipsButton",function(a){var o=null;if(a){var i=Xt(a);o=i.id||null}!function a(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";Object(hn.b)(Object(p.createElement)(ns,{showDialog:"show"===i,editPaymentId:o,onInsert:function(t){e.execCommand("mceInsertContent",!1,Zt(t)),a("hide")},onClose:function(){e.focus(),a("hide")}}),t,n)}()})};function os(e){e.on("preinit",function(e){var t=e.target;Object.keys(t.schema.elements).forEach(function(e){t.schema.elements[e].attributes.markdown={},t.schema.elements[e].attributesOrder.push("markdown")})})}var is=n("./node_modules/twemoji/2/twemoji.npm.js"),ss=n.n(is);function rs(e){var t,n=!1,a=H.a.Env,o=window.navigator.userAgent,i=o.indexOf("Windows")>-1,s=(t=o.match(/Windows NT 6\.(\d)/),!!(t&&t[1]>1));function r(t){var n,o;t&&ss.a.test(t.textContent||t.innerText)&&(a.webkit&&(n=e.selection,o=n.getBookmark()),function(e){ss.a.parse(e,{base:Object(Qt.a)("twemoji_cdn_url"),size:"72x72",attributes:function(){return{"data-mce-resize":"false","data-mce-placeholder":"1","data-wp-emoji":"1"}},callback:function(e,t){return-1===["a9","ae","2122","2194","2660","2663","2665","2666"].indexOf(e)&&"".concat(t.base,t.size,"/",e,t.ext)}})}(t),a.webkit&&n.moveToBookmark(o))}s?e.on("keyup",function(t){231===t.keyCode&&r(e.selection.getNode())}):i||(e.on("keydown keyup",function(e){n="keydown"===e.type}),e.on("input",function(){n||r(e.selection.getNode())})),e.on("setcontent",function(){r(e.selection.getNode())}),e.on("PastePostProcess",function(t){H.a.each(e.dom.$("img.emoji",t.node),function(e){e.alt&&ss.a.test(e.alt)&&function(e){e.className="emoji",e.setAttribute("data-mce-resize","false"),e.setAttribute("data-mce-placeholder","1"),e.setAttribute("data-wp-emoji","1")}(e)})}),e.on("postprocess",function(e){e.content&&(e.content=e.content.replace(/<img[^>]+data-wp-emoji="[^>]+>/g,function(e){var t=e.match(/alt="([^"]+)"/);return t&&t[1]?t[1]:e}))}),e.on("resolvename",function(t){"IMG"===t.target.nodeName&&e.dom.getAttrib(t.target,"data-wp-emoji")&&t.preventDefault()})}var ls=n("./client/components/tinymce/i18n.js"),cs=n("./client/state/selectors/get-current-locale-slug.js"),ds=n("./client/state/selectors/is-rtl.js");[function(){H.a.PluginManager.add("wpcom",Ve)},function(){H.a.PluginManager.add("wpcom/autoresize",He)},function(){H.a.PluginManager.add("wpcom/help",$e)},function(){H.a.PluginManager.add("wpcom/charmap",Ze)},function(){H.a.PluginManager.add("wpcom/view",fn)},function(){H.a.PluginManager.add("wpcom/sourcecode",vn)},function(){H.a.PluginManager.add("wpeditimage",yn)},En.a,function(){H.a.PluginManager.add("wpcom/insertmenu",Fo)},function(){H.a.PluginManager.add("wpcom/media",ua)},function(){H.a.PluginManager.add("wpcom/advanced",ha)},function(){H.a.PluginManager.add("wpcom/tabindex",fa)},function(){H.a.PluginManager.add("wpcom/trackpaste",Ea)},function(){H.a.PluginManager.add("wpcom/touchscrolltoolbar",ja)},function(){H.a.PluginManager.add("wpcom/editorbuttonanalytics",xa)},function(){H.a.PluginManager.add("wpcom/calypsoalert",Oa)},function(){H.a.PluginManager.add("wpcom/contactform",go)},function(){H.a.PluginManager.add("AtD",Mo)},function(){H.a.PluginManager.add("wptextpattern",Ao)},function(){H.a.PluginManager.add("wpcom/toolbarpin",Lo)},function(){H.a.PluginManager.add("embed",zo)},function(){H.a.PluginManager.add("wpcom/embedreversal",Vo)},function(){H.a.PluginManager.add("wpcom/markdown",os)},function(){H.a.PluginManager.add("wpemoji",rs)},function(){H.a.PluginManager.add("wpcom/simplepayments",vo)}].forEach(function(e){return e()});var us=1,ps="/do-not-load/",ms={activate:"onActivate",blur:"onBlur",change:"onChange",input:"onInput",keyUp:"onKeyUp",deactivate:"onDeactivate",focus:"onFocus",hide:"onHide",init:"onInit",mouseUp:"onMouseUp",redo:"onRedo",remove:"onRemove",reset:"onReset",show:"onShow",submit:"onSubmit",undo:"onUndo",setContent:"onSetContent"},hs=["colorpicker","embed","hr","lists","media","paste","tabfocus","textcolor","wptextpattern","wpcom","wpeditimage","wplink","AtD","directionality","wpemoji","wpcom/autoresize","wpcom/media","wpcom/advanced","wpcom/help","wpcom/charmap","wpcom/tabindex","wpcom/touchscrolltoolbar","wpcom/view","wpcom/editorbuttonanalytics","wpcom/calypsoalert","wpcom/tabindex","wpcom/toolbarpin","wpcom/contactform","wpcom/sourcecode","wpcom/embedreversal","wpcom/trackpaste","wpcom/insertmenu","wpcom/markdown","wpcom/simplepayments"];Qt.a.isEnabled("memberships")&&(H.a.PluginManager.add("wpcom/memberships",as),hs.push("wpcom/memberships")),H.a.PluginManager.add("wpcom/mentions",pi),hs.push("wpcom/mentions");var fs=[window.app.staticUrls["tinymce/skins/wordpress/wp-content.css"],"//s1.wp.com/wp-includes/css/dashicons.css?v=20150727",window.app.staticUrls["editor.css"],"https://fonts.googleapis.com/css?family=Noto+Serif:400,400i,700,700i&subset=cyrillic,cyrillic-ext,greek,greek-ext,latin-ext,vietnamese"],gs=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={content:"",selection:null},n._editor=null,n.destroyEditor=function(){Object(v.forEach)(ms,function(e,t){this.props[e]&&this._editor.off(t,this.props[e])}.bind(we()(we()(n)))),H.a.remove(n._editor),n._editor=null,ze.a.destroy(L.a.findDOMNode(n.refs.text))},n.doAutosizeUpdate=function(){ze.a.update(L.a.findDOMNode(n.refs.text))},n.bindEditorEvents=function(e){e=e||{},Object(v.forEach)(ms,function(t,n){e[t]!==this.props[t]&&(this.props[t]?this._editor.on(n,this.props[t]):this._editor.off(n,this.props[t]))}.bind(we()(we()(n))))},n.toggleEditor=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{autofocus:!0};if(n._editor){if("html"===n.props.mode)return n._editor.hide(),n.doAutosizeUpdate(),void(e.autofocus&&n.focusEditor());n._editor.show(),e.autofocus&&n.focusEditor()}},n.focusEditor=function(){if("html"===n.props.mode){var e=L.a.findDOMNode(n.refs.text);n.state.selection?n.selectTextInTextArea(n.state.selection):e.setSelectionRange(0,0),11!==H.a.Env.ie&&e.focus()}else n._editor&&n._editor.focus()},n.getContent=function(e){if("html"===n.props.mode)return n.state.content;if(!n._editor)return"";var t=n._editor.getContent(e);return e&&"raw"===e.format||(t=t.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>"),t=Object(oe.e)(t)),t},n.isDirty=function(){return!!n._editor&&n._editor.isDirty()},n.setTextAreaContent=function(e){n.setState({content:Object(oe.b)(e)},n.doAutosizeUpdate)},n.setEditorContent=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n._editor){var a=n.props.mode;n._editor.setContent(Object(oe.g)(e),Fe()({},t,{mode:a})),t.initial&&n._editor.undoManager.clear()}n.setTextAreaContent(e)},n.setSelection=function(e){n.setState({selection:e})},n.selectTextInTextArea=function(e){if(e){var t=L.a.findDOMNode(n.refs.text),a=e.start,o=e.end||e.start;t.setSelectionRange(a,o),n.setState({selection:null})}},n.onTextAreaChange=function(e){var t=e.target.value;n.props.onTextEditorChange&&n.props.onTextEditorChange(t),n.setState({content:t},n.doAutosizeUpdate)},n.onToolbarChangeContent=function(e){n.props.onTextEditorChange&&n.props.onTextEditorChange(e),n.setState({content:e},n.doAutosizeUpdate)},n.localize=function(e,t){var n=ls.a;e&&(n=Object(v.assign)({_dir:"rtl"},n)),H.a.addI18n(t,n),H.a.ScriptLoader.markDone(ps)},n}return M()(t,e),O()(t,[{key:"componentWillMount",value:function(){this._id="tinymce-"+us,us++}},{key:"componentDidUpdate",value:function(e){this._editor&&(this.bindEditorEvents(e),this.props.mode!==e.mode&&this.toggleEditor())}},{key:"componentDidMount",value:function(){this.mounted=!0;var e=function(e){var t=this;this._editor=e,this.mounted?(this.bindEditorEvents(),e.on("SetTextAreaContent",function(e){return t.setTextAreaContent(e.content)}),e.once("PostRender",this.toggleEditor.bind(this,{autofocus:!this.props.isNew}))):this.destroyEditor()}.bind(this),t=this.context.store,n=!1,a="en";if(t){var o=t.getState();n=Object(ds.a)(o),a=Object(cs.a)(o)}this.localize(n,a);var i=n?"ltr,":"";H.a.init({selector:"#"+this._id,skin_url:"/calypso/tinymce/skins/lightgray",skin:"lightgray",content_css:fs,language:a,language_url:ps,directionality:n?"rtl":"ltr",formats:{alignleft:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"}},{selector:"img,table,dl.wp-caption",classes:"alignleft"}],aligncenter:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"}},{selector:"img,table,dl.wp-caption",classes:"aligncenter"}],alignright:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"}},{selector:"img,table,dl.wp-caption",classes:"alignright"}],strikethrough:{inline:"del"}},relative_urls:!1,remove_script_host:!1,convert_urls:!1,branding:!1,browser_spellcheck:!0,fix_list_elements:!0,entities:"38,amp,60,lt,62,gt",entity_encoding:"raw",keep_styles:!1,wpeditimage_html5_captions:!0,redux_store:this.context.store,textarea:this.refs.text,preview_styles:"font-family font-size font-weight font-style text-decoration text-transform",end_container_on_empty_block:!0,plugins:hs.join(),statusbar:!1,resize:!1,menubar:!1,indent:!1,atd_rpc_id:"https://wordpress.com",atd_ignore_enable:!0,autoresize_min_height:Math.max(document.documentElement.clientHeight-300,300),autoresize_bottom_margin:Object(De.c)()?10:50,toolbar1:"wpcom_insert_menu,formatselect,bold,italic,bullist,numlist,link,blockquote,alignleft,aligncenter,alignright,spellchecker,wp_more,"+i+"wpcom_advanced",toolbar2:"strikethrough,underline,hr,alignjustify,forecolor,pastetext,removeformat,wp_charmap,outdent,indent,undo,redo,wp_help",toolbar3:"",toolbar4:"",tabfocus_elements:"content-html,save-post",tabindex:this.props.tabIndex,body_class:"content post-type-post post-status-draft post-format-standard locale-en-us",add_unload_trigger:!1,setup:e}),ze()(L.a.findDOMNode(this.refs.text))}},{key:"componentWillUnmount",value:function(){this.mounted=!1,this._editor&&this.destroyEditor()}},{key:"render",value:function(){var e=this.props.mode,t=z()({tinymce:!0,"is-visible":"html"===e}),n=z()("tinymce-container","editor-mode-"+e);return m.a.createElement("div",{className:n},"html"===e&&Qt.a.isEnabled("post-editor/html-toolbar")&&m.a.createElement(ni,{content:this.refs.text,onToolbarChangeContent:this.onToolbarChangeContent}),m.a.createElement("textarea",{ref:"text",className:t,id:this._id,onChange:this.onTextAreaChange,tabIndex:this.props.tabIndex,value:this.state.content}))}}]),t}(m.a.Component);gs.displayName="TinyMCE",gs.propTypes={isNew:U.a.bool,mode:U.a.string,tabIndex:U.a.number,onActivate:U.a.func,onBlur:U.a.func,onChange:U.a.func,onDeactivate:U.a.func,onFocus:U.a.func,onHide:U.a.func,onInit:U.a.func,onInput:U.a.func,onKeyUp:U.a.func,onMouseUp:U.a.func,onRedo:U.a.func,onRemove:U.a.func,onReset:U.a.func,onShow:U.a.func,onSubmit:U.a.func,onSetContent:U.a.func,onUndo:U.a.func,onTextEditorChange:U.a.func},gs.contextTypes={store:U.a.object},gs.defaultProps={mode:"tinymce",isNew:!1};var bs=n("./client/components/segmented-control/index.jsx"),vs=n("./client/components/segmented-control/item.jsx"),ys=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={isPage:n.isPage()},n.startNewPage=function(){var e=Object(j.d)(s.a.current),t=n.state.isPage?"/page/":"/post/";s()(t+e)},n}return M()(t,e),O()(t,[{key:"isPage",value:function(){return Object(v.startsWith)(s.a.current,"/page/")}},{key:"getDialogButtons",value:function(){var e=this.state.isPage?this.props.translate("New Page"):this.props.translate("New Post");return[m.a.createElement(Ge.a,{key:"startNewPage",isPrimary:!0,onClick:this.startNewPage},e),m.a.createElement(Ge.a,{key:"back",isPrimary:!1,onClick:this.props.onClose},this.props.translate("Close"))]}},{key:"getStrings",value:function(e){return e?{dialogTitle:this.props.translate("Invalid Page Address"),dialogContent:this.props.translate("This page cannot be found. Check the web address or start a new page.")}:{dialogTitle:this.props.translate("Invalid Post Address"),dialogContent:this.props.translate("This post cannot be found. Check the web address or start a new post.")}}},{key:"render",value:function(){var e=this.getStrings(this.state.isPage);return m.a.createElement(We.a,{isVisible:!0,buttons:this.getDialogButtons()},m.a.createElement("h1",null,e.dialogTitle),m.a.createElement("p",null,e.dialogContent))}}]),t}(m.a.Component);ys.displayName="EditorTrashedDialog",ys.defaultProps={onClose:v.noop},ys.propTypes={onClose:U.a.func};var Es=Object(h.localize)(ys),js=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.getStrings=function(){var e=n.props,t=e.isAutosave,a=e.postType,o=e.translate,i="page"===a;return t?i?{dialogTitle:o("Saved Draft"),dialogContent:o("A more recent revision of this page exists. Restore?")}:{dialogTitle:o("Saved Draft"),dialogContent:o("A more recent revision of this post exists. Restore?")}:i?{dialogTitle:o("Deleted Page"),dialogContent:o("This page has been sent to the trash. Restore it to continue writing.")}:{dialogTitle:o("Deleted Post"),dialogContent:o("This post has been sent to the trash. Restore it to continue writing.")}},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.onClose,n=e.onRestore,a=e.translate,o=this.getStrings(),i=[m.a.createElement(Ge.a,{key:"restore",isPrimary:!0,onClick:n},a("Restore")),m.a.createElement(Ge.a,{key:"back",isPrimary:!1,onClick:t},a("Don't restore"))];return m.a.createElement(We.a,{isVisible:!0,buttons:i},m.a.createElement("h1",null,o.dialogTitle),m.a.createElement("p",null,o.dialogContent))}}]),t}(p.Component);js.propTypes={translate:U.a.func,onClose:U.a.func,onRestore:U.a.func,isAutosave:U.a.bool,postType:U.a.string},js.defaultProps={onClose:v.noop,onRestore:v.noop,isAutosave:!1};var ws=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.c)(e,t,n,"type");return{postType:a}})(Object(h.localize)(js)),_s=n("./client/components/email-verification/email-verification-dialog/index.jsx"),Cs=n("./node_modules/url/url.js"),Ss=n.n(Cs),xs=n("./client/lib/url/index.js"),ks=n("./client/components/web-preview/index.jsx"),Is=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={iframeUrl:"about:blank"},n._hasTouch=!1,n.didStartSaving=function(e,t){return!(!e||!t)&&(t.isSaving&&!e.isSaving)},n.didFinishSaving=function(e){return e.isSaving&&!n.props.isSaving},n.didLoad=function(e){return e&&e.isLoading&&!n.props.isLoading},n.didShowSavedPreviewViaTouch=function(e){return n._hasTouch&&!e.showPreview&&n.props.showPreview&&!n.props.isSaving&&!n.props.isLoading},n.didShowOrHideFullPreview=function(e){return Object(Qt.b)("post-editor/preview-scroll-to-content")&&"about:blank"!==n.state.iframeUrl&&e.showPreview!==n.props.showPreview},n.getIframePreviewUrl=function(){var e=Ss.a.parse(n.props.previewUrl,!0);return e.query.preview="true",e.query.iframe="true",e.query.revision=String(n.props.revision),n.props.postId&&Object(Qt.b)("post-editor/preview-scroll-to-content")&&(n.props.showPreview?e.hash="post-"+n.props.postId:e.hash="__preview-hidden"),delete e.search,Ss.a.format(e)},n.cleanExternalUrl=function(e){return Object(xs.h)(e,["iframe","frame-nonce"])},n}return M()(t,e),O()(t,[{key:"componentDidUpdate",value:function(e){this.didStartSaving(e,this.props)&&this.setState({iframeUrl:"about:blank"}),this.props.previewUrl&&(this.didFinishSaving(e)||this.didLoad(e)||this.didShowSavedPreviewViaTouch(e)||this.didShowOrHideFullPreview(e))&&this.setState({iframeUrl:this.getIframePreviewUrl()})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.keyDown)}},{key:"render",value:function(){var e=this.props.isFullScreen,t=z()("editor-preview",{"is-fullscreen":e});return m.a.createElement("div",{className:t},e?m.a.createElement(ks.a,{isContentOnly:!0,showPreview:this.props.showPreview,showEdit:!0,showExternal:!0,showUrl:!0,onClose:this.props.onClose,onEdit:this.props.onEdit,previewUrl:this.state.iframeUrl,editUrl:this.props.editUrl,externalUrl:this.cleanExternalUrl(this.props.externalUrl),loadingMessage:this.props.translate("{{strong}}One moment, please.{{/strong}} We're loading your preview.",{components:{strong:m.a.createElement("strong",null)}})}):m.a.createElement(ks.a,{showPreview:this.props.showPreview,onClose:this.props.onClose,previewUrl:this.state.iframeUrl,externalUrl:this.cleanExternalUrl(this.props.externalUrl)}))}}]),t}(m.a.Component);Is.propTypes={showPreview:U.a.bool,isSaving:U.a.bool,isLoading:U.a.bool,isFullScreen:U.a.bool,previewUrl:U.a.string,editUrl:U.a.string,onClose:U.a.func,postId:U.a.number,revision:U.a.number};var Os=Object(h.localize)(Is),Ts=n("./client/state/ui/layout-focus/actions.js"),Ps=function(){return function(e){e(Object(pa.b)("editor-sidebar","closed")),e(Object(Pn.k)(Object(Pn.b)(Object(Pn.i)("calypso_editor_sidebar_toggle_close"),Object(Pn.g)("Editor","Sidebar Toggle","close"),Object(Pn.a)("editor_actions","close-sidebar")),Object(Ts.b)("content")))}},Ds=n("./client/state/selectors/edited-post-has-content.js"),Ns=n("./client/state/selectors/has-broken-site-user-connection.js"),Rs=n("./client/components/post-schedule/index.jsx"),Ms=n("./client/components/data/query-posts/index.jsx"),As=n("./client/lib/site/utils.js"),Ls=Object(F.b)(function(e,t){var n=t.site,a=t.query;return{posts:Object(ee.i)(e,Object(v.get)(n,"ID"),a)||[]}})(function(e){var t=e.onDateChange,n=e.onMonthChange,a=e.posts,o=e.selectedDay,i=e.site;return m.a.createElement(Rs.a,{displayInputChrono:!1,selectedDay:o,onDateChange:t,onMonthChange:n,posts:a,site:i})}),Bs=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={firstDayOfTheMonth:n.getFirstDayOfTheMonth(n.props.initialDate),lastDayOfTheMonth:n.getLastDayOfTheMonth(n.props.initialDate)},n.setCurrentMonth=function(e){n.setState({firstDayOfTheMonth:n.getFirstDayOfTheMonth(e),lastDayOfTheMonth:n.getLastDayOfTheMonth(e)})},n}return M()(t,e),O()(t,[{key:"getFirstDayOfTheMonth",value:function(e){var t=Object(As.f)(this.props.site);return ae.i(e,t).set({year:e.year(),month:e.month(),date:1,hours:0,minutes:0,seconds:0,milliseconds:0})}},{key:"getLastDayOfTheMonth",value:function(e){return this.getFirstDayOfTheMonth(e).add(1,"month").second(-1)}},{key:"render",value:function(){var e=this.props,t=e.post,n=e.setPostDate,a=e.site,o={status:"publish,future",before:this.state.lastDayOfTheMonth.format(),after:this.state.firstDayOfTheMonth.format(),number:100};return m.a.createElement("div",null,!ae.w(t)&&m.a.createElement(Ms.a,{siteId:Object(v.get)(a,"ID"),query:o}),m.a.createElement(Ls,{onDateChange:n,onMonthChange:this.setCurrentMonth,query:o,selectedDay:Object(v.get)(t,"date"),site:a}))}}]),t}(p.PureComponent);Bs.propTypes={initialDate:U.a.object.isRequired,post:U.a.object,setPostDate:U.a.func,site:U.a.object};var Us=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={isOpen:!1},n.handleOutsideClick=function(e){var t="string"==typeof e.target.className?e.target.className.split(/\s/):[],a=Object(v.intersection)(t,["DayPicker-Day","date-picker__day"]).length>0,o=L.a.findDOMNode(n.refs.editorPublishDateWrapper).contains(e.target);a||o||n.setState({isOpen:!1})},n.setImmediate=function(){n.props.setPostDate(!1),n.setState({isOpen:!1})},n.toggleOpenState=function(){n.setState({isOpen:!n.state.isOpen})},n}return M()(t,e),O()(t,[{key:"componentWillUnmount",value:function(){window.removeEventListener("click",this.handleOutsideClick)}},{key:"componentDidUpdate",value:function(){this.state.isOpen?window.addEventListener("click",this.handleOutsideClick):window.removeEventListener("click",this.handleOutsideClick)}},{key:"getHeaderDescription",value:function(){var e=ae.v(this.props.post),t=ae.r(this.props.post),n=ae.z(this.props.post);return n&&e?this.props.translate("Scheduled"):e?this.props.translate("Schedule"):n?this.props.translate("Published"):t?this.props.translate("Backdate"):this.props.translate("Publish Immediately")}},{key:"renderCalendarHeader",value:function(){var e=ae.v(this.props.post),t=ae.r(this.props.post),n=ae.z(this.props.post);if(!n)return e||t?m.a.createElement(J.a,{borderless:!0,className:"editor-publish-date__immediate",onClick:this.setImmediate},this.props.translate("Cancel scheduling")):m.a.createElement("div",{className:"editor-publish-date__choose-header"},this.props.translate("Choose a date to schedule"))}},{key:"renderHeader",value:function(){var e=ae.v(this.props.post),t=ae.r(this.props.post),n=ae.z(this.props.post),a=z()("editor-publish-date__header",{"is-scheduled":e,"is-back-dated":t,"is-published":n}),o=this.props.post&&this.props.post.date?this.props.post.date:null;return m.a.createElement("div",{className:a,onClick:this.toggleOpenState},m.a.createElement(Y.a,{className:"editor-publish-date__header-icon",icon:"calendar",size:18}),m.a.createElement("div",{className:"editor-publish-date__header-wrapper"},m.a.createElement("div",{className:"editor-publish-date__header-description"},this.getHeaderDescription()),(e||t||n)&&m.a.createElement("div",{className:"editor-publish-date__header-chrono"},this.props.moment(o).calendar())),m.a.createElement(Y.a,{className:"editor-publish-date__header-chevron",icon:"chevron-down",size:18}))}},{key:"renderSchedule",value:function(){var e=this.props.post&&this.props.post.date?this.props.post.date:null,t=ae.v(this.props.post),n=z()("editor-publish-date__schedule",{"is-scheduled":t});return m.a.createElement("div",{className:n},this.renderCalendarHeader(),m.a.createElement(Bs,{post:this.props.post,site:this.props.site,initialDate:this.props.moment(),setPostDate:this.props.setPostDate,selectedDay:e}))}},{key:"render",value:function(){var e=z()("editor-publish-date",{"is-open":this.state.isOpen});return m.a.createElement("div",{className:e},m.a.createElement("div",{className:"editor-publish-date__wrapper",ref:"editorPublishDateWrapper"},this.renderHeader(),this.state.isOpen&&this.renderSchedule()))}}]),t}(m.a.Component);Us.propTypes={post:U.a.object,setPostDate:U.a.func};var Fs=Object(F.b)(function(e){return{site:Object(Z.d)(e)}})(Object(h.localize)(Us)),qs=n("./client/lib/touch-detect/index.js"),zs=n("./client/state/selectors/is-private-site.js"),Vs=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={passwordIsValid:!0},n.getVisibility=function(){return n.props.password?"password":"private"===n.props.status?"private":"public"},n.recordStats=function(e){n.getVisibility()!==e&&(n.props.recordEditorStat("visibility-set-"+e),n.props.recordEditorEvent("Changed visibility",e),n.props.recordTracksEvent("calypso_editor_visibility_set",{context:n.props.context,visibility:e}))},n.onPrivatePublish=function(){n.setPostToPrivate(),setTimeout(function(){return n.props.onPrivatePublish(!0)},0)},n.onSetToPrivate=function(){var e;"private"!==n.props.savedStatus?(e="page"===n.props.type?n.props.translate("Private pages are only visible to administrators and editors of this site. Would you like to privately publish this page now?"):n.props.translate("Private posts are only visible to administrators and editors of this site. Would you like to privately publish this post now?"),Object(Gi.a)(e,function(e){e&&n.onPrivatePublish()},n.props.translate("Yes"),n.props.translate("No"))):n.setPostToPrivate()},n.onPasswordChange=function(e){var t=n.props,a=t.siteId,o=t.postId,i=e.target.value.trim(),s=i.length>0;n.setState({passwordIsValid:s}),s||(i=" "),n.props.editPost(a,o,{password:i})},n.renderPrivacyDropdown=function(e){var t=n.props.translate("Public",{context:"Editor: Radio label to set post visible to public"}),a=n.props.translate("Site Members",{context:"Editor: Radio label to set post visible to public on a private site so that only site members can see it"}),o=[{label:n.props.isPrivateSite?a:t,icon:m.a.createElement(Y.a,{icon:"globe",size:18}),value:"public",onClick:function(){n.updateVisibility("public")}},{label:n.props.translate("Admins and Editors",{context:"Editor: Radio label to set post to private so that only admins and editors can see it"}),icon:m.a.createElement(Y.a,{icon:"user",size:18}),value:"private",onClick:n.onSetToPrivate},{label:n.props.translate("Password Protected",{context:"Editor: Radio label to set post to password protected"}),icon:m.a.createElement(Y.a,{icon:"lock",size:18}),value:"password",onClick:function(){n.updateVisibility("password")}}],i=Object(v.find)(o,["value",e]);return m.a.createElement("div",{className:"editor-visibility__dropdown"},m.a.createElement(ea.a,{className:"editor-fieldset"},m.a.createElement(Qa.a,{selectedText:i?i.label:n.props.translate("Select an option"),selectedIcon:i.icon},o.map(function(t){return m.a.createElement(Za.a,{selected:t.value===e,key:t.value,value:t.value,onClick:t.onClick,icon:t.icon},t.label)})),"password"===e?n.renderPasswordInput():null))},n}return M()(t,e),O()(t,[{key:"componentWillReceiveProps",value:function(e){if(this.props.password!==e.password){var t=this.props.password+"",n=e.password+"",a=""===t&&" "===n,o=n.trim().length>0,i=a||o;this.setState({passwordIsValid:i})}}},{key:"updateVisibility",value:function(e){var t=this.props,n=t.siteId,a=t.postId,o=t.status,i="draft"===o?"draft":"publish",s={status:i};switch(e){case"public":s.password="";break;case"password":s.password=this.props.savedPassword||" ",s.sticky=!1,this.setState({passwordIsValid:!0})}this.props.editPost(n,a,s),this.recordStats(e)}},{key:"setPostToPrivate",value:function(){var e=this.props,t=e.siteId,n=e.postId;this.props.editPost(t,n,{status:"private",password:"",sticky:!1}),this.recordStats("private")}},{key:"renderPasswordInput",value:function(){var e=this.props.password?this.props.password.trim():null,t=!this.state.passwordIsValid,n=this.props.translate("Password is empty.",{context:"Editor: Error shown when password is empty."});return m.a.createElement("div",null,m.a.createElement(Ce.a,{autoFocus:!0,onChange:this.onPasswordChange,onBlur:this.onPasswordChange,value:e,isError:t,placeholder:this.props.translate("Create password",{context:"Editor: Create password for post"})}),t?m.a.createElement(Da.a,{isError:!0,text:n}):null)}},{key:"render",value:function(){if(!this.props.hasPost)return null;var e=this.getVisibility(),t=z()("editor-visibility",{"is-touch":Object(qs.a)()});return m.a.createElement("div",{className:t},this.renderPrivacyDropdown(e))}}]),t}(m.a.Component);Vs.propTypes={context:U.a.string,onPrivatePublish:U.a.func,isPrivateSite:U.a.bool,hasPost:U.a.bool,type:U.a.string,status:U.a.string,password:U.a.string,savedStatus:U.a.string,savedPassword:U.a.string,siteId:U.a.number,postId:U.a.number};var Hs=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.l)(e,t,n),o=Object(ee.a)(e,t,n);return{siteId:t,postId:n,hasPost:!!o,type:Object(v.get)(o,"type",null),status:Object(v.get)(o,"status","draft"),password:Object(v.get)(o,"password",null),savedStatus:Object(v.get)(a,"status",null),savedPassword:Object(v.get)(a,"password",null),isPrivateSite:Object(zs.a)(e,t)}},{editPost:E.e,recordEditorStat:Q.b,recordEditorEvent:Q.a,recordTracksEvent:Pn.i})(Object(h.localize)(Vs)),Ws=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"renderPublishHeader",value:function(){var e=this.props.translate;return m.a.createElement("div",{className:"editor-confirmation-sidebar__header"},e("{{strong}}Almost there!{{/strong}} Double-check your settings, then use the big green button to publish!",{comment:"This string appears as the header for the confirmation sidebar when a user publishes a post.",components:{strong:m.a.createElement("strong",null)}}))}},{key:"renderScheduleHeader",value:function(){var e=this.props.translate;return m.a.createElement("div",{className:"editor-confirmation-sidebar__header"},e("{{strong}}Almost there!{{/strong}} Double-check your settings below, then use the big green button to schedule!",{comment:"This string appears as the header for the confirmation sidebar when a user schedules the publishing of a post.",components:{strong:m.a.createElement("strong",null)}}))}},{key:"render",value:function(){var e=ae.v(this.props.post);return e?this.renderScheduleHeader():this.renderPublishHeader()}}]),t}(p.PureComponent);Ws.propTypes={post:U.a.object};var Gs=Object(h.localize)(Ws),Ks=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.getCloseOverlayHandler=function(e){return function(){return n.props.setStatus({status:"closed",context:e})}},n.closeAndPublish=function(){n.props.setStatus({status:"closed",context:"publish"}),n.props.onPublish(!0)},n}return M()(t,e),O()(t,[{key:"getPublishButtonLabel",value:function(e){switch(e){case"update":return this.props.translate("Update");case"schedule":return this.props.translate("Schedule!");case"publish":return this.props.translate("Publish!");case"requestReview":return this.props.translate("Submit for Review")}}},{key:"renderPublishButton",value:function(){if(null===this.props.publishButtonStatus)return null;var e=this.getPublishButtonLabel(this.props.publishButtonStatus),t=this.props.isPasswordProtectedWithInvalidPassword;return m.a.createElement(J.a,{disabled:t,onClick:this.closeAndPublish},e)}},{key:"getBusyButtonLabel",value:function(e){switch(e){case"update":return this.props.translate("Updatingâ€¦");case"schedule":return this.props.translate("Schedulingâ€¦");case"publish":return this.props.translate("Publishingâ€¦");case"requestReview":return this.props.translate("Submitting for Reviewâ€¦")}return this.props.translate("Publishingâ€¦")}},{key:"renderPrivacyControl",value:function(){return m.a.createElement(Hs,{onPrivatePublish:this.props.onPrivatePublish,context:"confirmation-sidebar"})}},{key:"renderPublishingBusyButton",value:function(){if("publishing"!==this.props.status||null===this.props.publishButtonStatus)return null;var e=this.getBusyButtonLabel(this.props.publishButtonStatus);return m.a.createElement(J.a,{disabled:!0,className:"editor-confirmation-sidebar__publishing-button is-busy is-primary"},e)}},{key:"renderNoticeDisplayPreferenceCheckbox",value:function(){return m.a.createElement("div",{className:"editor-confirmation-sidebar__display-preference"},m.a.createElement(ta.a,null,m.a.createElement(Ja.a,{onChange:this.props.handlePreferenceChange,defaultChecked:!0,className:"editor-confirmation-sidebar__display-preference-checkbox",id:"confirmation_sidebar_display_preference",name:"confirmation_sidebar_display_preference"}),m.a.createElement("span",null,this.props.translate("Show this every time I publish",{comment:"This string appears in the bottom of a publish confirmation sidebar.There is limited space. Longer strings will wrap."}))))}},{key:"render",value:function(){var e="open"===this.props.status,t="closed"!==this.props.status;return m.a.createElement("div",{className:z()({"editor-confirmation-sidebar":!0,"is-active":t})},this.renderPublishingBusyButton(),m.a.createElement("div",{className:z()({"editor-confirmation-sidebar__sidebar":!0,"is-active":e})},m.a.createElement("div",{className:"editor-confirmation-sidebar__ground-control"},m.a.createElement("div",{className:"editor-confirmation-sidebar__close"},m.a.createElement(J.a,{borderless:!0,onClick:this.getCloseOverlayHandler("dismiss_x"),title:this.props.translate("Close sidebar"),"aria-label":this.props.translate("Close sidebar")},m.a.createElement(Y.a,{icon:"cross"}))),m.a.createElement("div",{className:"editor-confirmation-sidebar__action"},this.renderPublishButton())),m.a.createElement("div",{className:"editor-confirmation-sidebar__content-wrap"},m.a.createElement(Gs,{post:this.props.post}),m.a.createElement(Fs,{post:this.props.post,setPostDate:this.props.setPostDate}),m.a.createElement("div",{className:"editor-confirmation-sidebar__privacy-control"},this.renderPrivacyControl())),this.renderNoticeDisplayPreferenceCheckbox()))}}]),t}(p.Component);Ks.propTypes={handlePreferenceChange:U.a.func,onPrivatePublish:U.a.func,onPublish:U.a.func,post:U.a.object,isPasswordProtectedWithInvalidPassword:U.a.bool,setPostDate:U.a.func,setStatus:U.a.func,status:U.a.string};var Ys=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.a)(e,t,n),o=Object(ee.p)(e,t,n)&&!Object(ee.q)(e,t,n),i=Object(X.h)(e);return{siteId:t,postId:n,post:a,isPasswordProtectedWithInvalidPassword:o,publishButtonStatus:i}},{editPost:E.e})(Object(h.localize)(Ks)),$s=n("./client/components/data/document-head/index.jsx");function Js(e){var t,n=e.translate,a=e.siteId,o=e.type,i=e.typeObject,s=e.newPost;return t="post"===o?n(s?"New Post":"Edit Post",{textOnly:!0}):"page"===o?n(s?"New Page":"Edit Page",{textOnly:!0}):s?i?i.labels.new_item:n("New",{textOnly:!0}):i?i.labels.edit_item:n("Edit",{context:"verb",textOnly:!0}),m.a.createElement("div",null,a&&"page"!==o&&"post"!==o&&m.a.createElement(ie.a,{siteId:a}),m.a.createElement($s.a,{title:t}))}Js.propTypes={translate:U.a.func,siteId:U.a.number,type:U.a.string,typeObject:U.a.object,newPost:U.a.bool};var Qs=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.c)(e,t,n,"type");return{siteId:t,type:a,typeObject:Object(se.a)(e,t,a),newPost:Object(X.m)(e)}})(Object(h.localize)(Js)),Zs=["jetpack-portfolio","jetpack-testimonial"];function Xs(e){var t=e.translate,n=e.types,a=e.type,o=e.typeObject,i=e.writePostPath,s=e.siteSlug;if(!n||!a||o)return null;var r,l=[m.a.createElement(J.a,{href:"/posts/"+s},t("Back to My Sites"))],c=Object(v.includes)(Zs,a);if(c){switch(a){case"jetpack-portfolio":r=t("Portfolios are not enabled. Open your site settings to activate them.");break;case"jetpack-testimonial":r=t("Testimonials are not enabled. Open your site settings to activate them.")}l.push(m.a.createElement(J.a,{href:"/settings/writing/"+s,primary:!0},t("Site Settings")))}else r=t("To use this post type, please check that your theme and site support it."),l.push(m.a.createElement(J.a,{href:i,primary:!0},t("Write a Blog Post")));return m.a.createElement(We.a,{isVisible:!0,buttons:l,className:"editor-post-type-unsupported"},m.a.createElement("h1",null,t("This post type is not supported")),m.a.createElement("p",null,r),m.a.createElement("p",null,t("For more information, visit our {{supportLink}}support page on custom content types{{/supportLink}}.",{components:{supportLink:m.a.createElement("a",{href:"https://support.wordpress.com/custom-post-types/"})}})))}Xs.propTypes={translate:U.a.func,types:U.a.object,type:U.a.string,typeObject:U.a.object,writePostPath:U.a.string,siteSlug:U.a.string};var er=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(ee.c)(e,t,Object(X.f)(e),"type");return{type:n,types:Object(se.b)(e,t),typeObject:Object(se.a)(e,t,n),writePostPath:Object(X.d)(e,t),siteSlug:Object(ge.w)(e,t)}})(Object(h.localize)(Xs)),tr=n("./client/state/selectors/can-current-user.js");function nr(e){var t=e.translate,n=e.userCanEdit,a=e.siteSlug;if(!1!==n)return null;var o=[m.a.createElement(J.a,{key:"back",href:"/posts/"+a,primary:!0},t("Back to My Sites"))];return m.a.createElement(We.a,{isVisible:!0,buttons:o,className:"editor-forbidden"},m.a.createElement("h1",null,t("You can't edit this post type")),m.a.createElement("p",null,t("If you think you should have access to this post type, request that your site administrator grant you access.")))}nr.propTypes={translate:U.a.func,userCanEdit:U.a.bool,siteSlug:U.a.string};var ar=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(ee.c)(e,t,Object(X.f)(e),"type"),a=Object(se.a)(e,t,n),o=Object(v.get)(a,["capabilities","edit_posts"],null);return{userCanEdit:Object(tr.a)(e,t,o),siteSlug:Object(ge.w)(e,t)}})(Object(h.localize)(nr)),or=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.handleViewPostClick=function(){n.props.recordTracksEvent("calypso_editor_notice_view_post_click")},n.handleAddPagePromptClick=function(){n.props.recordTracksEvent("calypso_editor_notice_add_page_prompt_click")},n}return M()(t,e),O()(t,[{key:"componentWillReceiveProps",value:function(e){Object(De.c)()&&(!this.props.message&&e.message||!this.props.error&&e.error)&&this.props.setLayoutFocus("content")}},{key:"getErrorMessage",value:function(){var e=this.props,t=e.translate,n=e.error;if(n)switch(n.message){case"NO_CONTENT":return t("You haven't written anything yet!")}}},{key:"getText",value:function(e){var t=this.props,n=t.translate,a=t.type,o=t.typeObject,i=t.site,s=t.postUrl,r=t.postDate,l=t.moment,c=l(r).format("lll"),d=Object(v.get)(o,"labels.singular_name",a);switch(e){case"publishFailure":return"post"===a?n("Publishing of post failed."):"page"===a?n("Publishing of page failed."):n("Publishing of %(typeLabel)s failed.",{args:{typeLabel:d}});case"saveFailure":return n("Saving of draft failed.");case"trashFailure":return"page"===a?n("Trashing of page failed!"):"post"===a?n("Trashing of post failed!"):n("Trashing of %(typeLabel)s failed.",{args:{typeLabel:d}});case"published":return i?"page"===a?n("Page published on {{pageLink/}}! {{a}}Add another page{{/a}}",{components:{pageLink:m.a.createElement("a",{href:s,onClick:this.handleViewPostClick},i.title),a:m.a.createElement("a",{href:"/page/"+i.slug,onClick:this.handleAddPagePromptClick})},comment:"Editor: Message displayed when a page is published, with a link to the page."}):"post"===a?n("Post published on {{postLink/}}! {{a}}Add another post{{/a}}",{components:{postLink:m.a.createElement("a",{href:s,onClick:this.handleViewPostClick},i.title),a:m.a.createElement("a",{href:"/post/"+i.slug,onClick:this.handleAddPagePromptClick})},comment:"Editor: Message displayed when a post is published, with a link to the post."}):n("%(typeLabel)s published on {{postLink/}}!",{args:{typeLabel:d},components:{postLink:m.a.createElement("a",{href:s,onClick:this.handleViewPostClick},i.title)},comment:"Editor: Message displayed when a post or post of a custom type is published, with a link to the post."}):"page"===a?n("Page published!"):"post"===a?n("Post published!"):n("%(typeLabel)s published!",{args:{typeLabel:d}});case"scheduled":return"post"===a?n("Post scheduled for %(formattedPostDate)s!",{args:{formattedPostDate:c},comment:"Editor: Message displayed when a post is scheduled, with the scheduled date and time."}):"page"===a?n("Page scheduled for %(formattedPostDate)s!",{args:{formattedPostDate:c},comment:"Editor: Message displayed when a page is scheduled, with the scheduled date and time."}):n("%(typeLabel)s scheduled for %(formattedPostDate)s!",{args:{typeLabel:d,formattedPostDate:c},comment:"Editor: Message displayed when a post of a custom type is scheduled, with the scheduled date and time."});case"publishedPrivately":return n("{{strong}}Published privately.{{/strong}} Only admins and editors can view.",{components:{strong:m.a.createElement("strong",null)},comment:"Editor: Message displayed when a post is published privately."});case"view":return o.labels.view_item;case"preview":return n("View Preview");case"updated":return"page"===a?n("Page updated! {{pageLink}}Visit page{{/pageLink}}.",{components:{pageLink:m.a.createElement("a",{href:s,onClick:this.handleViewPostClick})},comment:"Editor: Message displayed when a page is updated, with a link to the updated page."}):"post"===a?n("Post updated! {{postLink}}Visit post{{/postLink}}.",{components:{postLink:m.a.createElement("a",{href:s,onClick:this.handleViewPostClick})},comment:"Editor: Message displayed when a post is updated, with a link to the updated post."}):n("%(typeLabel)s updated! {{postLink}}Visit %(typeLabel)s{{/postLink}}.",{args:{typeLabel:d},components:{postLink:m.a.createElement("a",{href:s,onClick:this.handleViewPostClick})},comment:"Editor: Message displayed when a post of a custom type is updated, with a link to the updated post."})}}},{key:"render",value:function(){var e=this.props,t=e.siteId,n=e.message,a=e.status,o=e.onDismissClick,i=this.getErrorMessage()||this.getText(n);return m.a.createElement("div",{className:z()("editor-notice",{"is-global":!0})},t&&m.a.createElement(ie.a,{siteId:t}),i&&m.a.createElement(yi.b,_()({status:a,text:i,onDismissClick:o},{showDismiss:!0})))}}]),t}(p.Component);or.propTypes={translate:U.a.func,moment:U.a.func,siteId:U.a.number,site:U.a.object,type:U.a.string,typeObject:U.a.object,message:U.a.string,status:U.a.string,onDismissClick:U.a.func,error:U.a.object,postUrl:U.a.string,postDate:U.a.string};var ir=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(ee.a)(e,t,Object(X.f)(e));return n?{siteId:t,site:Object(Z.d)(e),type:n.type,typeObject:Object(se.a)(e,t,n.type),postUrl:n.URL||null,postDate:n.date||null}:{}},{setLayoutFocus:Ts.b,recordTracksEvent:Pn.i})(Object(h.localize)(or));n("./node_modules/diff/dist/diff.js");function sr(e){if(e&&"string"==typeof e){e=e.replace(/\.\.\./g," "),e=e.replace(/<.[^<>]*?>/g," "),e=e.replace(/&nbsp;|&#160;/gi," "),e=e.replace(/(\w+)(&#?[a-z0-9]+;)+(\w+)/i,"$1$3"),e=e.replace(/&.+?;/g," "),e=e.replace(/[0-9.(),;:!?%#$\x27\x22_+=\\\/\-]*/g,"");var t=e.match(/[\w\u2019\x27\-\u00C0-\u1FFF]+/g);if(t)return t.length}return 0}var rr=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"getSelectedTextCount",value:function(){var e=sr(this.props.selectedText);return e?this.props.translate("%(selectedText)s word selected {{span}}%(separator)s{{/span}}","%(selectedText)s words selected {{span}}%(separator)s{{/span}}",{count:e,args:{selectedText:e,separator:"/ "},components:{span:m.a.createElement("span",{className:"editor-word-count__separator"})}}):null}},{key:"render",value:function(){switch(this.props.localeSlug){case"ja":case"th":case"zh-cn":case"zh-hk":case"zh-sg":case"zh-tw":case"ko":return null}var e=sr(this.props.rawContent);return m.a.createElement("div",{className:"editor-word-count"},m.a.createElement("span",{className:"editor-word-count__is-selected-text"},m.a.createElement("strong",null,this.getSelectedTextCount())),this.props.translate("%d word","%d words",{count:e,args:[e]}))}}]),t}(p.Component);rr.propTypes={selectedText:U.a.string,rawContent:U.a.string,localeSlug:U.a.string};var lr=Object(F.b)(function(e){return{localeSlug:Object(wa.h)(e)||"en",rawContent:Object(X.i)(e)}})(Object(h.localize)(rr)),cr=n("./client/components/data/query-preferences/index.jsx"),dr=n("./client/state/ui/layout-focus/selectors.js"),ur=n("./client/lib/protect-form/index.jsx"),pr=n("./client/components/accordion/index.jsx"),mr=n("./client/components/accordion/section.jsx"),hr=n("./client/post-editor/editor-drawer/label.jsx"),fr=n("./client/blocks/term-tree-selector/index.jsx"),gr=n("./client/blocks/term-form-dialog/index.jsx"),br=n("./client/state/post-types/taxonomies/selectors.js"),vr=n("./client/state/terms/selectors.js"),yr=function(e){function t(e){var n;return k()(this,t),n=P()(this,N()(t).call(this,e)),n.openDialog=function(e){e.preventDefault(),n.setState({showDialog:!0})},n.closeDialog=function(){n.setState({showDialog:!1})},n.state={showDialog:!1},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.labels,n=e.onSuccess,a=e.type,o=e.terms,i=e.taxonomy,s=o?o.length:0,r=z()("editor-term-selector__add-term",{"is-compact":s<8});return m.a.createElement("div",{className:r},m.a.createElement(J.a,{borderless:!0,compact:!0,onClick:this.openDialog},m.a.createElement(Y.a,{icon:"folder"})," ",t.add_new_item),m.a.createElement(gr.a,{showDialog:this.state.showDialog,onClose:this.closeDialog,postType:a,taxonomy:i,onSuccess:n}))}}]),t}(p.Component);yr.propTypes={labels:U.a.object,onSuccess:U.a.func,taxonomy:U.a.string,terms:U.a.array,type:U.a.string},yr.defaultProps={onSuccess:v.noop};var Er=Object(F.b)(function(e,t){var n=t.taxonomy,a=Object(Z.e)(e),o=Object(X.f)(e),i=Object(ee.c)(e,a,o,"type"),s=Object(br.b)(e,a,i,n),r=Object(v.get)(s,"labels",{});return{terms:Object(vr.c)(e,a,n),labels:r,type:i}})(yr),jr=function(e){function t(e){var n;return k()(this,t),n=P()(this,N()(t).call(this,e)),n.onAddTerm=function(e){var t=n.props,a=t.postId,o=t.taxonomyName,i=t.siteId;n.props.addTermForPost(i,o,e,a)},n.boundOnTermsChange=n.onTermsChange.bind(we()(we()(n))),n}return M()(t,e),O()(t,[{key:"onTermsChange",value:function(e){var t=this.props,n=t.postTerms,a=t.taxonomyName,o=t.siteId,i=t.postId,s=Object(v.cloneDeep)(n)||{},r=Object(v.toArray)(s[a]),l=Object(v.findIndex)(r,{ID:e.ID});-1!==l?r.splice(l,1):r.push(e),this.props.editPost(o,i,{terms:dt()({},a,r)})}},{key:"getSelectedTermIds",value:function(){var e=this.props,t=e.postTerms,n=e.taxonomyName,a=t?t[n]:[];return Object(v.map)(a,"ID")}},{key:"render",value:function(){var e=this.props,t=e.taxonomyName,n=e.canEditTerms,a=e.compact;return m.a.createElement("div",null,m.a.createElement(fr.a,{analyticsPrefix:"Editor",onChange:this.boundOnTermsChange,selected:this.getSelectedTermIds(),taxonomy:t,multiple:!0,compact:a}),n&&m.a.createElement(Er,{taxonomy:t,onSuccess:this.onAddTerm}))}}]),t}(p.Component);jr.propTypes={siteId:U.a.number,postId:U.a.number,postTerms:U.a.object,taxonomyName:U.a.string,canEditTerms:U.a.bool,compact:U.a.bool};var wr=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e);return{postTerms:Object(ee.c)(e,t,n,"terms"),canEditTerms:Object(tr.a)(e,t,"manage_categories"),siteId:t,postId:n}},{editPost:E.e,addTermForPost:E.a})(jr),_r=n("./client/components/data/query-terms/index.jsx"),Cr=ba()("calypso:post-editor:editor-terms"),Sr={number:1e3,order_by:"count",order:"DESC"},xr=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"componentWillMount",value:function(){this.boundOnTermsChange=this.onTermsChange.bind(this)}},{key:"onTermsChange",value:function(e){var t,n;Cr("onTermsChange",e,this),e.length>this.getPostTerms().length?(t="term_added",n="Added Term"):(t="term_removed",n="Removed Term"),this.props.recordEditorStat(t),this.props.recordEditorEvent("Changed Terms",n);var a=this.props,o=a.siteId,i=a.postId,s=a.taxonomyName;this.props.editPost(o,i,{terms:dt()({},s,e)})}},{key:"getPostTerms",value:function(){var e=this.props,t=e.postTerms,n=e.taxonomyName;return t&&t[n]?Array.isArray(t[n])?t[n]:Object.keys(t[n]):[]}},{key:"render",value:function(){var e=Object(v.map)(this.props.terms,"name");return m.a.createElement("div",null,m.a.createElement(_r.a,{siteId:this.props.siteId,taxonomy:this.props.taxonomyName,query:Sr}),m.a.createElement(Xa.a,{value:this.getPostTerms(),displayTransform:oe.b,suggestions:e,onChange:this.boundOnTermsChange,maxSuggestions:20}))}}]),t}(m.a.Component);xr.propTypes={siteId:U.a.number,postId:U.a.number,postTerms:U.a.object,taxonomyName:U.a.string,taxonomyLabel:U.a.string,terms:U.a.arrayOf(U.a.object),editPost:U.a.func};var kr=Object(F.b)(function(e,t){var n=Object(Z.e)(e),a=Object(X.f)(e),o=Object(ee.c)(e,n,a,"type"),i=Object(br.b)(e,n,o,t.taxonomyName);return{siteId:n,postId:a,taxonomyLabel:i&&i.label,terms:Object(vr.c)(e,n,t.taxonomyName),postTerms:Object(ee.c)(e,n,a,"terms")}},{editPost:E.e,recordEditorStat:Q.b,recordEditorEvent:Q.a})(xr),Ir=n("./client/components/notice/notice-action.jsx"),Or=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"renderJetpackNotice",value:function(){var e=this.props,t=e.translate,n=e.siteSlug;return m.a.createElement(yi.b,{status:"is-warning",showDismiss:!1,text:t("You must update Jetpack to use this feature."),className:"editor-categories-tags__upgrade-notice"},m.a.createElement(Ir.a,{href:Object(j.b)("/plugins/jetpack",n)},t("Update Now")))}},{key:"renderCategories",value:function(){var e=this.props,t=e.translate,n=e.postType,a=e.isTermsSupported;if("page"!==n)return m.a.createElement(mr.a,null,m.a.createElement(hr.a,{helpText:t("Use categories to group your posts by topic."),labelText:t("Categories")}),a?m.a.createElement(wr,{compact:!0,taxonomyName:"category"}):this.renderJetpackNotice())}},{key:"renderTags",value:function(){var e=this.props,t=e.isTermsSupported,n=e.postType,a=e.translate,o=a("page"===n?"Use tags to associate more specific keywords with your pages.":"Use tags to associate more specific keywords with your posts.");return m.a.createElement(mr.a,null,m.a.createElement(hr.a,{helpText:o,labelText:a("Tags")},t?m.a.createElement(kr,{taxonomyName:"post_tag"}):this.renderJetpackNotice()))}},{key:"getCategoriesSubtitle",value:function(){var e,t=this.props,n=t.translate,a=t.postTerms,o=t.defaultCategory,i=Object(v.toArray)(Object(v.get)(a,"category"));return i.length>1?n("%d category","%d categories",{args:[i.length],count:i.length}):(e=i.length>0?i[0]:o,e?Object(v.unescape)(e.name):void 0)}},{key:"getTagsSubtitle",value:function(){var e=this.props,t=e.translate,n=e.postTerms,a=Object(v.toArray)(Object(v.get)(n,"post_tag")),o=a.length;switch(o){case 0:return null;case 1:case 2:return a.map(function(e){return"#"+Object(v.unescape)(e.name||e)}).join(", ");default:return t("%d tag","%d tags",{args:[o],count:o})}}},{key:"getSubtitle",value:function(){var e=[],t=this.props,n=t.postType,a=t.siteId;if(!a)return null;if("post"===n){var o=this.getCategoriesSubtitle();o&&e.push(o)}var i=this.getTagsSubtitle();return i&&e.push(i),e.join(", ")}},{key:"getTitle",value:function(){var e,t=this.props,n=t.translate,a=t.postType;return e=n("page"===a?"Tags":"Categories & Tags"),e}},{key:"render",value:function(){var e=z()("editor-drawer__accordion","editor-categories-tags__accordion",this.props.className);return m.a.createElement(pr.a,{title:this.getTitle(),subtitle:this.getSubtitle(),className:e,e2eTitle:"categories-tags"},this.renderCategories(),this.renderTags())}}]),t}(p.Component);Or.propTypes={translate:U.a.func,postTerms:U.a.object,postType:U.a.string,defaultCategory:U.a.object,isTermsSupported:U.a.bool,siteSlug:U.a.string};var Tr=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ge.s)(e,t,"default_category"),o=!1!==Object(ge.I)(e,t,"4.1.0");return{defaultCategory:Object(vr.b)(e,t,"category",a),postTerms:Object(ee.c)(e,t,n,"terms"),postType:Object(ee.c)(e,t,n,"type"),siteSlug:Object(ge.w)(e,t),siteId:t,postId:n,isTermsSupported:o}})(Object(h.localize)(Or)),Pr=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"getPopoverLabel",value:function(){var e=this.props,t=e.translate,n=e.postType;return t("page"===n?"The slug is the part of a web address that identifies a specific page within a site. It's often based on the page title.":"The slug is the part of a web address that identifies a specific post within a site. It's often based on the post title.")}},{key:"render",value:function(){var e=this.props,t=e.postType,n=e.translate;return m.a.createElement(mr.a,{className:"editor-more-options__slug"},m.a.createElement(hr.a,{labelText:n("Slug"),helpText:this.getPopoverLabel()},m.a.createElement(xe,{instanceName:t+"-sidebar",className:"editor-more-options__slug-field"})))}}]),t}(p.PureComponent);Pr.propTypes={postType:U.a.string,translate:U.a.func};var Dr=Object(F.b)(function(e){var t=Object(Z.e)(e);return{postType:Object(ee.c)(e,t,Object(X.f)(e),"type")}})(Object(h.localize)(Pr)),Nr=n("./client/lib/products-values/index.js"),Rr=n("./client/components/data/query-jetpack-plugins/index.jsx"),Mr=n("./client/state/plugins/installed/selectors.js"),Ar=n("./client/components/data/query-taxonomies/index.jsx");function Lr(e){var t=e.translate,n=e.siteId,a=e.postType,o=e.isSupported,i=e.taxonomies,s=e.terms;return o?m.a.createElement("div",{className:"editor-drawer__taxonomies"},n&&a&&m.a.createElement(Ar.a,{siteId:n,postType:a}),Object(v.reduce)(i,function(e,n){var o=n.name,i=n.label,r=n.hierarchical;if(function(e,t){return!!Object(v.includes)(["post_format","mentions","xposts"],t)||"post"===e&&Object(v.includes)(["category","post_tag"],t)}(a,o))return e;var l,c=Object(v.get)(s,o),d=Object(v.size)(c);return l=d>2?t("%d selected","%d selected",{count:d,args:[d]}):Object(v.map)(c,function(e){return Object(oe.b)(e.name||e)}).join(", "),e.concat(m.a.createElement(pr.a,{key:o,title:i,subtitle:l,e2eTitle:"taxonomies"},r?m.a.createElement(wr,{compact:!0,taxonomyName:o}):m.a.createElement(kr,{taxonomyName:o})))},[])):null}Lr.propTypes={translate:U.a.func,siteId:U.a.number,postType:U.a.string,isSupported:U.a.bool,terms:U.a.oneOfType([U.a.object,U.a.array]),taxonomies:U.a.array};var Br=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.c)(e,t,n,"type"),o=!1!==Object(ge.I)(e,t,"4.1.0");return{siteId:t,postType:a,isSupported:o,terms:Object(ee.c)(e,t,n,"terms"),taxonomies:Object(br.a)(e,t,a)}})(Object(h.localize)(Lr)),Ur=n("./client/components/forms/form-legend/index.jsx"),Fr=n("./client/components/forms/form-toggle/compact.jsx"),qr=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={isTopLevel:!n.props.parentId},n.updatePageParent=function(e){var t=n.props,a=t.siteId,o=t.postId,i=Object(v.get)(e,"ID");if(!i)return n.setState(function(e){var t=e.isTopLevel;return{isTopLevel:!t}},function(){n.state.isTopLevel&&n.props.editPost(a,o,{parent:0})});n.setState({isTopLevel:!1}),n.props.editPost(a,o,{parent:i})},n}return M()(t,e),O()(t,[{key:"componentWillReceiveProps",value:function(e){this.props.parentId!==e.parentId&&this.setState({isTopLevel:!e.parentId})}},{key:"render",value:function(){var e=this.props,t=e.parentId,n=e.translate,a=e.postId,o=e.siteId,i=e.postType,s=e.labels,r=this.state.isTopLevel;return m.a.createElement(mr.a,{className:"editor-page-parent"},m.a.createElement(ta.a,null,m.a.createElement("span",{className:"editor-page-parent__label-text"},s.parent||n("Parent Page"))),m.a.createElement(ta.a,{className:"editor-page-parent__top-level"},m.a.createElement(Fr.a,{checked:r,onChange:this.updatePageParent,"aria-label":n("Toggle to set as top level")}),m.a.createElement("span",{className:"editor-page-parent__top-level-label"},n("Top level",{context:"Editor: Page being edited is top level i.e. has no parent"})),r&&m.a.createElement("span",{className:"editor-page-parent__top-level-description"},n("Disable to select a parent page"))),!r&&m.a.createElement("div",{className:"editor-page-parent__parent-tree-selector"},m.a.createElement(Ur.a,null,n("Choose a parent page")),m.a.createElement(Go.a,{type:i,siteId:o,onChange:this.updatePageParent,selected:t,excludeTree:a,emptyMessage:s.not_found||n("You have no other pages yet.")})))}}]),t}(p.Component);qr.propTypes={siteId:U.a.number,postId:U.a.number,parentId:U.a.number,postType:U.a.string,translate:U.a.func,labels:U.a.object};var zr=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.c)(e,t,n,"type"),o=Object(ee.c)(e,t,n,"parent"),i=Object(v.get)(o,"ID",o)||0,s=Object(v.get)(Object(se.a)(e,t,a),"labels",{});return{siteId:t,postId:n,postType:a,parentId:i,labels:s}},{editPost:E.e})(Object(h.localize)(qr));var Vr=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"componentWillMount",value:function(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.siteId,a=t.themeSlug,o=e.siteId,i=e.themeSlug,s=n!==o||a&&i&&a!==i;s&&this.request(e)}},{key:"request",value:function(e){e.isRequesting||e.requestPageTemplates(e.siteId)}},{key:"render",value:function(){return null}}]),t}(p.Component);Vr.propTypes={siteId:U.a.number.isRequired,isRequesting:U.a.bool,requestPageTemplates:U.a.func};var Hr=Object(F.b)(function(e,t){var n=t.siteId;return{isRequesting:function(e,t){return!!e.pageTemplates.requesting[t]}(e,n),themeSlug:Object(ge.s)(e,n,"theme_slug")}},{requestPageTemplates:function(e){return function(t){return t({type:"PAGE_TEMPLATES_REQUEST",siteId:e}),yt.a.site(e).pageTemplates().then(function(n){var a=n.templates;t(function(e,t){return{type:"PAGE_TEMPLATES_RECEIVE",siteId:e,templates:t}}(e,a)),t({type:"PAGE_TEMPLATES_REQUEST_SUCCESS",siteId:e})}).catch(function(n){t({type:"PAGE_TEMPLATES_REQUEST_FAILURE",siteId:e,error:n})})}}})(Vr),Wr=n("./client/post-editor/editor-theme-help/index.jsx"),Gr=function(e){function t(){var e;return k()(this,t),e=P()(this,N()(t).apply(this,arguments)),e.selectTemplate=e.selectTemplate.bind(we()(we()(e))),e}return M()(t,e),O()(t,[{key:"selectTemplate",value:function(e){var t=this.props,n=t.siteId,a=t.postId;this.props.editPost(n,a,{page_template:e})}},{key:"getSelectedTemplateText",value:function(){var e,t=this.props,n=t.templates,a=t.template,o=t.translate;return a&&(e=Object(v.find)(n,{file:a})),e?e.label:o("Default Template")}},{key:"getTemplates",value:function(){var e=this.props,t=e.translate,n=e.templates;return[{label:t("Default Template"),file:""}].concat(n||[])}},{key:"render",value:function(){var e=this,t=this.props,n=t.postType,a=t.template,o=t.siteId,i=t.translate,s=t.postId,r=t.pageForPostsId;if("page"!==n||s===r)return null;var l=this.getTemplates();return m.a.createElement("div",null,o&&m.a.createElement(Hr,{siteId:o}),Object(v.size)(l)>1&&m.a.createElement(mr.a,null,m.a.createElement(hr.a,{labelText:i("Page Template")},m.a.createElement(Wr.a,{className:"editor-page-templates__help-link"}),m.a.createElement(Qa.a,{selectedText:this.getSelectedTemplateText()},Object(v.map)(l,function(t){var n=t.file,o=t.label;return m.a.createElement(Za.a,{key:n,selected:n===a,onClick:function(){return e.selectTemplate(n)}},o)})))))}}]),t}(p.Component);Gr.propTypes={siteId:U.a.number,postId:U.a.number,postType:U.a.string,template:U.a.string,templates:U.a.array,editPost:U.a.func,pageForPostsId:U.a.number};var Kr=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.c)(e,t,n,"type"),o=Object(ee.c)(e,t,n,"page_template"),i=function(e,t){return e.pageTemplates.items[t]||null}(e,t),s=Object(ge.s)(e,t,"page_for_posts");return{siteId:t,postId:n,postType:a,template:o,templates:i,pageForPostsId:s}},{editPost:E.e})(Object(h.localize)(Gr)),Yr=function(e){function t(){var e;return k()(this,t),e=P()(this,N()(t).apply(this,arguments)),e.editMenuOrder=e.editMenuOrder.bind(we()(we()(e))),e.statTracked=!1,e}return M()(t,e),O()(t,[{key:"editMenuOrder",value:function(e){var t=this.props,n=t.menuOrder,a=t.siteId,o=t.postId,i=parseInt(e.target.value,10)||0;i!==n&&(this.statTracked||(this.statTracked=!0,this.props.recordEditorStat("advanced_menu_order_changed"),this.props.recordEditorEvent("Changed page menu order")),this.props.editPost(a,o,{menu_order:i}))}},{key:"render",value:function(){var e=this.props,t=e.translate,n=e.menuOrder;return m.a.createElement(mr.a,{className:"editor-page-order"},m.a.createElement("label",null,m.a.createElement("span",{className:"editor-page-order__label-text"},t("Order",{context:"Editor: Field label for menu order."})),m.a.createElement(Ce.a,{type:"number",value:n,pattern:"[0-9]*",onChange:this.editMenuOrder,onBlur:this.editMenuOrder,className:"editor-page-order__input"})))}}]),t}(p.Component);Yr.propTypes={siteId:U.a.number,postId:U.a.number,menuOrder:U.a.number},Yr.defaultProps={menuOrder:0};var $r=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.c)(e,t,n,"menu_order");return{siteId:t,postId:n,menuOrder:a}},{editPost:E.e,recordEditorStat:Q.b,recordEditorEvent:Q.a})(Object(h.localize)(Yr));var Jr=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.c)(e,t,n,"type"),o="page"===a||Object(v.get)(Object(se.a)(e,t,a),"hierarchical");return{postType:a,hierarchical:o}})(Object(h.localize)(function(e){var t,n=e.translate,a=e.postType,o=e.hierarchical;return t=n("page"===a?"Page Attributes":"Attributes"),m.a.createElement(pr.a,{title:t,e2eTitle:"page-options"},o&&m.a.createElement(zr,null),m.a.createElement(Kr,null),m.a.createElement($r,null))})),Qr=n("./client/components/forms/form-section-heading/index.jsx"),Zr=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={selectedPostId:null,showDialog:!1},n.isPost=function(){return"post"===n.props.type},n.openDialog=function(e){e.preventDefault(),n.setState({showDialog:!0})},n.closeDialog=function(){n.setState({selectedPostId:null,showDialog:!1})},n.setPostToCopy=function(e){n.setState({selectedPostId:e.ID})},n.goToNewDraft=function(){var e=n.props,t=e.siteSlug,a=e.type,o=n.state.selectedPostId;""!==o&&(s.a.redirect("/"+a+"/"+t+"?copy="+o),n.closeDialog())},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.siteId,n=e.translate,a=e.type,o=this.state,i=o.selectedPostId,s=o.showDialog,r=[{action:"cancel",label:n("Cancel")},{action:"copy",label:n("Overwrite"),isPrimary:!0,disabled:!i,onClick:this.goToNewDraft}];return m.a.createElement(mr.a,{className:"editor-more-options__copy-post"},m.a.createElement(hr.a,{labelText:this.isPost()?n("Copy Post"):n("Copy Page"),helpText:this.isPost()?n("Pick a post and we'll copy the title, content, tags and categories."):n("Pick a page and we'll copy the title and content.")},m.a.createElement(J.a,{borderless:!0,compact:!0,onClick:this.openDialog},m.a.createElement(Y.a,{icon:"clipboard"}),this.isPost()?n("Select a post to copy"):n("Select a page to copy"))),m.a.createElement(We.a,{autoFocus:!1,isVisible:s,buttons:r,onClose:this.closeDialog,additionalClassNames:"editor-more-options__copy-post-select-dialog"},m.a.createElement(Qr.a,null,this.isPost()?n("Select a post to copy"):n("Select a page to copy")),m.a.createElement("p",null,this.isPost()?n("Pick a post and we'll copy the title, content, tags and categories."):n("Pick a page and we'll copy the title and content.")),t&&m.a.createElement(Go.a,{emptyMessage:this.isPost()?n("No posts found"):n("No pages found"),onChange:this.setPostToCopy,order:"DESC",orderBy:"date",selected:i,siteId:t,status:"draft,future,pending,private,publish",type:a})))}}]),t}(p.Component);Zr.propTypes={siteId:U.a.number,siteSlug:U.a.string,translate:U.a.func,type:U.a.oneOf(["page","post"]).isRequired};var Xr=Object(F.b)(function(e){var t=Object(X.f)(e),n=Object(Z.e)(e),a=Object(ee.c)(e,n,t,"type");return{siteId:n,siteSlug:Object(ge.w)(e,n),type:a}})(Object(h.localize)(Zr)),el=n("./client/components/info-popover/index.jsx"),tl=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.toggleStickyStatus=function(){var e,t;n.props.post.sticky?(e="advanced_sticky_disabled",t="Off"):(e="advanced_sticky_enabled",t="On"),n.props.recordEditorStat(e),n.props.recordEditorEvent("Changed Sticky Setting",t),n.props.editPost(n.props.siteId,n.props.postId,{sticky:!n.props.post.sticky})},n.togglePendingStatus=function(){var e="pending"===n.props.post.status;n.props.recordEditorStat("status_changed"),n.props.recordEditorEvent("Changed Pending Status",e?"Marked Draft":"Marked Pending"),n.props.editPost(n.props.siteId,n.props.postId,{status:e?"draft":"pending"})},n.revertToDraft=function(){n.props.onSave("draft")},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.translate,n=e.canUserPublishPosts,a=e.post,o=e.currentPost,i=ae.x(a),s=ae.y(a),r="password"===ae.p(a),l=ae.z(o),c=ae.A(o),d=a&&"post"===a.type&&!s&&!r,u=a&&!l&&!c&&n,p=l||c||i&&!n;return m.a.createElement("div",{className:"edit-post-status"},this.renderPostScheduling(),this.renderPostVisibility(),d&&m.a.createElement("label",{className:"edit-post-status__sticky"},m.a.createElement("span",{className:"edit-post-status__label-text"},t("Stick to the front page"),m.a.createElement(el.a,{position:"top right",gaEventCategory:"Editor",popoverName:"Sticky Post"},t("Sticky posts will appear at the top of the posts listing."))),m.a.createElement(Fr.a,{checked:a.sticky,onChange:this.toggleStickyStatus,"aria-label":t("Stick post to the front page")})),u&&m.a.createElement("label",{className:"edit-post-status__pending-review"},m.a.createElement("span",{className:"edit-post-status__label-text"},t("Pending review"),m.a.createElement(el.a,{position:"top right"},t("Flag this post to be reviewed for approval."))),m.a.createElement(Fr.a,{checked:i,onChange:this.togglePendingStatus,"aria-label":t("Request review for post")})),p&&m.a.createElement(J.a,{className:"edit-post-status__revert-to-draft",onClick:this.revertToDraft,compact:!0},m.a.createElement(Y.a,{icon:"undo",size:18})," ",t("Revert to draft")))}},{key:"renderPostScheduling",value:function(){return m.a.createElement(Fs,{post:this.props.post,setPostDate:this.props.setPostDate})}},{key:"renderPostVisibility",value:function(){if("open"!==this.props.confirmationSidebarStatus)return m.a.createElement(Hs,{onPrivatePublish:this.props.onPrivatePublish,context:"post-settings"})}}]),t}(p.Component);tl.propTypes={moment:U.a.func,setPostDate:U.a.func,onSave:U.a.func,post:U.a.object,currentPost:U.a.object,translate:U.a.func,onPrivatePublish:U.a.func,confirmationSidebarStatus:U.a.string};var nl=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.a)(e,t,n),o=Object(ee.l)(e,t,n),i=Object(tr.a)(e,t,"publish_posts");return{siteId:t,postId:n,post:a,currentPost:o,canUserPublishPosts:i}},{editPost:E.e,recordEditorStat:Q.b,recordEditorEvent:Q.a})(Object(h.localize)(tl)),al=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.recordExcerptChangeStats=function(){n.props.recordEditorStat("excerpt_changed"),n.props.recordEditorEvent("Changed Excerpt")},n.onExcerptChange=function(e){var t=e.target.value;n.props.editPost(n.props.siteId,n.props.postId,{excerpt:t})},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.excerpt,n=e.translate,a=n("Write an excerptâ€¦");return m.a.createElement(_e.a,{onNewValue:this.recordExcerptChangeStats},m.a.createElement(Ii.a,{id:"excerpt",name:"excerpt",onChange:this.onExcerptChange,value:t,placeholder:a,"aria-label":a}))}}]),t}(m.a.Component),ol=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.c)(e,t,n,"excerpt");return{siteId:t,postId:n,excerpt:a}},{editPost:E.e,recordEditorStat:Q.b,recordEditorEvent:Q.a})(Object(h.localize)(al)),il=n("./client/lib/seo/index.js"),sl=Object(v.overSome)(Nr.h,Nr.t,Nr.C),rl={post:{thumbnail:!0,excerpt:!0,"post-formats":!0,"geo-location":!0,tags:!0,comments:!0},page:{thumbnail:!0,"page-attributes":!0,"geo-location":!0,excerpt:!0,comments:!0}},ll=function(e){n.e(82).then(function(t){e(n("./client/post-editor/editor-post-formats/accordion.jsx").__esModule?n("./client/post-editor/editor-post-formats/accordion.jsx").default:n("./client/post-editor/editor-post-formats/accordion.jsx"))}.bind(null,n)).catch(n.oe)},cl=function(e){n.e(78).then(function(t){e(n("./client/post-editor/editor-sharing/accordion.jsx").__esModule?n("./client/post-editor/editor-sharing/accordion.jsx").default:n("./client/post-editor/editor-sharing/accordion.jsx"))}.bind(null,n)).catch(n.oe)},dl=function(e){n.e(136).then(function(t){e(n("./client/post-editor/editor-drawer/featured-image.jsx").__esModule?n("./client/post-editor/editor-drawer/featured-image.jsx").default:n("./client/post-editor/editor-drawer/featured-image.jsx"))}.bind(null,n)).catch(n.oe)},ul=function(e){n.e(110).then(function(t){e(n("./client/post-editor/editor-location/index.jsx").__esModule?n("./client/post-editor/editor-location/index.jsx").default:n("./client/post-editor/editor-location/index.jsx"))}.bind(null,n)).catch(n.oe)},pl=function(e){n.e(135).then(function(t){e(n("./client/post-editor/editor-discussion/index.jsx").__esModule?n("./client/post-editor/editor-discussion/index.jsx").default:n("./client/post-editor/editor-discussion/index.jsx"))}.bind(null,n)).catch(n.oe)},ml=function(e){n.e(96).then(function(t){e(n("./client/post-editor/editor-seo-accordion/index.jsx").__esModule?n("./client/post-editor/editor-seo-accordion/index.jsx").default:n("./client/post-editor/editor-seo-accordion/index.jsx"))}.bind(null,n)).catch(n.oe)},hl=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"currentPostTypeSupports",value:function(e){var t=this.props,n=t.typeObject,a=t.type;return n&&n.supports?!!n.supports[e]:!rl.hasOwnProperty(a)||!!rl[a][e]}},{key:"renderCategories",value:function(){var e=this.props.type,t=Qt.a.isEnabled("manage/custom-post-types"),n=!t&&this.currentPostTypeSupports("tags");if("post"===e||n)return m.a.createElement(Tr,null)}},{key:"renderTaxonomies",value:function(){var e=this.props.canJetpackUseTaxonomies,t=Qt.a.isEnabled("manage/custom-post-types");if(t&&!1!==e)return m.a.createElement(Br,null)}},{key:"renderPostFormats",value:function(){if(this.currentPostTypeSupports("post-formats"))return m.a.createElement(G.a,{require:ll})}},{key:"renderSharing",value:function(){return m.a.createElement(G.a,{require:cl})}},{key:"renderFeaturedImage",value:function(){if(this.currentPostTypeSupports("thumbnail"))return m.a.createElement(G.a,{require:dl})}},{key:"renderExcerpt",value:function(){var e=this.props.translate;if(this.currentPostTypeSupports("excerpt"))return m.a.createElement(mr.a,null,m.a.createElement(hr.a,{labelText:e("Excerpt"),helpText:e("An excerpt is a short summary you can add to your posts. Some themes show excerpts alongside post titles on your site's homepage and archive pages.")},m.a.createElement(ol,null)))}},{key:"renderLocation",value:function(){var e=this.props.translate;if(this.props.site&&(!this.props.isJetpack||this.props.jetpackVersionSupportsLocation)&&this.currentPostTypeSupports("geo-location"))return m.a.createElement(mr.a,null,m.a.createElement(hr.a,{labelText:e("Location")}),m.a.createElement(G.a,{require:ul}))}},{key:"renderDiscussion",value:function(){if(this.currentPostTypeSupports("comments"))return m.a.createElement(mr.a,null,m.a.createElement(G.a,{require:pl}))}},{key:"renderSeo",value:function(){var e=this.props,t=e.hasConflictingSeoPlugins,n=e.isSeoToolsModuleActive,a=e.isJetpack,o=e.jetpackVersionSupportsSeo,i=e.isRequestingPlugins,s=e.site;if(s&&(!a||!i&&n&&o&&!t)&&sl(s.plan))return m.a.createElement(G.a,{require:ml})}},{key:"renderCopyPost",value:function(){var e=this.props.type;if("post"===e||"page"===e)return m.a.createElement(Xr,null)}},{key:"renderMoreOptions",value:function(){var e=this.props,t=e.isPermalinkEditable,n=e.translate;if(this.currentPostTypeSupports("excerpt")||this.currentPostTypeSupports("geo-location")||this.currentPostTypeSupports("comments")||t)return m.a.createElement(pr.a,{title:n("More Options"),className:"editor-drawer__more-options",e2eTitle:"more-options"},t&&m.a.createElement(Dr,null),this.renderExcerpt(),this.renderLocation(),this.renderDiscussion(),this.renderCopyPost())}},{key:"renderPageOptions",value:function(){if(this.currentPostTypeSupports("page-attributes"))return m.a.createElement(Jr,null)}},{key:"renderStatus",value:function(){var e=this.props.translate;return m.a.createElement(pr.a,{title:e("Status"),e2eTitle:"status"},m.a.createElement(nl,{onSave:this.props.onSave,onPrivatePublish:this.props.onPrivatePublish,setPostDate:this.props.setPostDate,confirmationSidebarStatus:this.props.confirmationSidebarStatus}))}},{key:"render",value:function(){var e=this.props.site;return m.a.createElement("div",{className:"editor-drawer"},e&&m.a.createElement(ie.a,{siteId:e.ID}),e&&m.a.createElement(he.a,{siteId:e.ID}),e&&m.a.createElement(Rr.a,{siteIds:[e.ID]}),this.renderStatus(),this.renderCategories(),this.renderTaxonomies(),this.renderFeaturedImage(),this.renderPageOptions(),this.renderSharing(),this.renderPostFormats(),this.renderSeo(),this.renderMoreOptions())}}]),t}(p.Component);hl.propTypes={site:U.a.object,canJetpackUseTaxonomies:U.a.bool,typeObject:U.a.object,type:U.a.string,setPostDate:U.a.func,onSave:U.a.func,confirmationSidebarStatus:U.a.string},hl.displayName="EditorDrawer";var fl=Object(v.flow)(h.localize,Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(ee.c)(e,t,Object(X.f)(e),"type"),a=Object(Mr.b)(e,[t],"active");return{hasConflictingSeoPlugins:!!Object(il.a)(a),isPermalinkEditable:Ne(e,t),canJetpackUseTaxonomies:Object(ge.I)(e,t,"4.1"),isJetpack:Object(ge.K)(e,t),isSeoToolsModuleActive:Object(ge.J)(e,t,"seo-tools"),jetpackVersionSupportsSeo:Object(ge.I)(e,t,"4.4-beta1"),jetpackVersionSupportsLocation:Object(ge.I)(e,t,"6.3-beta"),isRequestingPlugins:Object(Mr.g)(e,t),type:n,typeObject:Object(se.a)(e,t,n)}})),gl=fl(hl),bl=n("./client/blocks/post-status/index.jsx");function vl(e){var t,n=e.translate,a=e.siteId,o=e.typeSlug,i=e.type,s=e.globalId,r=e.isSettings;"page"===o?t=r?n("Page Settings"):n("Page",{context:"noun"}):"post"===o?t=r?n("Post Settings"):n("Post",{context:"noun"}):i?(t=r?n("%s: Settings",{args:i.labels.singular_name,comment:"type refers to a post type's singular noun"}):i.labels.singular_name,t=Object(oe.b)(t)):t=n("Loadingâ€¦");var l=z()("editor-post-type",{"is-loading":!t});return m.a.createElement("span",{className:l},a&&"page"!==o&&"post"!==o&&m.a.createElement(ie.a,{siteId:a}),t," ",m.a.createElement(bl.a,{globalId:s,showAll:!0,showIcon:!1}))}vl.propTypes={translate:U.a.func,siteId:U.a.number,typeSlug:U.a.string,type:U.a.object,globalId:U.a.string,isSettings:U.a.bool};var yl=Object(F.b)(function(e){var t={},n=Object(Z.d)(e);if(!n)return t;t.siteId=n.ID;var a=Object(ee.a)(e,n.ID,Object(X.f)(e));return a?Object.assign(t,{typeSlug:a.type,type:Object(se.a)(e,n.ID,a.type),globalId:a.global_ID}):t})(Object(h.localize)(vl)),El=function(e){var t=e.closeSidebar,n=e.translate;return m.a.createElement("div",{className:"editor-sidebar__header"},m.a.createElement(yl,{isSettings:!0}),m.a.createElement(J.a,{compact:!0,borderless:!0,className:"editor-sidebar__back",onClick:t,title:n("Close sidebar")},m.a.createElement(Y.a,{icon:"cross"})))};El.propTypes={translate:U.a.func.isRequired,closeSidebar:U.a.func};var jl=Object(v.flow)(h.localize,Object(F.b)(null,{closeSidebar:Ps}))(El),wl=n("./client/layout/sidebar/footer.jsx"),_l=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={isTrashing:!1},n.sendToTrash=function(){var e=n.props,t=e.siteId,a=e.postId,o=e.canDelete;o&&(n.props.onTrashingPost&&n.props.onTrashingPost(),n.setState({isTrashing:!0}),n.props.trashPost(t,a))},n.onSendToTrash=function(){var e,t=n.props,a=t.translate,o=t.postType;n.state.isTrashing||(e=a("page"===o?"Are you sure you want to trash this page?":"Are you sure you want to trash this post?"),Object(Gi.a)(e,function(e){e&&n.sendToTrash()},a("Move to trash"),a("Back")))},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.canDelete,n=e.postId,a=e.postStatus,o=e.translate;if(!t||!n||"trash"===a)return null;var i=z()("editor-delete-post__button",{"is-trashing":this.state.isTrashing}),s=this.state.isTrashing?o("Trashingâ€¦"):o("Move to trash");return m.a.createElement("div",{className:"editor-delete-post"},m.a.createElement(J.a,{borderless:!0,className:i,onClick:this.onSendToTrash,"aria-label":s},m.a.createElement(Y.a,{icon:"trash",size:18}),s))}}]),t}(m.a.Component);_l.displayName="EditorDeletePost",_l.propTypes={siteId:U.a.number,postId:U.a.number,postType:U.a.string,postStatus:U.a.string,canDelete:U.a.bool,onTrashingPost:U.a.func};var Cl=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.a)(e,t,n),o=Object(wa.g)(e),i=!Object(v.isNull)(o)&&Object(v.get)(a,["author","ID"],null)===o;return{siteId:t,postId:n,postType:Object(v.get)(a,"type",null),postStatus:Object(v.get)(a,"status",null),canDelete:Object(tr.a)(e,t,i?"delete_posts":"delete_others_posts")}},{trashPost:E.n})(Object(h.localize)(_l)),Sl=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.onTrashingPost,n=e.onPublish,a=e.onSave,o=e.site,i=e.setPostDate,s=e.confirmationSidebarStatus;return m.a.createElement("div",{className:"editor-sidebar"},m.a.createElement(jl,null),m.a.createElement(gl,{site:o,setPostDate:i,onPrivatePublish:n,onSave:a,confirmationSidebarStatus:s}),m.a.createElement(wl.a,null,m.a.createElement(Cl,{onTrashingPost:t})))}}]),t}(p.Component);Sl.propTypes={onSave:U.a.func,onPublish:U.a.func,onTrashingPost:U.a.func,site:U.a.object,setPostDate:U.a.func,confirmationSidebarStatus:U.a.string};var xl=Sl,kl=n("./client/blocks/site/index.jsx"),Il=n("./node_modules/moment/moment.js"),Ol=n.n(Il),Tl={update:"Clicked Update Post Button",schedule:"Clicked Schedule Post Button",requestReview:"Clicked Request-Review Post Button",publish:"Clicked Publish Post Button"},Pl={update:"Clicked Update Page Button",schedule:"Clicked Schedule Page Button",requestReview:"Clicked Request-Review Page Button",publish:"Clicked Publish Page Button"},Dl=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.onClick=function(){return n.trackClick(),ae.z(n.props.currentPost)&&!ae.s(n.props.currentPost)?n.props.onSave():n.props.canUserPublishPosts?n.props.onPublish():n.props.onSave("pending")},n}return M()(t,e),O()(t,[{key:"trackClick",value:function(){var e=ae.w(this.props.currentPost)?Pl:Tl;this.props.recordEditorEvent(e[this.props.publishButtonStatus]),this.props.recordEditorEvent("Clicked Primary Button")}},{key:"getButtonLabel",value:function(){var e=this.props.translate;switch(this.props.publishButtonStatus){case"update":return e("Update");case"schedule":return this.props.isConfirmationSidebarEnabled?e("Scheduleâ€¦",{comment:"Button label on the editor sidebar - a confirmation step will follow"}):e("Schedule");case"publish":return this.props.isConfirmationSidebarEnabled?this.props.isPublishing?e("Publishingâ€¦",{comment:"Button label on the editor sidebar while publishing is in progress"}):e("Publishâ€¦",{comment:"Button label on the editor sidebar - a confirmation step will follow"}):e("Publish");case"requestReview":return e("Submit for Review");default:return e("Loadingâ€¦")}}},{key:"isBusy",value:function(){return this.props.isPublishing||ae.z(this.props.currentPost)&&this.props.isSaving}},{key:"isEnabled",value:function(){return!this.props.isPublishing&&!this.props.isSaveBlocked&&this.props.hasContent&&!this.props.needsVerification&&!this.props.isPasswordProtectedWithInvalidPassword}},{key:"render",value:function(){return m.a.createElement(J.a,{className:"editor-publish-button",primary:!0,busy:this.isBusy(),onClick:this.onClick,disabled:!this.isEnabled(),tabIndex:this.props.tabIndex,"data-tip-target":"editor-publish-button"},this.getButtonLabel())}}]),t}(p.Component);Dl.propTypes={currentPost:U.a.object,onSave:U.a.func,onPublish:U.a.func,tabIndex:U.a.number,isSaving:U.a.bool,isPublishing:U.a.bool,isSaveBlocked:U.a.bool,hasContent:U.a.bool,needsVerification:U.a.bool,isPasswordProtectedWithInvalidPassword:U.a.bool,isConfirmationSidebarEnabled:U.a.bool,recordEditorEvent:U.a.func.isRequired},Dl.defaultProps={recordEditorEvent:v.noop};var Nl=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.l)(e,t,n),o=Object(X.h)(e),i=Object(tr.a)(e,t,"publish_posts"),s=Object(ee.p)(e,t,n)&&!Object(ee.q)(e,t,n);return{currentPost:a,publishButtonStatus:o,canUserPublishPosts:i,isPasswordProtectedWithInvalidPassword:s}},{recordEditorEvent:Q.a})(Object(h.localize)(Dl)),Rl=n("./client/state/posts/revisions/actions.js"),Ml=function(e){var t=e.translate,n=e.selectHistory;return m.a.createElement("div",{className:"editor-ground-control__history"},m.a.createElement("button",{className:"editor-ground-control__history-button button is-link",onClick:n},t("History")))};Ml.propTypes={translate:U.a.func};var Al=Object(F.b)(null,{selectHistory:function(){return Object(Pn.k)(Object(Pn.i)("calypso_editor_history_button_click"),Object(Rl.b)())}})(Object(h.localize)(Ml)),Ll=function(e){var t=e.isSaving,n=e.isSaveBlocked,a=e.isDirty,o=e.hasContent,i=e.post,s=e.translate,r=e.onSave,l=wi()(e,["isSaving","isSaveBlocked","isDirty","hasContent","post","translate","onSave"]),c=function(e){var t=e.isSaving,n=void 0!==t&&t,a=e.isSaveBlocked,o=void 0!==a&&a,i=e.isDirty,s=void 0!==i&&i,r=e.hasContent,l=void 0!==r&&r,c=e.post,d=void 0===c?null:c;return!n&&!o&&s&&l&&!!d&&!Object(ae.z)(d)}({isSaving:t,isSaveBlocked:n,isDirty:a,hasContent:o,post:i}),d=t||i&&i.ID&&!Object(ae.z)(i),u=c||d,p=i&&!Object(v.isEmpty)(i.revisions);return u||p?m.a.createElement("div",{className:"editor-ground-control__quick-save"},p&&m.a.createElement(Al,null),u&&m.a.createElement("div",{className:"editor-ground-control__status"},c&&m.a.createElement("button",{className:"editor-ground-control__save button is-link",onClick:function(){r();var e=Object(ae.w)(i)?"Clicked Save Page Button":"Clicked Save Post Button";l.recordEditorEvent(e),l.recordEditorStat("save_draft_clicked")},tabIndex:3},s("Save")),!c&&d&&m.a.createElement("span",{className:"editor-ground-control__save-status","data-e2e-status":t?"Savingâ€¦":"Saved"},s(t?"Savingâ€¦":"Saved")))):null};Ll.propTypes={isSaving:U.a.bool,isSaveBlocked:U.a.bool,isDirty:U.a.bool,hasContent:U.a.bool,post:U.a.object,onSave:U.a.func.isRequired,translate:U.a.func,recordEditorEvent:U.a.func,recordEditorStat:U.a.func},Ll.defaultProps={hasContent:!1,isDirty:!1,isSaveBlocked:!1,isSaving:!1,post:null,recordEditorEvent:v.noop,recordEditorStat:v.noop};var Bl=Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(ee.a)(e,t,n);return{post:a}},{recordEditorEvent:Q.a,recordEditorStat:Q.b})(Object(h.localize)(Ll)),Ul=n("./client/layout/masterbar/drafts.jsx"),Fl=n("./client/state/selectors/is-vip-site.js"),ql=n("./client/state/ui/action-log/selectors.js"),zl=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.onPreviewButtonClick=function(e){n.isPreviewEnabled()&&n.props.onPreview(e)},n.onCloseButtonClick=function(){n.props.recordCloseButtonClick(),s.a.show(n.getCloseButtonPath())},n}return M()(t,e),O()(t,[{key:"getPreviewLabel",value:function(){return this.props.translate("Preview")}},{key:"getVerificationNoticeLabel",value:function(){var e=this.props,t=e.translate,n=e.publishButtonStatus;switch(n){case"update":return t("To update, check your email and confirm your address.");case"schedule":return t("To schedule, check your email and confirm your address.");case"publish":return t("To publish, check your email and confirm your address.");case"requestReview":return t("To submit for review, check your email and confirm your address.");default:return null}}},{key:"isPreviewEnabled",value:function(){return this.props.hasContent&&!(this.props.isNew&&!this.props.isDirty)&&!this.props.isSaveBlocked}},{key:"renderGroundControlActionButtons",value:function(){if("open"!==this.props.confirmationSidebarStatus)return m.a.createElement("div",{className:"editor-ground-control__action-buttons"},m.a.createElement(J.a,{borderless:!0,className:"editor-ground-control__toggle-sidebar",onClick:this.props.toggleSidebar},m.a.createElement(Y.a,{icon:"cog"})),m.a.createElement(J.a,{className:"editor-ground-control__preview-button",disabled:!this.isPreviewEnabled(),onClick:this.onPreviewButtonClick,tabIndex:4},m.a.createElement("span",{className:"editor-ground-control__button-label"},this.getPreviewLabel())),m.a.createElement("div",{className:"editor-ground-control__publish-button"},m.a.createElement(Nl,{onSave:this.props.onSave,onPublish:this.props.onPublish,tabIndex:5,isConfirmationSidebarEnabled:this.props.isConfirmationSidebarEnabled,isSaving:this.props.isSaving,isPublishing:this.props.isPublishing,isSaveBlocked:this.props.isSaveBlocked,hasContent:this.props.hasContent,needsVerification:this.props.userNeedsVerification})))}},{key:"getCloseButtonPath",value:function(){var e=Object(v.findLast)(this.props.routeHistory,function(e){return!e.path.match(/^\/(post|page|(edit\/[^\/]+))\/[^\/]+(\/\d+)?$/i)});return e?e.path:this.props.allPostsUrl}},{key:"render",value:function(){var e=this.props,t=e.isSaving,n=e.isSaveBlocked,a=e.isDirty,o=e.hasContent,i=e.onSave,s=e.translate,r=e.userNeedsVerification;return m.a.createElement(Pa.a,{className:"editor-ground-control"},m.a.createElement(J.a,{borderless:!0,className:"editor-ground-control__back",href:"",onClick:this.onCloseButtonClick,"aria-label":s("Close")},s("Close")),m.a.createElement(kl.a,{compact:!0,site:this.props.site,onSelect:this.props.recordSiteButtonClick,indicator:!1}),m.a.createElement(Ul.a,null),r&&m.a.createElement("div",{className:"editor-ground-control__email-verification-notice",tabIndex:7,onClick:this.props.onMoreInfoAboutEmailVerify},m.a.createElement(Y.a,{icon:"info",className:"editor-ground-control__email-verification-notice-icon"}),this.getVerificationNoticeLabel()," ",m.a.createElement("span",{className:"editor-ground-control__email-verification-notice-more"},s("Learn More"))),m.a.createElement(Bl,{isSaving:t,isSaveBlocked:n,isDirty:a,hasContent:o,onSave:i}),this.renderGroundControlActionButtons())}}]),t}(m.a.Component);zl.propTypes={hasContent:U.a.bool,isConfirmationSidebarEnabled:U.a.bool,confirmationSidebarStatus:U.a.string,isDirty:U.a.bool,isSaveBlocked:U.a.bool,isPublishing:U.a.bool,isSaving:U.a.bool,isSidebarOpened:U.a.bool,moment:U.a.func,onPreview:U.a.func,onPublish:U.a.func,onSave:U.a.func,onSaveDraft:U.a.func,onMoreInfoAboutEmailVerify:U.a.func,setPostDate:U.a.func,site:U.a.object,toggleSidebar:U.a.func,translate:U.a.func},zl.defaultProps={hasContent:!1,isConfirmationSidebarEnabled:!0,isDirty:!1,isSaveBlocked:!1,isPublishing:!1,isSaving:!1,moment:Ol.a,onPublish:v.noop,onSaveDraft:v.noop,site:{},translate:v.identity,setPostDate:v.noop};var Vl={recordSiteButtonClick:function(){return Object(Pn.i)("calypso_editor_site_button_click")},recordCloseButtonClick:function(){return Object(Pn.i)("calypso_editor_close_button_click")}},Hl=Object(F.b)(function(e,t){var n=Object(v.get)(t,"site.ID",null);return{publishButtonStatus:Object(X.h)(e),routeHistory:Object(ql.d)(e),userNeedsVerification:!Object(wa.l)(e)&&!Object(Fl.a)(e,n)}},Vl)(Object(h.localize)(zl)),Wl=Object(mi.a)(function(e,t,n,a){return Object(v.get)(e.posts.revisions.diffs,[t,n,"revisions",a],null)},function(e){return[e.posts.revisions.diffs]}),Gl=Wl,Kl=function(e){return Object(v.get)(e,"posts.revisions.selection.revisionId")};var Yl=Object(mi.a)(function(e,t,n){return Object(v.orderBy)(Object(v.values)(Object(v.get)(e.posts.revisions.diffs,[t,n,"revisions"],{})),"post_modified_gmt","desc")},function(e){return[e.posts.revisions.diffs]}),$l=Yl,Jl=Object(mi.a)(function(e,t,n){return Object(v.uniq)(Object(v.map)(Object(v.get)(e.posts.revisions.diffs,[t,n,"revisions"],{}),function(e){return parseInt(e.post_author,10)}))},function(e){return[e.posts.revisions.diffs]}),Ql=Jl;function Zl(e,t,n,a,o){var i=(a||0)+":"+(o||0);return Object(v.get)(e.posts.revisions.diffs,[t,n,i,"diff"],{})}var Xl=Object(mi.a)(function(e,t,n){for(var a=$l(e,t,n),o={},i=0;i<a.length;i++){var s=Object(v.get)(a,[i,"id"],0),r=s&&Object(v.get)(a,[i-1,"id"]),l=s&&Object(v.get)(a,[i+1,"id"]);o[s]={diff:Zl(e,t,n,l,s),nextRevisionId:r,prevRevisionId:l}}return o},function(e){return[e.posts.revisions.diffs]}),ec=Xl,tc=function(e){return Object(v.get)(e,"posts.revisions.ui.diffView","unified")},nc=n("./client/components/text-diff/index.jsx"),ac=n("./client/lib/scroll-to/index.js"),oc=function(e){return Object(v.get)(e,"offsetTop",0)+Object(v.get)(e,"offsetHeight",0)/2},ic=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state={changeOffsets:[],scrollTop:0,viewportHeight:0},n.isBigViewport=!1,n.lastScolledRevisionId=null,n.tryScrollingToFirstChangeOrTop=function(){n.props.selectedRevisionId&&n.props.selectedRevisionId!==n.lastScolledRevisionId&&(n.lastScolledRevisionId=n.props.selectedRevisionId,n.recomputeChanges(function(){n.centerScrollingOnOffset(n.state.changeOffsets[0]||0,!1)}))},n.recomputeChanges=function(e){var t=".text-diff__additions, .text-diff__deletions";n.isBigViewport&&"split"===n.props.diffView&&(t=".editor-diff-viewer__secondary-pane .text-diff__additions, .editor-diff-viewer__main-pane .text-diff__deletions");var a=n.node.querySelectorAll(t);n.setState({changeOffsets:Object(v.map)(a,oc),viewportHeight:Object(v.get)(n.node,"offsetHeight",0),scrollTop:Object(v.get)(n.node,"scrollTop",0)},e)},n.debouncedRecomputeChanges=Object(v.debounce)(function(){n.isBigViewport=Object(De.d)(">1040px"),n.recomputeChanges(null)},500),n.centerScrollingOnOffset=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=Math.max(0,e-n.state.viewportHeight/2);t?Object(ac.a)({container:n.node,x:0,y:a}):n.node.scrollTop=a},n.handleScroll=function(e){n.setState({scrollTop:Object(v.get)(e.target,"scrollTop",0)})},n.throttledScrollHandler=Object(v.throttle)(n.handleScroll,100),n.handleScrollableRef=function(e){e?(n.node=e,n.node.addEventListener("scroll",n.throttledScrollHandler)):(n.node.removeEventListener("scroll",n.throttledScrollHandler),n.node=null)},n.scrollAbove=function(){n.centerScrollingOnOffset(Object(v.last)(n.changesAboveViewport)),n.props.recordTracksEvent("calypso_editor_post_revisions_scroll_hint_used",{direction:"above"})},n.scrollBelow=function(){n.centerScrollingOnOffset(Object(v.first)(n.changesBelowViewport)),n.props.recordTracksEvent("calypso_editor_post_revisions_scroll_hint_used",{direction:"below"})},n}return M()(t,e),O()(t,[{key:"componentDidMount",value:function(){this.tryScrollingToFirstChangeOrTop(),"undefined"!=typeof window&&(window.addEventListener("resize",this.debouncedRecomputeChanges),this.isBigViewport=Object(De.d)(">1040px"))}},{key:"componentWillUnmount",value:function(){"undefined"!=typeof window&&window.removeEventListener("resize",this.debouncedRecomputeChanges)}},{key:"componentDidUpdate",value:function(){this.tryScrollingToFirstChangeOrTop()}},{key:"componentWillReceiveProps",value:function(e){e.selectedRevisionId!==this.props.selectedRevisionId&&this.setState({changeOffsets:[]}),e.diffView!==this.props.diffView&&this.recomputeChanges(null)}},{key:"render",value:function(){var e=this,t=this.props,n=t.diff,a=t.diffView,o=z()("editor-diff-viewer",{"is-loading":!Object(v.has)(n,"post_content")&&!Object(v.has)(n,"post_title"),"is-split":"split"===a}),i=this.state.scrollTop+this.state.viewportHeight;this.changesAboveViewport=Object(v.filter)(this.state.changeOffsets,function(t){return t<e.state.scrollTop}),this.changesBelowViewport=Object(v.filter)(this.state.changeOffsets,function(e){return e>i});var s=this.state.viewportHeight>470,r=this.changesAboveViewport.length,l=this.changesBelowViewport.length;return m.a.createElement("div",{className:o},m.a.createElement("div",{className:"editor-diff-viewer__scrollable",ref:this.handleScrollableRef},m.a.createElement("div",{className:"editor-diff-viewer__main-pane"},m.a.createElement("h1",{className:"editor-diff-viewer__title"},m.a.createElement(nc.a,{operations:n.post_title})),m.a.createElement("pre",{className:"editor-diff-viewer__content"},m.a.createElement(nc.a,{operations:n.post_content,splitLines:!0}))),"split"===a&&m.a.createElement("div",{className:"editor-diff-viewer__secondary-pane"},m.a.createElement("h1",{className:"editor-diff-viewer__title"},m.a.createElement(nc.a,{operations:n.post_title})),m.a.createElement("pre",{className:"editor-diff-viewer__content"},m.a.createElement(nc.a,{operations:n.post_content,splitLines:!0})))),s&&r>0&&m.a.createElement("div",{className:"editor-diff-viewer__hint-above",onClick:this.scrollAbove},m.a.createElement(Y.a,{className:"editor-diff-viewer__hint-icon",size:18,icon:"arrow-up"}),this.props.translate("%(numberOfChanges)d change","%(numberOfChanges)d changes",{args:{numberOfChanges:r},count:r})),s&&l>0&&m.a.createElement("div",{className:"editor-diff-viewer__hint-below",onClick:this.scrollBelow},m.a.createElement(Y.a,{className:"editor-diff-viewer__hint-icon",size:18,icon:"arrow-down"}),this.props.translate("%(numberOfChanges)d change","%(numberOfChanges)d changes",{args:{numberOfChanges:l},count:l})))}}]),t}(p.PureComponent);ic.propTypes={postId:U.a.number.isRequired,selectedRevisionId:U.a.number,siteId:U.a.number.isRequired,diff:U.a.shape({post_content:U.a.array,post_title:U.a.array,totals:U.a.object}).isRequired,diffView:U.a.string,recordTracksEvent:U.a.func.isRequired,translate:U.a.func.isRequired};var sc=Object(v.flow)(h.localize,Object(F.b)(function(e,t){var n=t.siteId,a=t.postId,o=t.selectedRevisionId;return{revision:Gl(e,n,a,o,"display"),diffView:tc(e)}},{recordTracksEvent:Pn.i}))(ic),rc=function(e){var t=e.numRevisions,n=e.translate;return m.a.createElement("div",{className:"editor-revisions-list__header"},m.a.createElement("span",{className:"editor-revisions-list__count"},!!t&&n("%(revisions)d revision","%(revisions)d revisions",{count:t,args:{revisions:t}})))};rc.propTypes={numRevisions:U.a.number.isRequired,translate:U.a.func.isRequired};var lc=Object(h.localize)(rc),cc=function(e){var t=e.translate,n=e.diffView,a=e.viewSplit,o=e.viewUnified;return m.a.createElement(bs.a,{compact:!0,className:"editor-revisions-list__view-buttons"},m.a.createElement(vs.a,{className:"editor-revisions-list__unified-button",onClick:o,selected:"unified"===n},t("Unified")),m.a.createElement(vs.a,{className:"editor-revisions-list__split-button",onClick:a,selected:"split"===n},t("Split")))};cc.propTypes={viewSplit:U.a.func.isRequired,viewUnified:U.a.func.isRequired,translate:U.a.func.isRequired};var dc={viewUnified:Rl.i,viewSplit:Rl.h},uc=Object(F.b)(function(e){return{diffView:tc(e)}},dc)(Object(h.localize)(cc)),pc=n("./client/components/button-group/index.jsx"),mc=function(e){var t=e.nextIsDisabled,n=e.prevIsDisabled,a=e.selectNextRevision,o=e.selectPreviousRevision;return m.a.createElement(pc.a,{className:"editor-revisions-list__navigation"},m.a.createElement(J.a,{compact:!0,className:"editor-revisions-list__prev-button",type:"button",onClick:o,disabled:n},m.a.createElement(Y.a,{icon:"chevron-down"})),m.a.createElement(J.a,{compact:!0,className:"editor-revisions-list__next-button",type:"button",onClick:a,disabled:t},m.a.createElement(Y.a,{icon:"chevron-up"})))};mc.propTypes={selectNextRevision:U.a.func.isRequired,selectPreviousRevision:U.a.func.isRequired,nextIsDisabled:U.a.bool,prevIsDisabled:U.a.bool};var hc=mc,fc=n("./client/state/users/selectors.js"),gc=n("./client/components/time-since/index.jsx"),bc=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.selectRevision=function(){n.props.selectPostRevision(n.props.revision.id)},n}return M()(t,e),O()(t,[{key:"render",value:function(){var e=this.props,t=e.authorName,n=e.revision,a=e.revisionChanges,o=e.isMultiUserSite,i=e.translate,s=Object(v.get)(a,"add",0),r=Object(v.get)(a,"del",0),l={added:s&&i("%(changes)d word added","%(changes)d words added",{args:{changes:s},count:s}),removed:r&&i("%(changes)d word removed","%(changes)d words removed",{args:{changes:r},count:r})};return m.a.createElement("button",{className:"editor-revisions-list__button",onClick:this.selectRevision,type:"button"},m.a.createElement("span",{className:"editor-revisions-list__date"},m.a.createElement(gc.a,{date:Object(v.get)(n,"post_modified_gmt"),dateFormat:"lll"})),t&&o&&m.a.createElement("span",{className:"editor-revisions-list__author"},t),m.a.createElement("div",{className:"editor-revisions-list__changes"},s>0&&m.a.createElement("span",{className:"editor-revisions-list__additions","aria-label":l.added,title:l.added},m.a.createElement("b",null,"+"),s),r>0&&m.a.createElement("span",{className:"editor-revisions-list__deletions","aria-label":l.removed,title:l.removed},m.a.createElement("b",null,"-"),r),0===s&&0===r&&m.a.createElement("span",{className:"editor-revisions-list__minor-changes"},i("minor",{context:"post revisions: minor changes"}))))}}]),t}(p.PureComponent);bc.propTypes={postId:U.a.number,revision:U.a.object.isRequired,revisionChanges:U.a.object.isRequired,siteId:U.a.number.isRequired,authorName:U.a.string,isMultiUserSite:U.a.bool.isRequired,selectPostRevision:U.a.func.isRequired,translate:U.a.func.isRequired};var vc=Object(v.flow)(h.localize,Object(F.b)(function(e,t){var n=t.revision,a=t.siteId;return{authorName:Object(v.get)(Object(fc.a)(e,Object(v.get)(n,"post_author")),"display_name",""),isMultiUserSite:!Object(ge.R)(e,a)}},{selectPostRevision:Rl.g}))(bc),yc=n("./client/lib/keyboard-shortcuts/index.js"),Ec=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.selectRevision=function(e){n.props.selectPostRevision(e)},n.trySelectingLatestRevision=function(){var e=n.props.latestRevisionId;e&&n.selectRevision(e)},n.selectNextRevision=function(){var e=n.props.nextRevisionId;e&&n.selectRevision(e)},n.selectPreviousRevision=function(){var e=n.props.prevRevisionId;e&&n.selectRevision(e)},n}return M()(t,e),O()(t,[{key:"componentDidMount",value:function(){window.scrollTo(0,0),yc.a.on("move-selection-up",this.selectNextRevision),yc.a.on("move-selection-down",this.selectPreviousRevision),this.props.selectedRevisionId||this.trySelectingLatestRevision()}},{key:"componentWillUnmount",value:function(){yc.a.off("move-selection-up",this.selectNextRevision),yc.a.off("move-selection-down",this.selectPreviousRevision)}},{key:"componentDidUpdate",value:function(e){this.props.selectedRevisionId||this.trySelectingLatestRevision(),this.props.selectedRevisionId!==e.selectedRevisionId&&this.scrollToSelectedItem()}},{key:"scrollToSelectedItem",value:function(){var e=L.a.findDOMNode(this),t=e.querySelector(".editor-revisions-list__scroller"),n=e.querySelector(".editor-revisions-list__revision.is-selected"),a=e.querySelector(".editor-revisions-list__list");if(t&&n&&a){var o=n.getBoundingClientRect(),i=o.top,s=o.right,r=o.bottom,l=o.left,c=a.getBoundingClientRect(),d=c.top,u=c.left,p=c.width,m=c.height,h=t.getBoundingClientRect(),f=h.top,g=h.bottom,b=h.height,v=h.left,y=h.right,E=h.width;if(p>m){var j=l<v,w=s>y,_=l-u,C=Math.abs(E-(s-u));(j||w)&&(t.scrollLeft=j?_:C)}else{var S=i<f,x=r>g,k=i-d,I=Math.abs(b-(r-d));(S||x)&&(t.scrollTop=S?k:I)}}}},{key:"render",value:function(){var e=this.props,t=e.comparisons,n=e.nextIsDisabled,a=e.prevIsDisabled,o=e.postId,i=e.revisions,s=e.selectedRevisionId,r=e.siteId,l=z()("editor-revisions-list",{"is-loading":Object(v.isEmpty)(i)});return m.a.createElement("div",{className:l},m.a.createElement(lc,{numRevisions:i.length}),m.a.createElement(uc,null),m.a.createElement(hc,{nextIsDisabled:n,prevIsDisabled:a,selectNextRevision:this.selectNextRevision,selectPreviousRevision:this.selectPreviousRevision}),m.a.createElement("div",{className:"editor-revisions-list__scroller"},m.a.createElement("ul",{className:"editor-revisions-list__list"},Object(v.map)(i,function(e){var n=z()("editor-revisions-list__revision",{"is-selected":e.id===s}),a=Object(v.get)(t,[e.id,"diff","totals"],{});return m.a.createElement("li",{className:n,key:e.id},m.a.createElement(vc,{postId:o,revision:e,revisionChanges:a,siteId:r}))}))))}}]),t}(p.PureComponent);Ec.propTypes={comparisons:U.a.object,postId:U.a.number,siteId:U.a.number,revisions:U.a.array.isRequired,selectedRevisionId:U.a.number,nextIsDisabled:U.a.bool,prevIsDisabled:U.a.bool};var jc=Object(F.b)(function(e,t){var n=t.comparisons,a=t.revisions,o=t.selectedRevisionId,i=Object(v.get)(n,[o],{}),s=i.nextRevisionId,r=i.prevRevisionId,l=Object(v.get)(Object(v.head)(a),"id"),c=l===o,d=!c&&Object(v.get)(Object(v.last)(a),"id")===o,u=c||1===a.length,p=d||1===a.length;return{latestRevisionId:l,prevIsDisabled:p,nextIsDisabled:u,nextRevisionId:s,prevRevisionId:r}},{selectPostRevision:Rl.g})(Ec),wc=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"componentWillMount",value:function(){this.request()}},{key:"componentDidUpdate",value:function(e){this.props.siteId===e.siteId&&this.props.postId===e.postId||this.request()}},{key:"request",value:function(){var e=this.props,t=e.comparisons,n=e.postId,a=e.postType,o=e.siteId;this.props.requestPostRevisions(o,n,a,t)}},{key:"render",value:function(){return null}}]),t}(p.Component);wc.propTypes={comparisons:U.a.array,postId:U.a.number,siteId:U.a.number,postType:U.a.string,requestPostRevisions:U.a.func};var _c=Object(F.b)(function(e,t){var n=t.postId,a=t.siteId;return{postType:Object(ee.c)(e,a,n,"type")}},{requestPostRevisions:Rl.f})(wc),Cc=n("./node_modules/react-pure-render/shallowEqual.js"),Sc=n.n(Cc),xc=n("./client/state/users/actions.js"),kc=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"componentWillMount",value:function(){this.request()}},{key:"componentDidUpdate",value:function(e){Sc()(this.props.userIds,e.userIds)&&this.props.siteId===e.siteId||this.request()}},{key:"request",value:function(){var e=this.props,t=e.siteId,n=e.userIds,a=e.currentUserId,o=n.filter(function(e){return e!==a});o.length&&this.props.requestUsers(t,o)}},{key:"render",value:function(){return null}}]),t}(p.Component);kc.propTypes={currentUserId:U.a.number,requestUsers:U.a.func,siteId:U.a.number,userIds:U.a.arrayOf(U.a.number)};var Ic=Object(F.b)(function(e){return{currentUserId:Object(wa.g)(e)}},{requestUsers:xc.b})(kc),Oc=function(e){function t(){return k()(this,t),P()(this,N()(t).apply(this,arguments))}return M()(t,e),O()(t,[{key:"componentDidMount",value:function(){this.props.recordTracksEvent("calypso_editor_post_revisions_open")}},{key:"render",value:function(){var e=this.props,t=e.authorsIds,n=e.comparisons,a=e.postId,o=e.revisions,i=e.selectedDiff,s=e.selectedRevisionId,r=e.siteId;return m.a.createElement("div",{className:"editor-revisions__wrapper"},m.a.createElement(_c,{postId:a,siteId:r,selectedRevisionId:s}),m.a.createElement(Ic,{siteId:r,userIds:t}),m.a.createElement(sc,{diff:i,postId:a,selectedRevisionId:s,siteId:r}),m.a.createElement(jc,{comparisons:n,postId:a,revisions:o,selectedRevisionId:s,siteId:r}))}}]),t}(p.Component);Oc.propTypes={authorsIds:U.a.array.isRequired,comparisons:U.a.object,postId:U.a.number.isRequired,revisions:U.a.array.isRequired,selectedDiff:U.a.object,selectedRevisionId:U.a.number,siteId:U.a.number.isRequired,recordTracksEvent:U.a.func.isRequired,translate:U.a.func.isRequired};var Tc=Object(v.flow)(h.localize,Object(F.b)(function(e){var t=Object(X.f)(e),n=Object(Z.e)(e),a=$l(e,n,t),o=Kl(e),i=ec(e,n,t),s=Object(v.get)(i,[o,"diff"],{});return{authorsIds:Ql(e,n,t),comparisons:i,postId:t,revisions:a,selectedDiff:s,selectedRevisionId:o,siteId:n}},{recordTracksEvent:Pn.i}))(Oc),Pc=n("./client/components/close-on-escape/index.jsx"),Dc=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.onLoadClick=function(){var e=n.props,t=e.loadRevision,a=e.revision,o=e.closeDialog;t(a),o(),n.props.recordTracksEvent("calypso_editor_post_revisions_load_revision")},n.dialogButtons=function(){var e=n.props,t=e.postId,a=e.revision,o=e.siteId,i=e.translate;return[{action:"cancel",compact:!0,label:i("Cancel")},{action:"load",compact:!0,disabled:!(a&&t&&o),isPrimary:!0,label:i("Load",{context:"Load revision in editor"}),onClick:n.onLoadClick}]},n}return M()(t,e),O()(t,[{key:"componentWillMount",value:function(){this.toggleBodyClass({isVisible:this.props.isVisible}),this.props.selectPostRevision(null)}},{key:"componentWillUpdate",value:function(e){var t=e.isVisible;this.toggleBodyClass({isVisible:t})}},{key:"toggleBodyClass",value:function(e){var t=e.isVisible;if("object"===("undefined"==typeof document?"undefined":st()(document))&&Object(v.get)(document,"body.classList")){t?document.body.classList.add("showing-post-revisions-dialog"):document.body.classList.remove("showing-post-revisions-dialog")}}},{key:"render",value:function(){var e=this.props,t=e.isVisible,n=e.closeDialog;return m.a.createElement(We.a,{buttons:this.dialogButtons(),className:"editor-revisions__dialog",isVisible:t,onClose:n},m.a.createElement(Pc.a,{onEscape:n}),m.a.createElement(Tc,null))}}]),t}(p.PureComponent);Dc.propTypes={loadRevision:U.a.func.isRequired,isVisible:U.a.bool.isRequired,closeDialog:U.a.func.isRequired,recordTracksEvent:U.a.func.isRequired,translate:U.a.func.isRequired};var Nc=Object(v.flow)(h.localize,Object(F.b)(function(e){return{isVisible:function(e){return Object(v.get)(e,"posts.revisions.ui.isDialogVisible",!1)}(e),postId:Object(X.f)(e),revision:function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Kl(e);return Gl(e,t,n,a)}(e),siteId:Object(Z.e)(e)}},{recordTracksEvent:Pn.i,closeDialog:Rl.a,selectPostRevision:Rl.g}))(Dc),Rc=n("./client/lib/analytics/page-view-tracker/index.jsx"),Mc=function(e){function t(){var e,n;k()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=P()(this,(e=N()(t)).call.apply(e,[this].concat(o))),n.state=n.getDefaultState(),n._previewWindow=null,n.storeEditor=function(e){n.editor=e},n.hideNotice=function(){n.setState({notice:null})},n.setConfirmationSidebar=function(e){var t=e.status,a=e.context,o=void 0===a?null:a,i=["closed","open","publishing"].indexOf(t)>-1?t:"closed",s="open"===n.props.editorSidebarPreference?"sidebar":"content";switch(n.setState({confirmationSidebar:i}),i){case"closed":n.props.setLayoutFocus(s),n.props.recordTracksEvent("calypso_editor_confirmation_sidebar_close",{context:o});break;case"open":n.props.setLayoutFocus("editor-confirmation-sidebar"),n.props.recordTracksEvent("calypso_editor_confirmation_sidebar_open")}},n.copySelectedText=function(){var e=H.a.activeEditor.selection.getContent()||null;n.state.selectedText!==e&&n.setState({selectedText:e||null})},n.handleConfirmationSidebarPreferenceChange=function(e){n.setState({confirmationSidebarPreference:e.target.checked})},n.toggleSidebar=function(){"sidebar"===n.props.layoutFocus?n.props.closeEditorSidebar():n.props.openEditorSidebar()},n.loadRevision=function(e){n.restoreRevision({content:e.post_content,excerpt:e.post_excerpt,title:e.post_title}),Object(De.d)("<660px")&&n.props.setLayoutFocus("content")},n.restoreTrashed=function(){n.onSave("draft")},n.restoreAutosave=function(){n.setState({showAutosaveDialog:!1}),n.restoreRevision(Object(v.get)(n.props.post,"meta.data.autosave"))},n.restoreRevision=function(e){n.props.editPost(n.props.siteId,n.props.postId,{excerpt:e.excerpt,title:e.title,content:e.content}),n.editor&&n.editor.setEditorContent(e.content,{initial:!0})},n.closeAutosaveDialog=function(){n.setState({showAutosaveDialog:!1})},n.closeVerifyEmailDialog=function(){n.setState({showVerifyEmailDialog:!1})},n.onEditedPostChange=function(e){e.loadingError||(e.isNew&&!n.props.isNew||e.isLoading?n.setState(n.getDefaultState(),function(){return n.editor&&n.editor.setEditorContent("")}):n.editor&&n.props.isLoading&&!e.isLoading&&n.editor.setEditorContent(e.post.content,{initial:!0}))},n.isSaveBlocked=function(){return n.props.isSaveBlocked||!n.state.isEditorInitialized},n.onEditorInitialized=function(){n.setState({isEditorInitialized:!0})},n.onEditorTitleChange=function(){"open"===n.state.confirmationSidebar&&n.setConfirmationSidebar({status:"closed",context:"content_edit"}),n.debouncedAutosave()},n.onEditorContentChange=function(){n.debouncedSaveRawContent(),n.debouncedAutosave()},n.onEditorTextContentChange=function(){"open"===n.state.confirmationSidebar&&n.setConfirmationSidebar({status:"closed",context:"content_edit"}),n.debouncedSaveRawContent(),n.debouncedAutosave()},n.onEditorKeyUp=function(){"open"===n.state.confirmationSidebar&&n.setConfirmationSidebar({status:"closed",context:"content_edit"}),n.debouncedCopySelectedText(),n.debouncedSaveRawContent()},n.onEditorFocus=function(){L.a.findDOMNode(n.editor).click()},n.saveRawContent=function(){n.props.editorEditRawContent(n.editor.getContent({format:"raw"})),n.debouncedSaveRawContent.cancel()},n.autosave=S()(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.throttledAutosave.cancel(),n.debouncedAutosave.cancel(),!0!==n.state.isSaving&&!n.isSaveBlocked()){e.next=4;break}return e.abrupt("return");case 4:return n.syncEditorContent(),t=ae.z(n.props.savedPost)||ae.z(n.props.post),t||n.setState({isSaving:!0}),e.prev=7,e.next=10,n.props.autosave();case 10:a=e.sent,t||n.onSaveDraftSuccess(a),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),t||n.onSaveDraftFailure(e.t0);case 17:case"end":return e.stop()}},e,this,[[7,14]])})),n.onClose=function(){s.a.back(n.getAllPostsUrl())},n.getAllPostsUrl=function(e){var t,a=n.props,o=a.type,i=a.selectedSite,s=i;switch(o){case"page":t="/pages";break;case"post":t="/posts";break;default:t="/types/"+o}return"post"!==o||!s||s.jetpack||s.single_user_site||(t+="/my"),"trashed"===e&&(t+="/trashed"),s&&(t=Object(j.b)(t,s.slug)),t},n.onMoreInfoAboutEmailVerify=function(){n.setState({showVerifyEmailDialog:!0})},n.onTrashingPost=function(){var e=n.props.type;n.props.recordEditorStat(e+"_trashed"),n.props.recordEditorEvent("page"===e?"Clicked Trash Page Button":"Clicked Trash Post Button"),n.props.markSaved(),s()(n.getAllPostsUrl("trashed"))},n.onSave=function(e){!ae.z(n.props.savedPost)&&ae.z(n.props.post,e)||(n.setState({isSaving:!0}),e&&n.props.editPost(n.props.siteId,n.props.postId,{status:e}),n.syncEditorContent(),n.props.saveEdited().then(n.onSaveDraftSuccess,n.onSaveDraftFailure))},n.onPreview=function(){var e=S()(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.recordPreviewButtonClick(),!n.props.isSitePreviewable||t.metaKey||t.ctrlKey){e.next=3;break}return e.abrupt("return",n.iframePreview());case 3:if(n._previewWindow&&!n._previewWindow.closed||(n._previewWindow=window.open("about:blank","WordPress.com Post Preview")),!n.props.isDirty){e.next=7;break}return e.next=7,n.autosave();case 7:a=n.props.previewUrl,n._previewWindow?(n._previewWindow.location=a,n._previewWindow.focus()):n._previewWindow=window.open(a,"WordPress.com Post Preview");case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.iframePreview=S()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.props.isDirty&&n.autosave(),n.setState({showPreview:!0});case 2:case"end":return e.stop()}},e,this)})),n.onPreviewClose=function(){n.state.isPostPublishPreview?s.a.back(n.getAllPostsUrl()):n.setState({showPreview:!1,isPostPublishPreview:!1})},n.onPreviewEdit=function(){return"open"===n.props.editorSidebarPreference&&n.props.setNextLayoutFocus("sidebar"),n.hideNotice(),n.setState({showPreview:!1,isPostPublishPreview:!1}),!1},n.onSaveDraftFailure=function(e){n.onSaveFailure(e,"saveFailure")},n.onSaveDraftSuccess=function(e){n.onSaveSuccess(e,"save")},n.onPublish=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(n.props.isConfirmationSidebarEnabled){if(!1===e)return void n.setConfirmationSidebar({status:"open"});"open"===n.state.confirmationSidebar&&n.setConfirmationSidebar({status:"publishing"})}n.setState({isSaving:!0,isPublishing:!0});var t=n.getPublishStatus();n.props.editPost(n.props.siteId,n.props.postId,{status:t}),n.syncEditorContent(),n.props.saveEdited().then(n.onPublishSuccess,n.onPublishFailure)},n.onPublishFailure=function(e){n.props.isConfirmationSidebarEnabled&&n.setConfirmationSidebar({status:"closed",context:"publish_failure"}),n.onSaveFailure(e,"publishFailure")},n.onPublishSuccess=function(e){n.state.confirmationSidebarPreference||n.props.saveConfirmationSidebarPreference(n.props.siteId,!1),n.props.isConfirmationSidebarEnabled&&n.setConfirmationSidebar({status:"closed",context:"publish_success"}),n.onSaveSuccess(e,"publish")},n.onSaveFailure=function(e,t){n.setState({isSaving:!1,isPublishing:!1,notice:{status:"is-error",error:e,message:t}})},n.setPostDate=function(e){var t=n.props,a=t.siteId,o=t.postId,i=!!e&&e.format();n.props.editPost(a,o,{date:i}),n.props.recordTracksEvent("calypso_editor_publish_date_change",{context:"open"===n.state.confirmationSidebar?"confirmation-sidebar":"post-settings"})},n.onSaveSuccess=function(e,t){var a=null;if(e){var o=e.receivedPost;"save"===t?ae.z(o)&&(a="updated"):"publish"===t&&(a=ae.y(o)?"publishedPrivately":ae.v(o)?"scheduled":"published")}var i={isSaving:!1,isPublishing:!1};if(a?(i.notice={status:"is-success",message:a},window.scrollTo(0,0),n.props.isSitePreviewable&&"published"===a&&(n.setState({isPostPublishPreview:!0}),n.iframePreview())):i.notice=null,n.setState(i),e&&e.idAssigned){var r=ae.e(e.receivedPost,n.props.selectedSite);s.a.replace(r,null,!1,!1)}},n.getContainingTagInfo=function(e,t){var n=e.lastIndexOf("<",t),a=e.lastIndexOf(">",t);if(n>a){var o=e.substr(n),i=o.match(/<\s*(\/)?(\w+)/);if(!i)return null;var s=i[2],r=o.indexOf(">"),l=!!i[1];return{ltPos:n,gtPos:n+r+1,tagType:s,isClosingTag:l}}return null},n.getCursorMarkerSpan=function(e){var t=e||"start";return'<span\n\t\t\t\tdata-mce-type="bookmark"\n\t\t\t\tid="mce_SELREST_'+t+'"\n\t\t\t\tdata-mce-style="overflow:hidden;line-height:0"\n\t\t\t\tstyle="overflow:hidden;line-height:0"\n\t\t\t>&#65279;</span>'},n.addHTMLBookmarkInTextAreaContent=function(){var e=n.editor._editor.getElement(),t=e.selectionStart,a=e.selectionEnd,o=n.getContainingTagInfo(e.value,t);o&&(t=o.ltPos);var i=n.getContainingTagInfo(e.value,a);i&&(a=i.gtPos);var s=t!==a?"range":"single",r=null;if("range"===s){var l=n.getCursorMarkerSpan("end");r=[e.value.slice(t,a),l].join("")}e.value=[e.value.slice(0,t),n.getCursorMarkerSpan("start"),r,e.value.slice(a)].join(""),n.editor.onTextAreaChange({target:{value:e.value}})},n.focusHTMLBookmarkInVisualEditor=function(e){var t=e.target.getDoc().getElementById("mce_SELREST_start"),a=e.target.getDoc().getElementById("mce_SELREST_end");if(t){if(e.target.focus(),a){var o=document.createRange();o.setStart(t,0),o.setEnd(a,0),e.target.selection.setRng(o),a.parentNode.removeChild(a)}else e.target.selection.select(t);t.parentNode.removeChild(t),e.target.off("SetContent",n.focusHTMLBookmarkInVisualEditor)}},n.findBookmarkedPosition=function(e){var t=e.getWin(),n=t.getSelection();if(!(n.rangeCount<=0)){var a="SELRES_"+Object(W.v4)(),o=document.createElement("span");o.className="mce_SELRES_start",o.style.display="inline-block",o.style.width=0,o.style.overflow="hidden",o.style.lineHeight="0px",o.innerHTML=a;var i=document.createElement("span");i.className="mce_SELRES_end",i.style.display="inline-block",i.style.width=0,i.style.overflow="hidden",i.style.lineHeight="0px",i.innerHTML=a;var s=n.getRangeAt(0),r=s.startContainer,l=s.startOffset,c=s.cloneRange();c.collapse(!1),c.insertNode(i),c.setStart(r,l),c.collapse(!0),c.insertNode(o),s.setStartAfter(o),s.setEndBefore(i),n.removeAllRanges(),n.addRange(s);var d=Object(oe.e)(e.getContent()),u=new RegExp('<span[^>]*\\s*class="mce_SELRES_start"[^>]+>\\s*'+a+"[^<]*<\\/span>"),p=new RegExp('<span[^>]*\\s*class="mce_SELRES_end"[^>]+>\\s*'+a+"[^<]*<\\/span>"),m=d.match(u),h=d.match(p);return m?{start:m.index,end:h?h.index-m[0].length:null}:null}},n.switchEditorMode=function(e){var t=n.editor.getContent();if("html"===e){var a=n.findBookmarkedPosition(n.editor._editor);n.editor.setEditorContent(t),n.state.selectedText&&n.copySelectedText(),n.editor.setSelection(a)}else"tinymce"===e&&(n.addHTMLBookmarkInTextAreaContent(),n.editor._editor.on("SetContent",n.focusHTMLBookmarkInVisualEditor));n.props.setEditorModePreference(e),n.setState({mode:e},function(){n.syncEditorContent({resetRawContent:!0,content:t})})},n}return M()(t,e),O()(t,[{key:"getDefaultState",value:function(){return{mode:this.props.editorModePreference||"tinymce",confirmationSidebar:"closed",confirmationSidebarPreference:!0,isSaving:!1,isPublishing:!1,notice:null,selectedText:null,showVerifyEmailDialog:!1,showAutosaveDialog:!0,isTitleFocused:!1,showPreview:!1,isPostPublishPreview:!1}}},{key:"componentWillMount",value:function(){this.debouncedSaveRawContent=Object(v.debounce)(this.saveRawContent,200),this.throttledAutosave=Object(v.throttle)(this.autosave,2e4),this.debouncedAutosave=Object(v.debounce)(this.throttledAutosave,3e3),this.switchEditorVisualMode=this.switchEditorMode.bind(this,"tinymce"),this.switchEditorHtmlMode=this.switchEditorMode.bind(this,"html"),this.debouncedCopySelectedText=Object(v.debounce)(this.copySelectedText,200),this.useDefaultSidebarFocus(),Ln.default.mc.bumpStat("calypso_default_sidebar_mode",this.props.editorSidebarPreference),this.setState({isEditorInitialized:!1})}},{key:"componentWillUpdate",value:function(e,t){t.isSaving&&!this.state.isSaving&&(this.debouncedAutosave.cancel(),this.throttledAutosave.cancel()),e.isDirty?this.props.markChanged():this.props.markSaved()}},{key:"componentDidMount",value:function(){this.props.post&&this.props.post.content&&this.editor.setEditorContent(this.props.post.content,{initial:!0}),this.props.editorModePreference&&Ln.default.mc.bumpStat("calypso_default_editor_mode",this.props.editorModePreference)}},{key:"componentWillUnmount",value:function(){this.debouncedAutosave.cancel(),this.throttledAutosave.cancel(),this.debouncedSaveRawContent.cancel(),this.debouncedCopySelectedText.cancel(),this._previewWindow=null,clearTimeout(this._switchEditorTimeout)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.siteId,a=t.postId;e.siteId===n&&e.postId===a||this.useDefaultSidebarFocus(e),this.onEditedPostChange(e)}},{key:"useDefaultSidebarFocus",value:function(e){var t=e||this.props;Object(De.d)(">660px")&&("open"===t.editorSidebarPreference||t.hasBrokenPublicizeConnection)&&this.props.setLayoutFocus("sidebar")}},{key:"render",value:function(){var e=this.props.selectedSite,t=this.state.mode,n=this.props.loadingError,a="trash"===Object(v.get)(this.props.post,"status"),o=Object(v.get)(this.props.post,"meta.data.autosave"),i=z()("post-editor",{"is-loading":!this.state.isEditorInitialized});return m.a.createElement("div",{className:i},m.a.createElement(Rc.a,{path:this.props.analyticsPath,title:this.props.analyticsTitle}),m.a.createElement(cr.a,null),m.a.createElement(Ys,{handlePreferenceChange:this.handleConfirmationSidebarPreferenceChange,onPrivatePublish:this.onPublish,onPublish:this.onPublish,setPostDate:this.setPostDate,setStatus:this.setConfirmationSidebar,status:this.state.confirmationSidebar}),m.a.createElement(Qs,null),m.a.createElement(er,null),m.a.createElement(ar,null),m.a.createElement(Nc,{loadRevision:this.loadRevision}),m.a.createElement("div",{className:"post-editor__inner"},m.a.createElement(Hl,{setPostDate:this.setPostDate,hasContent:this.props.hasContent,isConfirmationSidebarEnabled:this.props.isConfirmationSidebarEnabled,confirmationSidebarStatus:this.state.confirmationSidebar,isDirty:this.props.isDirty,isSaveBlocked:this.isSaveBlocked(),isPublishing:this.state.isPublishing,isSaving:this.state.isSaving,onPreview:this.onPreview,onPublish:this.onPublish,onSave:this.onSave,onSaveDraft:this.props.onSaveDraft,site:e,toggleSidebar:this.toggleSidebar,onMoreInfoAboutEmailVerify:this.onMoreInfoAboutEmailVerify,allPostsUrl:this.getAllPostsUrl(),isSidebarOpened:"sidebar"===this.props.layoutFocus}),m.a.createElement("div",{className:"post-editor__content"},m.a.createElement("div",{className:"post-editor__content-editor"},m.a.createElement(ye,null),m.a.createElement("div",{className:"post-editor__site"},m.a.createElement(kl.a,{compact:!0,site:e,indicator:!1,homeLink:!0,externalLink:!0}),this.props.isDirty?m.a.createElement(Bl,{isSaving:this.state.isSaving,isSaveBlocked:this.isSaveBlocked(),isDirty:this.props.isDirty,hasContent:this.props.hasContent,onSave:this.onSave}):m.a.createElement(pe,null)),m.a.createElement("div",{className:"post-editor__inner-content"},m.a.createElement(Ee.a,{maxWidth:1462,hasDropZone:!0}),m.a.createElement("div",{className:"post-editor__header"},m.a.createElement(Ae,{onChange:this.onEditorTitleChange,tabIndex:1}),m.a.createElement(Be,null),m.a.createElement(bs.a,{className:"post-editor__switch-mode",compact:!0},m.a.createElement(vs.a,{selected:"tinymce"===t,onClick:this.switchEditorVisualMode,title:this.props.translate("Edit with a visual editor")},this.props.translate("Visual",{context:"Editor writing mode"})),m.a.createElement(vs.a,{selected:"html"===t,onClick:this.switchEditorHtmlMode,title:this.props.translate("Edit the raw HTML code")},"HTML"))),m.a.createElement("hr",{className:"post-editor__header-divider"}),m.a.createElement(gs,{ref:this.storeEditor,mode:t,tabIndex:2,isNew:this.props.isNew,onSetContent:this.debouncedSaveRawContent,onInit:this.onEditorInitialized,onChange:this.onEditorContentChange,onKeyUp:this.onEditorKeyUp,onFocus:this.onEditorFocus,onMouseUp:this.copySelectedText,onBlur:this.copySelectedText,onTextEditorChange:this.onEditorTextContentChange}),m.a.createElement(lr,{selectedText:this.state.selectedText})))),m.a.createElement(xl,{onPublish:this.onPublish,onTrashingPost:this.onTrashingPost,site:e,setPostDate:this.setPostDate,onSave:this.onSave,confirmationSidebarStatus:this.state.confirmationSidebar}),this.props.isSitePreviewable?m.a.createElement(Os,{showPreview:this.state.showPreview,onClose:this.onPreviewClose,onEdit:this.onPreviewEdit,isSaving:this.state.isSaving||this.props.isAutosaving,isLoading:this.props.isLoading,isFullScreen:this.state.isPostPublishPreview,previewUrl:this.props.previewUrl,postId:this.props.postId,externalUrl:this.getExternalUrl(),revision:Object(v.get)(this.props.post,"revisions.length",0)}):null,m.a.createElement(ir,_()({},this.state.notice,{onDismissClick:this.hideNotice}))),a?m.a.createElement(ws,{onClose:this.onClose,onRestore:this.restoreTrashed}):null,this.state.showVerifyEmailDialog?m.a.createElement(_s.a,{onClose:this.closeVerifyEmailDialog}):null,n&&m.a.createElement(Es,{onClose:this.onClose}),o&&this.state.showAutosaveDialog?m.a.createElement(ws,{onRestore:this.restoreAutosave,onClose:this.closeAutosaveDialog,isAutosave:!0}):null)}},{key:"syncEditorContent",value:function(e){var t=Object(v.get)(e,"resetRawContent",!1),n=Object(v.get)(e,"content",this.editor.getContent());t&&this.props.editorResetRawContent(),this.saveRawContent(),n!==Object(v.get)(this.props.post,"content",null)&&this.props.editPost(this.props.siteId,this.props.postId,{content:n})}},{key:"getExternalUrl",value:function(){var e=this.props.post;return e?e.URL:this.props.previewUrl}},{key:"recordPreviewButtonClick",value:function(){var e="page"===this.props.type;this.props.recordTracksEvent(e?"calypso_editor_page_preview_button_click":"calypso_editor_post_preview_button_click"),this.props.recordGoogleEvent("Editor",e?"Clicked Preview Page Button":"Clicked Preview Post Button",e?"Editor Preview Page Button Clicked":"Editor Preview Post Button Clicked",e?"editorPageButtonClicked":"editorPostButtonClicked")}},{key:"getPublishStatus",value:function(){return ae.y(this.props.post)?"private":ae.v(this.props.post)?"future":"publish"}}]),t}(m.a.Component);Mc.propTypes={siteId:U.a.number,preferences:U.a.object,setEditorModePreference:U.a.func,setLayoutFocus:U.a.func.isRequired,setNextLayoutFocus:U.a.func.isRequired,editorModePreference:U.a.string,editorSidebarPreference:U.a.string,markChanged:U.a.func.isRequired,markSaved:U.a.func.isRequired,translate:U.a.func.isRequired,hasBrokenPublicizeConnection:U.a.bool,editPost:U.a.func,type:U.a.string,analyticsPath:U.a.string,analyticsTitle:U.a.string};var Ac=Object(v.flow)(h.localize,ur.c,Object(F.b)(function(e){var t=Object(Z.e)(e),n=Object(X.f)(e),a=Object(wa.g)(e);return{siteId:t,postId:n,savedPost:Object(ee.l)(e,t,n),post:Object(ee.a)(e,t,n),type:Object(ee.c)(e,t,n,"type"),selectedSite:Object(Z.d)(e),editorModePreference:Object(ma.b)(e,"editor-mode"),editorSidebarPreference:Object(ma.b)(e,"editor-sidebar")||"open",isNew:Object(X.m)(e),isDirty:Object(ee.o)(e,t,n),hasContent:Object(Ds.a)(e,t,n),layoutFocus:Object(dr.a)(e),hasBrokenPublicizeConnection:Object(Ns.a)(e,t,a),isSitePreviewable:Object(ge.S)(e,t),isConfirmationSidebarEnabled:Object(X.j)(e,t),isSaveBlocked:Object(X.n)(e),previewUrl:Object(X.g)(e),isAutosaving:Object(X.k)(e),isLoading:Object(X.l)(e),loadingError:Object(X.c)(e)}},{autosave:E.b,saveEdited:E.j,editPost:E.e,setEditorModePreference:Object(v.partial)(pa.b,"editor-mode"),setLayoutFocus:Ts.b,setNextLayoutFocus:Ts.c,saveConfirmationSidebarPreference:ia.k,recordTracksEvent:Pn.i,recordGoogleEvent:Pn.g,recordEditorStat:Q.b,recordEditorEvent:Q.a,closeEditorSidebar:Ps,openEditorSidebar:function(){return function(e){e(Object(pa.b)("editor-sidebar","open")),e(Object(Pn.k)(Object(Pn.b)(Object(Pn.i)("calypso_editor_sidebar_toggle_open"),Object(Pn.g)("Editor","Sidebar Toggle","open"),Object(Pn.a)("editor_actions","open-sidebar")),Object(Ts.b)("sidebar")))}},editorEditRawContent:ia.c,editorResetRawContent:ia.g})),Lc=Ac(Mc);function Bc(e){return e.params.post&&"new"!==e.params.post?parseInt(e.params.post,10):null}function Uc(e){return Object(v.startsWith)(e.path,"/post")?"post":Object(v.startsWith)(e.path,"/page")?"page":e.params.type}var Fc=function(e,t){var n,a=Uc(e),o=Bc(e),i=e.query.copy;function r(t){var n,r,l,c,d,p,h;if(!function(e){var t=Uc(e),n=Bc(e),a=e.store.getState(),o=Object(Z.e)(a);if(null===n){var i=Object(X.d)(a,o,t);if(i!==e.pathname)return e.querystring&&(i+="?"+e.querystring),s.a.redirect(i),!0}return!1}(e))if(i)e.store.dispatch(Object(E.m)(t,i));else if(o){var g=e.path;e.store.dispatch(Object(E.l)(t,o)).then(function(n){g===s.a.current&&n&&n.type&&n.type!==a&&s.a.redirect(Object(ae.e)(n,Object(ge.l)(e.store.getState(),t)))})}else{var v={type:a};if(e.query.url){var y=(n=e.query,r=n.text,l=n.url,c=n.title,d=n.image,p=n.embed,h=[],d&&h.push(u.a.renderToStaticMarkup(m.a.createElement("p",null,m.a.createElement("a",{href:l},m.a.createElement("img",{src:d}))))),Object(b.isWebUri)(p)&&h.push(u.a.renderToStaticMarkup(m.a.createElement("p",null,p))),r&&h.push(u.a.renderToStaticMarkup(m.a.createElement("blockquote",null,r))),h.push(u.a.renderToStaticMarkup(m.a.createElement("p",null,f.a.translate("via {{anchor/}}",{components:{anchor:m.a.createElement("a",{href:l},c)}})))),h.join("\n\n"));Object.assign(v,{format:"quote",title:e.query.title,content:y})}e.store.dispatch(Object(ia.m)(t,v))}}function l(){var t=Object(Z.e)(e.store.getState());return!!t&&(n&&n(),r(t),!0)}Object(y.b)(),l()||(n=e.store.subscribe(l));var d=function(e,t,n){var a="post"===e,o="page"===e,i=n||!t,s=!!t;return a&&i?["/post/:site","Post > New"]:a&&s?["/post/:site/:post_id","Post > Edit"]:o&&i?["/page/:site","Page > New"]:o&&s?["/page/:site/:post_id","Page > Edit"]:i?["/edit/"+e+"/:site","Custom Post Type > New"]:s?["/edit/"+e+"/:site/:post_id","Custom Post Type > Edit"]:void 0}(a,o,i),p=c()(d,2),h=p[0],g=p[1];!function(e,t){e.primary=m.a.createElement(Lc,t)}(e,{analyticsPath:h,analyticsTitle:g}),t()},qc=function(e,t){var n=Bc(e),a=Object(Z.e)(e.store.getState());a&&e.store.dispatch(Object(ia.o)(a,n)),t()},zc=function(e,t){if(e.getSiteSelectionHeaderText=function(){return f.a.translate("Select a site to start writing")},!e.query.url)return t();var n=Object(wa.b)(e.store.getState()),a=n.primarySiteSlug;if(!a)return t();var o=Object(j.b)(e.pathname,a),i=Object(g.stringify)(e.query),r=[o,i].join("?");return s.a.redirect(r),!1},Vc=n("./client/controller/index.web.js");t.default=function(){s()("/post",zc,r.d,r.e,Vc.c,Vc.f),s()("/post/new",function(){return s.a.redirect("/post")}),s()("/post/:site?/:post?",r.d,Fc,Vc.c,Vc.f),s.a.exit("/post/:site?/:post?",qc),s()("/page",r.d,r.e,Vc.c,Vc.f),s()("/page/new",function(){return s.a.redirect("/page")}),s()("/page/:site?/:post?",r.d,Fc,Vc.c,Vc.f),s.a.exit("/page/:site?/:post?",qc),Qt.a.isEnabled("manage/custom-post-types")&&(s()("/edit/:type",r.d,r.e,Vc.c,Vc.f),s()("/edit/:type/new",function(e){return s.a.redirect("/edit/"+e.params.type)}),s()("/edit/:type/:site?/:post?",r.d,Fc,Vc.c,Vc.f),s.a.exit("/edit/:type/:site?/:post?",qc))}},"./client/post-editor/media-modal/index.jsx":function(e,t,n){"use strict";n.r(t);var a=n("./node_modules/@babel/runtime/helpers/extends.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n("./node_modules/@babel/runtime/helpers/createClass.js"),l=n.n(r),c=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),d=n.n(c),u=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),p=n.n(u),m=n("./node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(m),f=n("./node_modules/react/index.js"),g=n.n(f),b=n("./node_modules/prop-types/index.js"),v=n.n(b),y=n("./node_modules/i18n-calypso/index.js"),E=n("./node_modules/react-redux/es/index.js"),j=n("./node_modules/lodash/lodash.js"),w=n("./client/my-sites/media-library/index.jsx"),_=n("./client/lib/analytics/index.js"),C=n("./client/state/posts/stats.js"),S=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),x=n.n(S),k=n("./client/components/header-cake/index.jsx"),I=n("./client/lib/media/store.js"),O=n("./client/my-sites/media-library/drop-zone.jsx"),T=n("./client/lib/media/library-selected-store.js"),P=n("./client/lib/media/actions.js"),D=n("./client/lib/media/utils.js"),N=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=d()(this,(e=p()(t)).call.apply(e,[this].concat(o))),n.filterDroppedImagesSelected=function(){var e=n.props.site;if(e){var t=T.a.getAll(e.ID),a=Object(D.d)(t,"image");Object(j.isEqual)(t,a)||(P.a.setLibrarySelectedItems(e.ID,a),n.props.onInvalidItemAdded())}},n}return h()(t,e),l()(t,[{key:"render",value:function(){return g.a.createElement(O.a,{site:this.props.site,onAddMedia:this.filterDroppedImagesSelected,fullScreen:!1})}}]),t}(g.a.Component);N.displayName="EditorMediaModalGalleryDropZone",N.propTypes={site:v.a.object,onInvalidItemAdded:v.a.func},N.defaultProps={onInvalidItemAdded:function(){}};var R=n("./client/post-editor/media-modal/fieldset.jsx"),M=n("./client/components/select-dropdown/index.jsx"),A=n("./client/components/select-dropdown/item.jsx"),L=n("./client/components/forms/form-checkbox/index.jsx"),B=n("./client/lib/media/constants.js"),U=n("./client/lib/site/utils.js"),F=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=d()(this,(e=p()(t)).call.apply(e,[this].concat(o))),n.getTypeOptions=function(){var e=n.props.site,t={individual:n.props.translate("Individual Images"),default:n.props.translate("Thumbnail Grid")};return!e||e.jetpack&&!Object(U.e)(e,"tiled-gallery")||Object(j.assign)(t,{rectangular:n.props.translate("Tiled Mosaic"),square:n.props.translate("Square Tiles"),circle:n.props.translate("Circles"),columns:n.props.translate("Tiled Columns")}),!e||e.jetpack&&!Object(U.e)(e,"shortcodes")||Object(j.assign)(t,{slideshow:n.props.translate("Slideshow")}),t},n.getLinkOptions=function(){return"individual"===n.props.settings.type?{}:{"":n.props.translate("Attachment Page"),file:n.props.translate("Media File"),none:n.props.translate("None")}},n.getSizeOptions=function(){return Object(j.includes)(B.c,n.props.settings.type)?{thumbnail:n.props.translate("Thumbnail"),medium:n.props.translate("Medium"),large:n.props.translate("Large"),full:n.props.translate("Full Size")}:{}},n.getColumnOptions=function(){var e=Math.min(n.props.numberOfItems,9);return Object(j.fromPairs)(Object(j.times)(e,function(e){return[e+1,(e+1).toString()]}))},n.updateRandomOrder=function(e){n.props.onUpdateSetting("orderBy",e.target.checked?"rand":null)},n.renderDropdown=function(e,t,a){var o=n.props,i=o.settings,s=o.onUpdateSetting;if(Object.keys(t).length)return g.a.createElement(R.a,{legend:e,className:"for-setting-"+a},g.a.createElement(M.a,{selectedText:t[i[a]]},Object.keys(t).map(function(e){var n=t[e];return g.a.createElement(A.a,{key:"value-"+e,selected:e===i[a],onClick:function(){return s(a,isFinite(parseInt(e))?+e:e)}},n)})))},n.renderColumnsOption=function(){if(Object(j.includes)(B.a,n.props.settings.type))return n.renderDropdown(n.props.translate("Columns"),n.getColumnOptions(),"columns")},n.renderRandomOption=function(){var e=n.props.settings;if("individual"!==e.type)return g.a.createElement(R.a,{legend:n.props.translate("Random Order")},g.a.createElement(L.a,{onChange:n.updateRandomOrder,checked:"rand"===e.orderBy}))},n}return h()(t,e),l()(t,[{key:"render",value:function(){var e=this.getTypeOptions(),t=this.getLinkOptions(),n=this.getSizeOptions();return g.a.createElement("div",{className:"editor-media-modal-gallery__fields"},this.renderDropdown(this.props.translate("Layout"),e,"type"),this.renderColumnsOption(),this.renderRandomOption(),this.renderDropdown(this.props.translate("Link To"),t,"link"),this.renderDropdown(this.props.translate("Size"),n,"size"))}}]),t}(g.a.Component);F.propTypes={site:v.a.object,settings:v.a.object,onUpdateSetting:v.a.func,numberOfItems:v.a.number},F.defaultProps={settings:Object.freeze({}),onUpdateSetting:j.noop,numberOfItems:0};var q=Object(y.localize)(F),z=n("./client/components/notice/index.jsx"),V=n("./client/components/segmented-control/index.jsx"),H=n("./client/components/segmented-control/item.jsx"),W=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),G=n.n(W),K=n("./client/components/ellipsis-menu/index.jsx"),Y=n("./client/components/popover/menu-item.jsx"),$=n("./client/components/forms/sortable-list/index.jsx"),J=n("./client/my-sites/media-library/list-item.jsx"),Q=n("./client/components/forms/form-text-input/index.jsx"),Z=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=d()(this,(e=p()(t)).call.apply(e,[this].concat(o))),n.state={caption:null},n.getValue=function(){return null!==n.state.caption?n.state.caption:n.props.item?n.props.item.caption:void 0},n.setCaption=function(e){n.setState({caption:e.target.value})},n.saveCaption=function(){var e=n.props,t=e.siteId,a=e.item;if(t&&a){var o=n.getValue();a&&o===a.caption||P.a.update(t,Object.assign({},a,{caption:o}))}},n}return h()(t,e),l()(t,[{key:"render",value:function(){return g.a.createElement(Q.a,{value:this.getValue(),placeholder:this.props.translate("Caption this imageâ€¦"),onChange:this.setCaption,onBlur:this.saveCaption,onMouseDown:function(e){return e.stopPropagation()},className:"editor-media-modal-gallery__caption"})}}]),t}(g.a.Component);Z.displayName="EditorMediaModalGalleryCaption",Z.propTypes={siteId:v.a.number,item:v.a.object};var X=Object(y.localize)(Z),ee=n("./node_modules/gridicons/dist/index.js"),te=n.n(ee),ne=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=d()(this,(e=p()(t)).call.apply(e,[this].concat(o))),n.remove=function(){var e=n.props,t=e.siteId,a=e.itemId;if(t&&a){var o=T.a.getAll(t),i=Object(j.reject)(o,function(e){return e.ID===a});P.a.setLibrarySelectedItems(t,i)}},n}return h()(t,e),l()(t,[{key:"render",value:function(){var e=this.props.translate;return g.a.createElement("button",{onClick:this.remove,onMouseDown:function(e){return e.stopPropagation()},className:"editor-media-modal-gallery__remove"},g.a.createElement("span",{className:"screen-reader-text"},e("Remove")),g.a.createElement(te.a,{icon:"cross"}))}}]),t}(f.PureComponent);ne.propTypes={siteId:v.a.number,itemId:v.a.number},ne.displayName="RemoveButton";var ae=Object(y.localize)(ne),oe=n("./client/state/selectors/can-current-user.js"),ie=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=d()(this,(e=p()(t)).call.apply(e,[this].concat(o))),n.renderCaption=function(){var e=n.props,t=e.site,a=e.item,o=e.canUserUploadFiles;if(o)return g.a.createElement(X,{siteId:t.ID,item:a})},n}return h()(t,e),l()(t,[{key:"render",value:function(){var e=this.props,t=e.site,n=e.item,a=e.showRemoveButton;return g.a.createElement("div",{className:"editor-media-modal-gallery__edit-item"},g.a.createElement(J.a,{media:n,scale:1,photon:!1}),this.renderCaption(),a&&g.a.createElement(ae,{siteId:t.ID,itemId:n.ID}))}}]),t}(f.Component);ie.propTypes={site:v.a.object,item:v.a.object,showRemoveButton:v.a.bool},ie.defaultProps={showRemoveButton:!0};var se=Object(E.b)(function(e,t){var n=t.site,a=void 0===n?{}:n,o=Object(oe.a)(e,a.ID,"upload_files");return{canUserUploadFiles:o}})(ie),re=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=d()(this,(e=p()(t)).call.apply(e,[this].concat(o))),n.onOrderChanged=function(e){var t=[];n.props.settings.items.forEach(function(n,a){t[e[a]]=n}),n.props.onUpdateSetting({items:t,orderBy:null})},n}return h()(t,e),l()(t,[{key:"render",value:function(){var e,t=this.props,n=t.onUpdateSetting,a=t.site,o=t.settings,i=t.translate;if(!a||!o.items)return null;var s=(e={},x()(e,i("Reverse order"),Object(j.reverse)(G()(o.items))),x()(e,i("Order alphabetically"),Object(j.sortBy)(o.items,"title")),x()(e,i("Order chronologically"),Object(j.sortBy)(o.items,"date")),e);return g.a.createElement("div",null,g.a.createElement(K.a,{popoverClassName:"gallery__order-popover",position:"bottom right"},Object(j.map)(s,function(e,t){return g.a.createElement(Y.a,{key:t,onClick:function(){return n({items:e})}},t)})),g.a.createElement($.a,{onChange:this.onOrderChanged},o.items.map(function(e){return g.a.createElement(se,{key:e.ID,site:a,item:e,showRemoveButton:o.items.length>1})})))}}]),t}(g.a.Component);re.propTypes={site:v.a.object,settings:v.a.object,onUpdateSetting:v.a.func},re.defaultProps={settings:Object.freeze({}),onUpdateSetting:j.noop};var le=Object(y.localize)(re),ce=n("./node_modules/create-react-class/index.js"),de=n.n(ce),ue=n("./node_modules/classnames/index.js"),pe=n.n(ue),me=n("./client/components/gallery-shortcode/index.jsx"),he=de()({displayName:"EditorMediaModalGalleryPreviewShortcode",propTypes:{siteId:v.a.number,settings:v.a.object},getInitialState:function(){return{isLoading:!0,shortcode:Object(D.e)(this.props.settings)}},componentWillReceiveProps:function(e){var t=Object(D.e)(e.settings);this.state.shortcode!==t&&this.setState({isLoading:!0,shortcode:t})},setLoaded:function(){this.isMounted()&&this.setState({isLoading:!1})},render:function(){var e=this.props,t=e.siteId,n=e.settings,a=this.state,o=a.isLoading,i=a.shortcode,s=pe()("editor-media-modal-gallery__preview-shortcode",{"is-loading":o||Object(j.some)(n.items,"transient")});return g.a.createElement("div",{className:s},g.a.createElement(me.a,{siteId:t,onLoad:this.setLoaded},i))}}),fe=n("./client/post-editor/media-modal/markup.js"),ge=n("./client/state/ui/selectors.js"),be=function(e){function t(){return s()(this,t),d()(this,p()(t).apply(this,arguments))}return h()(t,e),l()(t,[{key:"render",value:function(){var e=this,t=this.props.items.map(function(t){var n=fe.a.caption(e.props.site,t);return null===n?g.a.createElement("div",{key:t.ID,dangerouslySetInnerHTML:{__html:fe.a.get(e.props.site,t)}}):g.a.cloneElement(n,{key:t.ID})});return g.a.createElement("div",{className:"editor-media-modal-gallery__preview-individual"},g.a.createElement("div",{className:"editor-media-modal-gallery__preview-individual-content"},t))}}]),t}(g.a.Component);be.propTypes={items:v.a.arrayOf(v.a.object),site:v.a.object};var ve=Object(E.b)(function(e){return{site:Object(ge.d)(e)}})(be),ye=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=d()(this,(e=p()(t)).call.apply(e,[this].concat(o))),n.state={isEditing:!1},n}return h()(t,e),l()(t,[{key:"renderPreviewModeToggle",value:function(){var e=this,t=this.props.translate;return g.a.createElement(V.a,{className:"editor-media-modal-gallery__preview-toggle",compact:!0},g.a.createElement(H.a,{selected:!this.state.isEditing,onClick:function(){return e.setState({isEditing:!1})}},t("Preview")),g.a.createElement(H.a,{selected:this.state.isEditing,onClick:function(){return e.setState({isEditing:!0})}},t("Edit")))}},{key:"renderPreview",value:function(){var e=this.props,t=e.site,n=e.settings,a=e.onUpdateSetting;if(t&&n.items)return this.state.isEditing?g.a.createElement(le,{site:t,settings:n,onUpdateSetting:a}):"individual"===n.type?g.a.createElement(ve,{items:n.items}):g.a.createElement(he,{siteId:t.ID,settings:n})}},{key:"render",value:function(){var e=this.props.translate;return g.a.createElement("div",{className:"editor-media-modal-gallery__preview"},this.props.invalidItemDropped&&g.a.createElement(z.b,{status:"is-warning",onDismissClick:this.props.onDismissInvalidItemDropped,isCompact:!0},e("Galleries can only include images. All other uploads will be added to your media library.")),g.a.createElement("div",{className:"editor-media-modal-gallery__preview-wrapper"},this.renderPreview()),this.renderPreviewModeToggle())}}]),t}(f.Component);ye.propTypes={site:v.a.object,settings:v.a.object,onUpdateSetting:v.a.func,invalidItemDropped:v.a.bool,onDismissInvalidItemDropped:v.a.func},ye.defaultProps={settings:Object.freeze({}),onUpdateSetting:j.noop,invalidItemDropped:!1,onDismissInvalidItemDropped:j.noop},ye.displayName="EditorMediaModalGalleryPreview";var Ee=Object(y.localize)(ye),je=n("./client/state/ui/media-modal/constants.js"),we=n("./client/state/ui/editor/actions.js"),_e=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=d()(this,(e=p()(t)).call.apply(e,[this].concat(o))),n.state={invalidItemDropped:!1},n.reconcileSettingsItems=function(e,t){var a=e.items.filter(function(e){return Object(j.some)(t,{ID:e.ID})}).concat(t.filter(function(t){return!Object(j.some)(e.items,{ID:t.ID})})).map(function(e){return I.a.get(n.props.site.ID,e.ID)});Object(j.isEqual)(a,e.items)||n.updateSetting("items",a)},n.maybeUpdateColumnsSetting=function(){n.props.items.length<n.props.settings.columns&&n.updateSetting("columns",n.props.items.length)},n.setDefaultSettings=function(){var e=n.props,t=e.site,a=e.settings,o=e.items,i=e.onUpdateSettings;if(!a){var s=Object(j.assign)({},B.b,{items:o});!t||t.jetpack&&!Object(U.e)(t,"tiled-gallery")||(s.type="rectangular"),i(s)}},n.updateSetting=function(e,t){"string"==typeof e&&(e=x()({},e,t));var a=Object(j.assign)({},n.props.settings,e);a=Object(j.omitBy)(a,function(e){return null===e}),n.props.onUpdateSettings(a)},n}return h()(t,e),l()(t,[{key:"componentWillMount",value:function(){this.props.settings?(this.maybeUpdateColumnsSetting(),this.reconcileSettingsItems(this.props.settings,this.props.items)):this.setDefaultSettings()}},{key:"componentDidUpdate",value:function(e){this.props.settings&&(this.maybeUpdateColumnsSetting(),Object(j.isEqual)(e.items,this.props.items)||this.reconcileSettingsItems(this.props.settings,this.props.items))}},{key:"render",value:function(){var e=this,t=this.props,n=t.site,a=t.items,o=t.settings;return g.a.createElement("div",{className:"editor-media-modal-gallery"},g.a.createElement(N,{site:n,onInvalidItemAdded:function(){return e.setState({invalidItemDropped:!0})}}),g.a.createElement(k.a,{onClick:this.props.onReturnToList,backText:this.props.translate("Media Library")}),g.a.createElement("div",{className:"editor-media-modal-gallery__content editor-media-modal__content"},g.a.createElement(Ee,{site:n,items:a,settings:o,onUpdateSetting:this.updateSetting,invalidItemDropped:this.state.invalidItemDropped,onDismissInvalidItemDropped:function(){return e.setState({invalidItemDropped:!1})}}),g.a.createElement("div",{className:"editor-media-modal-gallery__sidebar"},g.a.createElement(q,{site:n,settings:o,onUpdateSetting:this.updateSetting,numberOfItems:a.length}))))}}]),t}(g.a.Component);_e.propTypes={site:v.a.object,items:v.a.array,settings:v.a.object,onUpdateSettings:v.a.func,onReturnToList:v.a.func},_e.defaultProps={onUpdateSettings:j.noop};var Ce=Object(E.b)(null,{onReturnToList:Object(j.partial)(we.l,je.a.LIST)})(Object(y.localize)(_e)),Se=n("./client/components/dialog/index.jsx"),xe=n("./client/components/close-on-escape/index.jsx"),ke=n("./client/lib/accept/index.js"),Ie=n("./client/state/ui/media-modal/selectors.js"),Oe=n("./client/state/sites/selectors.js"),Te=n("./client/state/ui/editor/selectors.js"),Pe=n("./client/state/ui/media-modal/actions.js"),De=n("./client/state/media/actions.js"),Ne=n("./client/blocks/image-editor/index.jsx"),Re=n("./client/blocks/video-editor/index.jsx"),Me=n("./client/post-editor/media-modal/detail/index.jsx"),Ae=n("./client/state/analytics/actions.js");function Le(e,t,n){return!n(t)||Object(j.some)(t,function(t){return D.k(t)&&("image"!==D.g(t)||!D.o(t)||e===je.a.GALLERY)})}n.d(t,"EditorMediaModal",function(){return Be});var Be=function(e){function t(e){var n;return s()(this,t),n=d()(this,p()(t).call(this,e)),n.confirmSelection=function(){var e=n.props,t=e.view,a=e.mediaLibrarySelectedItems;if(!Le(t,a,n.props.isParentReady))if(a.length&&""!==n.state.source){var o=a.map(function(e){return Object.assign({},e,{ID:Object(j.uniqueId)("media-"),transient:!0})});1===o.length&&"image"===D.g(o[0])?(n.copyExternal(o,n.state.source),n.props.onClose({type:"media",items:o})):n.copyExternalAfterLoadingWordPressLibrary(o,n.state.source)}else{var i=a.length?{type:je.a.GALLERY===t?"gallery":"media",items:a,settings:n.state.gallerySettings}:void 0;n.props.onClose(i)}},n.setDetailSelectedIndex=function(e){n.setState({detailSelectedIndex:e})},n.confirmDeleteMedia=function(e){var t=n.props,a=t.site,o=t.mediaLibrarySelectedItems;if(a&&e){var i=o;je.a.DETAIL===n.props.view&&(i=i[n.getDetailSelectedIndex()],n.setNextAvailableDetailView()),P.a.delete(a.ID,i),_.default.mc.bumpStat("editor_media_actions","delete_media"),n.props.deleteMedia(a.ID,Object(j.map)(i,"ID"))}},n.deleteMedia=function(){var e,t=n.props,a=t.view,o=t.mediaLibrarySelectedItems,i=t.translate;e=je.a.DETAIL===a?1:o.length;var s=i("Are you sure you want to delete this item? Deleted media will no longer appear anywhere on your website, including all posts, pages, and widgets. This cannot be undone.","Are you sure you want to delete these items? Deleted media will no longer appear anywhere on your website, including all posts, pages, and widgets. This cannot be undone.",{count:e});Object(ke.a)(s,n.confirmDeleteMedia,i("Delete"),null,{isScary:!0})},n.onAddMedia=function(){n.props.recordEditorStat("media_explorer_upload"),n.props.recordEditorEvent("Upload Media")},n.onAddAndEditImage=function(){P.a.setLibrarySelectedItems(n.props.site.ID,[]),n.props.setView(je.a.IMAGE_EDITOR)},n.restoreOriginalMedia=function(e,t){e&&t&&(P.a.update(e,{ID:t.ID,media_url:t.guid},!0),n.props.onRestoreMediaHook())},n.onImageEditorDone=function(e,t,a){if(e)n.onImageEditorCancel(a);else{var o=a.fileName,i=a.site,s=a.ID,r=a.resetAllImageEditorState,l=a.width,c=a.height,d=D.h(o),u=Object.assign({ID:s,media:{fileName:o,fileContents:t,mimeType:d}},l&&{width:l},c&&{height:c});P.a.update(i.ID,u,!0),r(),n.props.setView(je.a.DETAIL),n.props.onImageEditorDoneHook()}},n.handleUpdatePoster=function(e){var t=e.ID,a=e.posterUrl,o=n.props.site,i=(a||"").split("?")[0];o&&P.a.edit(o.ID,{ID:t,thumbnails:{fmt_hd:i,fmt_dvd:i,fmt_std:i}}),n.props.setView(je.a.DETAIL)},n.handleCancel=function(){var e=n.props.mediaLibrarySelectedItems,t=e[n.getDetailSelectedIndex()];t?n.props.setView(je.a.DETAIL):n.props.setView(je.a.LIST)},n.onImageEditorCancel=function(e){var t=e.resetAllImageEditorState;n.handleCancel(),t()},n.onFilterChange=function(e){e!==n.state.filter&&_.default.mc.bumpStat("editor_media_actions","filter_"+(e||"all")),n.setState({filter:e})},n.onScaleChange=function(){n.statsTracking.scale||(_.default.mc.bumpStat("editor_media_actions","scale"),n.statsTracking.scale=!0)},n.onSearch=function(e){n.setState({search:e||void 0}),n.statsTracking.search||(_.default.mc.bumpStat("editor_media_actions","search"),n.statsTracking.search=!0)},n.onSourceChange=function(e){P.a.sourceChanged(n.props.site.ID),n.setState({source:e,search:void 0})},n.onClose=function(){n.props.onClose()},n.editItem=function(e){var t=n.props,a=t.site,o=t.mediaLibrarySelectedItems,i=t.single;if(a){var s=o;s.some(function(t){return t.ID===e.ID})||(s=i?[e]:s.concat(e),P.a.setLibrarySelectedItems(a.ID,s)),n.setDetailSelectedIndex(Object(j.findIndex)(s,{ID:e.ID})),_.default.mc.bumpStat("editor_media_actions","edit_button_contextual"),_.default.ga.recordEvent("Media","Clicked Contextual Edit Button"),n.props.setView(je.a.DETAIL)}},n.updateSettings=function(e){n.setState({gallerySettings:e})},n.state=n.getDefaultState(e),n}return h()(t,e),l()(t,[{key:"componentWillReceiveProps",value:function(e){e.site&&this.props.visible&&!e.visible&&P.a.setLibrarySelectedItems(e.site.ID,[]),this.props.visible!==e.visible&&(e.visible?(this.setState(this.getDefaultState(e)),e.source&&this.state.source!==e.source&&e.site&&P.a.sourceChanged(e.site.ID)):this.props.resetView())}},{key:"componentDidMount",value:function(){this.statsTracking={}}},{key:"componentWillMount",value:function(){var e=this.props,t=e.view,n=e.mediaLibrarySelectedItems,a=e.site,o=e.single;Object(j.isEmpty)(n)||t!==je.a.LIST&&!o||P.a.setLibrarySelectedItems(a.ID,[])}},{key:"componentWillUnmount",value:function(){this.props.resetView(),P.a.setLibrarySelectedItems(this.props.site.ID,[])}},{key:"getDefaultState",value:function(e){return{filter:"",detailSelectedIndex:0,source:e.source?e.source:"",gallerySettings:e.initialGallerySettings}}},{key:"copyExternalAfterLoadingWordPressLibrary",value:function(e,t){var n=this.props.site;P.a.sourceChanged(n.ID),this.setState({source:"",search:void 0},function(){P.a.setQuery(n.ID,{}),P.a.addExternal(n,e,t)})}},{key:"copyExternal",value:function(e,t){var n=this.props.site,a=!!this.state.search;a&&this.setState({search:""}),P.a.addExternal(n,e,t),a&&P.a.setQuery(n.ID,{})}},{key:"setNextAvailableDetailView",value:function(){1===this.props.mediaLibrarySelectedItems.length?this.props.setView(je.a.LIST):this.getDetailSelectedIndex()===this.props.mediaLibrarySelectedItems.length-1&&this.setDetailSelectedIndex(Math.max(this.getDetailSelectedIndex()-1,0))}},{key:"getDetailSelectedIndex",value:function(){var e=this.props.mediaLibrarySelectedItems,t=this.state.detailSelectedIndex;return t>=e.length?0:t}},{key:"getFirstEnabledFilter",value:function(){if(this.props.enabledFilters)return Object(j.head)(this.props.enabledFilters)}},{key:"getModalButtons",value:function(){var e=this;if(!Object(j.includes)([je.a.IMAGE_EDITOR,je.a.VIDEO_EDITOR],this.props.view)){var t,n=this.props.mediaLibrarySelectedItems,a=this.props.galleryViewEnabled,o=Le(this.props.view,n,this.props.isParentReady),i=[{action:"cancel",label:this.props.translate("Cancel")}];return""!==this.state.source?i.push({action:"confirm",label:this.props.labels.confirm||(t=e.props.translate("Insert"),(n.length>1||1===n.length&&"image"!==D.g(n[0]))&&(t=e.props.translate("Copy to media library")),t),isPrimary:!0,disabled:o||0===n.length,onClick:this.confirmSelection}):je.a.GALLERY!==this.props.view&&n.length>1&&a&&!Object(j.some)(n,function(e){return"image"!==D.g(e)})?i.push({action:"confirm",label:this.props.translate("Continue"),isPrimary:!0,disabled:o||!this.props.site,onClick:Object(j.partial)(this.props.setView,je.a.GALLERY)}):i.push({action:"confirm",label:this.props.labels.confirm||this.props.translate("Insert"),isPrimary:!0,disabled:o||0===n.length,onClick:this.confirmSelection}),i}}},{key:"shouldClose",value:function(){return!Object(j.includes)([je.a.IMAGE_EDITOR,je.a.VIDEO_EDITOR],this.props.view)}},{key:"renderContent",value:function(){var e;switch(this.props.view){case je.a.DETAIL:e=g.a.createElement(Me.b,{site:this.props.site,items:this.props.mediaLibrarySelectedItems,selectedIndex:this.getDetailSelectedIndex(),onRestoreItem:this.restoreOriginalMedia,onSelectedIndexChange:this.setDetailSelectedIndex});break;case je.a.GALLERY:e=g.a.createElement(Ce,{site:this.props.site,items:this.props.mediaLibrarySelectedItems,settings:this.state.gallerySettings,onUpdateSettings:this.updateSettings});break;case je.a.IMAGE_EDITOR:var t=this.props,n=t.site,a=t.imageEditorProps,i=t.mediaLibrarySelectedItems,s=this.getDetailSelectedIndex(),r=Object(j.get)(i,s,null);e=g.a.createElement(Ne.a,o()({siteId:Object(j.get)(n,"ID"),media:r,onDone:this.onImageEditorDone,onCancel:this.onImageEditorCancel},a));break;case je.a.VIDEO_EDITOR:var l=this.props.mediaLibrarySelectedItems,c=this.getDetailSelectedIndex(),d=Object(j.get)(l,c,null);e=g.a.createElement(Re.a,{media:d,onCancel:this.handleCancel,onUpdatePoster:this.handleUpdatePoster});break;default:e=g.a.createElement(w.a,{site:this.props.site,filter:this.state.filter||this.props.defaultFilter||this.getFirstEnabledFilter(),enabledFilters:this.props.enabledFilters,search:this.state.search,source:this.state.source,onAddMedia:this.onAddMedia,onAddAndEditImage:this.onAddAndEditImage,onFilterChange:this.onFilterChange,onScaleChange:this.onScaleChange,onSourceChange:this.onSourceChange,onSearch:this.onSearch,onEditItem:this.editItem,fullScreenDropZone:!1,single:this.props.single,onDeleteItem:this.deleteMedia,onViewDetails:this.props.onViewDetails,mediaLibrarySelectedItems:this.props.mediaLibrarySelectedItems,postId:this.props.postId,disableLargeImageSources:this.props.disableLargeImageSources,disabledDataSources:this.props.disabledDataSources,scrollable:!0})}return e}},{key:"render",value:function(){return g.a.createElement(Se.a,{isVisible:this.props.visible,buttons:this.getModalButtons(),onClose:this.onClose,additionalClassNames:"editor-media-modal",isBackdropVisible:this.props.isBackdropVisible,shouldCloseOnOverlayClick:this.shouldClose(),shouldCloseOnEsc:!1},g.a.createElement(xe.a,{onEscape:this.onClose}),this.renderContent())}}]),t}(f.Component);Be.propTypes={visible:v.a.bool,mediaLibrarySelectedItems:v.a.arrayOf(v.a.object),onClose:v.a.func,isBackdropVisible:v.a.bool,isParentReady:v.a.func,site:v.a.object,siteId:v.a.number,labels:v.a.object,single:v.a.bool,defaultFilter:v.a.string,enabledFilters:v.a.arrayOf(v.a.string),view:v.a.oneOf(Object(j.values)(je.a)),galleryViewEnabled:v.a.bool,setView:v.a.func,resetView:v.a.func,postId:v.a.number,disableLargeImageSources:v.a.bool,disabledDataSources:v.a.arrayOf(v.a.string),onImageEditorDoneHook:v.a.func,onRestoreMediaHook:v.a.func},Be.defaultProps={visible:!1,mediaLibrarySelectedItems:Object.freeze([]),onClose:j.noop,isBackdropVisible:!0,isParentReady:function(){return!0},labels:Object.freeze({}),setView:j.noop,resetView:j.noop,translate:j.identity,view:je.a.LIST,galleryViewEnabled:!0,imageEditorProps:{},deleteMedia:function(){},disableLargeImageSources:!1,disabledDataSources:[],onImageEditorDoneHook:j.noop,onRestoreMediaHook:j.noop};t.default=Object(E.b)(function(e,t){var n=t.site,a=t.siteId;return{view:Object(Ie.a)(e),site:n||Object(Oe.l)(e,a),postId:Object(Te.f)(e)}},{setView:we.l,resetView:Pe.a,deleteMedia:De.a,onViewDetails:Object(j.flow)(Object(Ae.k)(Object(Ae.a)("editor_media_actions","edit_button_dialog")),Object(Ae.k)(Object(Ae.g)("Media","Clicked Dialog Edit Button")),Object(j.partial)(we.l,je.a.DETAIL)),recordEditorEvent:C.a,recordEditorStat:C.b})(Object(y.localize)(Be))},"./client/post-editor/media-modal/markup.js":function(e,t,n){"use strict";var a=n("./node_modules/lodash/lodash.js"),o=n("./node_modules/react-dom/server.browser.js"),i=n.n(o),s=n("./node_modules/react/index.js"),r=n.n(s),l=n("./node_modules/classnames/index.js"),c=n.n(l),d=n("./client/lib/shortcode/index.js"),u=n("./client/lib/media/utils.js"),p=n("./client/lib/media-serialization/index.js"),m={get:function(e,t,n){if(!t||t.hasOwnProperty("status"))return"";var a=u.g(t);return a&&"function"==typeof m.mimeTypes[a]?m.mimeTypes[a](e,t,n):m.link(t)},link:function(e){var t=r.a.createElement("a",{href:e.URL,title:e.title},e.title);return i.a.renderToStaticMarkup(t)},
/**
   * Given a media object or markup string and a site, returns a caption React element.
   *
   * Adapted from WordPress.
   *
   * @copyright 2015 by the WordPress contributors.
   * @license See CREDITS.md.
   * @see https://github.com/WordPress/WordPress/blob/4.3/wp-includes/js/tinymce/plugins/wpeditimage/plugin.js#L97-L157
   *
   * @param  {Object} site           A site object
   * @param  {(Object|String)} media A media object or markup string
   * @return {String}                A caption React element, or null if not
   *                                 a captioned item.
   */
caption:function(e,t){var n,a,o;"string"!=typeof t&&(t=m.get(e,t));var i=Object(d.b)(t);if(!i||!i.content)return null;var s=i.content.match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i);return s&&(n=s[1].trim(),a=s[2].trim()),o=i.attrs.named.width,o||(o=Object(p.a)(n).width),r.a.createElement("dl",{className:c()("wp-caption",i.attrs.named.align,i.attrs.named.classes),style:{width:parseInt(o,10)}},r.a.createElement("dt",{className:"wp-caption-dt",dangerouslySetInnerHTML:{__html:n}}),r.a.createElement("dd",{className:"wp-caption-dd"},a))},mimeTypes:{image:function(e,t,n){var o,s,l;if(n=Object(a.assign)({size:"full",align:"none",forceResize:!1},n),"full"===n.size)o=t.width,s=t.height;else{var p=u.i(n.size,e),m=Math.min(p.width/t.width||1/0,p.height/t.height||1/0);o=Math.round(t.width*m),s=Math.round(t.height*m)}l=n.forceResize||e&&!e.jetpack&&o&&o!==t.width?{maxWidth:o}:{size:n.size};var h=r.a.createElement("img",{src:u.s(t,l),alt:t.alt||t.title,width:isFinite(o)?o:null,height:isFinite(s)?s:null,className:c()("align"+n.align,"size-"+n.size,"wp-image-"+t.ID),"data-istransient":t.transient?"istransient":null}),f=i.a.renderToStaticMarkup(h);return t.caption&&o&&(f=Object(d.c)({tag:"caption",attrs:{id:"attachment_"+t.ID,width:o},content:[f,t.caption].join(" ")})),f},audio:function(e,t){return Object(d.c)({tag:"audio",attrs:{src:t.URL}})},video:function(e,t){return u.p(t)?Object(d.c)({tag:"wpvideo",attrs:[t.videopress_guid],type:"single"}):Object(d.c)({tag:"video",attrs:{src:t.URL,height:t.height,width:t.width}})}}};t.a=m},"./client/state/plugins/installed/actions.js":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/helpers/objectSpread.js"),o=n.n(a),i=n("./client/lib/wp/browser.js"),s="INSTALL_PLUGIN",r="UPDATE_PLUGIN",l="ACTIVATE_PLUGIN";n.d(t,"a",function(){return d}),n.d(t,"d",function(){return u}),n.d(t,"c",function(){return m}),n.d(t,"b",function(){return h});var c=function(e,t){var n=i.a.site(e);return n.plugin(t)};function d(e,t){return function(n){var a=t.id,i={action:l,siteId:e,pluginId:a};n(o()({},i,{type:"PLUGIN_ACTIVATE_REQUEST"}));var s=function(e){n(o()({},i,{type:"PLUGIN_ACTIVATE_REQUEST_SUCCESS",data:e}))};return c(e,a).activate().then(s).catch(function(e){e&&"activation_error"===e.error&&s(t),n(o()({},i,{type:"PLUGIN_ACTIVATE_REQUEST_FAILURE",error:e}))})}}function u(e,t){return function(n){if(!t.update)return Promise.reject("Error: Plugin already up-to-date.");var a=t.id,i={action:r,siteId:e,pluginId:a};n(o()({},i,{type:"PLUGIN_UPDATE_REQUEST"}));return c(e,a).updateVersion().then(function(e){n(o()({},i,{type:"PLUGIN_UPDATE_REQUEST_SUCCESS",data:e}))}).catch(function(e){n(o()({},i,{type:"PLUGIN_UPDATE_REQUEST_FAILURE",error:e}))})}}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(a){var i=t.id,r={action:s,siteId:e,pluginId:i};a(o()({},r,{type:"PLUGIN_INSTALL_REQUEST"}));var l=function(t){return c(e,t.slug).install()},d=function(t){return c(e,t.id).activate()},u=function(t){return c(e,t.id).updateVersion()},p=function(t){return c(e,t.id).enableAutoupdate()},m=function(e){a(o()({},r,{type:"PLUGIN_INSTALL_REQUEST_SUCCESS",data:e}))},h=function e(i){return"PluginAlreadyInstalledError"===i.name?n?u(t).then(p).then(m).catch(e):u(t).then(d).then(p).then(m).catch(e):"ActivationErrorError"===i.name?u(t).then(p).then(m).catch(e):(a(o()({},r,{type:"PLUGIN_INSTALL_REQUEST_FAILURE",error:i})),Promise.reject(i))};return n?l(t).then(p).then(m).catch(h):l(t).then(d).then(p).then(m).catch(h)}}function m(e,t){return p(e,t)}function h(e){return function(t){return e.map(function(e){var n={siteId:e};t(o()({},n,{type:"PLUGINS_REQUEST"}));return i.a.site(e).pluginsList().then(function(a){t(o()({},n,{type:"PLUGINS_RECEIVE",data:a.plugins})),t(o()({},n,{type:"PLUGINS_REQUEST_SUCCESS"})),a.plugins.map(function(n){n.update&&n.autoupdate&&u(e,n)(t)})}).catch(function(e){t(o()({},n,{type:"PLUGINS_REQUEST_FAILURE",error:e}))})})}}},"./client/state/plugins/installed/selectors.js":function(e,t,n){"use strict";n.d(t,"g",function(){return c}),n.d(t,"f",function(){return d}),n.d(t,"h",function(){return u}),n.d(t,"b",function(){return p}),n.d(t,"c",function(){return m}),n.d(t,"a",function(){return h}),n.d(t,"d",function(){return f}),n.d(t,"e",function(){return g});var a=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=n.n(a),i=n("./node_modules/@babel/runtime/helpers/objectSpread.js"),s=n.n(i),r=n("./node_modules/lodash/lodash.js"),l=(n("./client/state/sites/selectors.js"),{none:function(){return!1},all:function(){return!0},active:function(e){return Object(r.some)(e.sites,function(e){return e.active})},inactive:function(e){return Object(r.some)(e.sites,function(e){return!e.active})},updates:function(e){return Object(r.some)(e.sites,function(e){return e.update})},isEqual:function(e,t){return t.slug===e}});function c(e,t){return void 0!==e.plugins.installed.isRequesting[t]&&e.plugins.installed.isRequesting[t]}function d(e,t){return!1===e.plugins.installed.isRequesting[t]}function u(e,t){return Object(r.some)(t,function(t){return c(e,t)})}function p(e,t,n){var a=Object(r.reduce)(t,function(t,n){var a=e.plugins.installed.plugins[n]||[];return a.forEach(function(e){var a=Object(r.pick)(e,["active","autoupdate","update"]);t[e.slug]?t[e.slug].sites=s()({},t[e.slug].sites,o()({},n,a)):t[e.slug]=s()({},e,{sites:o()({},n,a)})}),t},{});return n&&l[n]&&(a=Object(r.filter)(a,l[n])),Object(r.values)(Object(r.sortBy)(a,function(e){return e.slug.toLowerCase()}))}function m(e,t){return Object(r.filter)(p(e,t),l.updates).map(function(e){return s()({},e,{version:e.update.new_version,type:"plugin"})})}function h(e,t,n){var a=p(e,[t]);return Object(r.find)(a,{slug:n})}function f(e,t,n){if(void 0===e.plugins.installed.status[t])return!1;if(void 0===e.plugins.installed.status[t][n])return!1;var a=e.plugins.installed.status[t][n];return Object.assign({},a,{siteId:t,pluginId:n})}function g(e,t){return void 0!==e.plugins.installed.status[t]&&e.plugins.installed.status[t]}},"./client/state/post-types/taxonomies/selectors.js":function(e,t,n){"use strict";n.d(t,"c",function(){return o}),n.d(t,"a",function(){return i}),n.d(t,"b",function(){return s});var a=n("./node_modules/lodash/lodash.js");function o(e,t,n){return Object(a.get)(e.postTypes.taxonomies.requesting,[t,n],!1)}function i(e,t,n){return Object(a.get)(e.postTypes.taxonomies.items,[t,n],null)}function s(e,t,n,o){var s=i(e,t,n);return Object(a.find)(s,{name:o})||null}},"./client/state/selectors/get-current-locale-slug.js":function(e,t,n){"use strict";var a=n("./node_modules/lodash/lodash.js"),o=n("./client/lib/create-selector/index.js"),i=Object(o.a)(function(e){return Object(a.get)(e,"ui.language.localeSlug",null)},function(e){return e.ui.language});t.a=i},"./client/state/selectors/get-simple-payments.js":function(e,t,n){"use strict";var a=n("./node_modules/lodash/lodash.js"),o=n("./client/lib/create-selector/index.js");t.a=Object(o.a)(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return null;var o=Object(a.get)(e,"simplePayments.productList.items."+t,null);if(!o)return null;if(!n)return Object(a.orderBy)(o,"ID","desc");var i=Object(a.find)(o,function(e){return e.ID===n});return i||null},function(e){return e.simplePayments.productList.items})},"./client/state/selectors/has-broken-site-user-connection.js":function(e,t,n){"use strict";n.d(t,"a",function(){return i});var a=n("./node_modules/lodash/lodash.js"),o=n("./client/state/sharing/publicize/selectors.js");function i(e,t,n){return Object(a.some)(Object(o.c)(e,t,n),{status:"broken"})}},"./client/state/selectors/is-drop-zone-visible.js":function(e,t,n){"use strict";n.d(t,"a",function(){return o});var a=n("./node_modules/lodash/lodash.js");function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(a.get)(e,["ui","dropZone","isVisible",t],!1)}},"./client/state/ui/editor/image-editor/actions.js":function(e,t,n){"use strict";function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:"IMAGE_EDITOR_STATE_RESET",additionalData:e}}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:"IMAGE_EDITOR_STATE_RESET_ALL",additionalData:e}}function i(){return{type:"IMAGE_EDITOR_ROTATE_COUNTERCLOCKWISE"}}function s(){return{type:"IMAGE_EDITOR_FLIP"}}function r(e){return{type:"IMAGE_EDITOR_SET_ASPECT_RATIO",ratio:e}}function l(e){return{type:"IMAGE_EDITOR_SET_DEFAULT_ASPECT_RATIO",ratio:e}}function c(e,t,n,a){return{type:"IMAGE_EDITOR_SET_FILE_INFO",src:e,fileName:t,mimeType:n,title:a}}function d(e,t,n,a){return{type:"IMAGE_EDITOR_SET_CROP_BOUNDS",topBound:e,leftBound:t,bottomBound:n,rightBound:a}}function u(e,t,n,a){return{type:"IMAGE_EDITOR_COMPUTED_CROP",topRatio:e,leftRatio:t,widthRatio:n,heightRatio:a}}function p(e,t,n,a){return{type:"IMAGE_EDITOR_CROP",topRatio:e,leftRatio:t,widthRatio:n,heightRatio:a}}function m(e,t){return{type:"IMAGE_EDITOR_IMAGE_HAS_LOADED",width:e,height:t}}n.d(t,"f",function(){return a}),n.d(t,"e",function(){return o}),n.d(t,"d",function(){return i}),n.d(t,"c",function(){return s}),n.d(t,"g",function(){return r}),n.d(t,"i",function(){return l}),n.d(t,"j",function(){return c}),n.d(t,"h",function(){return d}),n.d(t,"a",function(){return u}),n.d(t,"b",function(){return p}),n.d(t,"k",function(){return m})},"./client/state/ui/editor/image-editor/selectors.js":function(e,t,n){"use strict";function a(e){return e.ui.editor.imageEditor.transform}function o(e){return e.ui.editor.imageEditor.fileInfo}function i(e){return e.ui.editor.imageEditor.hasChanges}function s(e){return!e.ui.editor.imageEditor.imageIsLoading}function r(e){return e.ui.editor.imageEditor.cropBounds}function l(e){return e.ui.editor.imageEditor.crop}function c(e){return e.ui.editor.imageEditor.aspectRatio}n.d(t,"e",function(){return a}),n.d(t,"d",function(){return o}),n.d(t,"f",function(){return i}),n.d(t,"g",function(){return s}),n.d(t,"c",function(){return r}),n.d(t,"b",function(){return l}),n.d(t,"a",function(){return c})},"./client/state/users/suggestions/selectors.js":function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return i});var a=n("./node_modules/lodash/lodash.js");function o(e,t){return Object(a.get)(e.users.suggestions.requesting,[t],!1)}function i(e,t){return Object(a.get)(e.users.suggestions.items,[t],[])}}}]);